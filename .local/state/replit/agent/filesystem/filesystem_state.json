{"file_contents":{"CONFIGURACAO_BANCO.md":{"content":"# üìã Guia de Configura√ß√£o do Banco de Dados - RotaF√°cil\n\n## ‚úÖ Resumo das Configura√ß√µes Realizadas\n\nSua aplica√ß√£o j√° est√° configurada para usar vari√°veis de ambiente. **N√£o h√° mais strings de conex√£o fixas no c√≥digo.**\n\n## üîß Arquivos Principais Configurados\n\n### 1. **server/db.ts** - Conex√£o Principal\n```typescript\n// üóÑÔ∏è CONFIGURA√á√ÉO OBRIGAT√ìRIA: DATABASE_URL deve estar definido nas vari√°veis de ambiente\n// Esta √© a string de conex√£o completa com seu banco PostgreSQL\n// Formato: postgresql://usuario:senha@host:porta/nome_do_banco\n// Exemplo: postgresql://user:password@localhost:5432/rotafacil\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set in environment variables. This should be your PostgreSQL connection string.\"\n  );\n}\n```\n\n### 2. **server/routes.ts** - Autentica√ß√£o JWT\n```typescript\n// üîê CONFIGURA√á√ÉO OBRIGAT√ìRIA: JWT_SECRET deve estar definido nas vari√°veis de ambiente\n// Esta chave √© usada para assinar e verificar tokens de autentica√ß√£o\nif (!process.env.JWT_SECRET) {\n  throw new Error(\n    \"JWT_SECRET must be set in environment variables. Generate a secure random string (32+ characters) for production.\"\n  );\n}\n```\n\n### 3. **drizzle.config.ts** - Migra√ß√µes do Banco\n- J√° configurado para usar `process.env.DATABASE_URL`\n- Usado pelo comando `npm run db:push` para aplicar mudan√ßas no schema\n\n## üéØ Vari√°veis de Ambiente Necess√°rias\n\nCopie o arquivo `.env.example` para `.env` e configure:\n\n### Para **Supabase** (Recomendado):\n```bash\nDATABASE_URL=postgresql://postgres:[SUA-SENHA]@db.[SEU-PROJETO].supabase.co:5432/postgres\nJWT_SECRET=sua_chave_secreta_muito_segura_aqui_32_caracteres_minimo\n```\n\n### Para **Railway**:\n```bash\nDATABASE_URL=postgresql://postgres:[SENHA]@[HOST].railway.app:[PORTA]/railway\nJWT_SECRET=sua_chave_secreta_muito_segura_aqui_32_caracteres_minimo\n```\n\n### Para **Banco Local**:\n```bash\nDATABASE_URL=postgresql://usuario:senha@localhost:5432/rotafacil\nJWT_SECRET=sua_chave_secreta_muito_segura_aqui_32_caracteres_minimo\n```\n\n## üöÄ Como Trocar de Banco\n\n1. **Pare a aplica√ß√£o** (se estiver rodando)\n2. **Configure a nova DATABASE_URL** no seu ambiente\n3. **Execute as migra√ß√µes**: `npm run db:push`\n4. **Reinicie a aplica√ß√£o**: `npm run dev`\n\n## ‚ö° Comandos √öteis\n\n```bash\n# Aplicar mudan√ßas no schema do banco\nnpm run db:push\n\n# Iniciar aplica√ß√£o em desenvolvimento\nnpm run dev\n\n# Gerar uma chave JWT segura (Linux/Mac)\nopenssl rand -hex 32\n```\n\n## üîí Seguran√ßa\n\n- **NUNCA** commite arquivos `.env` no Git\n- A chave JWT deve ter pelo menos 32 caracteres\n- Use sempre conex√µes SSL em produ√ß√£o (`?sslmode=require`)\n\n## ‚úÖ Status Atual\n\n- ‚úÖ Todas as strings de conex√£o removidas do c√≥digo\n- ‚úÖ Configura√ß√µes movidas para vari√°veis de ambiente\n- ‚úÖ Coment√°rios explicativos adicionados\n- ‚úÖ Arquivo de exemplo criado (.env.example)\n- ‚úÖ Valida√ß√µes de seguran√ßa implementadas","size_bytes":2939},"README.md":{"content":"# Corre√ß√£o do Formul√°rio de Equipes - TeamForm\n\n## Problema Identificado\n\nDurante o desenvolvimento, identificamos que o formul√°rio para gerenciar equipes estava com problemas no bot√£o de atualiza√ß√£o. A a√ß√£o de atualiza√ß√£o n√£o estava funcionando corretamente, e o formul√°rio estava incompleto ou n√£o pr√©-preenchido com os dados existentes.\n\n## Solu√ß√µes Implementadas\n\n### 1. Bot√£o de Atualiza√ß√£o (Submit)\n\nO bot√£o de atualiza√ß√£o no formul√°rio foi corrigido para garantir que ele apenas atue quando necess√°rio. Antes, o bot√£o estava criando novas equipes ao inv√©s de atualizar as existentes.\n\nA l√≥gica para lidar com a cria√ß√£o e atualiza√ß√£o de equipes foi ajustada, garantindo que:\n\n- O bot√£o de **Atualizar** s√≥ ser√° exibido quando o formul√°rio for usado para editar uma equipe existente\n- O bot√£o de **Criar** aparece quando uma nova equipe for criada\n- O `type=\"submit\"` foi aplicado corretamente apenas no bot√£o principal\n- O bot√£o \"Cancelar\" recebeu `type=\"button\"` para evitar submiss√µes acidentais\n\n### 2. Formul√°rio de Equipe (TeamForm)\n\nO formul√°rio foi modificado para garantir que a equipe seja corretamente pr√©-preenchida com os dados existentes quando o formul√°rio for usado para editar uma equipe. As equipes agora t√™m os dados j√° preenchidos, como nome, t√©cnicos e servi√ßos.\n\n**Principais melhorias:**\n- Pr√©-preenchimento autom√°tico dos dados da equipe\n- Carregamento correto dos membros existentes\n- Sele√ß√£o pr√©via dos servi√ßos associados\n- Valida√ß√£o adequada dos campos obrigat√≥rios\n\n### 3. Refatora√ß√£o das Muta√ß√µes\n\nO formul√°rio foi refatorado para seguir o mesmo padr√£o do TechnicianForm:\n\n```typescript\nconst updateTeamMutation = useMutation({\n  mutationFn: async (data: ExtendedTeamForm) => {\n    const response = await apiRequest(\"PUT\", `/api/teams/${team?.id}`, teamData);\n    // ... gerenciamento de membros\n    return updatedTeam;\n  },\n  onSuccess: () => {\n    queryClient.invalidateQueries({ queryKey: [\"/api/teams\"] });\n    queryClient.invalidateQueries({ queryKey: [\"/api/team-members\"] });\n    toast({ title: \"Sucesso\", description: \"Equipe atualizada com sucesso\" });\n    onClose();\n  },\n  onError: (error: Error) => {\n    toast({ title: \"Erro\", description: error.message || \"Erro ao atualizar equipe\", variant: \"destructive\" });\n  }\n});\n```\n\n### 4. Vincula√ß√£o de T√©cnicos\n\nO formul√°rio agora tamb√©m vincula corretamente os t√©cnicos selecionados √† equipe:\n\n- Ao editar uma equipe, os t√©cnicos previamente selecionados aparecem como selecionados nas caixas de sele√ß√£o\n- Remo√ß√£o autom√°tica de membros existentes antes de adicionar os novos\n- Sincroniza√ß√£o correta entre estado local e servidor\n\n### 5. Melhorias na Interface\n\n**Valida√ß√µes implementadas:**\n- Email deve conter o caractere @ \n- Telefone formatado automaticamente ((XX)XXXXX-XXXX ou (XX)XXXX-XXXX)\n- Bloqueio de submiss√µes vazias em modo cria√ß√£o\n\n**Layout e usabilidade:**\n- Scroll controlado com `max-height: 80vh` nos formul√°rios\n- Di√°logos responsivos que se ajustam √† viewport\n- Bot√µes sempre acess√≠veis mesmo com conte√∫do longo\n\n## Resultado Final\n\nAp√≥s as corre√ß√µes implementadas:\n\n‚úÖ O bot√£o \"Atualizar Equipe\" funciona corretamente  \n‚úÖ Formul√°rios s√£o pr√©-preenchidos com dados existentes  \n‚úÖ T√©cnicos s√£o vinculados corretamente √†s equipes  \n‚úÖ Valida√ß√µes de campo funcionam adequadamente  \n‚úÖ Interface responsiva e user-friendly  \n‚úÖ Logs de debug para facilitar manuten√ß√£o futura  \n\n## Arquivos Modificados\n\n- `client/src/components/forms/TeamForm.tsx` - Refatora√ß√£o completa\n- `client/src/components/forms/TechnicianForm.tsx` - Melhorias nas valida√ß√µes\n- `client/src/pages/Technicians.tsx` - Ajustes nas fun√ß√µes de callback\n- `server/routes.ts` - Verifica√ß√£o dos endpoints (j√° estavam corretos)\n\n## Data da Implementa√ß√£o\n\nJunho 2025 - Corre√ß√µes implementadas e testadas com sucesso.\n\n## Projeto - Gerenciamento de T√©cnicos e Equipes\n\nEste projeto tem como objetivo o gerenciamento de t√©cnicos, equipes e ve√≠culos, permitindo a cria√ß√£o, edi√ß√£o e vincula√ß√£o de t√©cnicos a diferentes equipes e servi√ßos, al√©m de gerenciar ve√≠culos com responsabilidade atribu√≠da a t√©cnicos ou equipes.\n\nO que foi feito\nModifica√ß√£o na Tela de Ve√≠culos\nCampo de Respons√°vel (T√©cnico ou Equipe) Obrigat√≥rio:\nAgora, para cadastrar um ve√≠culo, √© obrigat√≥rio selecionar um respons√°vel. Este respons√°vel pode ser:\n\nT√©cnico individual ou\n\nEquipe completa.\n\nA sele√ß√£o pode ser feita atrav√©s de radio buttons que permitem ao usu√°rio escolher entre atribuir um t√©cnico ou uma equipe.\n\nVincula√ß√£o Autom√°tica de T√©cnicos:\n\nCaso seja escolhida uma equipe como respons√°vel, todos os t√©cnicos dessa equipe ser√£o automaticamente atribu√≠dos ao ve√≠culo.\n\nIsso garante que, ao vincular uma equipe a um ve√≠culo, todos os t√©cnicos associados √† equipe tamb√©m sejam vinculados ao ve√≠culo sem a necessidade de selecion√°-los manualmente.\n\nAltera√ß√£o no Banco de Dados:\n\nFoi adicionado o campo teamId ao schema de ve√≠culos no banco de dados, para armazenar qual equipe (caso selecionada) est√° associada ao ve√≠culo.\n\nAs migra√ß√µes foram executadas para garantir que o banco de dados refletisse essas mudan√ßas.\n\nInterface de Usu√°rio Atualizada:\n\nFoi atualizada a interface para mostrar tanto t√©cnicos quanto equipes nos cards.\n\nUm badge foi implementado para indicar se o ve√≠culo est√° atribu√≠do (verde) ou sem respons√°vel (vermelho), facilitando a visualiza√ß√£o do status.","size_bytes":5512},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# Aplicativo de Gerenciamento de Agendamentos\n\n## Overview\nEste projeto √© um aplicativo de gerenciamento de agendamentos desenvolvido com React e `react-big-calendar`, focado em agendamento de eventos e visualiza√ß√£o. A aplica√ß√£o visa otimizar rotas de atendimento, fornecer uma interface de usu√°rio intuitiva e gerenciar eficientemente as opera√ß√µes de campo. As funcionalidades incluem otimiza√ß√£o de rotas com OR-Tools (Google), geocodifica√ß√£o robusta, e um sistema abrangente para gerenciamento de t√©cnicos, equipes e agendamentos, incluindo a defini√ß√£o de endere√ßos de in√≠cio para roteiriza√ß√£o e c√°lculo preciso de tempos e dist√¢ncias.\n\n## User Preferences\n- Comunica√ß√£o em portugu√™s\n- Foco apenas no que foi solicitado, sem altera√ß√µes adicionais\n- Implementa√ß√£o direta sem complica√ß√µes desnecess√°rias\n\n## System Architecture\nO aplicativo √© constru√≠do com uma arquitetura moderna e escal√°vel, utilizando as seguintes tecnologias e padr√µes:\n\n-   **Frontend**: React com TypeScript, utilizando Wouter para roteamento. A estiliza√ß√£o √© feita com Tailwind CSS e os componentes UI s√£o baseados em shadcn/ui. Para gerenciamento de formul√°rios, usa-se react-hook-form com valida√ß√£o Zod. O estado do servidor √© gerenciado por TanStack Query.\n-   **Backend**: Express.js com autentica√ß√£o JWT.\n-   **Banco de dados**: PostgreSQL com Drizzle ORM.\n-   **Otimiza√ß√£o de Rotas**: Integra√ß√£o com OR-Tools (Google) para resolu√ß√£o do Problema do Caixeiro Viajante (TSP) e OSRM para matrizes de dist√¢ncia e dura√ß√£o.\n-   **Estrutura de Dados**:\n    -   **`routes`**: Tabela para armazenar rotas otimizadas, incluindo t√≠tulo, data, ve√≠culo, respons√°vel, dist√¢ncia/dura√ß√£o total, n√∫mero de paradas, status (draft, optimized, running, done, canceled) e o GeoJSON da polilinha.\n    -   **`routeStops`**: Tabela para armazenar as paradas ordenadas de uma rota, com refer√™ncia ao agendamento, ordem da parada, coordenadas e endere√ßo formatado.\n-   **Design de UI/UX**:\n    -   Interface de calend√°rio responsiva e interativa.\n    -   Utiliza√ß√£o de Shadcn/UI para componentes, garantindo um visual limpo e moderno.\n    -   Layout flex√≠vel e responsivo para cards, especialmente na tela de otimiza√ß√£o de rotas, com alturas sim√©tricas e scroll interno para listas extensas.\n    -   Indicadores visuais claros para estados de carregamento (spinners) e avisos.\n    -   Consist√™ncia visual nas cores (azul para dist√¢ncia, verde para tempo) e formata√ß√£o (km/min).\n    -   Inclus√£o de funcionalidades de UX como checkbox \"Terminar no ponto inicial\" para controle de rotas circulares vs. abertas, com descri√ß√µes contextuais.\n-   **Geocodifica√ß√£o e Endere√ßos**:\n    -   Sistema robusto de geocodifica√ß√£o para valida√ß√£o e preenchimento autom√°tico de endere√ßos (CEP, logradouro, bairro, cidade, estado).\n    -   Defini√ß√£o de endere√ßos de in√≠cio para roteiriza√ß√£o (priorizando t√©cnico/equipe sobre o endere√ßo da empresa) com fallback autom√°tico.\n    -   Campos de endere√ßo padronizados e validados para t√©cnicos e dados da empresa.\n-   **Logging**: Sistema de logs detalhados para depura√ß√£o do backend, com formata√ß√£o padronizada e informa√ß√µes espec√≠ficas por endpoint.\n\n## External Dependencies\n-   **react-big-calendar**: Para exibi√ß√£o e gerenciamento de calend√°rios e eventos.\n-   **Tailwind CSS**: Framework de CSS para estiliza√ß√£o.\n-   **shadcn/ui**: Biblioteca de componentes de interface de usu√°rio.\n-   **Wouter**: Biblioteca de roteamento para React.\n-   **react-hook-form**: Para gerenciamento de formul√°rios.\n-   **Zod**: Para valida√ß√£o de esquemas de dados.\n-   **TanStack Query**: Para gerenciamento de estado do servidor.\n-   **Express.js**: Framework de backend para Node.js.\n-   **PostgreSQL**: Sistema de gerenciamento de banco de dados relacional.\n-   **Drizzle ORM**: ORM para interagir com o banco de dados.\n-   **OR-Tools (Google)**: Biblioteca para otimiza√ß√£o, usada para resolver o Problema do Caixeiro Viajante (TSP) na otimiza√ß√£o de rotas.\n-   **OSRM (Open Source Routing Machine)**: Utilizado para calcular matrizes de dist√¢ncia e dura√ß√£o entre pontos para a otimiza√ß√£o de rotas.\n-   **JWT (JSON Web Tokens)**: Para autentica√ß√£o de usu√°rios.\n\n## Recent Changes\n\n### 11 de agosto de 2025 - Endpoints de Otimiza√ß√£o e Hist√≥rico de Rotas\n\n**Funcionalidade implementada**: Sistema completo de endpoints backend para otimiza√ß√£o autom√°tica e gerenciamento de hist√≥rico de rotas\n\n**Endpoints criados**:\n\n1. **POST /api/routes/optimize** - Otimiza√ß√£o autom√°tica de rotas:\n   - Recebe: `appointmentIds[]`, `endAtStart`, `responsibleType`, `responsibleId`, `vehicleId`, `title`\n   - Busca agendamentos com coordenadas do banco\n   - Calcula matriz de dist√¢ncias/tempos via OSRM\n   - Resolve TSP com algoritmo Nearest Neighbor + 2-opt\n   - Gera polyline GeoJSON para visualiza√ß√£o\n   - Salva rota e paradas no banco automaticamente\n   - Retorna rota completa com paradas ordenadas\n\n2. **GET /api/routes** - Listagem com filtros avan√ßados:\n   - Filtros: `from`, `to`, `status`, `responsibleType`, `responsibleId`, `vehicleId`, `search`\n   - Ordena√ß√£o por data de cria√ß√£o (mais recente primeiro)\n   - Retorna lista paginada para tabela de hist√≥rico\n\n3. **GET /api/routes/:id** - Detalhes de rota espec√≠fica:\n   - Retorna cabe√ßalho completo da rota + paradas ordenadas\n   - Inclui polylineGeoJson para exibi√ß√£o no mapa\n   - Compat√≠vel com drawer de visualiza√ß√£o do frontend\n\n**Algoritmos implementados**:\n- **TSP Solver nativo**: Nearest Neighbor + 2-opt em JavaScript puro\n- **Integra√ß√£o OSRM**: Reutiliza helpers existentes (`getOsrmUrl()`)\n- **Matriz de dist√¢ncias**: `/table/v1/driving` com annotations\n- **Polyline generation**: `/route/v1/driving` com geometries GeoJSON\n\n**Arquivos criados**:\n- **server/routes/routes.api.ts**: Endpoints isolados com logs detalhados\n- **Middleware de autentica√ß√£o**: Compat√≠vel com modo DEV\n- **Valida√ß√£o Zod**: Schemas robustos para entrada de dados\n\n**Integra√ß√£o com sistema existente**:\n- Registrado em `server/routes.ts` via import din√¢mico\n- Reutiliza fun√ß√µes OSRM existentes (`getOsrmUrl`, matriz, route)\n- Compat√≠vel com formato de resposta do frontend atual\n- Logs padronizados seguindo padr√£o existente\n\n**Resultado**: Sistema completo de otimiza√ß√£o backend pronto para integra√ß√£o com interface de hist√≥rico e automa√ß√£o\n\n### 12 de agosto de 2025 - Implementa√ß√£o de DisplayNumber Sequencial\n\n**Funcionalidade implementada**: Sistema de numera√ß√£o sequencial para rotas com campo `displayNumber`\n\n**Modifica√ß√µes realizadas**:\n\n1. **Schema atualizado** (`shared/schema.ts`):\n   - Campo `displayNumber: integer('display_number').notNull().default(0)` j√° existente na tabela routes\n\n2. **Backend endpoints** (`server/routes/routes.api.ts`):\n   - **Import do sql**: Adicionado `sql` no import do drizzle-orm para consultas complexas\n   - **POST /api/routes/optimize**: \n     - C√°lculo autom√°tico do pr√≥ximo displayNumber usando `MAX(displayNumber) + 1`\n     - Inser√ß√£o do displayNumber na nova rota salva\n     - Retorno do displayNumber na resposta JSON\n   - **GET /api/routes**: Inclus√£o do campo `displayNumber` no select da listagem\n   - **GET /api/routes/:id**: Retorna displayNumber automaticamente com todas as colunas\n\n**Algoritmo de numera√ß√£o**:\n- Consulta `COALESCE(MAX(displayNumber), 0) + 1` para calcular pr√≥ximo n√∫mero\n- Numera√ß√£o global (n√£o por usu√°rio) devido √† aus√™ncia de userId na tabela routes\n- Valores sequenciais: 1, 2, 3... garantindo ordem cronol√≥gica\n\n**Resultado**: Rotas agora possuem IDs sequenciais amig√°veis (displayNumber) al√©m do UUID t√©cnico, facilitando refer√™ncia e ordena√ß√£o\n\n### 11 de agosto de 2025 - Cria√ß√£o das Tabelas de Rotas com Drizzle\n\n**Funcionalidade implementada**: Cria√ß√£o das tabelas `routes` e `routeStops` para salvar rotas otimizadas\n\n**Tabelas criadas**:\n\n1. **Tabela `routes`** (rotas principais):\n   - `id`: UUID prim√°rio com gera√ß√£o autom√°tica\n   - `title`: T√≠tulo da rota (varchar 120 chars)\n   - `date`: Data da rota (timestamp sem timezone)\n   - `vehicleId`: ID do ve√≠culo (varchar 64 chars, opcional)\n   - `responsibleType`: Tipo do respons√°vel - 'technician' ou 'team' (varchar 16 chars)\n   - `responsibleId`: ID do respons√°vel (varchar 64 chars)\n   - `endAtStart`: Terminar no ponto inicial (boolean, padr√£o false)\n   - `distanceTotal`: Dist√¢ncia total em metros (integer, padr√£o 0)\n   - `durationTotal`: Dura√ß√£o total em segundos (integer, padr√£o 0)\n   - `stopsCount`: N√∫mero de paradas (integer, padr√£o 0)\n   - `status`: Status da rota - draft|optimized|running|done|canceled (varchar 24, padr√£o 'optimized')\n   - `polylineGeoJson`: GeoJSON LineString para visualiza√ß√£o (jsonb)\n   - `createdAt`, `updatedAt`: Timestamps autom√°ticos\n\n2. **Tabela `routeStops`** (paradas ordenadas):\n   - `id`: UUID prim√°rio com gera√ß√£o autom√°tica\n   - `routeId`: Refer√™ncia para routes.id (UUID, obrigat√≥rio)\n   - `appointmentId`: ID do agendamento (UUID, obrigat√≥rio)\n   - `order`: Ordem da parada na rota (integer, obrigat√≥rio)\n   - `lat`, `lng`: Coordenadas latitude/longitude (doublePrecision)\n   - `address`: Endere√ßo formatado (text)\n\n**Arquivos modificados**:\n- **shared/schema.ts**: \n  - Adicionadas importa√ß√µes: `uuid`, `jsonb`, `doublePrecision`, `varchar`, `relations`\n  - Criadas tabelas `routes` e `routeStops` com relacionamento\n  - Adicionados schemas de inser√ß√£o `insertRouteSchema` e `insertRouteStopSchema`\n  - Adicionados tipos TypeScript `Route`, `InsertRoute`, `RouteStop`, `InsertRouteStop`\n\n**Migra√ß√£o aplicada**:\n- Executado `npx drizzle-kit push` com sucesso\n- Tabelas criadas no banco PostgreSQL/Supabase\n\n**Resultado**: Base de dados preparada para salvar e gerenciar rotas otimizadas com suporte a CSV/GeoJSON futuro","size_bytes":9848},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        \"burnt-yellow\": \"hsl(var(--burnt-yellow))\",\n        \"burnt-yellow-dark\": \"hsl(var(--burnt-yellow-dark))\",\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2901},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n    hmr: {\n      overlay: false,  // ADICIONE ESTA LINHA\n    },\n  },\n});\n","size_bytes":1035},"attached_assets/content-1752859365986.md":{"content":"[Skip to main content](https://www.godaddy.com/forsale/appointment.id?utm_source=TDFS_BINNS2&utm_medium=parkedpages&utm_campaign=x_corp_tdfs-binns2_base&traffic_type=TDFS_BINNS2&traffic_id=binns2&#main)\n\n[Excellent\\\\\n\\\\\n4.6 out of 5\\\\\n\\\\\nTrustpilot](https://www.trustpilot.com/review/godaddy.com)\n\n###### The domain name\n\n## appointment.id\n\n###### is for sale!\n\n#### Get this domain\n\nPremium\n\nVerified Domain\n\nPay the full $24,999 now, select Lease to Own or make an offer.\n\n* * *\n\nBuy now\n\nUSD$24,999\n\n* * *\n\nLease to own\n\nUSD$2,116\n\n/ month\n\n* * *\n\nMake an offer\n\n* * *\n\nNext\n\n* * *\n\nSubtotal does not include applicable taxes\n\nFree transaction support\n\nSecure payments\n\nLocal currency available in cart at checkout\n\n![Visa](https://www.godaddy.com/forsale/_next/image?url=%2Fforsale%2Fimgs%2Fpayments%2Fvisa.png&w=128&q=75)![MasterCard](https://www.godaddy.com/forsale/_next/image?url=%2Fforsale%2Fimgs%2Fpayments%2Fmastercard.png&w=128&q=75)![American Express](https://www.godaddy.com/forsale/_next/image?url=%2Fforsale%2Fimgs%2Fpayments%2FamericanExpress.png&w=128&q=75)![PayPal](https://www.godaddy.com/forsale/_next/image?url=%2Fforsale%2Fimgs%2Fpayments%2Fpaypal.png&w=128&q=75)![AliPay](https://www.godaddy.com/forsale/_next/image?url=%2Fforsale%2Fimgs%2Fpayments%2Falipay.png&w=128&q=75)\n\nNeed help? Give us a call.[480-651-9741](https://www.godaddy.com/forsale/true)\n\n![Safe & secure transactions](https://www.godaddy.com/forsale/imgs/dan-custom/secure-transactions.svg)\n\nSafe & secure transactions\n\n![Fast & easy transfers](https://www.godaddy.com/forsale/imgs/dan-custom/fast-and-easy-transfers.svg)\n\nFast & easy transfers\n\n![Hassle free payments](https://www.godaddy.com/forsale/imgs/dan-custom/hassle-free-payments.svg)\n\nHassle free payments\n\n* * *\n\n* * *\n\n###### The simple, and safe way to buy domain names\n\nNo matter what kind of domain you want to buy or lease, we make the transfer simple and safe.\n\nHere's how it works\n\nAsk AI\n\n* * *","size_bytes":1954},"server/db.ts":{"content":"import dotenv from \"dotenv\";\ndotenv.config();\n\nimport { Pool } from \"pg\";\nimport { drizzle } from \"drizzle-orm/node-postgres\";\nimport * as schema from \"@shared/schema\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set in environment variables. This should be your PostgreSQL connection string.\"\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle(pool, { schema });\n","size_bytes":460},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen(port, \"0.0.0.0\", () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":1879},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport jwt from \"jsonwebtoken\";\nimport { storage } from \"./storage\";\nimport { \n  insertUserSchema, loginSchema, insertClientSchema, insertServiceSchema,\n  insertTechnicianSchema, insertVehicleSchema, insertAppointmentSchema,\n  insertChecklistSchema, insertBusinessRulesSchema, insertTeamSchema,\n  insertTeamMemberSchema, extendedInsertAppointmentSchema\n} from \"@shared/schema\";\n\n// üîê CONFIGURA√á√ÉO OBRIGAT√ìRIA: JWT_SECRET deve estar definido nas vari√°veis de ambiente\n// Esta chave √© usada para assinar e verificar tokens de autentica√ß√£o\nconst JWT_SECRET = process.env.JWT_SECRET || \"development_jwt_secret_key_32_characters_long_minimum_for_security_rotafacil_2025\";\n\n// üîê CONFIGURA√á√ÉO: URL do OSRM (Open Source Routing Machine)\nimport fs from 'fs';\nimport path from 'path';\nimport { fileURLToPath } from 'url';\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = path.dirname(__filename);\n\nfunction getOsrmUrl() {\n  const filePath = path.join(__dirname, 'osrm_url.txt');\n  console.log(\"Procurando arquivo em:\", filePath);\n  try {\n    return fs.readFileSync(filePath, 'utf8').trim();\n  } catch (err) {\n    console.error('Arquivo osrm_url.txt n√£o encontrado ou n√£o lido!', err);\n    return null;\n  }\n}\n\n// Auth middleware\nfunction authenticateToken(req: any, res: any, next: any) {\n  // üöÄ DEV MODE BYPASS: Permite acesso sem autentica√ß√£o durante desenvolvimento\n  if (process.env.DEV_MODE === 'true') {\n    // Criar usu√°rio fake para desenvolvimento\n    req.user = {\n      userId: 1,\n      email: 'dev@rotafacil.com',\n      name: 'Dev User',\n      plan: 'premium'\n    };\n    return next();\n  }\n\n  // üîê Autentica√ß√£o normal para produ√ß√£o\n  const authHeader = req.headers['authorization'];\n  const token = authHeader && authHeader.split(' ')[1];\n\n  if (!token) {\n    return res.status(401).json({ message: 'Access token required' });\n  }\n\n  jwt.verify(token, JWT_SECRET, (err: any, user: any) => {\n    if (err) return res.status(403).json({ message: 'Invalid token' });\n    req.user = user;\n    next();\n  });\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Endpoint para gerar matriz do OSRM\n  app.post('/api/rota/matrix', async (req, res) => {\n    console.log(\"==== LOG IN√çCIO: /api/rota/matrix ====\");\n    console.log(\"Dados recebidos no req.body:\");\n    console.log(JSON.stringify(req.body, null, 2));\n    \n    const { coords } = req.body; // Ex: [[lon, lat], [lon, lat], ...]\n    if (!coords || !Array.isArray(coords) || coords.length < 2) {\n      console.log(\"‚ùå ERRO: Coordenadas inv√°lidas\");\n      console.log(\"Coordenadas recebidas:\", coords);\n      console.log(\"==== LOG FIM: /api/rota/matrix (ERRO) ====\");\n      return res.status(400).json({ error: 'Coordenadas inv√°lidas' });\n    }\n\n    const coordStr = coords.map((c: number[]) => c.join(',')).join(';');\n    const OSRM_URL = getOsrmUrl()?.replace(/\\/$/, '') || null;\n    console.log(\"üåê OSRM_URL configurado:\", OSRM_URL);\n\n    if (!OSRM_URL) {\n      console.log(\"‚ùå ERRO: OSRM_URL n√£o configurado\");\n      console.log(\"==== LOG FIM: /api/rota/matrix (ERRO CONFIG) ====\");\n      return res.status(500).json({ error: \"Endere√ßo OSRM n√£o configurado. Crie/atualize o arquivo osrm_url.txt.\" });\n    }\n\n    const osrmUrl = `${OSRM_URL}/table/v1/driving/${coordStr}?annotations=duration,distance`;\n    console.log(\"üåê URL completa para OSRM:\");\n    console.log(osrmUrl);\n    \n    try {\n      console.log(\"üöÄ Fazendo chamada para OSRM...\");\n      const resp = await fetch(osrmUrl);\n      const data = await resp.json();\n      \n      console.log(\"üì¶ Resposta completa do OSRM:\");\n      console.log(JSON.stringify(data, null, 2));\n      \n      if (!data.durations || !data.distances) {\n        console.log(\"‚ùå ERRO: OSRM n√£o retornou durations ou distances\");\n        console.log(\"==== LOG FIM: /api/rota/matrix (ERRO OSRM) ====\");\n        return res.status(500).json({ error: 'OSRM n√£o respondeu corretamente - durations ou distances n√£o encontradas' });\n      }\n      \n      console.log(\"‚úÖ Matriz de dura√ß√µes extra√≠da:\");\n      console.log(JSON.stringify(data.durations, null, 2));\n      console.log(\"‚úÖ Matriz de dist√¢ncias extra√≠da:\");\n      console.log(JSON.stringify(data.distances, null, 2));\n      console.log(\"==== LOG FIM: /api/rota/matrix (SUCESSO) ====\");\n      \n      return res.json({ \n        matrix: data.durations,\n        durations: data.durations,\n        distances: data.distances\n      });\n    } catch (e: any) {\n      console.log(\"‚ùå ERRO na chamada OSRM:\");\n      console.log(\"Mensagem de erro:\", e.message);\n      console.log(\"Stack trace completo:\");\n      console.log(e.stack);\n      console.log(\"==== LOG FIM: /api/rota/matrix (EXCE√á√ÉO) ====\");\n      return res.status(500).json({ error: 'Erro consultando OSRM', details: e.message });\n    }\n  });\n\n  // Endpoint para resolver TSP via Python\n  app.post('/api/rota/tsp', async (req, res) => {\n    console.log(\"==== LOG IN√çCIO: /api/rota/tsp ====\");\n    console.log(\"Dados recebidos no req.body:\");\n    console.log(JSON.stringify(req.body, null, 2));\n    \n    const { matrix, terminarNoPontoInicial } = req.body;\n    if (!matrix || !Array.isArray(matrix)) {\n      console.log(\"‚ùå ERRO: Matriz inv√°lida\");\n      console.log(\"Matriz recebida:\", matrix);\n      console.log(\"==== LOG FIM: /api/rota/tsp (ERRO) ====\");\n      return res.status(400).json({ error: 'Matriz inv√°lida' });\n    }\n\n    console.log(\"üìä Matriz para TSP:\");\n    console.log(`Dimens√µes: ${matrix.length}x${matrix[0]?.length || 0}`);\n    console.log(\"Primeira linha da matriz:\");\n    console.log(JSON.stringify(matrix[0], null, 2));\n    console.log(\"Matriz completa:\");\n    console.log(JSON.stringify(matrix, null, 2));\n\n    const { spawn } = await import('child_process');\n    console.log(\"üêç Iniciando processo Python...\");\n    const py = spawn('python3', ['./server/solve_tsp.py']);\n    let output = '';\n    let errors = '';\n    \n    py.stdout.on('data', (data: Buffer) => {\n      const chunk = data.toString();\n      console.log(\"üìù Python stdout:\", chunk);\n      output += chunk;\n    });\n    \n    py.stderr.on('data', (data: Buffer) => {\n      const errorChunk = data.toString();\n      console.log(\"‚ùå Python stderr:\", errorChunk);\n      errors += errorChunk;\n    });\n\n    py.on('close', (code: number) => {\n      console.log(`üîö Processo Python finalizado com c√≥digo: ${code}`);\n      console.log(\"üì§ Output completo do Python:\");\n      console.log(output);\n      \n      if (errors) {\n        console.log(\"‚ö†Ô∏è Erros do Python:\");\n        console.log(errors);\n      }\n      \n      try {\n        const result = JSON.parse(output);\n        console.log(\"‚úÖ Resultado TSP parseado:\");\n        console.log(JSON.stringify(result, null, 2));\n        console.log(\"==== LOG FIM: /api/rota/tsp (SUCESSO) ====\");\n        return res.json(result);\n      } catch (e: any) {\n        console.log(\"‚ùå ERRO ao parsear JSON do Python:\");\n        console.log(\"Output original:\", output);\n        console.log(\"Erro de parse:\", e.message);\n        console.log(\"==== LOG FIM: /api/rota/tsp (ERRO PARSE) ====\");\n        return res.status(500).json({ error: 'Erro no Python', details: output, parseError: e.message });\n      }\n    });\n\n    const inputData = { matrix, terminarNoPontoInicial };\n    console.log(\"üì§ Enviando dados para Python:\");\n    console.log(JSON.stringify(inputData, null, 2));\n    \n    py.stdin.write(JSON.stringify(inputData));\n    py.stdin.end();\n    console.log(\"‚úÖ Dados enviados para Python, aguardando resposta...\");\n  });\n\n  // Auth routes\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const userData = insertUserSchema.parse(req.body);\n      \n      // Check if user exists\n      const existingUser = await storage.getUserByEmail(userData.email);\n      if (existingUser) {\n        return res.status(400).json({ message: \"User already exists\" });\n      }\n      \n      const user = await storage.createUser(userData);\n      const token = jwt.sign({ userId: user.id, email: user.email }, JWT_SECRET, { expiresIn: '24h' });\n      \n      res.json({ \n        user: { \n          id: user.id, \n          email: user.email, \n          name: user.name, \n          plan: user.plan \n        }, \n        token \n      });\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { email, password } = loginSchema.parse(req.body);\n      \n      const user = await storage.validateUser(email, password);\n      if (!user) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n      \n      const token = jwt.sign({ userId: user.id, email: user.email }, JWT_SECRET, { expiresIn: '24h' });\n      \n      res.json({ \n        user: { \n          id: user.id, \n          email: user.email, \n          name: user.name, \n          plan: user.plan \n        }, \n        token \n      });\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/auth/me\", authenticateToken, async (req: any, res) => {\n    try {\n      const user = await storage.getUserById(req.user.userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      res.json({ \n        id: user.id, \n        email: user.email, \n        name: user.name, \n        plan: user.plan \n      });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Clients routes\n  app.get(\"/api/clients\", authenticateToken, async (req: any, res) => {\n    try {\n      const clients = await storage.getClients(req.user.userId);\n      res.json(clients);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/clients/search\", authenticateToken, async (req: any, res) => {\n    try {\n      const { q } = req.query;\n      if (!q || typeof q !== 'string') {\n        return res.json([]);\n      }\n      \n      const clients = await storage.searchClients(q.trim(), req.user.userId);\n      res.json(clients);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/clients/validate-cpf\", authenticateToken, async (req: any, res) => {\n    try {\n      const cpf = req.query.cpf as string;\n      console.log(\"Valida√ß√£o de CPF:\", cpf);\n      \n      if (!cpf) {\n        return res.json({ exists: false });\n      }\n\n      const existingClient = await storage.getClientByCpf(cpf, req.user.userId);\n      \n      if (existingClient) {\n        console.log(\"CPF j√° cadastrado:\", cpf, \"Nome:\", existingClient.name);\n        res.json({ \n          exists: true, \n          clientName: existingClient.name,\n          clientId: existingClient.id \n        });\n      } else {\n        res.json({ exists: false });\n      }\n    } catch (error: any) {\n      console.error(\"Erro na valida√ß√£o de CPF:\", error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/clients\", authenticateToken, async (req: any, res) => {\n    try {\n      const clientData = insertClientSchema.parse(req.body);\n      const client = await storage.createClient(clientData, req.user.userId);\n      res.json(client);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/clients/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const clientData = insertClientSchema.partial().parse(req.body);\n      const client = await storage.updateClient(id, clientData, req.user.userId);\n      res.json(client);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/clients/import\", authenticateToken, async (req: any, res) => {\n    try {\n      const { clients } = req.body;\n      if (!Array.isArray(clients)) {\n        return res.status(400).json({ message: \"Clients array is required\" });\n      }\n\n      let successCount = 0;\n      const detailedErrors: string[] = [];\n      const processedItems: any[] = [];\n\n      for (let i = 0; i < clients.length; i++) {\n        const clientData = clients[i];\n        try {\n          console.log(`üìù Criando cliente: ${clientData.name}`);\n          const validatedData = insertClientSchema.parse(clientData);\n          const createdClient = await storage.createClient(validatedData, req.user.userId);\n          \n          successCount++;\n          processedItems.push({\n            index: i + 1,\n            status: 'success',\n            data: createdClient\n          });\n          \n          console.log(`‚úÖ Cliente criado: ${createdClient.name} (ID: ${createdClient.id})`);\n        } catch (error: any) {\n          console.log(`üîç Analisando erro para cliente ${clientData.name}:`, error.message);\n          \n          // Melhorar mensagem de erro para CPFs duplicados\n          let friendlyErrorMessage = error.message;\n          \n          if (error.message && error.message.includes('clients_cpf_unique')) {\n            console.log(`üö´ CPF duplicado detectado: ${clientData.cpf || 'N/A'}`);\n            friendlyErrorMessage = `Erro na importa√ß√£o: CPF ${clientData.cpf} j√° est√° cadastrado.`;\n            console.log(`‚úèÔ∏è Mensagem de erro melhorada: ${friendlyErrorMessage}`);\n          }\n          \n          detailedErrors.push(`Item ${i + 1}: Erro ao criar cliente \"${clientData.name}\" - ${friendlyErrorMessage}`);\n          processedItems.push({\n            index: i + 1,\n            status: 'error',\n            error: friendlyErrorMessage,\n            data: clientData\n          });\n          console.log(`‚ùå Erro no cliente ${i + 1}: ${friendlyErrorMessage}`);\n        }\n      }\n\n      console.log(`üìä Importa√ß√£o de clientes conclu√≠da para usu√°rio ${req.user.userId}:`);\n      console.log(`   ‚Ä¢ Total de itens: ${clients.length}`);\n      console.log(`   ‚Ä¢ Sucessos: ${successCount}`);\n      console.log(`   ‚Ä¢ Erros: ${detailedErrors.length}`);\n      \n      if (detailedErrors.length > 0) {\n        console.log(`üìã Erros detalhados:`);\n        detailedErrors.forEach(error => console.log(`   ‚Ä¢ ${error}`));\n      }\n\n      res.json({ \n        success: successCount, \n        errors: detailedErrors.length,\n        detailedErrors,\n        processedItems\n      });\n    } catch (error: any) {\n      console.error(`‚ùå Erro fatal na importa√ß√£o de clientes:`, error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/clients/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.deleteClient(id, req.user.userId);\n      if (!success) {\n        return res.status(404).json({ message: \"Client not found\" });\n      }\n      res.json({ message: \"Client deleted successfully\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Services routes\n  app.get(\"/api/services\", authenticateToken, async (req: any, res) => {\n    try {\n      const services = await storage.getServices(req.user.userId);\n      res.json(services);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/services\", authenticateToken, async (req: any, res) => {\n    try {\n      const serviceData = insertServiceSchema.parse(req.body);\n      const service = await storage.createService(serviceData, req.user.userId);\n      res.json(service);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/services/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const serviceData = insertServiceSchema.partial().parse(req.body);\n      const service = await storage.updateService(id, serviceData, req.user.userId);\n      res.json(service);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/services/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.deleteService(id, req.user.userId);\n      if (!success) {\n        return res.status(404).json({ message: \"Service not found\" });\n      }\n      res.json({ message: \"Service deleted successfully\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Technicians routes\n  app.get(\"/api/technicians\", authenticateToken, async (req: any, res) => {\n    try {\n      const technicians = await storage.getTechnicians(req.user.userId);\n      res.json(technicians);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/technicians\", authenticateToken, async (req: any, res) => {\n    console.log(\"==== LOG IN√çCIO: POST /api/technicians ====\");\n    console.log(\"Dados recebidos:\");\n    console.log(JSON.stringify(req.body, null, 2));\n    \n    try {\n      const technicianData = insertTechnicianSchema.parse(req.body);\n      console.log(\"‚úÖ Dados validados pelo schema\");\n      \n      const technician = await storage.createTechnician(technicianData, req.user.userId);\n      console.log(\"‚úÖ T√©cnico criado com sucesso:\");\n      console.log(`ID: ${technician.id}, Nome: ${technician.name}`);\n      console.log(\"==== LOG FIM: POST /api/technicians (SUCESSO) ====\");\n      \n      res.json(technician);\n    } catch (error: any) {\n      console.log(\"‚ùå ERRO ao criar t√©cnico:\");\n      console.log(\"Tipo do erro:\", error.constructor.name);\n      console.log(\"Mensagem:\", error.message);\n      if (error.name === 'ZodError') {\n        console.log(\"Erros de valida√ß√£o:\");\n        console.log(JSON.stringify(error.errors, null, 2));\n      }\n      console.log(\"==== LOG FIM: POST /api/technicians (ERRO) ====\");\n      \n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/technicians/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const technicianData = insertTechnicianSchema.partial().parse(req.body);\n      const technician = await storage.updateTechnician(id, technicianData, req.user.userId);\n      res.json(technician);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/technicians/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.deleteTechnician(id, req.user.userId);\n      if (!success) {\n        return res.status(404).json({ message: \"Technician not found\" });\n      }\n      res.json({ message: \"Technician deleted successfully\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Vehicles routes\n  app.get(\"/api/vehicles\", authenticateToken, async (req: any, res) => {\n    try {\n      const vehicles = await storage.getVehicles(req.user.userId);\n      res.json(vehicles);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/vehicles\", authenticateToken, async (req: any, res) => {\n    try {\n      const vehicleData = insertVehicleSchema.parse(req.body);\n      const vehicle = await storage.createVehicle(vehicleData, req.user.userId);\n      res.json(vehicle);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/vehicles/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const vehicleData = insertVehicleSchema.parse(req.body);\n      const vehicle = await storage.updateVehicle(id, vehicleData, req.user.userId);\n      res.json(vehicle);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/vehicles/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.deleteVehicle(id, req.user.userId);\n      if (!success) {\n        return res.status(404).json({ message: \"Vehicle not found\" });\n      }\n      res.json({ message: \"Vehicle deleted successfully\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Appointments routes\n  app.get(\"/api/appointments\", authenticateToken, async (req: any, res) => {\n    try {\n      const appointments = await storage.getAppointments(req.user.userId);\n      res.json(appointments);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/appointments/date/:date\", authenticateToken, async (req: any, res) => {\n    try {\n      const date = req.params.date;\n      const appointments = await storage.getAppointmentsByDate(date, req.user.userId);\n      res.json(appointments);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/appointments\", authenticateToken, async (req: any, res) => {\n    try {\n      const appointmentData = extendedInsertAppointmentSchema.parse(req.body);\n      const appointment = await storage.createAppointment(appointmentData, req.user.userId);\n      res.json(appointment);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/appointments/import\", authenticateToken, async (req: any, res) => {\n    try {\n      const { appointments } = req.body;\n      if (!Array.isArray(appointments)) {\n        return res.status(400).json({ message: \"Appointments array is required\" });\n      }\n\n      let successCount = 0;\n      const detailedErrors: string[] = [];\n      const processedItems: any[] = [];\n\n      for (let i = 0; i < appointments.length; i++) {\n        const appointmentData = appointments[i];\n        try {\n          let clientId = appointmentData.clientId;\n          \n          // Criar cliente automaticamente se necess√°rio\n          if (!clientId && appointmentData.clientData) {\n            try {\n              const newClient = await storage.createClient(appointmentData.clientData, req.user.userId);\n              clientId = newClient.id;\n              console.log(`üìù Cliente criado automaticamente: ${appointmentData.clientData.name} (ID: ${clientId})`);\n            } catch (clientError: any) {\n              detailedErrors.push(`Item ${i + 1}: Erro ao criar cliente \"${appointmentData.clientData.name}\" - ${clientError.message}`);\n              processedItems.push({\n                index: i + 1,\n                status: 'error',\n                error: `Erro ao criar cliente: ${clientError.message}`,\n                data: appointmentData\n              });\n              continue;\n            }\n          }\n          \n          // Preparar dados do agendamento com clientId correto\n          const { clientData, ...cleanAppointmentData } = appointmentData;\n          cleanAppointmentData.clientId = clientId;\n          \n          console.log(`üîß Criando agendamento com clientId: ${cleanAppointmentData.clientId}`);\n          const validatedData = extendedInsertAppointmentSchema.parse(cleanAppointmentData);\n          const createdAppointment = await storage.createAppointment(validatedData, req.user.userId);\n          console.log(`‚úÖ Agendamento criado: ID ${createdAppointment.id}, clientId: ${createdAppointment.clientId}`);\n          successCount++;\n          processedItems.push({\n            index: i + 1,\n            status: 'success',\n            appointment: createdAppointment\n          });\n        } catch (error: any) {\n          let errorMessage = `Item ${i + 1}: `;\n          \n          if (error.name === 'ZodError') {\n            // Erro de valida√ß√£o do Zod - extrair detalhes espec√≠ficos\n            const zodErrors = error.errors.map((err: any) => {\n              const field = err.path.join('.');\n              return `${field}: ${err.message}`;\n            });\n            errorMessage += `Erro de valida√ß√£o - ${zodErrors.join('; ')}`;\n          } else if (error.code === '23505') {\n            // Erro de duplica√ß√£o no PostgreSQL\n            errorMessage += `Agendamento duplicado`;\n          } else if (error.code === '23503') {\n            // Erro de chave estrangeira\n            errorMessage += `Refer√™ncia inv√°lida (cliente, servi√ßo ou t√©cnico n√£o existe)`;\n          } else {\n            errorMessage += `${error.message || 'Erro desconhecido'}`;\n          }\n          \n          detailedErrors.push(errorMessage);\n          processedItems.push({\n            index: i + 1,\n            status: 'error',\n            error: errorMessage,\n            data: appointmentData\n          });\n        }\n      }\n\n      // Log detalhado no servidor\n      console.log(`üìä Importa√ß√£o CSV conclu√≠da para usu√°rio ${req.user.userId}:`);\n      console.log(`   ‚Ä¢ Total de itens: ${appointments.length}`);\n      console.log(`   ‚Ä¢ Sucessos: ${successCount}`);\n      console.log(`   ‚Ä¢ Erros: ${detailedErrors.length}`);\n      \n      if (detailedErrors.length > 0) {\n        console.log(`üìã Erros detalhados:`);\n        detailedErrors.forEach(error => console.log(`   ‚Ä¢ ${error}`));\n      }\n\n      res.json({ \n        success: successCount, \n        errors: detailedErrors.length,\n        detailedErrors,\n        processedItems\n      });\n    } catch (error: any) {\n      console.error(`‚ùå Erro fatal na importa√ß√£o CSV:`, error);\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/appointments/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const appointmentData = req.body;\n      \n      console.log(`üîß [UPDATE] Atualizando agendamento ${id}:`, appointmentData);\n      \n      // Corrigir campo scheduledDate se presente\n      if (appointmentData.scheduledDate) {\n        console.log(`üìÖ [UPDATE] Data recebida (tipo: ${typeof appointmentData.scheduledDate}):`, appointmentData.scheduledDate);\n        \n        // Se j√° √© uma string ISO, manter como est√°\n        if (typeof appointmentData.scheduledDate === 'string') {\n          console.log(`‚úÖ [UPDATE] Data j√° √© string, mantendo: ${appointmentData.scheduledDate}`);\n        } \n        // Se √© um objeto Date, converter para ISO string\n        else if (appointmentData.scheduledDate instanceof Date) {\n          appointmentData.scheduledDate = appointmentData.scheduledDate.toISOString();\n          console.log(`üîÑ [UPDATE] Data convertida para ISO: ${appointmentData.scheduledDate}`);\n        }\n        // Se √© outro tipo, tentar criar Date primeiro\n        else {\n          try {\n            const dateObj = new Date(appointmentData.scheduledDate);\n            if (isNaN(dateObj.getTime())) {\n              throw new Error(`Data inv√°lida: ${appointmentData.scheduledDate}`);\n            }\n            appointmentData.scheduledDate = dateObj.toISOString();\n            console.log(`üîÑ [UPDATE] Data parseada e convertida: ${appointmentData.scheduledDate}`);\n          } catch (dateError) {\n            console.log(`‚ùå [UPDATE] Erro ao processar data:`, dateError);\n            return res.status(400).json({ message: `Data inv√°lida: ${appointmentData.scheduledDate}` });\n          }\n        }\n      }\n      \n      const appointment = await storage.updateAppointment(id, appointmentData, req.user.userId);\n      console.log(`‚úÖ [UPDATE] Agendamento atualizado com sucesso: ${appointment.id}`);\n      res.json(appointment);\n    } catch (error: any) {\n      console.log(`‚ùå [UPDATE] Erro ao atualizar agendamento:`, error.message);\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/appointments/:id\", authenticateToken, async (req: any, res) => {\n    console.log(`==== LOG IN√çCIO: PATCH /api/appointments/${req.params.id} ====`);\n    console.log(\"Dados recebidos:\");\n    console.log(JSON.stringify(req.body, null, 2));\n    \n    try {\n      const id = parseInt(req.params.id);\n      const appointmentData = req.body;\n\n      // (repete o tratamento do campo scheduledDate, igual ao PUT)\n      if (appointmentData.scheduledDate) {\n        console.log(`üìÖ [PATCH] Data recebida: ${appointmentData.scheduledDate}`);\n        if (typeof appointmentData.scheduledDate === 'string') {\n          console.log(\"‚úÖ [PATCH] Data j√° √© string\");\n        } else if (appointmentData.scheduledDate instanceof Date) {\n          appointmentData.scheduledDate = appointmentData.scheduledDate.toISOString();\n          console.log(`üîÑ [PATCH] Data convertida: ${appointmentData.scheduledDate}`);\n        } else {\n          try {\n            const dateObj = new Date(appointmentData.scheduledDate);\n            if (isNaN(dateObj.getTime())) {\n              throw new Error(`Data inv√°lida: ${appointmentData.scheduledDate}`);\n            }\n            appointmentData.scheduledDate = dateObj.toISOString();\n            console.log(`üîÑ [PATCH] Data parseada: ${appointmentData.scheduledDate}`);\n          } catch (dateError) {\n            console.log(`‚ùå [PATCH] Erro ao processar data:`, dateError);\n            console.log(\"==== LOG FIM: PATCH /api/appointments (ERRO DATA) ====\");\n            return res.status(400).json({ message: `Data inv√°lida: ${appointmentData.scheduledDate}` });\n          }\n        }\n      }\n\n      const appointment = await storage.updateAppointment(id, appointmentData, req.user.userId);\n      console.log(`‚úÖ [PATCH] Agendamento ${id} atualizado com sucesso`);\n      console.log(\"==== LOG FIM: PATCH /api/appointments (SUCESSO) ====\");\n      \n      res.json(appointment);\n    } catch (error: any) {\n      console.log(`‚ùå [PATCH] Erro ao atualizar agendamento ${req.params.id}:`);\n      console.log(\"Tipo do erro:\", error.constructor.name);\n      console.log(\"Mensagem:\", error.message);\n      console.log(\"==== LOG FIM: PATCH /api/appointments (ERRO) ====\");\n      \n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/appointments/:id\", authenticateToken, async (req: any, res) => {\n    console.log(`==== LOG IN√çCIO: DELETE /api/appointments/${req.params.id} ====`);\n    \n    try {\n      const id = parseInt(req.params.id);\n      console.log(`üóëÔ∏è Tentando deletar agendamento ID: ${id}`);\n      \n      const success = await storage.deleteAppointment(id, req.user.userId);\n      if (!success) {\n        console.log(`‚ùå Agendamento ${id} n√£o encontrado para o usu√°rio`);\n        console.log(\"==== LOG FIM: DELETE /api/appointments (N√ÉO ENCONTRADO) ====\");\n        return res.status(404).json({ message: \"Appointment not found\" });\n      }\n      \n      console.log(`‚úÖ Agendamento ${id} deletado com sucesso`);\n      console.log(\"==== LOG FIM: DELETE /api/appointments (SUCESSO) ====\");\n      \n      res.json({ message: \"Appointment deleted successfully\" });\n    } catch (error: any) {\n      console.log(`‚ùå Erro ao deletar agendamento ${req.params.id}:`);\n      console.log(\"Tipo do erro:\", error.constructor.name);\n      console.log(\"Mensagem:\", error.message);\n      console.log(\"==== LOG FIM: DELETE /api/appointments (ERRO) ====\");\n      \n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Route optimization\n  app.post(\"/api/gerar-rota\", authenticateToken, async (req: any, res) => {\n    try {\n      const { appointmentIds } = req.body;\n      if (!Array.isArray(appointmentIds) || appointmentIds.length === 0) {\n        return res.status(400).json({ message: \"Appointment IDs are required\" });\n      }\n      \n      const optimizedRoute = await storage.optimizeRoute(appointmentIds, req.user.userId);\n      res.json(optimizedRoute);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Checklists routes\n  app.get(\"/api/checklists\", authenticateToken, async (req: any, res) => {\n    try {\n      const checklists = await storage.getChecklists(req.user.userId);\n      res.json(checklists);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/checklists\", authenticateToken, async (req: any, res) => {\n    try {\n      const checklistData = insertChecklistSchema.parse(req.body);\n      const checklist = await storage.createChecklist(checklistData, req.user.userId);\n      res.json(checklist);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.put(\"/api/checklists/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const checklistData = insertChecklistSchema.partial().parse(req.body);\n      const checklist = await storage.updateChecklist(id, checklistData, req.user.userId);\n      res.json(checklist);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/checklists/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.deleteChecklist(id, req.user.userId);\n      if (!success) {\n        return res.status(404).json({ message: \"Checklist not found\" });\n      }\n      res.json({ message: \"Checklist deleted successfully\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Business Rules routes\n  app.get(\"/api/business-rules\", authenticateToken, async (req: any, res) => {\n    try {\n      const businessRules = await storage.getBusinessRules(req.user.userId);\n      res.json(businessRules || {});\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/business-rules\", authenticateToken, async (req: any, res) => {\n    try {\n      const businessRulesData = insertBusinessRulesSchema.parse(req.body);\n      const businessRules = await storage.createBusinessRules(businessRulesData, req.user.userId);\n      res.json(businessRules);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/business-rules/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const businessRulesData = insertBusinessRulesSchema.partial().parse(req.body);\n      const businessRules = await storage.updateBusinessRules(id, businessRulesData, req.user.userId);\n      res.json(businessRules);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  // Teams routes - Nova funcionalidade conforme solicitado\n  app.get(\"/api/teams\", authenticateToken, async (req: any, res) => {\n    try {\n      const teams = await storage.getTeams(req.user.userId);\n      res.json(teams);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.get(\"/api/teams/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const team = await storage.getTeam(id, req.user.userId);\n      if (!team) {\n        return res.status(404).json({ message: \"Team not found\" });\n      }\n      res.json(team);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/teams\", authenticateToken, async (req: any, res) => {\n    try {\n      const teamData = insertTeamSchema.parse(req.body);\n      const team = await storage.createTeam(teamData, req.user.userId);\n      res.json(team);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.patch(\"/api/teams/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const teamData = insertTeamSchema.partial().parse(req.body);\n      const team = await storage.updateTeam(id, teamData, req.user.userId);\n      res.json(team);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/teams/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.deleteTeam(id, req.user.userId);\n      if (!success) {\n        return res.status(404).json({ message: \"Team not found\" });\n      }\n      res.json({ message: \"Team deleted successfully\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Team members routes - Para gerenciar membros das equipes\n  app.get(\"/api/team-members/:teamId\", authenticateToken, async (req: any, res) => {\n    try {\n      const teamId = parseInt(req.params.teamId);\n      const members = await storage.getTeamMembers(teamId, req.user.userId);\n      res.json(members);\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  app.post(\"/api/team-members\", authenticateToken, async (req: any, res) => {\n    try {\n      const memberData = insertTeamMemberSchema.parse(req.body);\n      const member = await storage.addTeamMember(memberData, req.user.userId);\n      res.json(member);\n    } catch (error: any) {\n      res.status(400).json({ message: error.message });\n    }\n  });\n\n  app.delete(\"/api/team-members/:id\", authenticateToken, async (req: any, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const success = await storage.removeTeamMember(id, req.user.userId);\n      if (!success) {\n        return res.status(404).json({ message: \"Team member not found\" });\n      }\n      res.json({ message: \"Team member removed successfully\" });\n    } catch (error: any) {\n      res.status(500).json({ message: error.message });\n    }\n  });\n\n  // Proxy OSRM para frontend\n  console.log(\"Procurando arquivo em:\", path.join(__dirname, 'osrm_url.txt'));\n\n  app.get(\"/api/route\", async (req, res) => {\n    console.log(\"==== LOG IN√çCIO: /api/route ====\");\n    console.log(\"Query params recebidos:\");\n    console.log(JSON.stringify(req.query, null, 2));\n    \n    try {\n      const coords = req.query.coords as string;\n      if (!coords) {\n        console.log(\"‚ùå ERRO: Par√¢metro 'coords' ausente\");\n        console.log(\"==== LOG FIM: /api/route (ERRO) ====\");\n        return res.status(400).json({ error: \"Missing 'coords' parameter\" });\n      }\n\n      // Validar que temos pelo menos dois pontos\n      const coordArray = coords.split(';');\n      console.log(\"üìç Array de coordenadas:\");\n      console.log(`Total de pontos: ${coordArray.length}`);\n      console.log(\"Coordenadas individuais:\");\n      coordArray.forEach((coord, idx) => {\n        console.log(`  ${idx + 1}: ${coord}`);\n      });\n      \n      if (coordArray.length < 2) {\n        console.log(\"‚ùå ERRO: Coordenadas insuficientes\");\n        console.log(\"==== LOG FIM: /api/route (ERRO) ====\");\n        return res.status(400).json({ error: \"S√£o necess√°rias pelo menos 2 coordenadas para calcular uma rota\" });\n      }\n\n      // Validar formato das coordenadas\n      console.log(\"üîç Validando formato das coordenadas...\");\n      for (const coord of coordArray) {\n        const parts = coord.split(',');\n        if (parts.length !== 2 || isNaN(parseFloat(parts[0])) || isNaN(parseFloat(parts[1]))) {\n          console.log(`‚ùå ERRO: Formato inv√°lido para coordenada: ${coord}`);\n          console.log(\"==== LOG FIM: /api/route (ERRO FORMATO) ====\");\n          return res.status(400).json({ error: `Formato de coordenada inv√°lido: ${coord}. Use formato: longitude,latitude` });\n        }\n      }\n\n      // Usa o endere√ßo da vari√°vel de ambiente, SEM barra no final!\n      const OSRM_URL = getOsrmUrl()?.replace(/\\/$/, '') || null;\n      console.log(\"üåê OSRM_URL configurado:\", OSRM_URL);\n      \n      if (!OSRM_URL) {\n        console.log(\"‚ùå ERRO: OSRM_URL n√£o configurado\");\n        console.log(\"==== LOG FIM: /api/route (ERRO CONFIG) ====\");\n        return res.status(500).json({ error: \"Endere√ßo OSRM n√£o configurado. Crie/atualize o arquivo osrm_url.txt.\" });\n      }\n      \n      const osrmUrl = `${OSRM_URL}/route/v1/driving/${coords}?overview=full&geometries=geojson`;\n      console.log(\"üåê URL completa para OSRM:\");\n      console.log(osrmUrl);\n      console.log(\"üìç Coordenadas validadas:\", coordArray.length, \"pontos\");\n      \n      console.log(\"üöÄ Fazendo chamada para OSRM...\");\n      const osrmRes = await fetch(osrmUrl, {\n        headers: { \"ngrok-skip-browser-warning\": \"true\" }\n      });\n      \n      console.log(\"üì¶ Status da resposta OSRM:\", osrmRes.status);\n      console.log(\"üì¶ Headers da resposta:\");\n      console.log(JSON.stringify(Object.fromEntries(osrmRes.headers.entries()), null, 2));\n      \n      if (!osrmRes.ok) {\n        const text = await osrmRes.text();\n        console.log(\"‚ùå ERRO OSRM - Resposta completa:\");\n        console.log(text);\n        console.log(\"==== LOG FIM: /api/route (ERRO OSRM) ====\");\n        return res.status(500).json({ error: `OSRM error: ${text.substring(0, 300)}` });\n      }\n      \n      const data = await osrmRes.json();\n      console.log(\"‚úÖ Rota OSRM calculada com sucesso\");\n      console.log(\"üìä Estrutura da resposta OSRM:\");\n      console.log(`- Rotas encontradas: ${data.routes?.length || 0}`);\n      console.log(`- Waypoints: ${data.waypoints?.length || 0}`);\n      if (data.routes?.[0]) {\n        console.log(`- Dist√¢ncia: ${data.routes[0].distance}m`);\n        console.log(`- Dura√ß√£o: ${data.routes[0].duration}s`);\n      }\n      console.log(\"==== LOG FIM: /api/route (SUCESSO) ====\");\n      \n      return res.json(data);\n    } catch (err: any) {\n      console.log(\"‚ùå ERRO EXCE√á√ÉO no proxy OSRM:\");\n      console.log(\"Mensagem:\", err.message);\n      console.log(\"Stack trace:\");\n      console.log(err.stack);\n      console.log(\"==== LOG FIM: /api/route (EXCE√á√ÉO) ====\");\n      return res.status(500).json({ error: \"Erro no proxy OSRM\", details: err.message });\n    }\n  });\n\n  // Registrar rotas de otimiza√ß√£o\n  const { registerRoutesAPI } = await import(\"./routes/routes.api\");\n  registerRoutesAPI(app);\n\n  const httpServer = createServer(app);\n  return httpServer;\n}","size_bytes":42152},"server/storage.ts":{"content":"import {\n  type User, type InsertUser,\n  type Client, type InsertClient,\n  type Service, type InsertService,\n  type Technician, type InsertTechnician,\n  type Vehicle, type InsertVehicle,\n  type Appointment, type InsertAppointment,\n  type Checklist, type InsertChecklist,\n  type BusinessRules, type InsertBusinessRules,\n  type Team, type InsertTeam,\n  type TeamMember, type InsertTeamMember,\n  users, clients, services, technicians, vehicles, appointments, checklists, businessRules, teams, teamMembers\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, or, ilike } from \"drizzle-orm\";\nimport bcrypt from \"bcryptjs\";\n\nexport interface IStorage {\n  // Users\n  createUser(user: InsertUser): Promise<User>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserById(id: number): Promise<User | undefined>;\n  validateUser(email: string, password: string): Promise<User | null>;\n\n  // Clients\n  getClients(userId: number): Promise<Client[]>;\n  getClient(id: number, userId: number): Promise<Client | undefined>;\n  getClientByCpf(cpf: string, userId: number): Promise<Client | undefined>;\n  createClient(client: InsertClient, userId: number): Promise<Client>;\n  updateClient(id: number, client: Partial<InsertClient>, userId: number): Promise<Client>;\n  deleteClient(id: number, userId: number): Promise<boolean>;\n  searchClients(query: string, userId: number): Promise<Client[]>;\n\n  // Services\n  getServices(userId: number): Promise<Service[]>;\n  getService(id: number, userId: number): Promise<Service | undefined>;\n  createService(service: InsertService, userId: number): Promise<Service>;\n  updateService(id: number, service: Partial<InsertService>, userId: number): Promise<Service>;\n  deleteService(id: number, userId: number): Promise<boolean>;\n\n  // Technicians\n  getTechnicians(userId: number): Promise<Technician[]>;\n  getTechnician(id: number, userId: number): Promise<Technician | undefined>;\n  createTechnician(technician: InsertTechnician, userId: number): Promise<Technician>;\n  updateTechnician(id: number, technician: Partial<InsertTechnician>, userId: number): Promise<Technician>;\n  deleteTechnician(id: number, userId: number): Promise<boolean>;\n\n  // Vehicles\n  getVehicles(userId: number): Promise<Vehicle[]>;\n  getVehicle(id: number, userId: number): Promise<Vehicle | undefined>;\n  createVehicle(vehicle: InsertVehicle, userId: number): Promise<Vehicle>;\n  updateVehicle(id: number, vehicle: Partial<InsertVehicle>, userId: number): Promise<Vehicle>;\n  deleteVehicle(id: number, userId: number): Promise<boolean>;\n\n  // Appointments\n  getAppointments(userId: number): Promise<Appointment[]>;\n  getAppointment(id: number, userId: number): Promise<Appointment | undefined>;\n  createAppointment(appointment: InsertAppointment, userId: number): Promise<Appointment>;\n  updateAppointment(id: number, appointment: Partial<InsertAppointment>, userId: number): Promise<Appointment>;\n  deleteAppointment(id: number, userId: number): Promise<boolean>;\n  getAppointmentsByDate(date: string, userId: number): Promise<Appointment[]>;\n\n  // Checklists\n  getChecklists(userId: number): Promise<Checklist[]>;\n  getChecklist(id: number, userId: number): Promise<Checklist | undefined>;\n  createChecklist(checklist: InsertChecklist, userId: number): Promise<Checklist>;\n  updateChecklist(id: number, checklist: Partial<InsertChecklist>, userId: number): Promise<Checklist>;\n  deleteChecklist(id: number, userId: number): Promise<boolean>;\n\n  // Business Rules\n  getBusinessRules(userId: number): Promise<BusinessRules | undefined>;\n  createBusinessRules(businessRules: InsertBusinessRules, userId: number): Promise<BusinessRules>;\n  updateBusinessRules(id: number, businessRules: Partial<InsertBusinessRules>, userId: number): Promise<BusinessRules>;\n\n  // Teams - Opera√ß√µes para equipes conforme solicitado\n  getTeams(userId: number): Promise<Team[]>;\n  getTeam(id: number, userId: number): Promise<Team | undefined>;\n  createTeam(team: InsertTeam, userId: number): Promise<Team>;\n  updateTeam(id: number, team: Partial<InsertTeam>, userId: number): Promise<Team>;\n  deleteTeam(id: number, userId: number): Promise<boolean>;\n  getTeamMembers(teamId: number, userId: number): Promise<TeamMember[]>;\n  addTeamMember(teamMember: InsertTeamMember, userId: number): Promise<TeamMember>;\n  removeTeamMember(id: number, userId: number): Promise<boolean>;\n\n  // Route optimization\n  optimizeRoute(appointmentIds: number[], userId: number): Promise<{ optimizedOrder: Appointment[], totalDistance: number, estimatedTime: number }>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // Users\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const hashedPassword = await bcrypt.hash(insertUser.password, 10);\n    const [user] = await db\n      .insert(users)\n      .values({ ...insertUser, password: hashedPassword })\n      .returning();\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user || undefined;\n  }\n\n  async getUserById(id: number): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async validateUser(email: string, password: string): Promise<User | null> {\n    const user = await this.getUserByEmail(email);\n    if (user && await bcrypt.compare(password, user.password)) {\n      return user;\n    }\n    return null;\n  }\n\n  // Clients\n  async getClients(userId: number): Promise<Client[]> {\n    return await db.select().from(clients).where(eq(clients.userId, userId));\n  }\n\n  async getClient(id: number, userId: number): Promise<Client | undefined> {\n    const [client] = await db.select().from(clients).where(and(eq(clients.id, id), eq(clients.userId, userId)));\n    return client || undefined;\n  }\n\n  async getClientByCpf(cpf: string, userId: number): Promise<Client | undefined> {\n    const [client] = await db.select().from(clients).where(and(eq(clients.cpf, cpf), eq(clients.userId, userId)));\n    return client || undefined;\n  }\n\n  async createClient(insertClient: InsertClient, userId: number): Promise<Client> {\n    const [client] = await db\n      .insert(clients)\n      .values({ ...insertClient, userId })\n      .returning();\n    return client;\n  }\n\n  async updateClient(id: number, clientData: Partial<InsertClient>, userId: number): Promise<Client> {\n    const [client] = await db\n      .update(clients)\n      .set(clientData)\n      .where(and(eq(clients.id, id), eq(clients.userId, userId)))\n      .returning();\n    return client;\n  }\n\n  async deleteClient(id: number, userId: number): Promise<boolean> {\n    const result = await db\n      .delete(clients)\n      .where(and(eq(clients.id, id), eq(clients.userId, userId)));\n    return (result.rowCount || 0) > 0;\n  }\n\n  async searchClients(query: string, userId: number): Promise<Client[]> {\n    console.log(\"Busca cliente - input:\", query);\n    const searchTerm = `%${query}%`;\n    \n    const results = await db\n      .select()\n      .from(clients)\n      .where(\n        and(\n          eq(clients.userId, userId),\n          or(\n            ilike(clients.name, searchTerm),\n            ilike(clients.cpf, searchTerm)\n          )\n        )\n      )\n      .limit(5);\n    \n    console.log(\"Resultados encontrados:\", results);\n    return results;\n  }\n\n  // Services\n  async getServices(userId: number): Promise<Service[]> {\n    return await db.select().from(services).where(eq(services.userId, userId));\n  }\n\n  async getService(id: number, userId: number): Promise<Service | undefined> {\n    const [service] = await db.select().from(services).where(and(eq(services.id, id), eq(services.userId, userId)));\n    return service || undefined;\n  }\n\n  async createService(insertService: InsertService, userId: number): Promise<Service> {\n    const [service] = await db\n      .insert(services)\n      .values({ ...insertService, userId })\n      .returning();\n    return service;\n  }\n\n  async updateService(id: number, serviceData: Partial<InsertService>, userId: number): Promise<Service> {\n    const [service] = await db\n      .update(services)\n      .set(serviceData)\n      .where(and(eq(services.id, id), eq(services.userId, userId)))\n      .returning();\n    return service;\n  }\n\n  async deleteService(id: number, userId: number): Promise<boolean> {\n    const result = await db\n      .delete(services)\n      .where(and(eq(services.id, id), eq(services.userId, userId)));\n    return (result.rowCount || 0) > 0;\n  }\n\n  // Technicians\n  async getTechnicians(userId: number): Promise<Technician[]> {\n    return await db.select().from(technicians).where(eq(technicians.userId, userId));\n  }\n\n  async getTechnician(id: number, userId: number): Promise<Technician | undefined> {\n    const [technician] = await db.select().from(technicians).where(and(eq(technicians.id, id), eq(technicians.userId, userId)));\n    return technician || undefined;\n  }\n\n  async createTechnician(insertTechnician: InsertTechnician, userId: number): Promise<Technician> {\n    const [technician] = await db\n      .insert(technicians)\n      .values({ ...insertTechnician, userId })\n      .returning();\n    return technician;\n  }\n\n  async updateTechnician(id: number, technicianData: Partial<InsertTechnician>, userId: number): Promise<Technician> {\n    const [technician] = await db\n      .update(technicians)\n      .set(technicianData)\n      .where(and(eq(technicians.id, id), eq(technicians.userId, userId)))\n      .returning();\n    return technician;\n  }\n\n  async deleteTechnician(id: number, userId: number): Promise<boolean> {\n    const result = await db\n      .delete(technicians)\n      .where(and(eq(technicians.id, id), eq(technicians.userId, userId)));\n    return (result.rowCount || 0) > 0;\n  }\n\n  // Vehicles\n  async getVehicles(userId: number): Promise<Vehicle[]> {\n    return await db.select().from(vehicles).where(eq(vehicles.userId, userId));\n  }\n\n  async getVehicle(id: number, userId: number): Promise<Vehicle | undefined> {\n    const [vehicle] = await db.select().from(vehicles).where(and(eq(vehicles.id, id), eq(vehicles.userId, userId)));\n    return vehicle || undefined;\n  }\n\n  async createVehicle(insertVehicle: InsertVehicle, userId: number): Promise<Vehicle> {\n    const [vehicle] = await db\n      .insert(vehicles)\n      .values({ ...insertVehicle, userId })\n      .returning();\n    return vehicle;\n  }\n\n  async updateVehicle(id: number, vehicleData: Partial<InsertVehicle>, userId: number): Promise<Vehicle> {\n    const [vehicle] = await db\n      .update(vehicles)\n      .set(vehicleData)\n      .where(and(eq(vehicles.id, id), eq(vehicles.userId, userId)))\n      .returning();\n    return vehicle;\n  }\n\n  async deleteVehicle(id: number, userId: number): Promise<boolean> {\n    const result = await db\n      .delete(vehicles)\n      .where(and(eq(vehicles.id, id), eq(vehicles.userId, userId)));\n    return (result.rowCount || 0) > 0;\n  }\n\n  // Appointments\n  async getAppointments(userId: number): Promise<Appointment[]> {\n    return await db.select().from(appointments).where(eq(appointments.userId, userId));\n  }\n\n  async getAppointment(id: number, userId: number): Promise<Appointment | undefined> {\n    const [appointment] = await db.select().from(appointments).where(and(eq(appointments.id, id), eq(appointments.userId, userId)));\n    return appointment || undefined;\n  }\n\n  async createAppointment(insertAppointment: InsertAppointment, userId: number): Promise<Appointment> {\n    const [appointment] = await db\n      .insert(appointments)\n      .values({ ...insertAppointment, userId })\n      .returning();\n    return appointment;\n  }\n\n  async updateAppointment(id: number, appointmentData: Partial<InsertAppointment>, userId: number): Promise<Appointment> {\n    console.log(`üîß [STORAGE] Dados recebidos para atualiza√ß√£o:`, appointmentData);\n    \n    // Processar scheduledDate se presente\n    const processedData = { ...appointmentData };\n    if (processedData.scheduledDate) {\n      console.log(`üìÖ [STORAGE] Processando scheduledDate:`, processedData.scheduledDate);\n      \n      // Garantir que scheduledDate seja uma string ISO v√°lida ou Date\n      if (typeof processedData.scheduledDate === 'string') {\n        // Verificar se √© uma string ISO v√°lida\n        const dateTest = new Date(processedData.scheduledDate);\n        if (isNaN(dateTest.getTime())) {\n          throw new Error(`Data inv√°lida no storage: ${processedData.scheduledDate}`);\n        }\n        // Converter para Date object para o Drizzle\n        processedData.scheduledDate = dateTest;\n        console.log(`‚úÖ [STORAGE] String convertida para Date object`);\n      } else if (!(processedData.scheduledDate instanceof Date)) {\n        throw new Error(`Tipo de data inv√°lido no storage: ${typeof processedData.scheduledDate}`);\n      }\n    }\n    \n    console.log(`üîÑ [STORAGE] Dados processados:`, processedData);\n    \n    const [appointment] = await db\n      .update(appointments)\n      .set(processedData)\n      .where(and(eq(appointments.id, id), eq(appointments.userId, userId)))\n      .returning();\n      \n    console.log(`‚úÖ [STORAGE] Agendamento atualizado no banco: ${appointment.id}`);\n    return appointment;\n  }\n\n  async deleteAppointment(id: number, userId: number): Promise<boolean> {\n    const result = await db\n      .delete(appointments)\n      .where(and(eq(appointments.id, id), eq(appointments.userId, userId)));\n    return (result.rowCount || 0) > 0;\n  }\n\n  async getAppointmentsByDate(date: string, userId: number): Promise<Appointment[]> {\n    return await db.select().from(appointments).where(eq(appointments.userId, userId));\n  }\n\n  // Checklists\n  async getChecklists(userId: number): Promise<Checklist[]> {\n    return await db.select().from(checklists).where(eq(checklists.userId, userId));\n  }\n\n  async getChecklist(id: number, userId: number): Promise<Checklist | undefined> {\n    const [checklist] = await db.select().from(checklists).where(and(eq(checklists.id, id), eq(checklists.userId, userId)));\n    return checklist || undefined;\n  }\n\n  async createChecklist(insertChecklist: InsertChecklist, userId: number): Promise<Checklist> {\n    const [checklist] = await db\n      .insert(checklists)\n      .values({ ...insertChecklist, userId })\n      .returning();\n    return checklist;\n  }\n\n  async updateChecklist(id: number, checklistData: Partial<InsertChecklist>, userId: number): Promise<Checklist> {\n    const [checklist] = await db\n      .update(checklists)\n      .set(checklistData)\n      .where(and(eq(checklists.id, id), eq(checklists.userId, userId)))\n      .returning();\n    return checklist;\n  }\n\n  async deleteChecklist(id: number, userId: number): Promise<boolean> {\n    const result = await db\n      .delete(checklists)\n      .where(and(eq(checklists.id, id), eq(checklists.userId, userId)));\n    return (result.rowCount || 0) > 0;\n  }\n\n  // Business Rules\n  async getBusinessRules(userId: number): Promise<BusinessRules | undefined> {\n    const [rules] = await db.select().from(businessRules).where(eq(businessRules.userId, userId));\n    return rules || undefined;\n  }\n\n  async createBusinessRules(insertBusinessRules: InsertBusinessRules, userId: number): Promise<BusinessRules> {\n    const [rules] = await db\n      .insert(businessRules)\n      .values({ ...insertBusinessRules, userId })\n      .returning();\n    return rules;\n  }\n\n  async updateBusinessRules(id: number, rulesData: Partial<InsertBusinessRules>, userId: number): Promise<BusinessRules> {\n    const [rules] = await db\n      .update(businessRules)\n      .set(rulesData)\n      .where(and(eq(businessRules.id, id), eq(businessRules.userId, userId)))\n      .returning();\n    return rules;\n  }\n\n  // Route optimization\n  async optimizeRoute(appointmentIds: number[], userId: number): Promise<{ optimizedOrder: Appointment[], totalDistance: number, estimatedTime: number }> {\n    const allAppointments = await db.select().from(appointments).where(eq(appointments.userId, userId));\n    const appointmentsList = allAppointments.filter(apt => appointmentIds.includes(apt.id));\n\n    // Simple optimization - in production you'd implement actual routing algorithms\n    return {\n      optimizedOrder: appointmentsList,\n      totalDistance: appointmentsList.length * 5, // Mock calculation\n      estimatedTime: appointmentsList.length * 30 // Mock calculation\n    };\n  }\n\n  // Teams - Implementa√ß√£o das opera√ß√µes de equipes conforme solicitado\n  async getTeams(userId: number): Promise<Team[]> {\n    return await db.select().from(teams).where(eq(teams.userId, userId));\n  }\n\n  async getTeam(id: number, userId: number): Promise<Team | undefined> {\n    const [team] = await db.select().from(teams).where(and(eq(teams.id, id), eq(teams.userId, userId)));\n    return team || undefined;\n  }\n\n  async createTeam(insertTeam: InsertTeam, userId: number): Promise<Team> {\n    const [team] = await db.insert(teams).values({ ...insertTeam, userId }).returning();\n    return team;\n  }\n\n  async updateTeam(id: number, teamData: Partial<InsertTeam>, userId: number): Promise<Team> {\n    const [team] = await db.update(teams)\n      .set(teamData)\n      .where(and(eq(teams.id, id), eq(teams.userId, userId)))\n      .returning();\n    return team;\n  }\n\n  async deleteTeam(id: number, userId: number): Promise<boolean> {\n    // Remove membros da equipe primeiro\n    await db.delete(teamMembers).where(and(eq(teamMembers.teamId, id), eq(teamMembers.userId, userId)));\n    \n    const result = await db.delete(teams).where(and(eq(teams.id, id), eq(teams.userId, userId)));\n    return (result.rowCount || 0) > 0;\n  }\n\n  async getTeamMembers(teamId: number, userId: number): Promise<TeamMember[]> {\n    return await db.select().from(teamMembers).where(and(eq(teamMembers.teamId, teamId), eq(teamMembers.userId, userId)));\n  }\n\n  async addTeamMember(insertTeamMember: InsertTeamMember, userId: number): Promise<TeamMember> {\n    const [teamMember] = await db.insert(teamMembers).values({ ...insertTeamMember, userId }).returning();\n    return teamMember;\n  }\n\n  async removeTeamMember(id: number, userId: number): Promise<boolean> {\n    const result = await db.delete(teamMembers).where(and(eq(teamMembers.id, id), eq(teamMembers.userId, userId)));\n    return (result.rowCount || 0) > 0;\n  }\n}\n\nexport const storage = new DatabaseStorage();","size_bytes":18330},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n  middlewareMode: true,\n  hmr: { server },\n  allowedHosts: [\"localhost\", \"127.0.0.1\",\"f130346c-8d15-41c5-b416-c62a70be1792-00-ptd0q90wpvxz.janeway.replit.dev\",\"9d646736-88fd-4b49-839a-250044e764d3-00-1m4oulyvq26qz.janeway.replit.dev\",\"a78649e2-d2af-4776-933c-4e04a348a333-00-2u6wmcz3go80z.worf.replit.dev\",\"10da3e29-2de8-4b1f-a8cd-5341f127deb7-00-19w3sw3bcbtxc.janeway.replit.dev\"],\n  };\n\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2567},"shared/plan-limits.ts":{"content":"// Plan limits configuration for route optimization\nexport interface PlanLimits {\n  maxRouteAddresses: number;\n  maxVehicles: number;\n  maxTechnicians: number;\n  maxMonthlyRequests: number;\n}\n\nexport const PLAN_LIMITS: Record<string, PlanLimits> = {\n  basic: {\n    maxRouteAddresses: 15,\n    maxVehicles: 3,\n    maxTechnicians: 5,\n    maxMonthlyRequests: 1000,\n  },\n  professional: {\n    maxRouteAddresses: 50,\n    maxVehicles: 10,\n    maxTechnicians: 20,\n    maxMonthlyRequests: 5000,\n  },\n  enterprise: {\n    maxRouteAddresses: 150,\n    maxVehicles: 50,\n    maxTechnicians: 100,\n    maxMonthlyRequests: 20000,\n  },\n  custom: {\n    maxRouteAddresses: 500,\n    maxVehicles: 200,\n    maxTechnicians: 500,\n    maxMonthlyRequests: 100000,\n  },\n};\n\n// Default plan for users without specified plan\nexport const DEFAULT_PLAN = 'basic';\n\nexport function getPlanLimits(planType?: string): PlanLimits {\n  const plan = planType || DEFAULT_PLAN;\n  return PLAN_LIMITS[plan.toLowerCase()] || PLAN_LIMITS[DEFAULT_PLAN];\n}","size_bytes":1008},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp, decimal, uuid, jsonb, doublePrecision, varchar } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Users table\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  username: text(\"username\").notNull().unique(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  name: text(\"name\").notNull(),\n  plan: text(\"plan\").notNull().default(\"basic\"), // basic, professional\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Clients table\nexport const clients = pgTable(\"clients\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\"),\n  phone1: text(\"phone1\"),\n  phone2: text(\"phone2\"),\n  cpf: text(\"cpf\").notNull().unique(),\n  cep: text(\"cep\").notNull(),\n  bairro: text(\"bairro\").notNull(),      // <-- NOVO CAMPO\n  cidade: text(\"cidade\").notNull(),      // <-- NOVO CAMPO\n  logradouro: text(\"logradouro\").notNull(),\n  numero: text(\"numero\").notNull(),\n  complemento: text(\"complemento\"),\n  observacoes: text(\"observacoes\"),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n\n// Services table\nexport const services = pgTable(\"services\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  duration: integer(\"duration\").notNull(), // in minutes\n  price: decimal(\"price\", { precision: 10, scale: 2 }),\n  cost: decimal(\"cost\", { precision: 10, scale: 2 }),\n  // Campo adicionado para pontos/remunera√ß√£o conforme solicitado\n  points: integer(\"points\"), // Pontos/remunera√ß√£o aceita apenas n√∫meros\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Technicians table\nexport const technicians = pgTable(\"technicians\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  email: text(\"email\"),\n  phone: text(\"phone\").notNull(),\n  documento: text(\"documento\").notNull(),\n  cep: text(\"cep\").notNull(),\n  logradouro: text(\"logradouro\").notNull(),\n  numero: text(\"numero\").notNull(),\n  complemento: text(\"complemento\"),\n  bairro: text(\"bairro\").notNull().default(\"N√£o informado\"),\n  cidade: text(\"cidade\").notNull().default(\"N√£o informado\"),\n  estado: text(\"estado\").notNull().default(\"N√£o informado\"),\n  specialization: text(\"specialization\"),\n  observacoes: text(\"observacoes\"),\n  serviceIds: text(\"service_ids\").array(),\n  // Endere√ßo de In√≠cio Di√°rio (opcional) - usado como ponto de partida na roteiriza√ß√£o\n  // Se n√£o preenchido, ser√° usado o endere√ßo padr√£o da empresa\n  enderecoInicioCep: text(\"endereco_inicio_cep\"),\n  enderecoInicioLogradouro: text(\"endereco_inicio_logradouro\"),\n  enderecoInicioNumero: text(\"endereco_inicio_numero\"),\n  enderecoInicioComplemento: text(\"endereco_inicio_complemento\"),\n  enderecoInicioBairro: text(\"endereco_inicio_bairro\"),\n  enderecoInicioCidade: text(\"endereco_inicio_cidade\"),\n  enderecoInicioEstado: text(\"endereco_inicio_estado\"),\n  isActive: boolean(\"is_active\").default(true).notNull(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Vehicles table\nexport const vehicles = pgTable(\"vehicles\", {\n  id: serial(\"id\").primaryKey(),\n  plate: text(\"plate\").notNull(),\n  model: text(\"model\").notNull(),\n  brand: text(\"brand\").notNull(),\n  year: integer(\"year\").notNull(),\n  technicianId: integer(\"technician_id\").references(() => technicians.id),\n  teamId: integer(\"team_id\").references(() => teams.id),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Appointments table\nexport const appointments = pgTable(\"appointments\", {\n  id: serial(\"id\").primaryKey(),\n  clientId: integer(\"client_id\").references(() => clients.id),\n  serviceId: integer(\"service_id\").notNull().references(() => services.id),\n  technicianId: integer(\"technician_id\").references(() => technicians.id),\n  teamId: integer(\"team_id\").references(() => teams.id),\n  scheduledDate: timestamp(\"scheduled_date\").notNull(),\n  allDay: boolean(\"all_day\").default(false).notNull(), // Campo para eventos \"dia todo\"\n  status: text(\"status\").notNull().default(\"scheduled\"), // scheduled, in_progress, completed, cancelled\n  priority: text(\"priority\").notNull().default(\"normal\"), // normal, high, urgent\n  notes: text(\"notes\"),\n  cep: text(\"cep\").notNull(),\n  logradouro: text(\"logradouro\").notNull(),\n  numero: text(\"numero\").notNull(),\n  complemento: text(\"complemento\"),\n  bairro: text(\"bairro\").notNull().default(\"N√£o informado\"),\n  cidade: text(\"cidade\").notNull().default(\"N√£o informado\"),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Vehicle checklists table\nexport const checklists = pgTable(\"checklists\", {\n  id: serial(\"id\").primaryKey(),\n  vehicleId: integer(\"vehicle_id\").notNull().references(() => vehicles.id),\n  technicianId: integer(\"technician_id\").notNull().references(() => technicians.id),\n  checkDate: timestamp(\"check_date\").defaultNow().notNull(),\n  items: text(\"items\").notNull(), // JSON string of checklist items\n  notes: text(\"notes\"),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Business rules table\nexport const businessRules = pgTable(\"business_rules\", {\n  id: serial(\"id\").primaryKey(),\n  maximoParadasPorRota: integer(\"maximo_paradas_por_rota\").notNull().default(10),\n  horarioInicioTrabalho: text(\"horario_inicio_trabalho\").notNull().default(\"08:00\"),\n  horarioFimTrabalho: text(\"horario_fim_trabalho\").notNull().default(\"18:00\"),\n  tempoDeslocamentoBuffer: integer(\"tempo_deslocamento_buffer\").notNull().default(15), // in minutes\n  minutosEntreParadas: integer(\"minutos_entre_paradas\").notNull().default(30),\n  distanciaMaximaEntrePontos: decimal(\"distancia_maxima_entre_pontos\", { precision: 8, scale: 2 }).notNull().default(\"50.00\"), // in km\n  enderecoEmpresaCep: text(\"endereco_empresa_cep\").notNull(),\n  enderecoEmpresaLogradouro: text(\"endereco_empresa_logradouro\").notNull(),\n  enderecoEmpresaNumero: text(\"endereco_empresa_numero\").notNull(),\n  enderecoEmpresaComplemento: text(\"endereco_empresa_complemento\"),\n  enderecoEmpresaBairro: text(\"endereco_empresa_bairro\").notNull(),\n  enderecoEmpresaCidade: text(\"endereco_empresa_cidade\").notNull(),\n  enderecoEmpresaEstado: text(\"endereco_empresa_estado\").notNull(),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Teams table - Nova tabela para equipes conforme solicitado\nexport const teams = pgTable(\"teams\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(), // Nome da equipe\n  serviceIds: text(\"service_ids\").array(), // IDs dos servi√ßos que a equipe atende\n  // Endere√ßo de In√≠cio Di√°rio (opcional) - usado como ponto de partida na roteiriza√ß√£o\n  // Se n√£o preenchido, ser√° usado o endere√ßo padr√£o da empresa\n  enderecoInicioCep: text(\"endereco_inicio_cep\"),\n  enderecoInicioLogradouro: text(\"endereco_inicio_logradouro\"),\n  enderecoInicioNumero: text(\"endereco_inicio_numero\"),\n  enderecoInicioComplemento: text(\"endereco_inicio_complemento\"),\n  enderecoInicioBairro: text(\"endereco_inicio_bairro\"),\n  enderecoInicioCidade: text(\"endereco_inicio_cidade\"),\n  enderecoInicioEstado: text(\"endereco_inicio_estado\"),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Team members table - Tabela para vincular t√©cnicos √†s equipes\nexport const teamMembers = pgTable(\"team_members\", {\n  id: serial(\"id\").primaryKey(),\n  teamId: integer(\"team_id\").notNull().references(() => teams.id),\n  technicianId: integer(\"technician_id\").notNull().references(() => technicians.id),\n  userId: integer(\"user_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Routes table - Tabela principal de rotas otimizadas\nexport const routes = pgTable(\"routes\", {\n  id: uuid(\"id\").defaultRandom().primaryKey(),\n  title: varchar(\"title\", { length: 120 }).notNull(),\n  date: timestamp(\"date\", { withTimezone: false }).notNull(),\n  vehicleId: varchar(\"vehicle_id\", { length: 64 }),\n  // respons√°vel pode ser t√©cnico OU equipe ‚Äî usar union simples por tipo+id\n  responsibleType: varchar(\"responsible_type\", { length: 16 }).notNull(), // 'technician' | 'team'\n  responsibleId: varchar(\"responsible_id\", { length: 64 }).notNull(),\n  endAtStart: boolean(\"end_at_start\").notNull().default(false),\n  distanceTotal: integer(\"distance_total\").notNull().default(0), // em metros\n  durationTotal: integer(\"duration_total\").notNull().default(0), // em segundos\n  stopsCount: integer(\"stops_count\").notNull().default(0),\n  status: varchar(\"status\", { length: 24 }).notNull().default(\"optimized\"), // draft|optimized|running|done|canceled\n  polylineGeoJson: jsonb(\"polyline_geojson\"), // GeoJSON LineString\n  displayNumber: integer(\"display_number\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Route stops table - Paradas ordenadas (liga√ß√£o rota ‚Üí agendamentos)\nexport const routeStops = pgTable(\"route_stops\", {\n  id: uuid(\"id\").defaultRandom().primaryKey(),\n  routeId: uuid(\"route_id\").references(() => routes.id).notNull(),\n  appointmentId: uuid(\"appointment_id\").notNull(),\n  order: integer(\"order\").notNull(), // 1..N\n  lat: doublePrecision(\"lat\").notNull(),\n  lng: doublePrecision(\"lng\").notNull(),\n  address: text(\"address\").notNull(),\n});\n\n// Relations\nexport const routeStopsRelations = relations(routeStops, ({ one }) => ({\n  route: one(routes, { fields: [routeStops.routeId], references: [routes.id] }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertClientSchema = createInsertSchema(clients).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertServiceSchema = createInsertSchema(services).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertTechnicianSchema = createInsertSchema(technicians).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertVehicleSchema = createInsertSchema(vehicles).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n}).extend({\n  brand: z.string().min(1, \"Marca √© obrigat√≥ria\"),\n  model: z.string().min(1, \"Modelo √© obrigat√≥rio\"),\n  year: z.number().min(1900, \"Ano deve ser v√°lido\").max(new Date().getFullYear() + 1, \"Ano n√£o pode ser no futuro\"),\n}).refine((data) => {\n  // Pelo menos um respons√°vel deve ser selecionado (t√©cnico ou equipe)\n  return data.technicianId || data.teamId;\n}, {\n  message: \"Selecione um t√©cnico ou equipe respons√°vel pelo ve√≠culo\",\n  path: [\"technicianId\"],\n});\n\nexport const insertAppointmentSchema = createInsertSchema(appointments).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertChecklistSchema = createInsertSchema(checklists).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertTeamSchema = createInsertSchema(teams).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertTeamMemberSchema = createInsertSchema(teamMembers).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n});\n\nexport const insertRouteSchema = createInsertSchema(routes).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertRouteStopSchema = createInsertSchema(routeStops).omit({\n  id: true,\n});\n\nexport const insertBusinessRulesSchema = createInsertSchema(businessRules).omit({\n  id: true,\n  userId: true,\n  createdAt: true,\n}).extend({\n  enderecoEmpresaCep: z.string().regex(/^\\d{5}-?\\d{3}$/, \"CEP deve estar no formato XXXXX-XXX\"),\n  enderecoEmpresaBairro: z.string().min(1, \"Bairro √© obrigat√≥rio\"),\n  enderecoEmpresaCidade: z.string().min(1, \"Cidade √© obrigat√≥ria\"),\n  enderecoEmpresaEstado: z.string().min(2, \"Estado √© obrigat√≥rio\"),\n});\n\n// Login schema\nexport const loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n});\n\n// CEP validation schema\nexport const cepSchema = z.string().regex(/^\\d{5}-?\\d{3}$/, \"CEP deve estar no formato XXXXX-XXX\");\n\n// Client schema with extended validation\nexport const extendedInsertClientSchema = insertClientSchema.extend({\n  cep: cepSchema,\n  bairro: z.string().min(1, \"Bairro √© obrigat√≥rio\"),\n  cidade: z.string().min(1, \"Cidade √© obrigat√≥ria\"),\n  numero: z.string().regex(/^\\d+$/, \"N√∫mero deve conter apenas d√≠gitos\"),\n  phone1: z.string().min(1, \"Telefone 1 √© obrigat√≥rio\").regex(/^\\(\\d{2}\\) \\d{4,5}-\\d{4}$/, \"Telefone deve estar no formato (XX) XXXXX-XXXX ou (XX) XXXX-XXXX\"),\n  phone2: z.string().regex(/^\\(\\d{2}\\) \\d{4,5}-\\d{4}$/, \"Telefone deve estar no formato (XX) XXXXX-XXXX ou (XX) XXXX-XXXX\").optional().or(z.literal(\"\")),\n  email: z.string().regex(/^[^@]*@[^@]*$/, \"Email deve conter @\").optional().or(z.literal(\"\")),\n});\n\n\n// Technician schema with extended validation  \nexport const extendedInsertTechnicianSchema = insertTechnicianSchema.extend({\n  cep: cepSchema,\n  bairro: z.string().min(1, \"Bairro √© obrigat√≥rio\"),\n  cidade: z.string().min(1, \"Cidade √© obrigat√≥ria\"),\n  estado: z.string().min(2, \"Estado √© obrigat√≥rio\"),\n  numero: z.string().regex(/^\\d+$/, \"N√∫mero deve conter apenas d√≠gitos\"),\n  serviceIds: z.array(z.string()).optional(),\n  // Valida√ß√µes opcionais para endere√ßo de in√≠cio di√°rio\n  enderecoInicioCep: z.string().regex(/^\\d{5}-?\\d{3}$/, \"CEP deve estar no formato XXXXX-XXX\").optional().or(z.literal(\"\")),\n  enderecoInicioNumero: z.string().regex(/^\\d+$/, \"N√∫mero deve conter apenas d√≠gitos\").optional().or(z.literal(\"\")),\n  // Campos adicionais de endere√ßo de in√≠cio di√°rio  \n  enderecoInicioBairro: z.string().optional(),\n  enderecoInicioCidade: z.string().optional(),\n  enderecoInicioEstado: z.string().optional(),\n});\n\n// Team schema with extended validation\nexport const extendedInsertTeamSchema = insertTeamSchema.extend({\n  serviceIds: z.array(z.string()).optional(),\n  // Valida√ß√µes opcionais para endere√ßo de in√≠cio di√°rio - id√™ntico aos t√©cnicos\n  enderecoInicioCep: z.string().regex(/^\\d{5}-?\\d{3}$/, \"CEP deve estar no formato XXXXX-XXX\").optional().or(z.literal(\"\")),\n  enderecoInicioNumero: z.string().regex(/^\\d+$/, \"N√∫mero deve conter apenas d√≠gitos\").optional().or(z.literal(\"\")),\n  enderecoInicioBairro: z.string().optional().or(z.literal(\"\")),\n  enderecoInicioCidade: z.string().optional().or(z.literal(\"\")),\n  enderecoInicioEstado: z.string().optional().or(z.literal(\"\")),\n});\n\n// Appointment schema with extended validation\nexport const extendedInsertAppointmentSchema = insertAppointmentSchema.extend({\n  cep: cepSchema,\n  numero: z.string().regex(/^\\d+$/, \"N√∫mero deve conter apenas d√≠gitos\"),\n  scheduledDate: z.union([z.string(), z.date()]).transform((val) => {\n    if (typeof val === 'string') {\n      return new Date(val);\n    }\n    return val;\n  }),\n}).refine((data) => {\n  // Pelo menos um respons√°vel deve ser selecionado (t√©cnico ou equipe)\n  return data.technicianId || data.teamId;\n}, {\n  message: \"Selecione um t√©cnico ou equipe respons√°vel\",\n  path: [\"technicianId\"],\n});\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type Client = typeof clients.$inferSelect;\nexport type InsertClient = z.infer<typeof insertClientSchema>;\nexport type Service = typeof services.$inferSelect;\nexport type InsertService = z.infer<typeof insertServiceSchema>;\nexport type Technician = typeof technicians.$inferSelect;\nexport type InsertTechnician = z.infer<typeof insertTechnicianSchema>;\nexport type Vehicle = typeof vehicles.$inferSelect;\nexport type InsertVehicle = z.infer<typeof insertVehicleSchema>;\nexport type Appointment = typeof appointments.$inferSelect;\nexport type InsertAppointment = z.infer<typeof extendedInsertAppointmentSchema>;\nexport type Checklist = typeof checklists.$inferSelect;\nexport type InsertChecklist = z.infer<typeof insertChecklistSchema>;\nexport type BusinessRules = typeof businessRules.$inferSelect;\nexport type InsertBusinessRules = z.infer<typeof insertBusinessRulesSchema>;\nexport type Team = typeof teams.$inferSelect;\nexport type InsertTeam = z.infer<typeof insertTeamSchema>;\nexport type TeamMember = typeof teamMembers.$inferSelect;\nexport type InsertTeamMember = z.infer<typeof insertTeamMemberSchema>;\nexport type Route = typeof routes.$inferSelect;\nexport type InsertRoute = z.infer<typeof insertRouteSchema>;\nexport type RouteStop = typeof routeStops.$inferSelect;\nexport type InsertRouteStop = z.infer<typeof insertRouteStopSchema>;\nexport type LoginData = z.infer<typeof loginSchema>;\n","size_bytes":17100},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { AuthProvider, useAuth } from \"./lib/auth.tsx\";\nimport Home from \"./pages/Home\";\nimport Login from \"./pages/Login\";\nimport Dashboard from \"./pages/Dashboard\";\nimport Appointments from \"./pages/Appointments\";\nimport FindDate from \"./pages/FindDate\";\nimport Routes from \"./pages/Routes\";\nimport Clients from \"./pages/Clients\";\nimport Technicians from \"./pages/Technicians\";\nimport Vehicles from \"./pages/Vehicles\";\nimport Services from \"./pages/Services\";\nimport BusinessRules from \"./pages/BusinessRules\";\nimport RoutesHistoryPage from \"./pages/routes-history/RoutesHistoryPage\";\nimport Layout from \"./components/Layout\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction AppRoutes() {\n  const { user, isLoading } = useAuth();\n  \n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-gray-50\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-burnt-yellow\"></div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <Switch>\n        <Route path=\"/login\" component={Login} />\n        <Route path=\"/\" component={Home} />\n        <Route component={Home} />\n      </Switch>\n    );\n  }\n\n  return (\n    <Layout>\n      <Switch>\n        <Route path=\"/\" component={Dashboard} />\n        <Route path=\"/dashboard\" component={Dashboard} />\n        <Route path=\"/appointments\" component={Appointments} />\n        <Route path=\"/find-date\" component={FindDate} />\n        <Route path=\"/routes\" component={Routes} />\n        <Route path=\"/clients\" component={Clients} />\n        <Route path=\"/technicians\" component={Technicians} />\n        <Route path=\"/vehicles\" component={Vehicles} />\n        <Route path=\"/services\" component={Services} />\n        <Route path=\"/business-rules\" component={BusinessRules} />\n        <Route path=\"/routes-history\" component={RoutesHistoryPage} />\n        <Route component={NotFound} />\n      </Switch>\n    </Layout>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <AuthProvider>\n        <TooltipProvider>\n          <Toaster />\n          <AppRoutes />\n        </TooltipProvider>\n      </AuthProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":2468},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* React Big Calendar Custom Styles */\n.rbc-calendar {\n  background-color: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 8px;\n  /* padding: 16px; */ /* <- REMOVA ou comente esta linha! */\n  box-sizing: border-box;\n}\n\n.rbc-header {\n  background-color: #f9fafb;\n  border-bottom: 1px solid #e5e7eb;\n  padding: 8px 16px;\n  font-weight: 600;\n  color: #374151;\n}\n\n.rbc-month-view {\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n}\n\n.rbc-date-cell {\n  padding: 4px;\n  border-right: 1px solid #e5e7eb;\n  min-height: 100px;\n  vertical-align: top;\n}\n\n.rbc-date-cell button {\n  color: #374151;\n  font-weight: 500;\n}\n\n.rbc-date-cell.rbc-off-range {\n  background-color: #f9fafb;\n  color: #9ca3af;\n}\n\n.rbc-date-cell.rbc-today {\n  background-color: #fef3c7;\n  font-weight: bold;\n}\n\n.rbc-date-cell.rbc-selected {\n  background-color: #dbeafe;\n}\n\n.rbc-event {\n  border: none !important;\n  border-radius: 4px !important;\n  padding: 2px 6px !important;\n  margin: 1px 0 !important;\n  font-size: 11px !important;\n  font-weight: 600 !important;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1) !important;\n  cursor: pointer !important;\n  transition: all 0.2s ease !important;\n}\n\n.rbc-event:hover {\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15) !important;\n  transform: translateY(-1px) !important;\n}\n\n.rbc-event.rbc-selected {\n  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;\n}\n\n.rbc-event-content {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.rbc-toolbar {\n  background-color: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 12px 16px;\n  margin-bottom: 16px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n}\n\n.rbc-toolbar button {\n  background-color: white;\n  border: 1px solid #d1d5db;\n  border-radius: 6px;\n  padding: 6px 12px;\n  color: #374151;\n  font-weight: 500;\n  transition: all 0.2s;\n}\n\n.rbc-toolbar button:hover {\n  background-color: #f3f4f6;\n  border-color: #9ca3af;\n}\n\n.rbc-toolbar button.rbc-active {\n  background-color: #f59e0b;\n  border-color: #f59e0b;\n  color: white;\n}\n\n.rbc-toolbar .rbc-toolbar-label {\n  font-size: 18px;\n  font-weight: 600;\n  color: #111827;\n  margin: 0 16px;\n}\n\n.rbc-time-view {\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n}\n\n.rbc-time-header {\n  background-color: #f9fafb;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.rbc-time-content {\n  border-left: 1px solid #e5e7eb;\n}\n\n.rbc-timeslot-group {\n  border-bottom: 1px solid #f3f4f6;\n}\n\n.rbc-time-slot {\n  border-top: 1px solid #f3f4f6;\n}\n\n.rbc-current-time-indicator {\n  background-color: #ef4444;\n  height: 2px;\n  z-index: 10;\n}\n\n.rbc-allday-cell {\n  background-color: #f9fafb;\n  border-bottom: 1px solid #e5e7eb;\n  padding: 8px;\n}\n\n.rbc-day-bg + .rbc-day-bg {\n  border-left: 1px solid #e5e7eb;\n}\n\n.rbc-month-row + .rbc-month-row {\n  border-top: 1px solid #e5e7eb;\n}\n\n.rbc-agenda-view {\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n}\n\n.rbc-agenda-view table {\n  width: 100%;\n}\n\n.rbc-agenda-view .rbc-agenda-date-cell,\n.rbc-agenda-view .rbc-agenda-time-cell,\n.rbc-agenda-view .rbc-agenda-event-cell {\n  padding: 8px 12px;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n/* Week/Day View Improvements */\n.rbc-time-view {\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n}\n\n.rbc-time-header {\n  background-color: #f9fafb;\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.rbc-time-header-content {\n  border-left: 1px solid #e5e7eb;\n  min-height: 40px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-weight: 600;\n  color: #374151;\n}\n\n.rbc-time-header-gutter {\n  background-color: #f9fafb;\n  border-right: 1px solid #e5e7eb;\n}\n\n.rbc-time-content {\n  border-top: 1px solid #e5e7eb;\n}\n\n.rbc-time-slot {\n  border-bottom: 1px solid #f3f4f6;\n  border-right: 1px solid #e5e7eb;\n}\n\n.rbc-time-slot.rbc-time-slot-selected {\n  background-color: #dbeafe;\n}\n\n.rbc-time-gutter {\n  background-color: #f9fafb;\n  border-right: 1px solid #e5e7eb;\n}\n\n/* Month View Improvements */\n.rbc-month-view .rbc-header {\n  background-color: #f9fafb;\n  border-bottom: 1px solid #e5e7eb;\n  padding: 12px 8px;\n  font-weight: 600;\n  color: #374151;\n  text-align: center;\n}\n\n.rbc-month-row {\n  border-bottom: 1px solid #e5e7eb;\n}\n\n.rbc-date-cell {\n  padding: 4px;\n  border-right: 1px solid #e5e7eb;\n  min-height: 120px;\n  vertical-align: top;\n}\n\n.rbc-date-cell button {\n  color: #374151;\n  font-weight: 500;\n  margin: 2px;\n}\n\n.rbc-date-cell.rbc-off-range {\n  background-color: #f9fafb;\n  color: #9ca3af;\n}\n\n.rbc-date-cell.rbc-today {\n  background-color: #fef3c7 !important;\n  font-weight: bold;\n}\n\n.rbc-date-cell.rbc-selected {\n  background-color: #dbeafe;\n}\n\n/* Show More Button */\n.rbc-show-more {\n  background-color: #f3f4f6 !important;\n  border: 1px solid #d1d5db !important;\n  border-radius: 4px !important;\n  padding: 2px 6px !important;\n  font-size: 11px !important;\n  font-weight: 600 !important;\n  color: #374151 !important;\n  cursor: pointer !important;\n  margin: 2px 0 !important;\n  transition: all 0.2s ease !important;\n}\n\n.rbc-show-more:hover {\n  background-color: #e5e7eb !important;\n  transform: translateY(-1px) !important;\n}\n\n/* Drag and Drop */\n.rbc-addons-dnd .rbc-event {\n  cursor: move !important;\n  user-select: none !important;\n}\n\n.rbc-addons-dnd .rbc-event.rbc-addons-dnd-dragging {\n  opacity: 0.5 !important;\n  transform: rotate(2deg) !important;\n}\n\n.rbc-addons-dnd .rbc-event.rbc-addons-dnd-over {\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2) !important;\n}\n\n/* Responsive Design */\n@media (max-width: 768px) {\n  .rbc-toolbar {\n    flex-direction: column;\n    gap: 8px;\n    padding: 8px 12px;\n  }\n  \n  .rbc-toolbar button {\n    font-size: 12px;\n    padding: 4px 8px;\n  }\n  \n  .rbc-toolbar .rbc-toolbar-label {\n    font-size: 16px;\n  }\n  \n  .rbc-date-cell {\n    min-height: 80px;\n  }\n  \n  .rbc-event {\n    font-size: 9px !important;\n    padding: 1px 3px !important;\n  }\n  \n  .rbc-month-view .rbc-date-cell {\n    min-height: 80px;\n  }\n  \n  .rbc-month-view .rbc-row-content {\n    min-height: 80px;\n  }\n  \n  .rbc-month-view .rbc-event {\n    font-size: 9px !important;\n    padding: 1px 2px !important;\n    margin: 1px !important;\n  }\n  \n  .rbc-month-view .rbc-show-more {\n    font-size: 8px !important;\n    padding: 1px !important;\n  }\n  \n  /* Mobile calendar adjustments */\n  .rbc-calendar {\n    padding: 8px;\n  }\n  \n  .rbc-month-view .rbc-header {\n    padding: 8px 4px;\n    font-size: 12px;\n  }\n  \n  .rbc-time-view .rbc-time-header-content {\n    font-size: 12px;\n    min-height: 32px;\n  }\n}\n\n.rbc-agenda-view .rbc-agenda-date-cell {\n  background-color: #f9fafb;\n  font-weight: 600;\n  color: #374151;\n}\n\n.rbc-show-more {\n  background-color: #f3f4f6;\n  border: 1px solid #d1d5db;\n  border-radius: 4px;\n  padding: 4px 8px;\n  font-size: 11px;\n  font-weight: 600;\n  color: #6b7280;\n  cursor: pointer;\n  margin: 2px 0;\n  text-align: center;\n  transition: all 0.2s ease;\n}\n\n.rbc-show-more:hover {\n  background-color: #e5e7eb;\n  color: #374151;\n  border-color: #9ca3af;\n}\n\n/* CORRE√á√ÉO: Month view - garante que os eventos apare√ßam corretamente */\n.rbc-month-view .rbc-row-content {\n  height: auto !important;\n  min-height: 120px !important;\n  overflow: visible !important;\n}\n\n.rbc-month-view .rbc-row {\n  min-height: 120px !important;\n  overflow: visible !important;\n}\n\n.rbc-month-view .rbc-date-cell {\n  min-height: 120px !important;\n  padding: 2px !important;\n  position: relative !important;\n  overflow: visible !important;\n  vertical-align: top !important;\n}\n\n.rbc-month-view .rbc-event {\n  margin: 1px 2px !important;\n  font-size: 10px !important;\n  padding: 2px 4px !important;\n  line-height: 1.2 !important;\n  position: relative !important;\n  z-index: 1 !important;\n  display: block !important;\n  max-width: calc(100% - 4px) !important;\n  width: auto !important;\n  height: auto !important;\n  min-height: 14px !important;\n  box-sizing: border-box !important;\n  visibility: visible !important;\n  opacity: 1 !important;\n}\n\n.rbc-month-view .rbc-event-content {\n  overflow: hidden !important;\n  text-overflow: ellipsis !important;\n  white-space: nowrap !important;\n  display: block !important;\n  width: 100% !important;\n  height: auto !important;\n  visibility: visible !important;\n}\n\n/* CORRE√á√ÉO ADICIONAL: Garante que o container dos eventos seja vis√≠vel */\n.rbc-month-view .rbc-row-segment {\n  position: relative !important;\n  overflow: visible !important;\n}\n\n.rbc-month-view .rbc-event-container {\n  position: relative !important;\n  overflow: visible !important;\n  height: auto !important;\n}\n\n/* Remove qualquer clipping que possa esconder os eventos */\n.rbc-month-view .rbc-date-cell * {\n  overflow: visible !important;\n}\n\n.rbc-month-view .rbc-overlay {\n  z-index: 1000 !important;\n}\n\n/* Garante que eventos \"allDay\" apare√ßam corretamente */\n.rbc-month-view .rbc-allday-cell {\n  overflow: visible !important;\n  height: auto !important;\n}\n\n/* For√ßa visibilidade dos eventos no m√™s */\n.rbc-month-view .rbc-event {\n  background-color: #3b82f6 !important;\n  color: white !important;\n  border-radius: 3px !important;\n  font-weight: 500 !important;\n  text-align: left !important;\n  cursor: pointer !important;\n}\n\n/* Ensure show more button is visible */\n.rbc-month-view .rbc-show-more {\n  position: relative;\n  z-index: 2;\n  display: block;\n  width: calc(100% - 4px);\n  margin: 1px 2px;\n  text-align: center;\n  background-color: #f3f4f6 !important;\n  border: 1px solid #d1d5db !important;\n  border-radius: 2px !important;\n  padding: 1px 2px !important;\n  font-size: 9px !important;\n  line-height: 1.2 !important;\n}\n\n/* Week and Day view improvements */\n.rbc-time-view .rbc-event {\n  border-radius: 4px;\n  padding: 4px 6px;\n  font-size: 12px;\n  line-height: 1.3;\n}\n\n.rbc-time-view .rbc-event-content {\n  overflow: visible;\n  white-space: normal;\n}\n\n/* Drag and drop improvements */\n.rbc-addons-dnd-drag-preview {\n  opacity: 0.8;\n  transform: rotate(5deg);\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n}\n\n.rbc-addons-dnd-over {\n  background-color: rgba(59, 130, 246, 0.1) !important;\n  border: 2px dashed #3b82f6 !important;\n}\n\n/* Responsive adjustments */\n@media (max-width: 768px) {\n  .rbc-month-view .rbc-event {\n    font-size: 9px;\n    padding: 1px 3px;\n  }\n  \n  .rbc-toolbar .rbc-toolbar-label {\n    font-size: 16px;\n  }\n  \n  .rbc-toolbar button {\n    padding: 4px 8px;\n    font-size: 12px;\n  }\n}\n\n:root {\n  --background: 0 0% 100%;\n  --foreground: 0 0% 3.9%;\n  --muted: 0 0% 96.1%;\n  --muted-foreground: 0 0% 45.1%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 0 0% 3.9%;\n  --card: 0 0% 100%;\n  --card-foreground: 0 0% 3.9%;\n  --border: 0 0% 89.8%;\n  --input: 0 0% 89.8%;\n  --primary: 43 74% 49%;\n  --primary-foreground: 0 0% 98%;\n  --secondary: 0 0% 96.1%;\n  --secondary-foreground: 0 0% 9%;\n  --accent: 0 0% 96.1%;\n  --accent-foreground: 0 0% 9%;\n  --destructive: 0 84.2% 60.2%;\n  --destructive-foreground: 0 0% 98%;\n  --ring: 43 74% 49%;\n  --radius: 0.5rem;\n  \n  /* Custom RotaF√°cil colors */\n  --burnt-yellow: 43 74% 49%; /* #DAA520 */\n  --burnt-yellow-dark: 43 74% 39%; /* #B8860B */\n  --black: 0 0% 0%;\n  --white: 0 0% 100%;\n  --gray-50: 0 0% 98%;\n  --gray-100: 0 0% 96.1%;\n  --gray-200: 0 0% 89.8%;\n  --gray-300: 0 0% 83.1%;\n  --gray-400: 0 0% 63.9%;\n  --gray-500: 0 0% 45.1%;\n  --gray-600: 0 0% 32.2%;\n  --gray-700: 0 0% 22.2%;\n  --gray-800: 0 0% 14.9%;\n  --gray-900: 0 0% 9%;\n}\n\n.dark {\n  --background: 0 0% 3.9%;\n  --foreground: 0 0% 98%;\n  --muted: 0 0% 14.9%;\n  --muted-foreground: 0 0% 63.9%;\n  --popover: 0 0% 3.9%;\n  --popover-foreground: 0 0% 98%;\n  --card: 0 0% 3.9%;\n  --card-foreground: 0 0% 98%;\n  --border: 0 0% 14.9%;\n  --input: 0 0% 14.9%;\n  --primary: 43 74% 49%;\n  --primary-foreground: 0 0% 9%;\n  --secondary: 0 0% 14.9%;\n  --secondary-foreground: 0 0% 98%;\n  --accent: 0 0% 14.9%;\n  --accent-foreground: 0 0% 98%;\n  --destructive: 0 62.8% 30.6%;\n  --destructive-foreground: 0 0% 98%;\n  --ring: 43 74% 49%;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;\n  }\n}\n\n@layer utilities {\n  .text-burnt-yellow {\n    color: hsl(var(--burnt-yellow));\n  }\n  \n  .bg-burnt-yellow {\n    background-color: hsl(var(--burnt-yellow));\n  }\n  \n  .border-burnt-yellow {\n    border-color: hsl(var(--burnt-yellow));\n  }\n  \n  .hover\\:bg-burnt-yellow-dark:hover {\n    background-color: hsl(var(--burnt-yellow-dark));\n  }\n  \n  .hover\\:text-burnt-yellow-dark:hover {\n    color: hsl(var(--burnt-yellow-dark));\n  }\n  \n  .focus\\:ring-burnt-yellow:focus {\n    --tw-ring-color: hsl(var(--burnt-yellow));\n  }\n}\n\n/* Custom scrollbar */\n::-webkit-scrollbar {\n  width: 6px;\n}\n\n::-webkit-scrollbar-track {\n  background: hsl(var(--muted));\n}\n\n::-webkit-scrollbar-thumb {\n  background: hsl(var(--muted-foreground));\n  border-radius: 3px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: hsl(var(--foreground));\n}\n\n/* Loading animation */\n@keyframes spin {\n  to { transform: rotate(360deg); }\n}\n\n.animate-spin {\n  animation: spin 1s linear infinite;\n}\n/* Faz o calend√°rio ocupar toda a largura dispon√≠vel */\n.rbc-calendar,\n.rbc-time-view,\n.rbc-time-content {\n  width: 100% !important;\n  min-width: 0 !important;\n  max-width: 100vw !important;\n  overflow-x: auto !important;\n}\n\n.rbc-time-header {\n  width: 100% !important;\n  min-width: 0 !important;\n  max-width: 100vw !important;\n}\n\n.rbc-time-header-content {\n  min-width: 0 !important;\n  width: 100% !important;\n  display: flex !important;\n}\n\n/* Garante que cada coluna/dia ocupa espa√ßo igual */\n.rbc-time-header-cell,\n.rbc-header {\n  flex: 1 1 0 !important;\n  min-width: 120px !important;\n  max-width: 1fr !important;\n  white-space: nowrap;\n  text-align: center;\n}\n\n.rbc-time-header-content {\n  min-width: 0 !important;\n  width: 100% !important;\n  display: flex !important;\n  align-items: stretch !important;\n  justify-content: stretch !important;\n  padding: 0 !important;\n  box-sizing: border-box !important;\n  background: transparent !important;\n}\n\n.rbc-time-header-cell,\n.rbc-header {\n  flex: 1 1 0 !important;\n  min-width: 120px !important;\n  max-width: 1fr !important;\n  padding: 0 !important;\n  margin: 0 !important;\n  white-space: nowrap;\n  text-align: center;\n  background: transparent !important;\n}\n\n.rbc-time-header, .rbc-time-header-content, .rbc-row.rbc-time-header-row {\n  box-sizing: border-box !important;\n  margin: 0 !important;\n  padding: 0 !important;\n  border-spacing: 0 !important;\n}\n\n.rbc-time-header-content {\n  border-left: 1px solid #e5e7eb !important;\n}\n\n.rbc-header {\n  box-sizing: border-box !important;\n  margin: 0 !important;\n  padding: 8px 0 !important; /* Ajuste se quiser mais/menos altura */\n  min-width: 120px !important;\n}\n\n.rbc-row.rbc-time-header-row {\n  height: 40px !important;\n}\n\n.rbc-allday-cell, .rbc-row.rbc-allday {\n  vertical-align: middle !important;\n  padding: 0 !important;\n}\n\n/* CORRE√á√ÉO: Garante que o header dos dias da semana sempre fique vis√≠vel acima do bloco all-day */\n.rbc-time-header {\n  position: sticky !important;\n  top: 0;\n  z-index: 10 !important;\n  background: #f9fafb !important;\n  border-bottom: 1px solid #e5e7eb !important;\n}\n\n/* Garante que os nomes dos dias fiquem fixos no topo */\n.rbc-time-header-content {\n  position: relative !important;\n  z-index: 10 !important;\n  background: #f9fafb !important;\n  border-bottom: 1px solid #e5e7eb !important;\n}\n\n/* Header individual de cada dia */\n.rbc-header {\n  position: relative !important;\n  z-index: 10 !important;\n  background: #f9fafb !important;\n  border-bottom: 1px solid #e5e7eb !important;\n  padding: 12px 8px !important;\n  font-weight: 600 !important;\n  color: #374151 !important;\n  text-align: center !important;\n}\n\n/* Bloco all-day com z-index menor para ficar atr√°s do header */\n.rbc-allday-cell {\n  z-index: 2 !important;\n  position: relative;\n  background: #f9fafb;\n  min-height: 48px;\n  margin-top: 0 !important;\n  border-top: 1px solid #e5e7eb !important;\n}\n\n/* Container da linha all-day */\n.rbc-row.rbc-allday {\n  z-index: 2 !important;\n  position: relative;\n  background: #f9fafb;\n}\n\n/* Garante que a tabela do header tenha layout est√°vel */\n.rbc-time-header .rbc-row.rbc-time-header-row {\n  position: relative !important;\n  z-index: 10 !important;\n  background: #f9fafb !important;\n  height: auto !important;\n  min-height: 40px !important;\n}\n\n/* Remove overflow oculto que pode causar problemas de exibi√ß√£o */\n.rbc-time-header-content,\n.rbc-time-header,\n.rbc-allday-cell {\n  overflow: visible !important;\n}\n\n/* Garante que o conte√∫do do calend√°rio n√£o sobreponha o header fixo */\n.rbc-time-content {\n  position: relative !important;\n  z-index: 1 !important;\n  margin-top: 0 !important;\n}\n\n/* CABE√áALHO DIAS DA SEMANA SEMPRE VIS√çVEL E SOBRE O BLOCO ALL DAY */\n.rbc-time-header {\n  position: sticky !important;\n  top: 0 !important;\n  z-index: 20 !important;\n  background: #f9fafb !important;\n}\n\n.rbc-time-header .rbc-header,\n.rbc-time-header .rbc-time-header-cell {\n  z-index: 21 !important;\n  background: #f9fafb !important;\n  position: relative !important;\n  border-bottom: 1px solid #e5e7eb !important;\n}\n\n.rbc-allday-cell,\n.rbc-row.rbc-allday-row {\n  z-index: 1 !important;\n  position: relative !important;\n  background: #fff !important;\n}\n\n.rbc-time-content {\n  overflow: visible !important;\n}\n\n.rbc-time-header {\n  border-bottom: 1.5px solid #e5e7eb !important;\n}\n/* === CORRE√á√ÉO ROTA F√ÅCIL ‚Äî CABE√áALHO DIAS SEMANA EM DESTAQUE (CALEND√ÅRIO SEMANA/DIA) === */\n\n/* Linha dos dias (segunda, ter√ßa...) sempre fixa, alta e com z-index maior */\n.rbc-time-header .rbc-row.rbc-time-header-cell {\n  min-height: 34px !important;  /* Altura suficiente p/ os nomes dos dias */\n  height: 38px !important;\n  background: #f9fafb !important;\n  z-index: 21 !important;\n  position: sticky !important;\n  top: 0 !important;\n  border-bottom: 1.5px solid #e5e7eb !important;\n}\n\n/* Header individual de cada dia */\n.rbc-header {\n  padding: 10px 0 !important;\n  font-size: 1rem !important;\n  font-weight: 600 !important;\n  color: #374151 !important;\n  background: #f9fafb !important;\n  border-bottom: none !important;\n  z-index: 22 !important;\n  position: relative !important;\n}\n\n/* All Day vem abaixo do header e N√ÉO pode sobrepor */\n.rbc-allday-cell, .rbc-row.rbc-allday {\n  z-index: 1 !important;\n  background: #fff !important;\n  min-height: 46px !important; /* Maior altura pra eventos all day */\n  border-top: 1.5px solid #e5e7eb !important;\n  border-bottom: 1.5px solid #e5e7eb !important;\n}\n\n/* Remove sobreposi√ß√£o/overflow do conte√∫do */\n.rbc-time-header, .rbc-time-header-content, .rbc-allday-cell, .rbc-row.rbc-allday {\n  overflow: visible !important;\n}\n","size_bytes":18718},"client/src/main.tsx":{"content":"import { ErrorBoundary } from \"./components/ErrorBoundary\";\nimport App from \"./App\";\nimport \"./index.css\";\nimport { createRoot } from \"react-dom/client\";\n\ncreateRoot(document.getElementById(\"root\")!).render(\n  <ErrorBoundary>\n    <App />\n  </ErrorBoundary>\n);\n","size_bytes":260},"client/src/components/AppointmentCalendar.tsx":{"content":"import { useState, useMemo, useCallback, useEffect, useRef } from \"react\";\nimport { Calendar, dateFnsLocalizer, Event, Views } from \"react-big-calendar\";\nimport withDragAndDrop from \"react-big-calendar/lib/addons/dragAndDrop\";\nimport { format, parse, startOfWeek, getDay } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport \"react-big-calendar/lib/css/react-big-calendar.css\";\nimport \"react-big-calendar/lib/addons/dragAndDrop/styles.css\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\";\nimport AppointmentForm from \"@/components/forms/AppointmentForm\";\nimport type { Appointment, Client, Service, Technician, Team } from \"@shared/schema\";\n\n// Create DnD Calendar\nconst DnDCalendar = withDragAndDrop(Calendar);\n\n// Configure date-fns localizer for Portuguese Brazil with Monday as first day of week\nconst localizer = dateFnsLocalizer({\n  format,\n  parse,\n  startOfWeek: (date) => startOfWeek(date, { weekStartsOn: 1 }),\n  getDay,\n  locales: {\n    'pt-BR': ptBR,\n  },\n});\n\n// Define color palette for teams/technicians\nconst COLORS = [\n  '#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd',\n  '#8c564b', '#e377c2', '#7f7f7f', '#bcbd22', '#17becf',\n  '#aec7e8', '#ffbb78', '#98df8a', '#ff9896', '#c5b0d5',\n  '#c49c94', '#f7b6d3', '#c7c7c7', '#dbdb8d', '#9edae5'\n];\n\ninterface CalendarEvent extends Event {\n  appointment: Appointment;\n  responsible: {\n    type: 'technician' | 'team' | 'none';\n    id: number | null;\n    name: string;\n  };\n}\n\ninterface AppointmentCalendarProps {\n  appointments: Appointment[];\n  clients: Client[];\n  services: Service[];\n  technicians: Technician[];\n  teams: Team[];\n}\n\n// Custom Month Event Component for better appointment display\nconst MonthEvent = ({ event }: { event: CalendarEvent }) => {\n  const responsible = event.responsible;\n  const responsibleIcon = responsible.type === 'team' ? 'üë•' : responsible.type === 'technician' ? 'üë§' : '‚ùå';\n  \n  return (\n    <div className=\"text-xs leading-tight cursor-pointer hover:opacity-80 transition-opacity p-1 rounded w-full h-full\">\n      <div className=\"font-semibold truncate\">{event.title.split(' - ')[0]}</div>\n      <div className=\"flex items-center gap-1\">\n        <span>{responsibleIcon}</span>\n        <span className=\"truncate text-xs opacity-90\">{responsible.name}</span>\n      </div>\n    </div>\n  );\n};\n\n// Custom Week/Day Event Component\nconst TimeEvent = ({ event }: { event: CalendarEvent }) => {\n  const responsible = event.responsible;\n  const responsibleIcon = responsible.type === 'team' ? 'üë•' : responsible.type === 'technician' ? 'üë§' : '‚ùå';\n  \n  return (\n    <div className=\"text-xs p-1 cursor-pointer hover:opacity-80 transition-opacity w-full h-full\">\n      <div className=\"font-bold truncate mb-1\">{event.title.split(' - ')[0]}</div>\n      <div className=\"text-xs opacity-90 truncate\">{event.title.split(' - ')[1]}</div>\n      <div className=\"flex items-center gap-1 mt-1\">\n        <span>{responsibleIcon}</span>\n        <span className=\"truncate\">{responsible.name}</span>\n      </div>\n    </div>\n  );\n};\n\nexport default function AppointmentCalendar({ \n  appointments, \n  clients, \n  services, \n  technicians, \n  teams \n}: AppointmentCalendarProps) {\n  const [view, setView] = useState<keyof typeof Views>(Views.MONTH);\n  const [date, setDate] = useState(new Date());\n  const [selectedAppointment, setSelectedAppointment] = useState<Appointment | null>(null);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Ref para controle de limpeza de componente\n  const isComponentMounted = useRef(true);\n  \n  // CR√çTICO: Cleanup do componente ao desmontar\n  useEffect(() => {\n    isComponentMounted.current = true;\n    \n    return () => {\n      console.log('üßπ [CALENDAR] Limpando componente AppointmentCalendar');\n      isComponentMounted.current = false;\n      \n      // Fechar modal se aberto durante desmontagem\n      if (isEditDialogOpen) {\n        setIsEditDialogOpen(false);\n        setSelectedAppointment(null);\n      }\n    };\n  }, [isEditDialogOpen]);\n\n  // Generate consistent colors for each responsible (technician/team)\n  const responsibleColors = useMemo(() => {\n    const colorMap = new Map<string, string>();\n    let colorIndex = 0;\n\n    // Add technicians\n    technicians.forEach((tech) => {\n      const key = `technician-${tech.id}`;\n      colorMap.set(key, COLORS[colorIndex % COLORS.length]);\n      colorIndex++;\n    });\n\n    // Add teams\n    teams.forEach((team) => {\n      const key = `team-${team.id}`;\n      colorMap.set(key, COLORS[colorIndex % COLORS.length]);\n      colorIndex++;\n    });\n\n    return colorMap;\n  }, [technicians, teams]);\n\n  // Helper functions\n  const getClient = (clientId: number | null) => \n    clientId ? clients.find(c => c.id === clientId) : null;\n  \n  const getService = (serviceId: number) => \n    services.find(s => s.id === serviceId);\n  \n  const getTechnician = (technicianId: number | null) => \n    technicianId ? technicians.find(t => t.id === technicianId) : null;\n  \n  const getTeam = (teamId: number | null) => \n    teamId ? teams.find(t => t.id === teamId) : null;\n\n  const getResponsibleInfo = (appointment: Appointment) => {\n    if (appointment.technicianId) {\n      const technician = getTechnician(appointment.technicianId);\n      return {\n        type: 'technician' as const,\n        id: appointment.technicianId,\n        name: technician?.name || \"T√©cnico n√£o encontrado\"\n      };\n    } else if (appointment.teamId) {\n      const team = getTeam(appointment.teamId);\n      return {\n        type: 'team' as const,\n        id: appointment.teamId,\n        name: team?.name || \"Equipe n√£o encontrada\"\n      };\n    }\n    return {\n      type: 'none' as const,\n      id: null,\n      name: \"Sem respons√°vel\"\n    };\n  };\n\n  // Convert appointments to calendar events\n  const calendarEvents: CalendarEvent[] = useMemo(() => {\n    console.log('üîÑ [CALENDAR] Processando agendamentos para o calend√°rio:', appointments.length);\n    \n    const events = appointments.map((appointment) => {\n      const client = getClient(appointment.clientId);\n      const service = getService(appointment.serviceId);\n      const responsible = getResponsibleInfo(appointment);\n      \n      // CORRE√á√ÉO: For√ßa convers√£o para objeto Date real\n      const startDate = new Date(appointment.scheduledDate);\n      let endDate: Date;\n      let allDay = false;\n\n      // Verifica se a data √© v√°lida\n      if (isNaN(startDate.getTime())) {\n        console.error('‚ùå [CALENDAR] Data inv√°lida para agendamento:', appointment.id, appointment.scheduledDate);\n        return null;\n      }\n\n      // Se o agendamento √© \"dia todo\"\n      if (appointment.allDay) {\n        // Para eventos \"dia todo\", definir in√≠cio e fim no mesmo dia\n        endDate = new Date(startDate);\n        endDate.setHours(23, 59, 59, 999); // Fim do dia\n        allDay = true;\n        console.log('üìÖ [CALENDAR] Evento dia todo:', appointment.id, 'Start:', startDate, 'End:', endDate);\n      } else {\n        // Para eventos com hor√°rio espec√≠fico, usar dura√ß√£o do servi√ßo\n        endDate = new Date(startDate.getTime() + (service?.duration || 60) * 60000);\n        console.log('‚è∞ [CALENDAR] Evento com hor√°rio:', appointment.id, 'Start:', startDate, 'End:', endDate);\n      }\n\n      const event = {\n        id: appointment.id,\n        title: `${client?.name || 'Cliente'} - ${service?.name || 'Servi√ßo'}`,\n        start: startDate,\n        end: endDate,\n        allDay: allDay,\n        appointment,\n        responsible,\n        resource: {\n          responsibleType: responsible.type,\n          responsibleId: responsible.id,\n          responsibleName: responsible.name,\n          status: appointment.status,\n          priority: appointment.priority\n        }\n      };\n      \n      console.log('‚úÖ [CALENDAR] Evento criado:', {\n        id: event.id,\n        title: event.title,\n        start: event.start,\n        end: event.end,\n        allDay: event.allDay,\n        startType: typeof event.start,\n        endType: typeof event.end\n      });\n      \n      return event;\n    }).filter(Boolean) as CalendarEvent[];\n    \n    console.log('üéØ [CALENDAR] Total de eventos processados:', events.length);\n    \n    // TESTE: Adiciona evento mock para garantir que funciona\n    const mockEvent = {\n      id: -1,\n      title: 'TESTE - Evento Mock',\n      start: new Date(2025, 6, 18, 10, 0), // 18 de julho de 2025, 10:00\n      end: new Date(2025, 6, 18, 11, 0),   // 18 de julho de 2025, 11:00\n      allDay: false,\n      appointment: null as any,\n      responsible: { type: 'none' as const, id: null, name: 'Teste' },\n      resource: {\n        responsibleType: 'none' as const,\n        responsibleId: null,\n        responsibleName: 'Teste',\n        status: 'scheduled',\n        priority: 'normal'\n      }\n    };\n    \n    console.log('üß™ [CALENDAR] Adicionando evento mock para teste:', mockEvent);\n    events.push(mockEvent);\n    \n    return events;\n  }, [appointments, clients, services, technicians, teams]);\n\n  // Update appointment mutation\n  const updateAppointmentMutation = useMutation({\n    mutationFn: async ({ appointmentId, scheduledDate }: { appointmentId: number; scheduledDate: string }) => {\n      return await apiRequest(\"PATCH\", `/api/appointments/${appointmentId}`, { scheduledDate });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/appointments\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Agendamento atualizado com sucesso\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao atualizar agendamento\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Custom event style function\n  const eventStyleGetter = useCallback((event: CalendarEvent) => {\n    const responsible = event.responsible;\n    let backgroundColor = '#6b7280'; // default gray\n    \n    if (responsible.type !== 'none' && responsible.id) {\n      const colorKey = `${responsible.type}-${responsible.id}`;\n      backgroundColor = responsibleColors.get(colorKey) || '#6b7280';\n    }\n\n    return {\n      style: {\n        backgroundColor,\n        borderRadius: '4px',\n        opacity: 0.9,\n        color: 'white',\n        border: '0px',\n        display: 'block',\n        fontSize: '12px',\n        fontWeight: 'bold',\n        cursor: 'pointer',\n        userSelect: 'none'\n      }\n    };\n  }, [responsibleColors]);\n\n  // Handle event click for editing\n  const handleSelectEvent = useCallback((event: CalendarEvent) => {\n    // Verifica se o componente ainda est√° montado\n    if (!isComponentMounted.current) {\n      console.log('‚ö†Ô∏è [CALENDAR] Componente desmontado, cancelando sele√ß√£o de evento');\n      return;\n    }\n    \n    // Only open edit dialog in week/day view, not in month view\n    if (view === Views.WEEK || view === Views.DAY || view === Views.AGENDA) {\n      console.log(`üñ±Ô∏è [CALENDAR] Evento selecionado:`, event.appointment);\n      setSelectedAppointment(event.appointment);\n      setIsEditDialogOpen(true);\n    }\n  }, [view]);\n\n  // Handle event movement (drag and drop)\n  const handleEventDrop = useCallback(async ({ event, start, end }: { event: CalendarEvent; start: Date; end: Date }) => {\n    // CR√çTICO: Verifica se o componente ainda est√° montado\n    if (!isComponentMounted.current) {\n      console.log('‚ö†Ô∏è [CALENDAR] Componente desmontado, cancelando drag and drop');\n      return;\n    }\n    \n    const draggedEvent = event as CalendarEvent;\n    \n    console.log(`üéØ [CALENDAR] Arrastando agendamento ${draggedEvent.appointment?.id} para ${start.toISOString()}`);\n\n    // CR√çTICO: Verifica√ß√£o de seguran√ßa para appointment v√°lido\n    if (!draggedEvent.appointment || !draggedEvent.appointment.id) {\n      console.warn('‚ö†Ô∏è [CALENDAR] Evento inv√°lido para drag and drop');\n      return;\n    }\n\n    // Check for conflicts with the same responsible\n    const conflictingEvent = calendarEvents.find(e => \n      e.id !== draggedEvent.id && \n      e.responsible.type === draggedEvent.responsible.type &&\n      e.responsible.id === draggedEvent.responsible.id &&\n      ((start >= e.start && start < e.end) || (end > e.start && end <= e.end) ||\n       (start <= e.start && end >= e.end))\n    );\n\n    if (conflictingEvent) {\n      toast({\n        title: \"Hor√°rio ocupado\",\n        description: `Este hor√°rio j√° est√° ocupado por outro agendamento de ${draggedEvent.responsible.name}.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Check if trying to move to a slot with different responsible\n    const targetSlotEvents = calendarEvents.filter(e => \n      e.id !== draggedEvent.id &&\n      ((start >= e.start && start < e.end) || (end > e.start && end <= e.end) ||\n       (start <= e.start && end >= e.end))\n    );\n\n    const conflictingResponsible = targetSlotEvents.find(e => \n      e.responsible.type !== draggedEvent.responsible.type || \n      e.responsible.id !== draggedEvent.responsible.id\n    );\n\n    if (conflictingResponsible) {\n      toast({\n        title: \"Opera√ß√£o n√£o permitida\",\n        description: `N√£o √© poss√≠vel mover agendamento entre respons√°veis diferentes. Este agendamento pertence a ${draggedEvent.responsible.name}.`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Update the appointment\n    const newScheduledDate = start.toISOString();\n    console.log(`‚úÖ [CALENDAR] Atualizando agendamento ${draggedEvent.appointment.id} para ${newScheduledDate}`);\n    \n    try {\n      await updateAppointmentMutation.mutateAsync({\n        appointmentId: draggedEvent.appointment.id,\n        scheduledDate: newScheduledDate\n      });\n      \n      // Success is handled by the mutation's onSuccess callback\n    } catch (error) {\n      console.error('‚ùå [CALENDAR] Erro ao atualizar agendamento:', error);\n      // CR√çTICO: S√≥ mostra toast se o componente ainda estiver montado\n      if (isComponentMounted.current) {\n        toast({\n          title: \"Erro ao mover agendamento\",\n          description: \"N√£o foi poss√≠vel atualizar o agendamento. Tente novamente.\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  }, [calendarEvents, toast, updateAppointmentMutation]);\n\n  // Handle event resize (if needed)\n  const handleEventResize = useCallback(async ({ event, start, end }: { event: CalendarEvent; start: Date; end: Date }) => {\n    // CR√çTICO: Verifica se o componente ainda est√° montado\n    if (!isComponentMounted.current) {\n      console.log('‚ö†Ô∏è [CALENDAR] Componente desmontado, cancelando resize');\n      return;\n    }\n    \n    // CR√çTICO: Verifica√ß√£o de seguran√ßa para appointment v√°lido\n    if (!event.appointment || !event.appointment.id) {\n      console.warn('‚ö†Ô∏è [CALENDAR] Evento inv√°lido para resize');\n      return;\n    }\n    \n    console.log(`üìè [CALENDAR] Redimensionando agendamento ${event.appointment.id} para ${start.toISOString()}`);\n    \n    // For now, just update the start time\n    const newScheduledDate = start.toISOString();\n    updateAppointmentMutation.mutate({\n      appointmentId: event.appointment.id,\n      scheduledDate: newScheduledDate\n    });\n  }, [updateAppointmentMutation]);\n\n  // Handle closing edit dialog\n  const handleCloseEditDialog = useCallback(() => {\n    // CR√çTICO: S√≥ executa se o componente ainda estiver montado\n    if (!isComponentMounted.current) {\n      console.log('‚ö†Ô∏è [CALENDAR] Componente desmontado, n√£o √© poss√≠vel fechar dialog');\n      return;\n    }\n    \n    console.log('üö™ [CALENDAR] Fechando dialog de edi√ß√£o');\n    setIsEditDialogOpen(false);\n    setSelectedAppointment(null);\n  }, []);\n\n  // Get appropriate event component based on view\n  const getEventComponent = useCallback((view: keyof typeof Views) => {\n    switch (view) {\n      case Views.MONTH:\n        return MonthEvent;\n      case Views.WEEK:\n      case Views.DAY:\n        return TimeEvent;\n      default:\n        return MonthEvent;\n    }\n  }, []);\n\n  // Custom toolbar to show responsible colors legend\n  const ResponsibleLegend = () => (\n    <div className=\"mb-4 p-3 bg-gray-50 rounded-lg\">\n      <h4 className=\"text-sm font-semibold mb-2\">Legenda de Cores:</h4>\n      <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2\">\n        {technicians.map((tech) => {\n          const colorKey = `technician-${tech.id}`;\n          const color = responsibleColors.get(colorKey);\n          return (\n            <div key={colorKey} className=\"flex items-center gap-2\">\n              <div \n                className=\"w-4 h-4 rounded\" \n                style={{ backgroundColor: color }}\n              />\n              <span className=\"text-xs\">üë§ {tech.name}</span>\n            </div>\n          );\n        })}\n        {teams.map((team) => {\n          const colorKey = `team-${team.id}`;\n          const color = responsibleColors.get(colorKey);\n          return (\n            <div key={colorKey} className=\"flex items-center gap-2\">\n              <div \n                className=\"w-4 h-4 rounded\" \n                style={{ backgroundColor: color }}\n              />\n              <span className=\"text-xs\">üë• {team.name}</span>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n \n  console.log('calendarEvents:', calendarEvents);\n  return (\n    <div className=\"h-full\">\n      <ResponsibleLegend />\n      \n      <div style={{ width: '100%' }}>\n        <DnDCalendar\n          localizer={localizer}\n          events={calendarEvents}\n          startAccessor=\"start\"\n          endAccessor=\"end\"\n          style={{ height: '600px', width: '100%' }}\n          view={view}\n          onView={setView}\n          date={date}\n          onNavigate={setDate}\n          eventPropGetter={eventStyleGetter}\n          onEventDrop={handleEventDrop}\n          onEventResize={handleEventResize}\n          onSelectEvent={handleSelectEvent}\n          selectable\n          resizable\n          draggableAccessor={() => true}\n          resizableAccessor={() => true}\n          components={{\n            month: { event: MonthEvent },\n            week: { event: TimeEvent },\n            day: { event: TimeEvent },\n            agenda: { event: TimeEvent },\n          }}\n          views={[Views.MONTH, Views.WEEK, Views.DAY, Views.AGENDA]}\n          culture=\"pt-BR\"\n          messages={{\n            next: \"Pr√≥ximo\",\n            previous: \"Anterior\",\n            today: \"Hoje\",\n            month: \"M√™s\",\n            week: \"Semana\", \n            day: \"Dia\",\n            agenda: \"Agenda\",\n            date: \"Data\",\n            time: \"Hora\",\n            event: \"Evento\",\n            allDay: \"Dia inteiro\",\n            noEventsInRange: \"N√£o h√° agendamentos neste per√≠odo.\",\n            showMore: (total) => `+${total}`,\n            work_week: \"Semana de trabalho\",\n            yesterday: \"Ontem\",\n            tomorrow: \"Amanh√£\"\n          }}\n          formats={{\n            dateFormat: 'dd',\n            dayFormat: 'eeee',\n            dayHeaderFormat: 'eeee dd/MM',\n            dayRangeHeaderFormat: ({ start, end }, culture, localizer) =>\n              `${localizer?.format(start, 'dd MMM', culture)} - ${localizer?.format(end, 'dd MMM yyyy', culture)}`,\n            monthHeaderFormat: 'MMMM yyyy',\n            agendaHeaderFormat: ({ start, end }, culture, localizer) =>\n              `${localizer?.format(start, 'dd MMM', culture)} - ${localizer?.format(end, 'dd MMM yyyy', culture)}`,\n            agendaDateFormat: 'eee dd/MM',\n            agendaTimeFormat: 'HH:mm',\n            agendaTimeRangeFormat: ({ start, end }, culture, localizer) =>\n              `${localizer?.format(start, 'HH:mm', culture)} - ${localizer?.format(end, 'HH:mm', culture)}`,\n            weekdayFormat: 'eeee',\n            selectRangeFormat: ({ start, end }, culture, localizer) =>\n              `${localizer?.format(start, 'dd MMM', culture)} - ${localizer?.format(end, 'dd MMM yyyy', culture)}`\n          }}\n          step={30}\n          timeslots={2}\n          min={new Date(0, 0, 0, 7, 0, 0)} // 7:00 AM\n          max={new Date(0, 0, 0, 19, 0, 0)} // 7:00 PM\n          popup\n          popupOffset={30}\n        />\n      </div>\n\n      {/* Edit Dialog */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          {selectedAppointment && (\n            <AppointmentForm\n              appointment={selectedAppointment}\n              onClose={handleCloseEditDialog}\n              clients={clients}\n              services={services}\n              technicians={technicians}\n              teams={teams}\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":20912},"client/src/components/Layout.tsx":{"content":"import { useState } from \"react\";\nimport Sidebar from \"./Sidebar\";\nimport TopBar from \"./TopBar\";\n\ninterface LayoutProps {\n  children: React.ReactNode;\n}\n\nexport default function Layout({ children }: LayoutProps = {}) {\n  if (!children) {\n    console.warn(\"[Layout] Renderizado sem children!\");\n    return <div>Erro: Layout renderizado sem conte√∫do.</div>;\n  }\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <Sidebar isOpen={sidebarOpen} onClose={() => setSidebarOpen(false)} />\n\n      <div className=\"lg:pl-64 flex flex-col min-h-screen\">\n        <TopBar onMenuClick={() => setSidebarOpen(true)} />\n\n        <main className=\"flex-1 p-6\">\n          {children}\n        </main>\n      </div>\n    </div>\n  );\n}\n","size_bytes":782},"client/src/components/Sidebar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport logoImg from \"@assets/SEM FUNDO_1750819798590.png\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  Calendar,\n  Car,\n  Users,\n  Settings,\n  MapPin,\n  LayoutDashboard,\n  UserCog,\n  Wrench,\n  LogOut,\n  X,\n  FileText,\n  Search,\n  History\n} from \"lucide-react\";\n\ninterface SidebarProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nconst navigation = [\n  { name: \"Dashboard\", href: \"/dashboard\", icon: LayoutDashboard },\n  { name: \"Agendamentos\", href: \"/appointments\", icon: Calendar },\n  { name: \"Ache uma data\", href: \"/find-date\", icon: Search },\n  { name: \"Roteiriza√ß√£o\", href: \"/routes\", icon: MapPin },\n  { name: \"Hist√≥rico de Rotas\", href: \"/routes-history\", icon: History },\n  { name: \"Clientes\", href: \"/clients\", icon: Users },\n  { name: \"T√©cnicos/Equipes\", href: \"/technicians\", icon: UserCog },\n  { name: \"Ve√≠culos\", href: \"/vehicles\", icon: Car },\n  { name: \"Servi√ßos\", href: \"/services\", icon: Wrench },\n  { name: \"Regras de Neg√≥cio\", href: \"/business-rules\", icon: FileText },\n];\n\nexport default function Sidebar({ isOpen, onClose }: SidebarProps) {\n  const [location] = useLocation();\n  const { user, logout } = useAuth();\n\n  const isActive = (href: string) => {\n    if (href === \"/dashboard\" && (location === \"/\" || location === \"/dashboard\")) {\n      return true;\n    }\n    return location === href;\n  };\n\n  return (\n    <>\n      {/* Mobile overlay */}\n      {isOpen && (\n        <div \n          className=\"fixed inset-0 z-40 bg-black bg-opacity-50 lg:hidden\" \n          onClick={onClose}\n        />\n      )}\n      \n      {/* Sidebar */}\n      <div className={`\n        fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform transition-transform duration-300 ease-in-out\n        ${isOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0\n      `}>\n        {/* Header */}\n        <div className=\"flex items-center justify-between h-16 bg-black px-6\">\n          <Link href=\"/dashboard\">\n            <div className=\"flex items-center space-x-2 cursor-pointer hover:opacity-80 transition-opacity\">\n              <img src={logoImg} alt=\"RotaF√°cil Logo\" className=\"h-8 w-8\" />\n              <h1 className=\"text-xl font-bold text-white\">\n                Rota<span className=\"text-burnt-yellow\">F√°cil</span>\n              </h1>\n            </div>\n          </Link>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"lg:hidden text-white hover:bg-gray-800\"\n            onClick={onClose}\n          >\n            <X className=\"h-5 w-5\" />\n          </Button>\n        </div>\n        \n        {/* Navigation */}\n        <nav className=\"mt-8 px-4\">\n          <ul className=\"space-y-2\">\n            {navigation.map((item) => {\n              const Icon = item.icon;\n              const active = isActive(item.href);\n              \n              return (\n                <li key={item.name}>\n                  <Link \n                    href={item.href}\n                    className={`\n                      flex items-center px-4 py-3 text-sm font-medium rounded-lg transition-colors\n                      ${active \n                        ? \"bg-gray-100 text-burnt-yellow\" \n                        : \"text-gray-700 hover:bg-gray-100\"\n                      }\n                    `}\n                  >\n                    <Icon className={`h-5 w-5 mr-3 ${active ? \"text-burnt-yellow\" : \"text-gray-600\"}`} />\n                    {item.name}\n                  </Link>\n                </li>\n              );\n            })}\n          </ul>\n          \n          {/* Plan info */}\n          <div className=\"mt-8 pt-8 border-t border-gray-200\">\n            <div className=\"px-4 py-2\">\n              <p className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">\n                Plano Atual\n              </p>\n              <div className=\"mt-2 flex items-center justify-between\">\n                <span className=\"text-sm font-medium text-gray-900 capitalize\">\n                  {user?.plan || \"B√°sico\"}\n                </span>\n                <span className=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-burnt-yellow bg-opacity-10 text-burnt-yellow\">\n                  Upgrade\n                </span>\n              </div>\n            </div>\n          </div>\n        </nav>\n        \n        {/* User info */}\n        <div className=\"absolute bottom-0 w-full p-4 border-t border-gray-200\">\n          <div className=\"flex items-center\">\n            <div className=\"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center\">\n              <span className=\"text-sm font-medium text-gray-600\">\n                {user?.name?.split(' ').map(n => n[0]).join('').toUpperCase() || 'U'}\n              </span>\n            </div>\n            <div className=\"ml-3 flex-1\">\n              <p className=\"text-sm font-medium text-gray-700\">{user?.name}</p>\n              <p className=\"text-xs text-gray-500\">{user?.email}</p>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"text-gray-400 hover:text-gray-600\"\n              onClick={logout}\n            >\n              <LogOut className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n","size_bytes":5339},"client/src/components/TopBar.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Menu, Bell } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\ninterface TopBarProps {\n  onMenuClick: () => void;\n}\n\nconst pageNames: Record<string, string> = {\n  \"/\": \"Dashboard\",\n  \"/dashboard\": \"Dashboard\", \n  \"/appointments\": \"Agendamentos\",\n  \"/routes\": \"Roteiriza√ß√£o\",\n  \"/clients\": \"Clientes\",\n  \"/technicians\": \"T√©cnicos\",\n  \"/vehicles\": \"Ve√≠culos\",\n  \"/services\": \"Servi√ßos\",\n};\n\nexport default function TopBar({ onMenuClick }: TopBarProps) {\n  const [location] = useLocation();\n  \n  const getCurrentDate = () => {\n    return new Date().toLocaleDateString('pt-BR', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  const pageName = pageNames[location] || \"Dashboard\";\n\n  return (\n    <header className=\"bg-white shadow-sm border-b border-gray-200 px-6 py-4\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center\">\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            className=\"lg:hidden text-gray-600 hover:text-gray-900 mr-4\"\n            onClick={onMenuClick}\n          >\n            <Menu className=\"h-5 w-5\" />\n          </Button>\n          <h2 className=\"text-2xl font-semibold text-gray-900\">{pageName}</h2>\n        </div>\n        \n        <div className=\"flex items-center space-x-4\">\n          <Button variant=\"ghost\" size=\"sm\" className=\"text-gray-400 hover:text-gray-600\">\n            <Bell className=\"h-5 w-5\" />\n          </Button>\n          <div className=\"text-sm text-gray-600 capitalize\">\n            {getCurrentDate()}\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":1714},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/lib/auth.tsx":{"content":"import { createContext, useContext, useState, useEffect, ReactNode } from \"react\";\nimport { apiRequest } from \"./queryClient\";\nimport type { User } from \"../../../shared/schema\";\n\ninterface AuthContextType {\n  user: User | null;\n  login: (email: string, password: string) => Promise<void>;\n  register: (userData: { name: string; email: string; password: string; username: string }) => Promise<void>;\n  logout: () => void;\n  isLoading: boolean;\n}\n\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\n\nexport function AuthProvider({ children }: { children?: ReactNode } = {}) {\n  if (!children) {\n    console.warn(\"[AuthProvider] Renderizado sem children!\");\n    return null;\n  }\n  const [user, setUser] = useState<User | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      if (!token) {\n        setIsLoading(false);\n        return;\n      }\n\n      const response = await fetch(\"/api/auth/me\", {\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      });\n\n      if (response.ok) {\n        const userData = await response.json();\n        setUser(userData);\n      } else {\n        localStorage.removeItem(\"token\");\n      }\n    } catch (error) {\n      localStorage.removeItem(\"token\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const login = async (email: string, password: string) => {\n    const response = await apiRequest(\"POST\", \"/api/auth/login\", { email, password });\n    const data = await response.json();\n    \n    localStorage.setItem(\"token\", data.token);\n    setUser(data.user);\n  };\n\n  const register = async (userData: { name: string; email: string; password: string; username: string }) => {\n    const response = await apiRequest(\"POST\", \"/api/auth/register\", userData);\n    const data = await response.json();\n    \n    localStorage.setItem(\"token\", data.token);\n    setUser(data.user);\n  };\n\n  const logout = () => {\n    localStorage.removeItem(\"token\");\n    setUser(null);\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, login, register, logout, isLoading }}>\n      {children}\n    </AuthContext.Provider>\n  );\n}\n\nexport function useAuth() {\n  const context = useContext(AuthContext);\n  if (context === undefined) {\n    throw new Error(\"useAuth must be used within an AuthProvider\");\n  }\n  return context;\n}\n\n// Utility function to get auth headers\nexport function getAuthHeaders(): Record<string, string> {\n  const token = localStorage.getItem(\"token\");\n  if (token) {\n    return { Authorization: `Bearer ${token}` };\n  }\n  return {};\n}","size_bytes":2682},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const token = localStorage.getItem(\"token\");\n  const headers: Record<string, string> = {\n    ...(data ? { \"Content-Type\": \"application/json\" } : {}),\n    ...(token ? { Authorization: `Bearer ${token}` } : {}),\n  };\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1542},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/Appointments.tsx":{"content":"import { useState, useEffect, useMemo, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getAuthHeaders } from \"@/lib/auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport AppointmentForm from \"@/components/forms/AppointmentForm\";\nimport AppointmentCalendar from \"@/components/AppointmentCalendar\";\nimport { Plus, Calendar, MapPin, Clock, User, Edit, Trash2, Download, Upload, Filter, Search, List, Route, X, Navigation, CheckCircle2, Repeat2 } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { downloadCSV, downloadReport, downloadWithConfirmation } from \"@/lib/download\";\nimport { useSafeNavigation } from \"@/hooks/useSafeNavigation\";\nimport { useCalendarCleanup } from \"@/hooks/useCalendarCleanup\";\nimport type { Appointment, Client, Service, Technician, Team } from \"@shared/schema\";\n\nexport default function Appointments() {\n  const [selectedAppointment, setSelectedAppointment] = useState<Appointment | null>(null);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const [prefilledData, setPrefilledData] = useState<any>(null);\n  \n  // Estados para filtros\n  const [selectedDate, setSelectedDate] = useState<string>(\"\");\n  const [searchTerm, setSearchTerm] = useState<string>(\"\");\n  const [selectedService, setSelectedService] = useState<string>(\"all\");\n  const [selectedTechnician, setSelectedTechnician] = useState<string>(\"all\");\n  const [selectedStatus, setSelectedStatus] = useState<string>(\"all\");\n  \n  // Estado para controlar visualiza√ß√£o (lista ou calend√°rio)\n  const [viewMode, setViewMode] = useState<\"list\" | \"calendar\">(\"list\");\n  \n  // Estados para sele√ß√£o de agendamentos e otimiza√ß√£o de rotas\n  const [selectedAppointmentIds, setSelectedAppointmentIds] = useState<number[]>([]);\n  const [isRouteDrawerOpen, setIsRouteDrawerOpen] = useState(false);\n  const [endAtStart, setEndAtStart] = useState(false);\n  const [isOptimizing, setIsOptimizing] = useState(false);\n  const [optimizedRoute, setOptimizedRoute] = useState<{\n    route?: any;\n    stops?: any[];\n    appointments?: Appointment[];\n    totalDistance?: number;\n    totalDuration?: number;\n  } | null>(null);\n  const [polyline, setPolyline] = useState<any>(null);\n  const [error, setError] = useState<string | null>(null);\n  const [savedInfo, setSavedInfo] = useState<null | { id: string; displayNumber: number }>(null);\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Hook de navega√ß√£o segura com limpeza robusta\n  const { isSafeToOperate, registerCleanup } = useSafeNavigation({\n    componentName: 'APPOINTMENTS',\n    modals: [\n      {\n        isOpen: isFormOpen,\n        setIsOpen: setIsFormOpen,\n        resetState: () => {\n          setSelectedAppointment(null);\n          setPrefilledData(null);\n        }\n      },\n      {\n        isOpen: isRouteDrawerOpen,\n        setIsOpen: setIsRouteDrawerOpen,\n        resetState: () => {\n          setOptimizedRoute(null);\n          setPolyline(null);\n          setError(null);\n          setSelectedAppointmentIds([]);\n          setSavedInfo(null);\n          setIsOptimizing(false);\n        }\n      }\n    ],\n    calendars: [\n      {\n        isVisible: viewMode === 'calendar',\n      }\n    ]\n  });\n  \n  // Hook espec√≠fico para limpeza do calend√°rio\n  const calendarContainerRef = useCalendarCleanup(viewMode === 'calendar');\n\n  // Limpar todos os estados quando o drawer fechar\n  useEffect(() => { \n    if (!isRouteDrawerOpen) {\n      setSavedInfo(null);\n      setOptimizedRoute(null);\n      setPolyline(null);\n      setError(null);\n      setIsOptimizing(false);\n    }\n  }, [isRouteDrawerOpen]);\n\n  // Limpar estados quando mudar a sele√ß√£o (nova otimiza√ß√£o)\n  useEffect(() => { \n    setSavedInfo(null);\n    setOptimizedRoute(null);\n    setPolyline(null);\n    setError(null);\n  }, [JSON.stringify(selectedAppointmentIds)]);\n\n  // Logs para monitorar uso dos filtros\n  useEffect(() => {\n    console.log(\"üîç [FILTER] Filtros aplicados:\", {\n      selectedDate,\n      searchTerm,\n      selectedService,\n      selectedTechnician,\n      selectedStatus\n    });\n  }, [selectedDate, searchTerm, selectedService, selectedTechnician, selectedStatus]);\n\n  // Verificar par√¢metros da URL ao carregar a p√°gina\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const preselected = urlParams.get('preselected');\n    \n    console.log(\"üìã [DEBUG] Appointments - Verificando par√¢metros URL:\", {\n      preselected,\n      date: urlParams.get('date'),\n      cep: urlParams.get('cep'),\n      numero: urlParams.get('numero'),\n      serviceId: urlParams.get('serviceId'),\n      technicianId: urlParams.get('technicianId'),\n      teamId: urlParams.get('teamId'),\n      clientId: urlParams.get('clientId')\n    });\n    \n    if (preselected === 'true') {\n      const data = {\n        date: urlParams.get('date'),\n        cep: urlParams.get('cep'),\n        numero: urlParams.get('numero'),\n        serviceId: urlParams.get('serviceId'),\n        technicianId: urlParams.get('technicianId'),\n        teamId: urlParams.get('teamId'),\n        clientId: urlParams.get('clientId'),\n      };\n      \n      console.log(\"üìã [DEBUG] Appointments - Dados processados:\", data);\n      \n      // Verificar se todos os campos obrigat√≥rios est√£o presentes\n      const hasRequiredFields = data.date && data.cep && data.numero && data.serviceId && \n                               (data.technicianId || data.teamId);\n      \n      console.log(\"üìã [DEBUG] Appointments - Campos obrigat√≥rios presentes:\", hasRequiredFields);\n      \n      if (hasRequiredFields) {\n        setPrefilledData(data);\n        setIsFormOpen(true);\n        \n        // Limpar par√¢metros da URL\n        window.history.replaceState({}, document.title, window.location.pathname);\n      }\n    }\n  }, []);\n\n  const { data: appointments = [], isLoading } = useQuery({\n    queryKey: [\"/api/appointments\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/appointments\", {\n        headers: getAuthHeaders(),\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      const data = await response.json();\n      return Array.isArray(data) ? data : [];\n    },\n  });\n\n  const { data: clients = [] } = useQuery({\n    queryKey: [\"/api/clients\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/clients\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const { data: services = [] } = useQuery({\n    queryKey: [\"/api/services\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/services\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const { data: technicians = [] } = useQuery({\n    queryKey: [\"/api/technicians\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/technicians\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const { data: teams = [] } = useQuery({\n    queryKey: [\"/api/teams\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/teams\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const deleteAppointmentMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/appointments/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/appointments\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Agendamento exclu√≠do com sucesso\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao excluir agendamento\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEdit = (appointment: Appointment) => {\n    setSelectedAppointment(appointment);\n    setIsFormOpen(true);\n  };\n\n  const handleDelete = async (appointment: Appointment) => {\n    if (confirm(\"Tem certeza que deseja excluir este agendamento?\")) {\n      deleteAppointmentMutation.mutate(appointment.id);\n    }\n  };\n\n  const handleFormClose = () => {\n    // Usa o hook seguro para verificar se √© seguro operar\n    if (!isSafeToOperate()) {\n      console.log('‚ö†Ô∏è [APPOINTMENTS] Componente desmontado, opera√ß√£o cancelada');\n      return;\n    }\n    \n    console.log(\"üßπ [DEBUG] handleFormClose - Limpando formul√°rio\");\n    console.log(\"üßπ [DEBUG] handleFormClose - selectedAppointment antes:\", selectedAppointment);\n    console.log(\"üßπ [DEBUG] handleFormClose - prefilledData antes:\", prefilledData);\n    \n    setIsFormOpen(false);\n    setSelectedAppointment(null);\n    setPrefilledData(null);\n    \n    console.log(\"üßπ [DEBUG] handleFormClose - Estado limpo - formul√°rio deve abrir vazio na pr√≥xima vez\");\n  };\n\n  // Handlers para sele√ß√£o de agendamentos\n  const handleAppointmentSelection = (appointmentId: number, isSelected: boolean) => {\n    if (isSelected) {\n      setSelectedAppointmentIds(prev => [...prev, appointmentId]);\n    } else {\n      setSelectedAppointmentIds(prev => prev.filter(id => id !== appointmentId));\n    }\n  };\n\n  const handleSelectAll = (isSelected: boolean) => {\n    if (isSelected) {\n      setSelectedAppointmentIds(filteredAppointments.map(apt => apt.id));\n    } else {\n      setSelectedAppointmentIds([]);\n    }\n  };\n\n  const handleOptimizeRoute = async () => {\n    if (selectedAppointmentIds.length < 2) {\n      toast({ \n        title: \"Selecione ao menos 2 agendamentos.\", \n        variant: \"destructive\" \n      });\n      return;\n    }\n\n    // ‚úÖ Respons√°vel √∫nico (mesmo t√©cnico OU mesma equipe)\n    const selected = filteredAppointments.filter(apt => selectedAppointmentIds.includes(apt.id));\n    const keys = selected.map(apt =>\n      apt.technicianId ? `technician-${apt.technicianId}` :\n      apt.teamId ? `team-${apt.teamId}` : null\n    ).filter(Boolean);\n    const uniqueKeys = Array.from(new Set(keys));\n    if (uniqueKeys.length !== 1) {\n      toast({\n        title: \"Sele√ß√£o inv√°lida\",\n        description: \"N√£o √© poss√≠vel otimizar rota com t√©cnicos/equipes diferentes. Selecione do mesmo respons√°vel.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      // Limpar estados ao iniciar nova otimiza√ß√£o\n      setSavedInfo(null);\n      setOptimizedRoute(null);\n      setPolyline(null);\n      setError(null);\n      setIsOptimizing(true);\n      setIsRouteDrawerOpen(true);\n\n      console.log(\"üó∫Ô∏è [ROUTE] Otimizando rotas com configura√ß√£o:\", {\n        appointmentIds: selectedAppointmentIds,\n        endAtStart: endAtStart\n      });\n\n      const res = await fetch(\"/api/routes/optimize\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          appointmentIds: selectedAppointmentIds, // n√∫meros\n          endAtStart,\n          title: `Rota ${new Date().toLocaleDateString()}`,\n          preview: true\n        }),\n      });\n\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || \"Falha ao otimizar rota\");\n      }\n\n      const data = await res.json();\n      console.log(\"‚úÖ [ROUTE] Rota otimizada recebida:\", data);\n      \n      // SUBSTITUIR estados (n√£o concatenar)\n      setOptimizedRoute(data);\n      setPolyline(data.route?.polylineGeoJson ?? null);\n      \n      toast({\n        title: \"Rota otimizada com sucesso!\",\n        description: `${data.stops?.length || 0} paradas organizadas`,\n      });\n\n    } catch (err) {\n      console.error(\"‚ùå [ROUTE] Erro ao otimizar:\", err);\n      setError(err.message || \"Erro interno do servidor\");\n      toast({ \n        title: \"Erro ao otimizar rota\", \n        description: err.message || \"Erro interno do servidor\",\n        variant: \"destructive\" \n      });\n      setIsRouteDrawerOpen(false);\n    } finally {\n      setIsOptimizing(false);\n    }\n  };\n\n  const handleSaveRoute = async () => {\n    if (!optimizedRoute?.route || optimizedRoute.route.id) {\n      toast({\n        title: \"Erro\",\n        description: \"Rota j√° foi salva ou dados inv√°lidos\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    try {\n      const res = await fetch(\"/api/routes/optimize\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          appointmentIds: selectedAppointmentIds,\n          endAtStart,\n          title: optimizedRoute.route.title,\n          preview: false\n        }),\n      });\n\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || \"Falha ao salvar rota\");\n      }\n\n      const data = await res.json();\n      setOptimizedRoute(data);\n      setSavedInfo({ id: data.route.id, displayNumber: data.route.displayNumber });\n      // mant√©m drawer aberto\n      setSelectedAppointmentIds([]);\n\n      toast({\n        title: `Rota salva com sucesso ‚Äî ID #${data.route.displayNumber}`,\n        description: \"A rota foi salva no hist√≥rico\",\n      });\n\n    } catch (err) {\n      console.error(\"‚ùå [ROUTE] Erro ao salvar:\", err);\n      toast({\n        title: \"Erro ao salvar rota\",\n        description: err.message || \"Erro interno do servidor\",\n        variant: \"destructive\"\n      });\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"bg-green-100 text-green-800\";\n      case \"in_progress\":\n        return \"bg-yellow-100 text-yellow-800\";\n      case \"scheduled\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"cancelled\":\n        return \"bg-red-100 text-red-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"Conclu√≠do\";\n      case \"in_progress\":\n        return \"Em Andamento\";\n      case \"scheduled\":\n        return \"Agendado\";\n      case \"cancelled\":\n        return \"Cancelado\";\n      default:\n        return status;\n    }\n  };\n\n  const getPriorityColor = (priority: string) => {\n    switch (priority) {\n      case \"urgent\":\n        return \"bg-red-100 text-red-800\";\n      case \"high\":\n        return \"bg-orange-100 text-orange-800\";\n      case \"normal\":\n        return \"bg-gray-100 text-gray-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getPriorityText = (priority: string) => {\n    switch (priority) {\n      case \"urgent\":\n        return \"Urgente\";\n      case \"high\":\n        return \"Alta\";\n      case \"normal\":\n        return \"Normal\";\n      default:\n        return priority;\n    }\n  };\n\n  const formatDateTime = (dateString: string) => {\n    const date = new Date(dateString);\n    return {\n      date: date.toLocaleDateString('pt-BR'),\n      time: date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })\n    };\n  };\n\n  const getClient = (clientId: number | null) => clientId ? clients.find((c: Client) => c.id === clientId) : null;\n  const getService = (serviceId: number) => services.find((s: Service) => s.id === serviceId);\n  const getTechnician = (technicianId: number | null) => technicianId ? technicians.find((t: Technician) => t.id === technicianId) : null;\n  const getTeam = (teamId: number | null) => teamId ? teams.find((t: Team) => t.id === teamId) : null;\n\n  // Fun√ß√£o para obter informa√ß√µes do respons√°vel (t√©cnico ou equipe) com logs detalhados\n  const getResponsibleInfo = (appointment: Appointment) => {\n    if (appointment.technicianId) {\n      const technician = getTechnician(appointment.technicianId);\n      console.log(`üë§ [DEBUG] Agendamento ${appointment.id} - T√©cnico individual:`, technician?.name, \"ID:\", appointment.technicianId);\n      return {\n        type: 'technician' as const,\n        name: technician?.name || \"T√©cnico n√£o encontrado\",\n        id: appointment.technicianId,\n        displayName: `üë§ ${technician?.name || \"T√©cnico n√£o encontrado\"}`\n      };\n    } else if (appointment.teamId) {\n      const team = getTeam(appointment.teamId);\n      console.log(`üë• [DEBUG] Agendamento ${appointment.id} - Equipe:`, team?.name, \"ID:\", appointment.teamId);\n      return {\n        type: 'team' as const,\n        name: team?.name || \"Equipe n√£o encontrada\",\n        id: appointment.teamId,\n        displayName: `üë• ${team?.name || \"Equipe n√£o encontrada\"}`\n      };\n    }\n    console.log(`‚ùå [DEBUG] Agendamento ${appointment.id} - Nenhum respons√°vel atribu√≠do`);\n    return {\n      type: 'none' as const,\n      name: \"Respons√°vel n√£o atribu√≠do\",\n      id: null,\n      displayName: \"‚ùå Respons√°vel n√£o atribu√≠do\"\n    };\n  };\n\n  // L√≥gica de filtragem dos agendamentos\n  const filteredAppointments = useMemo(() => {\n    if (!appointments || appointments.length === 0) return [];\n    \n    console.log(\"üîç [FILTER] Aplicando filtros nos agendamentos...\");\n    console.log(\"üîç [FILTER] Total de agendamentos:\", appointments.length);\n    \n    const filtered = appointments.filter((apt: Appointment) => {\n      // Filter by date\n      if (selectedDate) {\n        const aptDate = new Date(apt.scheduledDate).toLocaleDateString('en-CA'); // YYYY-MM-DD format\n        console.log(`üîç [FILTER] Comparando datas - selectedDate: ${selectedDate}, aptDate: ${aptDate}`);\n        if (aptDate !== selectedDate) {\n          console.log(`üîç [FILTER] Agendamento ${apt.id} filtrado por data`);\n          return false;\n        }\n      }\n\n      // Filter by client name (search term)\n      if (searchTerm) {\n        const client = getClient(apt.clientId);\n        const clientName = client?.name?.toLowerCase() || '';\n        const searchLower = searchTerm.toLowerCase();\n        console.log(`üîç [FILTER] Pesquisando \"${searchTerm}\" em \"${clientName}\"`);\n        if (!clientName.includes(searchLower)) {\n          console.log(`üîç [FILTER] Agendamento ${apt.id} filtrado por busca de cliente`);\n          return false;\n        }\n      }\n\n      // Filter by service\n      if (selectedService && selectedService !== \"all\") {\n        console.log(`üîç [FILTER] Filtro de servi√ßo aplicado - selectedService: ${selectedService}, apt.serviceId: ${apt.serviceId}`);\n        if (apt.serviceId.toString() !== selectedService) {\n          console.log(`üîç [FILTER] Agendamento ${apt.id} filtrado por servi√ßo`);\n          return false;\n        }\n      }\n\n      // Filter by technician/team\n      if (selectedTechnician && selectedTechnician !== \"all\") {\n        console.log(`üîç [FILTER] Filtro de t√©cnico/equipe aplicado - selectedTechnician: ${selectedTechnician}`);\n        \n        // Verificar se √© um t√©cnico individual\n        const technician = getTechnician(apt.technicianId);\n        const isMatchingTechnician = technician?.id.toString() === selectedTechnician;\n        \n        // Verificar se √© uma equipe (o valor vem como \"team-{id}\")\n        const team = teams.find((t: any) => t.id === apt.teamId);\n        const isMatchingTeam = team && selectedTechnician === `team-${team.id}`;\n        \n        console.log(`üîç [FILTER] isMatchingTechnician: ${isMatchingTechnician}, isMatchingTeam: ${isMatchingTeam}, team:`, team?.name);\n        \n        if (!isMatchingTechnician && !isMatchingTeam) {\n          console.log(`üîç [FILTER] Agendamento ${apt.id} filtrado por t√©cnico/equipe`);\n          return false;\n        }\n      }\n\n      // Filter by status\n      if (selectedStatus && selectedStatus !== \"all\") {\n        console.log(`üîç [FILTER] Filtro de status aplicado - selectedStatus: ${selectedStatus}, apt.status: ${apt.status}`);\n        if (apt.status !== selectedStatus) {\n          console.log(`üîç [FILTER] Agendamento ${apt.id} filtrado por status`);\n          return false;\n        }\n      }\n\n      return true;\n    });\n\n    console.log(`üîç [FILTER] Resultado da filtragem: ${filtered.length} de ${appointments.length} agendamentos`);\n    return filtered;\n  }, [appointments, selectedDate, searchTerm, selectedService, selectedTechnician, selectedStatus, clients, services, technicians, teams]);\n\n  // Computed values for route optimization\n  const selectedAppointments = filteredAppointments.filter(apt => \n    selectedAppointmentIds.includes(apt.id)\n  );\n  const isAllSelected = filteredAppointments.length > 0 && \n    selectedAppointmentIds.length === filteredAppointments.length;\n  const isPartiallySelected = selectedAppointmentIds.length > 0 && \n    selectedAppointmentIds.length < filteredAppointments.length;\n\n  const importCSVMutation = useMutation({\n    mutationFn: async (appointments: any[]) => {\n      const response = await apiRequest(\"POST\", \"/api/appointments/import\", { appointments });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/appointments\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      \n      // Log detalhado dos resultados do backend\n      console.group(\"üìä RESULTADO DA IMPORTA√á√ÉO NO BACKEND\");\n      console.log(`‚úÖ Sucessos: ${data.success}`);\n      console.log(`‚ùå Erros: ${data.errors}`);\n      \n      if (data.detailedErrors && data.detailedErrors.length > 0) {\n        console.log(\"\\nüìã Erros detalhados do servidor:\");\n        data.detailedErrors.forEach((error: string, index: number) => {\n          console.log(`   ${index + 1}. ${error}`);\n        });\n      }\n      \n      if (data.processedItems) {\n        console.log(`\\nüìà Itens processados: ${data.processedItems.length}`);\n        const successItems = data.processedItems.filter((item: any) => item.status === 'success');\n        const errorItems = data.processedItems.filter((item: any) => item.status === 'error');\n        console.log(`   ‚Ä¢ Sucessos: ${successItems.length}`);\n        console.log(`   ‚Ä¢ Erros: ${errorItems.length}`);\n      }\n      console.groupEnd();\n      \n      // Toast com resultado\n      if (data.errors > 0) {\n        const errorMessage = data.detailedErrors ? \n          data.detailedErrors.slice(0, 2).join('\\n') + \n          (data.detailedErrors.length > 2 ? `\\n... e mais ${data.detailedErrors.length - 2} erros` : '') : \n          `${data.errors} erros encontrados`;\n          \n        toast({\n          title: `Importa√ß√£o parcial: ${data.success} sucessos, ${data.errors} erros`,\n          description: errorMessage,\n          variant: \"destructive\",\n        });\n        \n        // Gerar relat√≥rio de erros do backend se houver\n        if (data.detailedErrors && data.detailedErrors.length > 0) {\n          const backendErrorReport = [\n            \"RELAT√ìRIO DE ERROS - PROCESSAMENTO NO SERVIDOR\",\n            \"=\" + \"=\".repeat(50),\n            \"\",\n            `Data/Hora: ${new Date().toLocaleString('pt-BR')}`,\n            \"\",\n            \"RESUMO:\",\n            \"-\".repeat(20),\n            `Total processado: ${data.success + data.errors}`,\n            `Sucessos: ${data.success}`,\n            `Erros: ${data.errors}`,\n            `Taxa de sucesso: ${((data.success / (data.success + data.errors)) * 100).toFixed(1)}%`,\n            \"\",\n            \"ERROS DO SERVIDOR:\",\n            \"-\".repeat(40),\n            ...data.detailedErrors.map((error: string, index: number) => `${index + 1}. ${error}`),\n          ].join('\\n');\n\n          // Download seguro do relat√≥rio do servidor\n          const filename = `relatorio_servidor_${new Date().toISOString().split('T')[0]}_${new Date().toTimeString().split(' ')[0].replace(/:/g, '')}.txt`;\n          \n          setTimeout(() => {\n            downloadWithConfirmation(\n              backendErrorReport, \n              filename, \n              \"Deseja baixar o relat√≥rio de erros do servidor?\"\n            );\n          }, 1500);\n        }\n      } else {\n        toast({\n          title: \"Sucesso\",\n          description: `${data.success} agendamentos importados com sucesso!`,\n        });\n      }\n    },\n    onError: (error: any) => {\n      console.error(\"‚ùå Erro na comunica√ß√£o com o servidor:\", error);\n      toast({\n        title: \"Erro de comunica√ß√£o\",\n        description: error.message || \"Erro ao conectar com o servidor\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleImportCSV = () => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.csv';\n    input.onchange = (e) => {\n      const file = (e.target as HTMLInputElement).files?.[0];\n      if (file) {\n        const reader = new FileReader();\n        reader.onload = (event) => {\n          try {\n            const csv = event.target?.result as string;\n            const lines = csv.split('\\n').filter(line => line.trim());\n            \n            if (lines.length < 2) {\n              toast({\n                title: \"Erro\",\n                description: \"Arquivo CSV deve conter pelo menos uma linha de dados\",\n                variant: \"destructive\",\n              });\n              return;\n            }\n\n            const headers = lines[0].split(',').map(h => h.replace(/\"/g, '').trim());\n            const appointmentsToImport = [];\n            const errors = [];\n\n            console.log(\"üìã [CSV IMPORT] Iniciando importa√ß√£o de agendamentos...\");\n            console.log(\"üìã [CSV IMPORT] Campos reconhecidos:\", headers);\n            console.log(\"üìã [CSV IMPORT] T√©cnicos dispon√≠veis:\", technicians.map((t: Technician) => t.name));\n            console.log(\"üìã [CSV IMPORT] Equipes dispon√≠veis:\", teams.map((t: Team) => t.name));\n\n            for (let i = 1; i < lines.length; i++) {\n              const values = lines[i].split(',').map(v => v.replace(/\"/g, '').trim());\n              \n              if (values.length < headers.length) continue;\n\n              const clientName = values[0];\n              const cpfCliente = values[1];\n              const serviceName = values[5];\n              const technicianName = values[6];\n              const dateTime = values[7];\n              const cep = values[10];\n              const bairro = values[11]; // NOVO\n              const cidade = values[12]; // NOVO\n              const logradouro = values[13];\n              const numero = values[14];\n              const complemento = values[15] || \"\";\n              const notes = values[16] || \"\";\n\n\n              console.log(`üìã [CSV IMPORT] Linha ${i + 1}: Cliente=${clientName}, CPF=${cpfCliente}`);\n\n              // Encontrar cliente pelo CPF (priorit√°rio) ou nome (fallback) ANTES da valida√ß√£o\n              let client = null;\n              let clientData = null;\n              let finalClientName = clientName;\n              let finalCep = cep;\n              let finalLogradouro = logradouro;\n              let finalNumero = numero;\n              \n              if (cpfCliente) {\n                // Buscar cliente pelo CPF primeiro\n                client = clients.find((c: Client) => c.cpf === cpfCliente);\n                \n                if (client) {\n                  console.log(`‚úÖ [CSV IMPORT] Cliente encontrado pelo CPF ${cpfCliente}: ${client.name}`);\n                  console.log(`üìã [CSV IMPORT] Usando dados do cliente cadastrado, ignorando dados do CSV`);\n                  \n                  // Usar dados do cliente cadastrado\n                  finalClientName = client.name;\n                  finalCep = client.cep;\n                  finalLogradouro = client.logradouro;\n                  finalNumero = client.numero;\n                } else {\n                  console.log(`üîç [CSV IMPORT] CPF ${cpfCliente} n√£o encontrado, criando novo cliente`);\n                }\n              }\n              \n              if (!client && clientName) {\n                // Se n√£o encontrou pelo CPF, tentar por nome como fallback\n                client = clients.find((c: Client) => c.name.toLowerCase() === clientName.toLowerCase());\n                \n                if (client) {\n                  console.log(`‚ö†Ô∏è [CSV IMPORT] Cliente encontrado pelo nome: ${client.name} (sem CPF fornecido)`);\n                  // Usar dados do cliente cadastrado\n                  finalClientName = client.name;\n                  finalCep = client.cep;\n                  finalLogradouro = client.logradouro;\n                  finalNumero = client.numero;\n                }\n              }\n\n              // Validar campos obrigat√≥rios AP√ìS puxar dados do cliente\n              const validationErrors = [];\n              const phone1 = values[3];\n              \n              // Validar campos obrigat√≥rios (agora usando dados finais)\n              if (!finalClientName) validationErrors.push(\"Cliente n√£o identificado (forne√ßa nome ou CPF v√°lido)\");\n              if (!serviceName) validationErrors.push(\"Servi√ßo (coluna 6) est√° vazio\");\n              if (!dateTime) validationErrors.push(\"Data/Hora (coluna 8) est√° vazia\");\n              if (!finalCep) validationErrors.push(\"CEP n√£o dispon√≠vel (cliente n√£o cadastrado)\");\n              if (!finalNumero) validationErrors.push(\"N√∫mero n√£o dispon√≠vel (cliente n√£o cadastrado)\");\n              \n              // Validar formato do CEP\n              if (finalCep && !/^\\d{5}-?\\d{3}$/.test(finalCep)) {\n                validationErrors.push(`CEP \"${finalCep}\" inv√°lido (formato esperado: XXXXX-XXX)`);\n              }\n              \n              // Validar se o n√∫mero √© num√©rico\n              if (finalNumero && isNaN(Number(finalNumero))) {\n                validationErrors.push(`N√∫mero \"${finalNumero}\" deve ser num√©rico`);\n              }\n              \n              if (validationErrors.length > 0) {\n                errors.push(`Linha ${i + 1}: ${validationErrors.join(\"; \")}`);\n                continue;\n              }\n              \n              if (!client) {\n                // Preparar dados do cliente para cria√ß√£o autom√°tica\n                 clientData = {\n                  name: finalClientName,\n                  cpf: cpfCliente || \"\",\n                  email: values[2] || \"\",\n                  phone1: phone1 || \"\",\n                  phone2: values[4] || \"\",\n                  cep: finalCep,\n                  bairro: bairro || \"\",\n                  cidade: cidade || \"\",\n                  logradouro: finalLogradouro,\n                  numero: finalNumero,\n                  complemento: complemento,\n                  observacoes: `Cliente criado automaticamente via importa√ß√£o CSV em ${new Date().toLocaleString('pt-BR')}`\n                };\n                console.log(`üÜï [CSV IMPORT] Preparando cria√ß√£o de novo cliente: ${finalClientName}`);\n              }\n\n              // Encontrar servi√ßo\n              const service = services.find((s: Service) => s.name.toLowerCase() === serviceName.toLowerCase());\n              if (!service) {\n                errors.push(`Linha ${i + 1}: Servi√ßo \"${serviceName}\" n√£o encontrado`);\n                continue;\n              }\n\n              // Encontrar t√©cnico ou equipe\n              let technician = null;\n              let team = null;\n              \n              if (technicianName) {\n                // Primeiro, procurar por t√©cnico individual\n                technician = technicians.find((t: Technician) => t.name.toLowerCase() === technicianName.toLowerCase());\n                \n                if (technician) {\n                  console.log(`üë§ [CSV IMPORT] T√©cnico encontrado: ${technician.name}`);\n                } else {\n                  // Se n√£o encontrou t√©cnico, procurar por equipe\n                  team = teams.find((team: Team) => team.name.toLowerCase() === technicianName.toLowerCase());\n                  \n                  if (team) {\n                    console.log(`üë• [CSV IMPORT] Equipe encontrada: ${team.name}`);\n                  } else {\n                    console.log(`‚ö†Ô∏è [CSV IMPORT] T√©cnico/Equipe \"${technicianName}\" n√£o encontrado`);\n                  }\n                }\n              }\n\n              // Validar e normalizar prioridade\n              let normalizedPriority = \"normal\";\n              const priorityValue = values[9];\n              if (priorityValue) {\n                const lowerPriority = priorityValue.toLowerCase().trim();\n                if (lowerPriority === \"normal\") {\n                  normalizedPriority = \"normal\";\n                } else if (lowerPriority === \"alta\" || lowerPriority === \"high\") {\n                  normalizedPriority = \"high\";\n                } else if (lowerPriority === \"urgente\" || lowerPriority === \"urgent\") {\n                  normalizedPriority = \"urgent\";\n                } else {\n                  errors.push(`Linha ${i + 1}: Prioridade \"${priorityValue}\" inv√°lida. Use: Normal, Alta ou Urgente`);\n                  continue;\n                }\n              }\n\n              // Validar e converter data com m√∫ltiplos formatos\n              let scheduledDate;\n              try {\n                // Tentar diferentes formatos de data\n                let dateObj;\n                \n                // Formato ISO (YYYY-MM-DD HH:MM:SS)\n                if (/^\\d{4}-\\d{2}-\\d{2}/.test(dateTime)) {\n                  dateObj = new Date(dateTime);\n                }\n                // Formato brasileiro (DD/MM/YYYY HH:MM)\n                else if (/^\\d{2}\\/\\d{2}\\/\\d{4}/.test(dateTime)) {\n                  const [datePart, timePart = \"00:00\"] = dateTime.split(\" \");\n                  const [day, month, year] = datePart.split(\"/\");\n                  dateObj = new Date(`${year}-${month}-${day} ${timePart}`);\n                }\n                // Formato americano (MM/DD/YYYY HH:MM)\n                else if (/^\\d{1,2}\\/\\d{1,2}\\/\\d{4}/.test(dateTime)) {\n                  dateObj = new Date(dateTime);\n                }\n                else {\n                  dateObj = new Date(dateTime);\n                }\n                \n                if (isNaN(dateObj.getTime())) {\n                  throw new Error(\"Data inv√°lida\");\n                }\n                \n                // Verificar se a data n√£o √© muito antiga (antes de 2020) ou muito futura (depois de 2030)\n                const year = dateObj.getFullYear();\n                if (year < 2020 || year > 2030) {\n                  errors.push(`Linha ${i + 1}: Data \"${dateTime}\" fora do intervalo v√°lido (2020-2030)`);\n                  continue;\n                }\n                \n                scheduledDate = dateObj.toISOString();\n              } catch {\n                errors.push(`Linha ${i + 1}: Data/hora \"${dateTime}\" inv√°lida. Formatos aceitos: YYYY-MM-DD HH:MM, DD/MM/YYYY HH:MM`);\n                continue;\n              }\n\n              // Mapear status em portugu√™s para valores do sistema\n              let finalStatus = \"scheduled\"; // padr√£o\n              const statusInput = (values[8] || \"\").trim();\n              \n              console.log(`üîÑ [CSV IMPORT] Status recebido da linha ${i + 1}: \"${statusInput}\"`);\n              \n              if (statusInput) {\n                const statusLower = statusInput.toLowerCase()\n                  .normalize('NFD')\n                  .replace(/[\\u0300-\\u036f]/g, ''); // remove acentos\n                \n                const statusMap: { [key: string]: string } = {\n                  'agendado': 'scheduled',\n                  'em andamento': 'in_progress', \n                  'em-andamento': 'in_progress',\n                  'emandamento': 'in_progress',\n                  'concluido': 'completed',\n                  'conclu√≠do': 'completed',\n                  'cancelado': 'cancelled',\n                  // Manter compatibilidade com ingl√™s\n                  'scheduled': 'scheduled',\n                  'in_progress': 'in_progress',\n                  'completed': 'completed',\n                  'cancelled': 'cancelled'\n                };\n                \n                if (statusMap[statusLower]) {\n                  finalStatus = statusMap[statusLower];\n                  console.log(`‚úÖ [CSV IMPORT] Status \"${statusInput}\" mapeado para: ${finalStatus}`);\n                } else {\n                  errors.push(`Linha ${i + 1}: Status \"${statusInput}\" inv√°lido. Valores aceitos: Agendado, Em Andamento, Conclu√≠do, Cancelado`);\n                  console.log(`‚ùå [CSV IMPORT] Status inv√°lido na linha ${i + 1}: \"${statusInput}\"`);\n                  continue;\n                }\n              }\n\n              const appointmentData = {\n                clientId: client?.id || null,\n                clientData: clientData,\n                serviceId: service.id,\n                technicianId: technician?.id || null,\n                teamId: team?.id || null,\n                scheduledDate,\n                status: finalStatus,\n                priority: normalizedPriority,\n                cep: finalCep,\n                bairro: client ? client.bairro : (bairro || \"\"),\n                cidade: client ? client.cidade : (cidade || \"\"),\n                logradouro: finalLogradouro,\n                numero: finalNumero,\n                complemento,\n                notes\n              };\n              \n              console.log(`üìã [CSV IMPORT] Agendamento preparado - Linha ${i + 1}:`, {\n                technicianId: appointmentData.technicianId,\n                teamId: appointmentData.teamId,\n                serviceId: appointmentData.serviceId,\n                clientId: appointmentData.clientId\n              });\n              \n              appointmentsToImport.push(appointmentData);\n            }\n\n            if (errors.length > 0) {\n              // Criar um relat√≥rio detalhado de erros\n              const errorReport = {\n                totalLines: lines.length - 1,\n                validAppointments: appointmentsToImport.length,\n                errorCount: errors.length,\n                errors: errors\n              };\n\n              // Mostrar primeiros 3 erros no toast\n              const shortErrorMessage = errors.slice(0, 3).join('\\n') + \n                (errors.length > 3 ? `\\n... e mais ${errors.length - 3} erros` : '');\n              \n              toast({\n                title: `${errors.length} erros encontrados na importa√ß√£o`,\n                description: shortErrorMessage,\n                variant: \"destructive\",\n              });\n              \n              // Log detalhado no console\n              console.group(\"üìã RELAT√ìRIO DETALHADO DE IMPORTA√á√ÉO CSV\");\n              console.log(`üìä Resumo:`);\n              console.log(`   ‚Ä¢ Total de linhas processadas: ${errorReport.totalLines}`);\n              console.log(`   ‚Ä¢ Agendamentos v√°lidos: ${errorReport.validAppointments}`);\n              console.log(`   ‚Ä¢ Erros encontrados: ${errorReport.errorCount}`);\n              console.log(`   ‚Ä¢ Taxa de sucesso: ${((errorReport.validAppointments / errorReport.totalLines) * 100).toFixed(1)}%`);\n              console.log(\"\\nüìù LISTA COMPLETA DE ERROS:\");\n              errorReport.errors.forEach((error, index) => {\n                console.log(`   ${index + 1}. ${error}`);\n              });\n              console.log(\"\\nüí° DICAS PARA CORRE√á√ÉO:\");\n              console.log(\"   ‚Ä¢ Verifique se os nomes de clientes, servi√ßos e t√©cnicos est√£o exatamente como cadastrados\");\n              console.log(\"   ‚Ä¢ Formato de data aceito: YYYY-MM-DD HH:MM:SS ou DD/MM/YYYY HH:MM\");\n              console.log(\"   ‚Ä¢ CEP deve estar no formato XXXXX-XXX\");\n              console.log(\"   ‚Ä¢ Campos obrigat√≥rios n√£o podem estar vazios\");\n              console.log(\"\\nüìã ORDEM DOS CAMPOS NO CSV:\");\n              console.log(\"   1. Cliente | 2. CPF Cliente | 3. Email Cliente | 4. Telefone 1 | 5. Telefone 2\");\n              console.log(\"   6. Servi√ßo | 7. T√©cnico | 8. Data/Hora | 9. Status | 10. Prioridade\");\n              console.log(\"   11. CEP | 12. Logradouro | 13. N√∫mero | 14. Complemento | 15. Observa√ß√µes\");\n              console.groupEnd();\n\n              // Criar arquivo de log para download\n              const logContent = [\n                \"RELAT√ìRIO DE ERROS - IMPORTA√á√ÉO CSV\",\n                \"=\" + \"=\".repeat(40),\n                \"\",\n                `Data/Hora: ${new Date().toLocaleString('pt-BR')}`,\n                `Arquivo processado: ${file.name}`,\n                \"\",\n                \"RESUMO:\",\n                `-\".repeat(20)`,\n                `Total de linhas: ${errorReport.totalLines}`,\n                `Agendamentos v√°lidos: ${errorReport.validAppointments}`,\n                `Erros encontrados: ${errorReport.errorCount}`,\n                `Taxa de sucesso: ${((errorReport.validAppointments / errorReport.totalLines) * 100).toFixed(1)}%`,\n                \"\",\n                \"ERROS DETALHADOS:\",\n                \"-\".repeat(40),\n                ...errorReport.errors.map((error, index) => `${index + 1}. ${error}`),\n                \"\",\n                \"DICAS PARA CORRE√á√ÉO:\",\n                \"-\".repeat(40),\n                \"‚Ä¢ Verifique se os nomes de clientes, servi√ßos e t√©cnicos est√£o exatamente como cadastrados no sistema\",\n                \"‚Ä¢ Formato de data aceito: YYYY-MM-DD HH:MM:SS ou DD/MM/YYYY HH:MM\",\n                \"‚Ä¢ CEP deve estar no formato XXXXX-XXX\",\n                \"‚Ä¢ Campos obrigat√≥rios n√£o podem estar vazios\",\n                \"‚Ä¢ Use apenas caracteres v√°lidos (evite caracteres especiais nos nomes)\",\n                \"\",\n                \"ORDEM DOS CAMPOS NO CSV:\",\n                \"-\".repeat(40),\n                \"1. Cliente | 2. CPF Cliente | 3. Email Cliente | 4. Telefone 1 | 5. Telefone 2\",\n                \"6. Servi√ßo | 7. T√©cnico | 8. Data/Hora | 9. Status | 10. Prioridade\", \n                \"11. CEP | 12. Logradouro | 13. N√∫mero | 14. Complemento | 15. Observa√ß√µes\",\n                \"\",\n                \"COMPORTAMENTO INTELIGENTE DE CPF:\",\n                \"-\".repeat(40),\n                \"‚Ä¢ Se o CPF do cliente j√° estiver cadastrado, os dados do cliente ser√£o puxados automaticamente\",\n                \"‚Ä¢ Neste caso, os dados do CSV (nome, telefone, endere√ßo) ser√£o ignorados para esse cliente\",\n                \"‚Ä¢ Isso garante consist√™ncia com os dados j√° cadastrados no sistema\",\n                \"\",\n                \"OBSERVA√á√ÉO: Use o bot√£o 'Baixar CSV Modelo' para obter um arquivo com a estrutura correta.\"\n              ].join('\\n');\n\n              const logBlob = new Blob([logContent], { type: \"text/plain;charset=utf-8;\" });\n              // Download seguro do relat√≥rio de erros\n              const filename = `relatorio_erros_${new Date().toISOString().split('T')[0]}_${new Date().toTimeString().split(' ')[0].replace(/:/g, '')}.txt`;\n              \n              setTimeout(() => {\n                downloadWithConfirmation(\n                  logContent,\n                  filename,\n                  \"Deseja baixar um relat√≥rio detalhado dos erros encontrados?\"\n                );\n              }, 1000);\n            }\n\n            if (appointmentsToImport.length > 0) {\n              importCSVMutation.mutate(appointmentsToImport);\n            } else {\n              toast({\n                title: \"Erro\",\n                description: \"Nenhum agendamento v√°lido encontrado no arquivo\",\n                variant: \"destructive\",\n              });\n            }\n\n          } catch (error) {\n            toast({\n              title: \"Erro\",\n              description: \"Erro ao processar arquivo CSV\",\n              variant: \"destructive\",\n            });\n          }\n        };\n        reader.readAsText(file);\n      }\n    };\n    input.click();\n  };\n\n  const downloadCSVTemplate = () => {\n    const templateHeaders = [\n      \"Cliente\",\n      \"CPF Cliente\", \n      \"Email Cliente\",\n      \"Telefone 1\",\n      \"Telefone 2\", \n      \"Servi√ßo\",\n      \"T√©cnico\",\n      \"Data/Hora\",\n      \"Status\",\n      \"Prioridade\",\n      \"CEP\",\n      \"Bairro\",      // NOVO\n      \"Cidade\",      // NOVO\n      \"Logradouro\", \n      \"N√∫mero\",\n      \"Complemento\",\n      \"Observa√ß√µes\"\n    ];\n\n    const exampleRow = [\n      \"Jo√£o Silva\",\n      \"123.456.789-01\",\n      \"joao@email.com\", \n      \"(11) 99999-9999\",\n      \"(11) 88888-8888\",\n      \"Instala√ß√£o\",\n      \"Carlos T√©cnico\",\n      \"2024-12-25 14:30\",\n      \"Agendado\",\n      \"normal\", \n      \"01234-567\",\n      \"Port√£o\",     // EXEMPLO\n      \"Curitiba\",   // EXEMPLO\n      \"Rua das Flores\",\n      \"123\",\n      \"Apto 45\",\n      \"Cliente preferencial\"\n    ];\n\n    const csvContent = [templateHeaders, exampleRow]\n      .map(row => row.map(field => `\"${field}\"`).join(\",\"))\n      .join(\"\\n\");\n\n    // Download seguro do modelo CSV\n    downloadCSV(csvContent, \"modelo_importacao_agendamentos.csv\");\n\n    toast({\n      title: \"Modelo baixado\",\n      description: \"Use este arquivo como base para importar seus agendamentos\",\n    });\n  };\n\n\n  const exportToCSV = () => {\n    if (appointments.length === 0) {\n      toast({\n        title: \"Aviso\",\n        description: \"N√£o h√° agendamentos para exportar\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const csvHeaders = [\n    \"ID\",\n    \"Cliente\",\n    \"Email Cliente\",\n    \"Telefone 1\",\n    \"Telefone 2\",\n    \"Servi√ßo\",\n    \"T√©cnico\",\n    \"Data/Hora\",\n    \"Status\",\n    \"Prioridade\",\n    \"CEP\",\n    \"Bairro\",         // NOVO\n    \"Cidade\",         // NOVO\n    \"Logradouro\",\n    \"N√∫mero\",\n    \"Complemento\",\n    \"Observa√ß√µes\"\n  ];\n\n  const csvData = appointments.map((appointment: Appointment) => {\n    const client = getClient(appointment.clientId);\n    const service = getService(appointment.serviceId);\n    const technician = getTechnician(appointment.technicianId);\n    const { date, time } = formatDateTime(appointment.scheduledDate.toString());\n\n    return [\n      appointment.id,\n      client?.name || \"Cliente n√£o encontrado\",\n      client?.email || \"\",\n      client?.phone1 || \"\",\n      client?.phone2 || \"\",\n      service?.name || \"Servi√ßo n√£o encontrado\",\n      technician?.name || \"T√©cnico n√£o encontrado\",\n      `${date} ${time}`,\n      getStatusText(appointment.status),\n      getPriorityText(appointment.priority),\n      appointment.cep,\n      appointment.bairro || \"\",       // NOVO\n      appointment.cidade || \"\",       // NOVO\n      appointment.logradouro,\n      appointment.numero,\n      appointment.complemento || \"\",\n      appointment.notes || \"\"\n    ];\n  });\n\n    const csvContent = [csvHeaders, ...csvData]\n      .map((row: any[]) => row.map((field: any) => `\"${field}\"`).join(\",\"))\n      .join(\"\\n\");\n\n    // Download seguro da exporta√ß√£o CSV\n    const filename = `agendamentos_${new Date().toISOString().split('T')[0]}.csv`;\n    downloadCSV(csvContent, filename);\n\n    toast({\n      title: \"Sucesso\",\n      description: \"Agendamentos exportados com sucesso\",\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-burnt-yellow\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header - Mobile-First Responsive */}\n      <div className=\"flex flex-col space-y-4 md:flex-row md:items-center md:justify-between md:space-y-0\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Agendamentos</h1>\n          <p className=\"text-gray-600\">Gerencie todos os seus agendamentos</p>\n        </div>\n        \n        {/* Action Buttons - Stack on mobile */}\n        <div className=\"flex flex-col gap-2 md:flex-row md:items-center md:gap-3\">\n          <div className=\"flex flex-col gap-2 sm:flex-row sm:gap-3\">\n            <Button\n              variant=\"ghost\"\n              onClick={downloadCSVTemplate}\n              className=\"text-xs text-blue-500 hover:text-blue-700 hover:bg-blue-50 w-full sm:w-auto\"\n            >\n              Baixar CSV Modelo\n            </Button>\n            \n            <Button\n              variant=\"outline\"\n              onClick={handleImportCSV}\n              className=\"border-blue-600 text-blue-600 hover:bg-blue-50 w-full sm:w-auto\"\n            >\n              <Upload className=\"h-4 w-4 mr-2\" />\n              Importar CSV\n            </Button>\n            \n            <Button\n              variant=\"outline\"\n              onClick={exportToCSV}\n              className=\"border-burnt-yellow text-burnt-yellow hover:bg-burnt-yellow hover:text-white w-full sm:w-auto\"\n            >\n              <Download className=\"h-4 w-4 mr-2\" />\n              Exportar CSV\n            </Button>\n          </div>\n          \n          <Button \n            className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white w-full md:w-auto\"\n            onClick={() => {\n              console.log(\"üÜï [DEBUG] Novo Agendamento - Bot√£o clicado\");\n              console.log(\"üÜï [DEBUG] Novo Agendamento - Limpando selectedAppointment e prefilledData\");\n              setSelectedAppointment(null);\n              setPrefilledData(null);\n              setIsFormOpen(true);\n            }}\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Novo Agendamento\n          </Button>\n        </div>\n      </div>\n\n      {/* Mobile-First Responsive Layout */}\n      <div className=\"space-y-4 md:space-y-6\">\n        {/* Filters Card with View Mode Toggle */}\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center\">\n              <Filter className=\"h-5 w-5 mr-2\" />\n              Filtros e Visualiza√ß√£o\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-6\">\n              {/* Filter Fields */}\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Data</label>\n                  <Input\n                    type=\"date\"\n                    value={selectedDate}\n                    onChange={(e) => {\n                      console.log(\"üîç [FILTER] Data alterada:\", e.target.value);\n                      setSelectedDate(e.target.value);\n                    }}\n                    className=\"w-full\"\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Buscar Cliente</label>\n                  <div className=\"relative\">\n                    <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n                    <Input\n                      placeholder=\"Nome do cliente...\"\n                      value={searchTerm}\n                      onChange={(e) => {\n                        console.log(\"üîç [FILTER] Busca alterada:\", e.target.value);\n                        setSearchTerm(e.target.value);\n                      }}\n                      className=\"pl-10\"\n                    />\n                  </div>\n                </div>\n                \n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Servi√ßo</label>\n                  <Select value={selectedService} onValueChange={(value) => {\n                    console.log(\"üîç [FILTER] Servi√ßo alterado:\", value);\n                    setSelectedService(value);\n                  }}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Todos os servi√ßos\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Todos os servi√ßos</SelectItem>\n                      {services.map((service: Service) => (\n                        <SelectItem key={service.id} value={service.id.toString()}>\n                          {service.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">T√©cnicos/Equipes</label>\n                  <Select value={selectedTechnician} onValueChange={(value) => {\n                    console.log(\"üîç [FILTER] T√©cnico/Equipe alterado:\", value);\n                    setSelectedTechnician(value);\n                  }}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Todos os t√©cnicos e equipes\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Todos os t√©cnicos e equipes</SelectItem>\n                      {technicians.map((technician: Technician) => (\n                        <SelectItem key={`tech-${technician.id}`} value={technician.id.toString()}>\n                          üë§ {technician.name}\n                        </SelectItem>\n                      ))}\n                      {teams.map((team: any) => (\n                        <SelectItem key={`team-${team.id}`} value={`team-${team.id}`}>\n                          üë• {team.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n                \n                <div>\n                  <label className=\"text-sm font-medium mb-2 block\">Status</label>\n                  <Select value={selectedStatus} onValueChange={(value) => {\n                    console.log(\"üîç [FILTER] Status alterado:\", value);\n                    setSelectedStatus(value);\n                  }}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"Todos os status\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">Todos os status</SelectItem>\n                      <SelectItem value=\"scheduled\">Agendado</SelectItem>\n                      <SelectItem value=\"in_progress\">Em Andamento</SelectItem>\n                      <SelectItem value=\"completed\">Conclu√≠do</SelectItem>\n                      <SelectItem value=\"cancelled\">Cancelado</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n\n              {/* View Mode Toggle and Clear Filters */}\n              <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4 pt-4 border-t border-gray-100\">\n                {/* View Mode Toggle */}\n                <div className=\"flex flex-col sm:flex-row sm:items-center gap-3\">\n                  <span className=\"text-sm font-medium text-gray-700\">Modo de Visualiza√ß√£o:</span>\n                  <div className=\"bg-white border border-gray-200 rounded p-0.5 shadow-sm w-full max-w-sm sm:w-auto\">\n                    <Tabs value={viewMode} onValueChange={(value) => setViewMode(value as \"list\" | \"calendar\")} className=\"w-full\">\n                      <TabsList className=\"grid w-full grid-cols-2 h-auto sm:h-8 bg-gray-50 p-0 gap-1 sm:gap-0\">\n                        <TabsTrigger \n                          value=\"list\" \n                          className=\"flex items-center justify-center gap-2 py-2 px-3 sm:py-1 sm:px-3 text-sm font-medium rounded border shadow-none data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-burnt-yellow data-[state=active]:border-burnt-yellow w-full\"\n                        >\n                          <List className=\"h-4 w-4\" />\n                          <span className=\"text-sm sm:text-xs\">Lista</span>\n                        </TabsTrigger>\n                        <TabsTrigger \n                          value=\"calendar\" \n                          className=\"flex items-center justify-center gap-2 py-2 px-3 sm:py-1 sm:px-3 text-sm font-medium rounded border shadow-none data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-burnt-yellow data-[state=active]:border-burnt-yellow w-full\"\n                        >\n                          <Calendar className=\"h-4 w-4\" />\n                          <span className=\"text-sm sm:text-xs\">Calend√°rio</span>\n                        </TabsTrigger>\n                      </TabsList>\n                    </Tabs>\n                  </div>\n                </div>\n                \n                {/* Clear Filters Button */}\n                <Button \n                  onClick={() => {\n                    console.log(\"üîç [FILTER] Limpando todos os filtros\");\n                    setSelectedDate(\"\");\n                    setSearchTerm(\"\");\n                    setSelectedService(\"all\");\n                    setSelectedTechnician(\"all\");\n                    setSelectedStatus(\"all\");\n                  }}\n                  variant=\"outline\"\n                  className=\"w-full sm:w-auto\"\n                  type=\"button\"\n                >\n                  Limpar Filtros\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Content Area - List or Calendar View */}\n      {viewMode === \"list\" ? (\n        /* List View */\n        filteredAppointments.length === 0 ? (\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-12\">\n              <Calendar className=\"h-12 w-12 text-gray-400 mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                {appointments.length === 0 ? \"Nenhum agendamento encontrado\" : \"Nenhum agendamento encontrado com os filtros aplicados\"}\n              </h3>\n              <p className=\"text-gray-600 text-center mb-6\">\n                {appointments.length === 0 \n                  ? \"Comece criando seu primeiro agendamento para organizar seus atendimentos t√©cnicos.\"\n                  : \"Tente ajustar os filtros ou limpar todos os filtros para ver mais agendamentos.\"\n                }\n              </p>\n              <Button \n                className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n                onClick={() => {\n                  setPrefilledData(null);\n                  setSelectedAppointment(null);\n                  setIsFormOpen(true);\n                }}\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Criar Primeiro Agendamento\n              </Button>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-4\">\n            {/* Selection Header */}\n            <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-lg border\">\n              <div className=\"flex items-center space-x-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"select-all\"\n                    checked={isAllSelected}\n                    ref={(el) => {\n                      if (el) el.indeterminate = isPartiallySelected;\n                    }}\n                    onChange={(e) => handleSelectAll(e.target.checked)}\n                    className=\"w-4 h-4 text-burnt-yellow bg-gray-100 border-gray-300 rounded focus:ring-burnt-yellow focus:ring-2\"\n                  />\n                  <label htmlFor=\"select-all\" className=\"text-sm font-medium text-gray-700\">\n                    Selecionar Todos\n                  </label>\n                </div>\n                {selectedAppointmentIds.length > 0 && (\n                  <span className=\"text-sm text-gray-600\">\n                    {selectedAppointmentIds.length} de {filteredAppointments.length} selecionados\n                  </span>\n                )}\n              </div>\n              \n              {selectedAppointmentIds.length > 1 && (\n                <div className=\"flex items-center gap-4\">\n                  <label className=\"flex items-center gap-2 text-[14px] font-medium text-[#B8860B]\">\n                    <input\n                      type=\"checkbox\"\n                      checked={endAtStart}\n                      onChange={(e) => setEndAtStart(e.target.checked)}\n                      className=\"h-4 w-4 rounded border-[#DAA520] text-[#DAA520] focus:ring-[#DAA520]\"\n                    />\n                    Terminar no ponto inicial\n                  </label>\n                  <Button\n                    onClick={handleOptimizeRoute}\n                    className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n                  >\n                    <Route className=\"h-4 w-4 mr-2\" />\n                    Otimizar Rotas\n                  </Button>\n                </div>\n              )}\n            </div>\n\n            {/* Appointments List */}\n            <div className=\"grid gap-4\">\n              {filteredAppointments.map((appointment: Appointment) => {\n                const client = getClient(appointment.clientId);\n                const service = getService(appointment.serviceId);\n                const responsible = getResponsibleInfo(appointment);\n                const { date, time } = formatDateTime(appointment.scheduledDate.toString());\n                const isSelected = selectedAppointmentIds.includes(appointment.id);\n\n                return (\n                  <Card key={appointment.id} className={`hover:shadow-md transition-shadow ${isSelected ? 'ring-2 ring-burnt-yellow' : ''}`}>\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex items-start space-x-3\">\n                          <input\n                            type=\"checkbox\"\n                            checked={isSelected}\n                            onChange={(e) => handleAppointmentSelection(appointment.id, e.target.checked)}\n                            className=\"w-4 h-4 text-burnt-yellow bg-gray-100 border-gray-300 rounded focus:ring-burnt-yellow focus:ring-2 mt-1\"\n                          />\n                          <div className=\"flex-1\">\n                        <div className=\"flex items-center space-x-3 mb-3\">\n                          <h3 className=\"text-lg font-semibold text-gray-900\">\n                            {client?.name || \"Cliente n√£o encontrado\"}\n                          </h3>\n                          <Badge className={getStatusColor(appointment.status)}>\n                            {getStatusText(appointment.status)}\n                          </Badge>\n                          <Badge className={getPriorityColor(appointment.priority)}>\n                            {getPriorityText(appointment.priority)}\n                          </Badge>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600\">\n                          <div className=\"flex items-center space-x-2\">\n                            <Calendar className=\"h-4 w-4\" />\n                            <span>{date} √†s {time}</span>\n                          </div>\n                          \n                          <div className=\"flex items-center space-x-2\">\n                            <User className=\"h-4 w-4\" />\n                            <span>{responsible.displayName}</span>\n                          </div>\n                          \n                          <div className=\"flex items-center space-x-2\">\n                            <MapPin className=\"h-4 w-4\" />\n                            <span>\n                              {client\n                                ? (\n                                    <>\n                                      {client.logradouro || \"Logradouro n√£o informado\"}\n                                      {client.numero ? `, ${client.numero}` : \"\"}\n                                      {client.complemento ? `, ${client.complemento}` : \"\"}\n                                      {client.bairro ? `, ${client.bairro}` : \"\"}\n                                      {client.cidade ? `, ${client.cidade}` : \"\"}\n                                      {client.cep ? ` - ${client.cep}` : \"\"}\n                                    </>\n                                  )\n                                : <span style={{ color: \"red\" }}>Cliente n√£o encontrado</span>\n                              }\n                            </span>\n                          </div>\n                          \n                          <div className=\"flex items-center space-x-2\">\n                            <Clock className=\"h-4 w-4\" />\n                            <span>{service?.name || \"Servi√ßo n√£o encontrado\"}</span>\n                          </div>\n                        </div>\n                        \n                        {appointment.notes && (\n                          <div className=\"mt-3 p-3 bg-gray-50 rounded-lg\">\n                            <p className=\"text-sm text-gray-700\">{appointment.notes}</p>\n                          </div>\n                        )}\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex space-x-2 ml-4\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleEdit(appointment)}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleDelete(appointment)}\n                            className=\"text-red-600 hover:text-red-700 hover:border-red-300\"\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n        )\n      ) : (\n        /* Calendar View */\n        <Card>\n          <CardContent className=\"p-6\">\n            {filteredAppointments.length === 0 ? (\n              <div className=\"flex flex-col items-center justify-center py-12\">\n                <Calendar className=\"h-12 w-12 text-gray-400 mb-4\" />\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                  {appointments.length === 0 ? \"Nenhum agendamento encontrado\" : \"Nenhum agendamento encontrado com os filtros aplicados\"}\n                </h3>\n                <p className=\"text-gray-600 text-center mb-6\">\n                  {appointments.length === 0 \n                    ? \"Comece criando seu primeiro agendamento para organizar seus atendimentos t√©cnicos.\"\n                    : \"Tente ajustar os filtros ou limpar todos os filtros para ver mais agendamentos.\"\n                  }\n                </p>\n                <Button \n                  className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n                  onClick={() => {\n                    setPrefilledData(null);\n                    setSelectedAppointment(null);\n                    setIsFormOpen(true);\n                  }}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Criar Primeiro Agendamento\n                </Button>\n              </div>\n            ) : (\n              <AppointmentCalendar\n                appointments={filteredAppointments}\n                clients={clients}\n                services={services}\n                technicians={technicians}\n                teams={teams}\n              />\n            )}\n          </CardContent>\n        </Card>\n      )}\n      \n      {/* Centralized Dialog for All Appointment Forms */}\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <AppointmentForm\n            appointment={selectedAppointment}\n            onClose={handleFormClose}\n            clients={clients}\n            services={services}\n            technicians={technicians}\n            teams={teams}\n            prefilledData={prefilledData}\n          />\n        </DialogContent>\n      </Dialog>\n\n      {/* Route Optimization Drawer */}\n      {isRouteDrawerOpen && (\n        <div className=\"fixed inset-0 z-50 overflow-hidden\">\n          <div className=\"absolute inset-0 overflow-hidden\">\n            <div className=\"absolute inset-0 bg-black bg-opacity-50\" onClick={() => { setIsRouteDrawerOpen(false); }} />\n            <section className=\"absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-xl\">\n              <div className=\"flex h-full flex-col\">\n                {/* Header */}\n                <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n                  <h2 className=\"text-lg font-semibold text-gray-900 flex items-center\">\n                    <Navigation className=\"h-5 w-5 mr-2 text-burnt-yellow\" />\n                    Rota Otimizada\n                  </h2>\n                  <button\n                    onClick={() => { setIsRouteDrawerOpen(false); }}\n                    className=\"text-gray-400 hover:text-gray-600\"\n                  >\n                    <X className=\"h-5 w-5\" />\n                  </button>\n                </div>\n\n                {/* Content */}\n                <div className=\"flex-1 overflow-y-auto p-6\">\n                  {isOptimizing && (\n                    <div className=\"p-4 text-sm text-gray-600 flex items-center justify-center\">\n                      <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-[#DAA520] mr-3\"></div>\n                      Otimizando rota, aguarde...\n                    </div>\n                  )}\n                  \n                  {optimizedRoute && !isOptimizing && (\n                    <div className=\"space-y-6\">\n                      {/* Summary */}\n                      <div className=\"bg-[#DAA520]/10 rounded-lg p-4\">\n                        <h3 className=\"font-semibold text-gray-900 mb-2\">Resumo da Rota</h3>\n                        <div className=\"space-y-2 text-sm\">\n                          <div className=\"flex justify-between\">\n                            <span>Paradas:</span>\n                            <span className=\"font-medium\">\n                              {optimizedRoute.route?.stopsCount ?? optimizedRoute.stops?.length ?? 0}\n                            </span>\n                          </div>\n                          <div className=\"flex justify-between\">\n                            <span>Dist√¢ncia Total:</span>\n                            <span className=\"font-medium text-blue-600\">\n                              {optimizedRoute.route?.distanceTotal ? \n                                `${(optimizedRoute.route.distanceTotal / 1000).toFixed(1)} km` : \n                                'N/A'\n                              }\n                            </span>\n                          </div>\n                          <div className=\"flex justify-between\">\n                            <span>Tempo Estimado:</span>\n                            <span className=\"font-medium text-green-600\">\n                              {optimizedRoute.route?.durationTotal ? \n                                `${Math.round(optimizedRoute.route.durationTotal / 60)} min` : \n                                'N/A'\n                              }\n                            </span>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Ordem Otimizada */}\n                      <div>\n                        <h3 className=\"font-semibold text-gray-900 mb-4\">Ordem Otimizada</h3>\n\n                        {/* In√≠cio da rota (endere√ßo da empresa) */}\n                        {optimizedRoute.start && (\n                          <div className=\"bg-gray-50 rounded-lg p-4 mb-3\">\n                            <div className=\"flex items-start space-x-3\">\n                              <div className=\"flex-shrink-0 w-6 h-6 bg-gray-400 text-white rounded-full flex items-center justify-center text-sm font-medium\">\n                                <span>‚Ä¢</span>\n                              </div>\n                              <div className=\"flex-1 min-w-0\">\n                                <h4 className=\"font-medium text-gray-900 truncate\">In√≠cio da rota</h4>\n                                <p className=\"text-sm text-gray-600 truncate\">\n                                  {optimizedRoute.start.address}\n                                </p>\n                              </div>\n                            </div>\n                          </div>\n                        )}\n\n                        <div className=\"space-y-3\">\n                          {optimizedRoute.stops?.map((stop: any, index: number) => {\n                            const dt = stop.scheduledDate ? new Date(stop.scheduledDate) : null;\n                            const date = dt ? dt.toLocaleDateString('pt-BR') : null;\n                            const time = dt ? dt.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }) : null;\n\n                            return (\n                              <div key={`${stop.appointmentId}-${index}`} className=\"bg-gray-50 rounded-lg p-4\">\n                                <div className=\"flex items-start space-x-3\">\n                                  <div className=\"flex-shrink-0 w-6 h-6 bg-burnt-yellow text-white rounded-full flex items-center justify-center text-sm font-medium\">\n                                    {index + 1}\n                                  </div>\n                                  <div className=\"flex-1 min-w-0\">\n                                    <h4 className=\"font-medium text-gray-900 truncate\">\n                                      {stop.clientName || \"Cliente\"}\n                                    </h4>\n                                    {stop.serviceName && (\n                                      <p className=\"text-sm text-gray-600 truncate\">{stop.serviceName}</p>\n                                    )}\n                                    {dt && (\n                                      <p className=\"text-sm text-gray-500\">{date} √†s {time}</p>\n                                    )}\n                                    <p className=\"text-sm text-gray-500 truncate\">{stop.address}</p>\n                                  </div>\n                                  <CheckCircle2 className=\"h-4 w-4 text-green-500 flex-shrink-0\" />\n                                </div>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      </div>\n\n                      {/* Action Buttons */}\n                      <div className=\"space-y-3\">\n                        {/* Bot√£o de salvar aparece apenas se √© preview (sem ID) */}\n                        {!optimizedRoute.route?.id && (\n                          <Button \n                            className=\"w-full bg-green-600 hover:bg-green-700 text-white\"\n                            onClick={handleSaveRoute}\n                          >\n                            Salvar Rota\n                          </Button>\n                        )}\n                        \n                        {/* Bot√µes padr√£o */}\n                        <Button className=\"w-full bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\">\n                          Iniciar Navega√ß√£o\n                        </Button>\n                        <Button variant=\"outline\" className=\"w-full\">\n                          Exportar Rota\n                        </Button>\n\n                        {/* Aviso de rota salva + bot√£o Ver no Hist√≥rico */}\n                        {savedInfo && (\n                          <div className=\"mt-3 flex items-center justify-between gap-2\">\n                            <div className=\"text-sm\">\n                              <span className=\"font-medium\">Rota salva com sucesso</span>\n                              <span className=\"ml-1\">ID #{savedInfo.displayNumber}</span>\n                            </div>\n                            <button\n                              type=\"button\"\n                              className=\"px-3 py-2 rounded-xl bg-[#DAA520] text-black hover:bg-[#B8860B] transition\"\n                              onClick={() => window.open(`/routes-history?open=${savedInfo.id}&id=${savedInfo.displayNumber}`, '_blank')}\n                            >\n                              Ver no Hist√≥rico\n                            </button>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </section>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":77025},"client/src/pages/BusinessRules.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/lib/auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Settings, Save, Clock, MapPin, Route } from \"lucide-react\";\nimport { insertBusinessRulesSchema, type BusinessRules, type InsertBusinessRules } from \"@shared/schema\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { buscarEnderecoPorCep } from \"@/lib/cep\";\n\nexport default function BusinessRules() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: businessRules, isLoading } = useQuery<BusinessRules>({\n    queryKey: ['/api/business-rules'],\n    enabled: !!user,\n  });\n\n  const form = useForm<InsertBusinessRules>({\n    resolver: zodResolver(insertBusinessRulesSchema),\n    defaultValues: {\n      maximoParadasPorRota: 10,\n      horarioInicioTrabalho: \"08:00\",\n      horarioFimTrabalho: \"18:00\",\n      tempoDeslocamentoBuffer: 15,\n      minutosEntreParadas: 30,\n      distanciaMaximaEntrePontos: \"50.00\",\n      enderecoEmpresaCep: \"\",\n      enderecoEmpresaLogradouro: \"\",\n      enderecoEmpresaNumero: \"\",\n      enderecoEmpresaComplemento: \"\",\n      enderecoEmpresaBairro: \"\",\n      enderecoEmpresaCidade: \"\",\n      enderecoEmpresaEstado: \"\",\n    },\n  });\n\n  // Reset form when data loads\n  useState(() => {\n    if (businessRules) {\n      form.reset({\n        maximoParadasPorRota: businessRules.maximoParadasPorRota,\n        horarioInicioTrabalho: businessRules.horarioInicioTrabalho,\n        horarioFimTrabalho: businessRules.horarioFimTrabalho,\n        tempoDeslocamentoBuffer: businessRules.tempoDeslocamentoBuffer,\n        minutosEntreParadas: businessRules.minutosEntreParadas,\n        distanciaMaximaEntrePontos: businessRules.distanciaMaximaEntrePontos,\n        enderecoEmpresaCep: businessRules.enderecoEmpresaCep,\n        enderecoEmpresaLogradouro: businessRules.enderecoEmpresaLogradouro,\n        enderecoEmpresaNumero: businessRules.enderecoEmpresaNumero,\n        enderecoEmpresaComplemento: businessRules.enderecoEmpresaComplemento || \"\",\n        enderecoEmpresaBairro: businessRules.enderecoEmpresaBairro,\n        enderecoEmpresaCidade: businessRules.enderecoEmpresaCidade,\n        enderecoEmpresaEstado: businessRules.enderecoEmpresaEstado,\n      });\n    }\n  });\n\n  const createOrUpdateMutation = useMutation({\n    mutationFn: async (data: InsertBusinessRules) => {\n      const url = businessRules?.id ? `/api/business-rules/${businessRules.id}` : \"/api/business-rules\";\n      const method = businessRules?.id ? \"PATCH\" : \"POST\";\n      \n      const response = await fetch(url, {\n        method,\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...(localStorage.getItem(\"token\") && {\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n          }),\n        },\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Erro ao salvar regras de neg√≥cio\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/business-rules'] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Regras de neg√≥cio salvas com sucesso.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao salvar regras de neg√≥cio.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertBusinessRules) => {\n    createOrUpdateMutation.mutate(data);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-96\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-burnt-yellow\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center gap-3\">\n        <div className=\"p-2 bg-burnt-yellow rounded-lg\">\n          <Settings className=\"h-6 w-6 text-white\" />\n        </div>\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Regras de Neg√≥cio</h1>\n          <p className=\"text-gray-600\">Configure as regras operacionais do seu neg√≥cio</p>\n        </div>\n      </div>\n\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          <div className=\"grid gap-6 md:grid-cols-2\">\n            {/* Configura√ß√µes de Rota */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Route className=\"h-5 w-5\" />\n                  Configura√ß√µes de Rota\n                </CardTitle>\n                <CardDescription>\n                  Defina os par√¢metros para otimiza√ß√£o de rotas\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"maximoParadasPorRota\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>M√°ximo de paradas por rota</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min=\"1\"\n                          max=\"50\"\n                          {...field}\n                          onChange={(e) => field.onChange(parseInt(e.target.value))}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"minutosEntreParadas\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Minutos entre paradas</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min=\"5\"\n                          max=\"120\"\n                          {...field}\n                          onChange={(e) => field.onChange(parseInt(e.target.value))}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"distanciaMaximaEntrePontos\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Dist√¢ncia m√°xima entre pontos (km)</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          step=\"0.01\"\n                          min=\"1\"\n                          max=\"200\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"tempoDeslocamentoBuffer\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Tempo de deslocamento (buffer em minutos)</FormLabel>\n                      <FormControl>\n                        <Input\n                          type=\"number\"\n                          min=\"5\"\n                          max=\"60\"\n                          {...field}\n                          onChange={(e) => field.onChange(parseInt(e.target.value))}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </CardContent>\n            </Card>\n\n            {/* Hor√°rio de Trabalho */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Clock className=\"h-5 w-5\" />\n                  Hor√°rio de Trabalho\n                </CardTitle>\n                <CardDescription>\n                  Configure os hor√°rios de funcionamento\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"horarioInicioTrabalho\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Hor√°rio de in√≠cio</FormLabel>\n                      <FormControl>\n                        <Input type=\"time\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"horarioFimTrabalho\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Hor√°rio de fim</FormLabel>\n                      <FormControl>\n                        <Input type=\"time\" {...field} />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Endere√ßo da Empresa */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <MapPin className=\"h-5 w-5\" />\n                Endere√ßo da Empresa\n              </CardTitle>\n              <CardDescription>\n                Endere√ßo base para c√°lculo de rotas\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"grid gap-4 md:grid-cols-2\">\n                <FormField\n                  control={form.control}\n                  name=\"enderecoEmpresaCep\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>CEP *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"00000-000\"\n                          maxLength={9}\n                          {...field}\n                          onChange={async (e) => {\n                            let value = e.target.value.replace(/\\D/g, '');\n                            if (value.length > 5) {\n                              value = value.slice(0, 5) + '-' + value.slice(5, 8);\n                            }\n                            field.onChange(value);\n\n                            // Busca autom√°tica de endere√ßo quando CEP tem 8 d√≠gitos\n                            if (value.replace(/\\D/g, '').length === 8) {\n                              try {\n                                const endereco = await buscarEnderecoPorCep(value);\n\n                                // Preenche os campos automaticamente\n                                form.setValue(\"enderecoEmpresaLogradouro\", endereco.logradouro || \"\");\n                                form.setValue(\"enderecoEmpresaBairro\", endereco.bairro || \"\");\n                                form.setValue(\"enderecoEmpresaCidade\", endereco.localidade || \"\");\n                                form.setValue(\"enderecoEmpresaEstado\", endereco.uf || \"\");\n\n                              } catch (err) {\n                                toast({\n                                  title: \"CEP n√£o encontrado\",\n                                  description: \"Preencha o endere√ßo manualmente.\",\n                                  variant: \"destructive\",\n                                });\n                                form.setValue(\"enderecoEmpresaLogradouro\", \"\");\n                                form.setValue(\"enderecoEmpresaBairro\", \"\");\n                                form.setValue(\"enderecoEmpresaCidade\", \"\");\n                                form.setValue(\"enderecoEmpresaEstado\", \"\");\n                              }\n                            }\n                          }}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"enderecoEmpresaNumero\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>N√∫mero *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"123\"\n                          {...field}\n                          onChange={(e) => {\n                            const value = e.target.value.replace(/\\D/g, '');\n                            field.onChange(value);\n                          }}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"enderecoEmpresaLogradouro\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Logradouro *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Rua das Flores\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"enderecoEmpresaBairro\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Bairro *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Centro\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"enderecoEmpresaCidade\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Cidade *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"S√£o Paulo\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"enderecoEmpresaEstado\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Estado (UF) *</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"SP\"\n                          maxLength={2}\n                          {...field}\n                          onChange={(e) => {\n                            field.onChange(e.target.value.toUpperCase());\n                          }}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"enderecoEmpresaComplemento\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Complemento</FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Sala 101\"\n                          {...field}\n                          value={field.value || \"\"}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          <div className=\"flex justify-end\">\n            <Button\n              type=\"submit\"\n              disabled={createOrUpdateMutation.isPending}\n              className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n            >\n              {createOrUpdateMutation.isPending ? (\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />\n              ) : (\n                <Save className=\"h-4 w-4 mr-2\" />\n              )}\n              Salvar Regras\n            </Button>\n          </div>\n        </form>\n      </Form>\n    </div>\n  );\n}","size_bytes":17360},"client/src/pages/Clients.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getAuthHeaders } from \"@/lib/auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport ClientForm from \"@/components/forms/ClientForm\";\nimport { Plus, Users, Mail, Phone, MapPin, Edit, Trash2, Upload, Download } from \"lucide-react\";\nimport { downloadCSV, downloadReport, downloadWithConfirmation } from \"@/lib/download\";\nimport { useSafeNavigation } from \"@/hooks/useSafeNavigation\";\nimport type { Client, InsertClient } from \"@shared/schema\";\n\nexport default function Clients() {\n  const [selectedClient, setSelectedClient] = useState<Client | null>(null);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Hook de navega√ß√£o segura\n  const { isSafeToOperate } = useSafeNavigation({\n    componentName: 'CLIENTS',\n    modals: [\n      {\n        isOpen: isFormOpen,\n        setIsOpen: setIsFormOpen,\n        resetState: () => setSelectedClient(null)\n      }\n    ]\n  });\n\n  const { data: clients = [], isLoading } = useQuery({\n    queryKey: [\"/api/clients\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/clients\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const deleteClientMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/clients/${id}`, undefined);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Cliente exclu√≠do com sucesso\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao excluir cliente\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const importClientsMutation = useMutation({\n    mutationFn: async (clients: any[]) => {\n      const response = await apiRequest(\"POST\", \"/api/clients/import\", { clients });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      if (data.errors > 0) {\n        const errorMessage = data.detailedErrors\n          ? data.detailedErrors.slice(0, 2).join('\\n') +\n            (data.detailedErrors.length > 2\n              ? `\\n... e mais ${data.detailedErrors.length - 2} erros`\n              : '')\n          : `${data.errors} erros encontrados`;\n\n        toast({\n          title: `Importa√ß√£o parcial: ${data.success} sucessos, ${data.errors} erros`,\n          description: errorMessage,\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Sucesso\",\n          description: `${data.success} clientes importados com sucesso!`,\n        });\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao importar clientes\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleImportCSV = () => {\n    const input = document.createElement('input');\n    input.type = 'file';\n    input.accept = '.csv';\n    input.onchange = (e) => {\n      const file = (e.target as HTMLInputElement).files?.[0];\n      if (file) {\n        const reader = new FileReader();\n        reader.onload = (event) => {\n          try {\n            const csv = event.target?.result as string;\n            const lines = csv.split('\\n').filter(line => line.trim());\n\n            if (lines.length < 2) {\n              toast({\n                title: \"Erro\",\n                description: \"Arquivo CSV deve conter pelo menos uma linha de dados\",\n                variant: \"destructive\",\n              });\n              return;\n            }\n\n            const headers = lines[0].split(',').map(h => h.replace(/\"/g, '').trim());\n            const clientsToImport = [];\n            const errors = [];\n\n            for (let i = 1; i < lines.length; i++) {\n              const values = lines[i].split(',').map(v => v.replace(/\"/g, '').trim());\n              if (values.length < headers.length) continue;\n\n              const nome = values[0];\n              const cpf = values[1];\n              const email = values[2];\n              const telefone1 = values[3];\n              const cep = values[4];\n              const bairro = values[5];\n              const cidade = values[6];\n              const logradouro = values[7];\n              const numero = values[8];\n\n              // Validar campos obrigat√≥rios\n              const validationErrors = [];\n              if (!nome) validationErrors.push(\"Nome (coluna 1) est√° vazio\");\n              if (!cpf) validationErrors.push(\"CPF (coluna 2) est√° vazio\");\n              if (!telefone1) validationErrors.push(\"Telefone 1 (coluna 4) est√° vazio\");\n              if (!cep) validationErrors.push(\"CEP (coluna 5) est√° vazio\");\n              if (!bairro) validationErrors.push(\"Bairro (coluna 6) est√° vazio\");\n              if (!cidade) validationErrors.push(\"Cidade (coluna 7) est√° vazio\");\n              if (!logradouro) validationErrors.push(\"Logradouro (coluna 8) est√° vazio\");\n              if (!numero) validationErrors.push(\"N√∫mero (coluna 9) est√° vazio\");\n              // Validar formato do CEP\n              if (cep && !/^\\d{5}-?\\d{3}$/.test(cep)) {\n                validationErrors.push(`CEP \"${cep}\" inv√°lido (formato esperado: XXXXX-XXX)`);\n              }\n              // Validar se o n√∫mero √© num√©rico\n              if (numero && isNaN(Number(numero))) {\n                validationErrors.push(`N√∫mero \"${numero}\" deve ser num√©rico`);\n              }\n              if (validationErrors.length > 0) {\n                errors.push(`Linha ${i + 1}: ${validationErrors.join(\"; \")}`);\n                continue;\n              }\n\n              clientsToImport.push({\n                name: nome,\n                cpf: cpf,\n                email: email || \"\",\n                phone1: telefone1,\n                cep: cep,\n                bairro: bairro || \"\",\n                cidade: cidade || \"\",\n                logradouro: logradouro,\n                numero: numero,\n                phone2: values[9] || \"\",\n                complemento: values[10] || \"\",\n                observacoes: values[11] || \"\",\n              });\n            } // <-- FECHA O FOR AQUI\n\n            if (errors.length > 0) {\n              const errorReport = [\n                \"RELAT√ìRIO DE ERROS - IMPORTA√á√ÉO DE CLIENTES\",\n                \"=\" + \"=\".repeat(50),\n                \"\",\n                `Data/Hora: ${new Date().toLocaleString('pt-BR')}`,\n                `Arquivo: ${file.name}`,\n                \"\",\n                \"RESUMO:\",\n                \"-\".repeat(20),\n                `Total de linhas processadas: ${lines.length - 1}`,\n                `Clientes v√°lidos: ${clientsToImport.length}`,\n                `Erros encontrados: ${errors.length}`,\n                `Taxa de sucesso: ${((clientsToImport.length / (lines.length - 1)) * 100).toFixed(1)}%`,\n                \"\",\n                \"CAMPOS OBRIGAT√ìRIOS:\",\n                \"-\".repeat(30),\n                \"‚Ä¢ Nome (coluna 1)\",\n                \"‚Ä¢ CPF (coluna 2)\",\n                \"‚Ä¢ Telefone 1 (coluna 4)\", \n                \"‚Ä¢ CEP (coluna 5)\",\n                \"‚Ä¢ Bairro (coluna 6)\",\n                \"‚Ä¢ Cidade (coluna 7)\",\n                \"‚Ä¢ Logradouro (coluna 8)\",\n                \"‚Ä¢ N√∫mero (coluna 9)\",\n                \"\",\n                \"ERROS ENCONTRADOS:\",\n                \"-\".repeat(30),\n                ...errors,\n                \"\",\n                \"OBSERVA√á√ÉO: Use o bot√£o 'Baixar CSV Modelo' para obter um arquivo com a estrutura correta.\"\n              ].join('\\n');\n\n              // Download seguro do relat√≥rio de erros\n              const filename = `relatorio_erros_clientes_${new Date().toISOString().split('T')[0]}_${new Date().toTimeString().split(' ')[0].replace(/:/g, '')}.txt`;\n              \n              setTimeout(() => {\n                downloadWithConfirmation(\n                  errorReport,\n                  filename,\n                  \"Deseja baixar um relat√≥rio detalhado dos erros encontrados?\"\n                );\n              }, 1000);\n            }\n\n            if (clientsToImport.length > 0) {\n              importClientsMutation.mutate(clientsToImport);\n            } else {\n              toast({\n                title: \"Erro\",\n                description: \"Nenhum cliente v√°lido encontrado no arquivo\",\n                variant: \"destructive\",\n              });\n            }\n          } catch (error) {\n            toast({\n              title: \"Erro\",\n              description: \"Erro ao processar arquivo CSV\",\n              variant: \"destructive\",\n            });\n          }\n        };\n        reader.readAsText(file);\n      }\n    };\n    input.click();\n  };\n\n  const downloadCSVTemplate = () => {\n    const headers = [\n      \"Nome\",\n      \"CPF\",\n      \"Email\",\n      \"Telefone 1\",\n      \"CEP\",\n      \"Bairro\",\n      \"Cidade\",\n      \"Logradouro\",\n      \"N√∫mero\",\n      \"Telefone 2\",\n      \"Complemento\",\n      \"Observa√ß√µes\"\n    ];\n\n    const exampleRow = [\n      \"Jo√£o Silva\",\n      \"123.456.789-01\",\n      \"joao@email.com\",\n      \"(11) 99999-9999\",\n      \"01234-567\",\n      \"Port√£o\",\n      \"Curitiba\",\n      \"Rua das Flores\",\n      \"123\",\n      \"(11) 88888-8888\",\n      \"Apto 45\",\n      \"Cliente preferencial\"\n    ];\n\n    const csvContent = [headers, exampleRow]\n      .map(row => row.map(field => `\"${field}\"`).join(\",\"))\n      .join(\"\\n\");\n\n    // Download seguro do modelo CSV\n    downloadCSV(csvContent, \"modelo_importacao_clientes.csv\");\n\n    toast({\n      title: \"Modelo baixado\",\n      description: \"Use este arquivo como base para importar seus clientes\",\n    });\n  };\n\n  const exportToCSV = () => {\n    if (clients.length === 0) {\n      toast({\n        title: \"Aviso\",\n        description: \"N√£o h√° clientes para exportar\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const csvHeaders = [\n      \"Nome\",\n      \"CPF\",\n      \"Email\",\n      \"Telefone 1\",\n      \"CEP\",\n      \"Bairro\",\n      \"Cidade\",\n      \"Logradouro\",\n      \"N√∫mero\",\n      \"Telefone 2\",\n      \"Complemento\",\n      \"Observa√ß√µes\"\n    ];\n\n    const csvData = clients.map((client: Client) => [\n      client.name,\n      client.cpf,\n      client.email || \"\",\n      client.phone1,\n      client.cep,\n      client.bairro || \"\",\n      client.cidade || \"\",\n      client.logradouro,\n      client.numero,\n      client.phone2 || \"\",\n      client.complemento || \"\",\n      client.observacoes || \"\"\n    ]);\n\n    const csvContent = [csvHeaders, ...csvData]\n      .map((row: any[]) => row.map((field: any) => `\"${field}\"`).join(\",\"))\n      .join(\"\\n\");\n\n    // Download seguro da exporta√ß√£o CSV\n    const filename = `clientes_${new Date().toISOString().split('T')[0]}.csv`;\n    downloadCSV(csvContent, filename);\n\n    toast({\n      title: \"Exporta√ß√£o conclu√≠da\",\n      description: `${clients.length} clientes exportados com sucesso`,\n    });\n  };\n\n  const handleEdit = (client: Client) => {\n    setSelectedClient(client);\n    setIsFormOpen(true);\n  };\n\n  const handleDelete = async (client: Client) => {\n    if (confirm(`Tem certeza que deseja excluir o cliente \"${client.name}\"?`)) {\n      deleteClientMutation.mutate(client.id);\n    }\n  };\n\n  const handleFormClose = () => {\n    // Usa hook seguro para verificar se √© seguro operar\n    if (!isSafeToOperate()) {\n      console.log('‚ö†Ô∏è [CLIENTS] Componente desmontado, opera√ß√£o cancelada');\n      return;\n    }\n    \n    console.log(\"Dialog de cliente fechado - resetando cliente selecionado!\");\n    setIsFormOpen(false);\n    setSelectedClient(null);\n  };\n\n  const handleDialogOpenChange = (open: boolean) => {\n    if (!open) {\n      console.log(\"Resetando formul√°rio ao fechar Dialog por fora\");\n      setSelectedClient(null);\n    }\n    setIsFormOpen(open);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-burnt-yellow\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Clientes</h1>\n          <p className=\"text-gray-600\">Gerencie sua base de clientes</p>\n        </div>\n        \n        <div className=\"flex gap-2\">\n          <Button\n            variant=\"outline\"\n            onClick={downloadCSVTemplate}\n            disabled={importClientsMutation.isPending}\n          >\n            <Download className=\"h-4 w-4 mr-2\" />\n            Baixar CSV Modelo\n          </Button>\n          \n          <Button\n            variant=\"outline\"\n            onClick={handleImportCSV}\n            disabled={importClientsMutation.isPending}\n          >\n            <Upload className=\"h-4 w-4 mr-2\" />\n            Importar CSV\n          </Button>\n          \n          <Button\n            variant=\"outline\"\n            onClick={exportToCSV}\n            disabled={clients.length === 0}\n          >\n            <Download className=\"h-4 w-4 mr-2\" />\n            Exportar CSV\n          </Button>\n          \n          <Button \n            className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n            onClick={() => {\n              setSelectedClient(null);\n              setIsFormOpen(true);\n            }}\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Novo Cliente\n          </Button>\n        </div>\n      </div>\n\n      {/* Clients List */}\n      {clients.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Users className=\"h-12 w-12 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Nenhum cliente cadastrado</h3>\n            <p className=\"text-gray-600 text-center mb-6\">\n              Comece adicionando seus primeiros clientes para organizar seus atendimentos.\n            </p>\n            <Button \n              className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n              onClick={() => {\n                setSelectedClient(null);\n                setIsFormOpen(true);\n              }}\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Adicionar Primeiro Cliente\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {clients.map((client: Client) => (\n            <Card key={client.id} className=\"hover:shadow-md transition-shadow\">\n              <CardHeader className=\"border-b border-gray-100\">\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-lg\">{client.name}</CardTitle>\n                  <div className=\"flex space-x-1\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => handleEdit(client)}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => handleDelete(client)}\n                      className=\"text-red-600 hover:text-red-700\"\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"p-6\">\n                <div className=\"space-y-3\">\n                  {client.email && (\n                    <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                      <Mail className=\"h-4 w-4\" />\n                      <span>{client.email}</span>\n                    </div>\n                  )}\n                  \n                  {client.phone1 && (\n                    <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                      <Phone className=\"h-4 w-4\" />\n                      <span>{client.phone1}</span>\n                    </div>\n                  )}\n                  \n                  {client.phone2 && (\n                    <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                      <Phone className=\"h-4 w-4\" />\n                      <span>{client.phone2}</span>\n                    </div>\n                  )}\n                  \n                  <div className=\"flex items-start space-x-2 text-sm text-gray-600\">\n                    <MapPin className=\"h-4 w-4 mt-0.5 flex-shrink-0\" />\n                    <span className=\"leading-relaxed\">\n                      {client.logradouro}, {client.numero}\n                      {client.complemento && `, ${client.complemento}`}\n                      <br />\n                      CEP: {client.cep}\n                    </span>\n                  </div>\n                </div>\n                \n                <div className=\"mt-4 pt-4 border-t border-gray-100\">\n                  <p className=\"text-xs text-gray-500\">\n                    Cadastrado em {new Date(client.createdAt).toLocaleDateString('pt-BR')}\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n      \n      {/* Centralized Dialog for All Client Forms */}\n      <Dialog open={isFormOpen} onOpenChange={handleDialogOpenChange}>\n        <DialogContent>\n          <ClientForm\n            client={selectedClient}\n            onClose={handleFormClose}\n          />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":18058},"client/src/pages/Dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { getAuthHeaders } from \"@/lib/auth\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Calendar, \n  Users, \n  CheckCircle, \n  DollarSign,\n  Plus,\n  Route,\n  UserPlus,\n  BarChart3,\n  MapPin,\n  Clock,\n  TrendingUp\n} from \"lucide-react\";\n\ninterface DashboardStats {\n  todayAppointments: number;\n  activeTechnicians: number;\n  completionRate: number;\n  monthRevenue: number;\n}\n\ninterface TodayAppointment {\n  id: number;\n  time: string;\n  client: string;\n  service: string;\n  address: string;\n  status: string;\n  technician: string;\n}\n\nexport default function Dashboard() {\n  const [, setLocation] = useLocation();\n  \n  const { data: appointments = [] } = useQuery({\n    queryKey: [\"/api/appointments\"],\n  });\n\n  const { data: clients = [] } = useQuery({\n    queryKey: [\"/api/clients\"],\n  });\n\n  const { data: technicians = [] } = useQuery({\n    queryKey: [\"/api/technicians\"],\n  });\n\n  // Calculate stats\n  const today = new Date().toDateString();\n  const todayAppointments = appointments.filter((apt: any) => \n    new Date(apt.scheduledDate).toDateString() === today\n  );\n  \n  const activeTechnicians = technicians.filter((tech: any) => tech.isActive);\n  const completedAppointments = appointments.filter((apt: any) => apt.status === \"completed\");\n  const completionRate = appointments.length > 0 \n    ? Math.round((completedAppointments.length / appointments.length) * 100)\n    : 0;\n\n  const stats: DashboardStats = {\n    todayAppointments: todayAppointments.length,\n    activeTechnicians: activeTechnicians.length,\n    completionRate,\n    monthRevenue: 24500, // This would come from a real calculation\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"bg-green-100 text-green-800\";\n      case \"in_progress\":\n        return \"bg-yellow-100 text-yellow-800\";\n      case \"scheduled\":\n        return \"bg-blue-100 text-blue-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  const getStatusText = (status: string) => {\n    switch (status) {\n      case \"completed\":\n        return \"Conclu√≠do\";\n      case \"in_progress\":\n        return \"Em Andamento\";\n      case \"scheduled\":\n        return \"Agendado\";\n      default:\n        return status;\n    }\n  };\n\n  const formatTime = (dateString: string) => {\n    return new Date(dateString).toLocaleTimeString('pt-BR', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Stats Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">Agendamentos Hoje</p>\n                <p className=\"text-3xl font-bold text-gray-900\">{stats.todayAppointments}</p>\n              </div>\n              <div className=\"w-12 h-12 bg-burnt-yellow bg-opacity-10 rounded-lg flex items-center justify-center\">\n                <Calendar className=\"text-burnt-yellow h-6 w-6\" />\n              </div>\n            </div>\n            <div className=\"mt-4 flex items-center\">\n              <TrendingUp className=\"h-4 w-4 text-green-600\" />\n              <span className=\"text-green-600 text-sm font-medium ml-1\">+8%</span>\n              <span className=\"text-gray-600 text-sm ml-2\">vs. ontem</span>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">T√©cnicos Ativos</p>\n                <p className=\"text-3xl font-bold text-gray-900\">{stats.activeTechnicians}</p>\n              </div>\n              <div className=\"w-12 h-12 bg-blue-50 rounded-lg flex items-center justify-center\">\n                <Users className=\"text-blue-600 h-6 w-6\" />\n              </div>\n            </div>\n            <div className=\"mt-4 flex items-center\">\n              <span className=\"text-gray-600 text-sm\">\n                {activeTechnicians.filter((t: any) => \n                  todayAppointments.some((a: any) => a.technicianId === t.id)\n                ).length} em campo agora\n              </span>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">Taxa de Conclus√£o</p>\n                <p className=\"text-3xl font-bold text-gray-900\">{stats.completionRate}%</p>\n              </div>\n              <div className=\"w-12 h-12 bg-green-50 rounded-lg flex items-center justify-center\">\n                <CheckCircle className=\"text-green-600 h-6 w-6\" />\n              </div>\n            </div>\n            <div className=\"mt-4 flex items-center\">\n              <TrendingUp className=\"h-4 w-4 text-green-600\" />\n              <span className=\"text-green-600 text-sm font-medium ml-1\">+5%</span>\n              <span className=\"text-gray-600 text-sm ml-2\">este m√™s</span>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600\">Receita do M√™s</p>\n                <p className=\"text-3xl font-bold text-gray-900\">R$ {stats.monthRevenue.toLocaleString()}</p>\n              </div>\n              <div className=\"w-12 h-12 bg-purple-50 rounded-lg flex items-center justify-center\">\n                <DollarSign className=\"text-purple-600 h-6 w-6\" />\n              </div>\n            </div>\n            <div className=\"mt-4 flex items-center\">\n              <TrendingUp className=\"h-4 w-4 text-green-600\" />\n              <span className=\"text-green-600 text-sm font-medium ml-1\">+12%</span>\n              <span className=\"text-gray-600 text-sm ml-2\">vs. m√™s passado</span>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Today's Schedule */}\n        <Card>\n          <CardHeader className=\"border-b border-gray-100\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle>Agenda de Hoje</CardTitle>\n              <Button variant=\"link\" className=\"text-burnt-yellow hover:text-burnt-yellow-dark\">\n                Ver todos\n              </Button>\n            </div>\n          </CardHeader>\n          <CardContent className=\"p-6\">\n            {todayAppointments.length === 0 ? (\n              <div className=\"text-center py-8\">\n                <Calendar className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <p className=\"text-gray-600\">Nenhum agendamento para hoje</p>\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                {todayAppointments.slice(0, 3).map((appointment: any) => {\n                  const client = clients.find((c: any) => c.id === appointment.clientId);\n                  const technician = technicians.find((t: any) => t.id === appointment.technicianId);\n                  \n                  return (\n                    <div key={appointment.id} className=\"flex items-center space-x-4 p-4 bg-gray-50 rounded-lg\">\n                      <div className=\"w-12 h-12 bg-burnt-yellow rounded-lg flex items-center justify-center\">\n                        <span className=\"text-white font-semibold text-sm\">\n                          {formatTime(appointment.scheduledDate)}\n                        </span>\n                      </div>\n                      <div className=\"flex-1\">\n                        <h4 className=\"font-medium text-gray-900\">{client?.name || \"Cliente\"}</h4>\n                        <p className=\"text-sm text-gray-600\">{appointment.notes || \"Servi√ßo\"}</p>\n                        <p className=\"text-xs text-gray-500\">{appointment.address}</p>\n                      </div>\n                      <div className=\"text-right\">\n                        <Badge className={getStatusColor(appointment.status)}>\n                          {getStatusText(appointment.status)}\n                        </Badge>\n                        <p className=\"text-xs text-gray-500 mt-1\">{technician?.name || \"T√©cnico\"}</p>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Quick Actions */}\n        <Card>\n          <CardHeader className=\"border-b border-gray-100\">\n            <CardTitle>A√ß√µes R√°pidas</CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-6\">\n            <div className=\"grid grid-cols-1 gap-4\">\n              <Button\n                variant=\"outline\"\n                className=\"flex items-center justify-start p-4 h-auto border-gray-200 hover:bg-gray-50\"\n                onClick={() => setLocation(\"/appointments\")}\n              >\n                <div className=\"w-10 h-10 bg-burnt-yellow rounded-lg flex items-center justify-center mr-4\">\n                  <Plus className=\"text-white h-5 w-5\" />\n                </div>\n                <div className=\"text-left\">\n                  <h4 className=\"font-medium text-gray-900\">Novo Agendamento</h4>\n                  <p className=\"text-sm text-gray-600\">Criar um novo atendimento</p>\n                </div>\n              </Button>\n              \n              <Button\n                variant=\"outline\"\n                className=\"flex items-center justify-start p-4 h-auto border-gray-200 hover:bg-gray-50\"\n                onClick={() => setLocation(\"/routes\")}\n              >\n                <div className=\"w-10 h-10 bg-blue-500 rounded-lg flex items-center justify-center mr-4\">\n                  <Route className=\"text-white h-5 w-5\" />\n                </div>\n                <div className=\"text-left\">\n                  <h4 className=\"font-medium text-gray-900\">Otimizar Rota</h4>\n                  <p className=\"text-sm text-gray-600\">Gerar rota para hoje</p>\n                </div>\n              </Button>\n              \n              <Button\n                variant=\"outline\"\n                className=\"flex items-center justify-start p-4 h-auto border-gray-200 hover:bg-gray-50\"\n                onClick={() => setLocation(\"/clients\")}\n              >\n                <div className=\"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center mr-4\">\n                  <UserPlus className=\"text-white h-5 w-5\" />\n                </div>\n                <div className=\"text-left\">\n                  <h4 className=\"font-medium text-gray-900\">Novo Cliente</h4>\n                  <p className=\"text-sm text-gray-600\">Cadastrar cliente</p>\n                </div>\n              </Button>\n              \n              <Button\n                variant=\"outline\"\n                className=\"flex items-center justify-start p-4 h-auto border-gray-200 hover:bg-gray-50\"\n                onClick={() => setLocation(\"/business-rules\")}\n              >\n                <div className=\"w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center mr-4\">\n                  <BarChart3 className=\"text-white h-5 w-5\" />\n                </div>\n                <div className=\"text-left\">\n                  <h4 className=\"font-medium text-gray-900\">Configura√ß√µes</h4>\n                  <p className=\"text-sm text-gray-600\">Regras de neg√≥cio</p>\n                </div>\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Recent Activity */}\n      <Card>\n        <CardHeader className=\"border-b border-gray-100\">\n          <CardTitle>Atividade Recente</CardTitle>\n        </CardHeader>\n        <CardContent className=\"p-6\">\n          {appointments.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <Clock className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <p className=\"text-gray-600\">Nenhuma atividade recente</p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {appointments.slice(0, 4).map((activity: any) => {\n                const client = clients.find((c: any) => c.id === activity.clientId);\n                const technician = technicians.find((t: any) => t.id === activity.technicianId);\n                \n                return (\n                  <div key={activity.id} className=\"flex items-start space-x-4\">\n                    <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                      <CheckCircle className=\"text-green-600 h-4 w-4\" />\n                    </div>\n                    <div className=\"flex-1\">\n                      <p className=\"text-sm text-gray-900\">\n                        <span className=\"font-medium\">{technician?.name || \"T√©cnico\"}</span>{\" \"}\n                        {activity.status === \"completed\" ? \"concluiu\" : \"criou\"} o atendimento na{\" \"}\n                        <span className=\"font-medium\">{client?.name || \"Cliente\"}</span>\n                      </p>\n                      <p className=\"text-xs text-gray-500\">\n                        {new Date(activity.createdAt).toLocaleDateString('pt-BR')}\n                      </p>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":13896},"client/src/pages/FindDate.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Search, Calendar } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Service, Technician, BusinessRules, Client, Team } from \"@shared/schema\";\nimport { useLocation } from \"wouter\";\nimport { ClientSearch } from \"@/components/ui/client-search\";\n\n// Schema para valida√ß√£o do formul√°rio de busca\nconst findDateSchema = z.object({\n  clientId: z.number().optional(),\n  cep: z.string().regex(/^\\d{5}-?\\d{3}$/, \"CEP deve estar no formato XXXXX-XXX\"),\n  numero: z.string().min(1, \"N√∫mero √© obrigat√≥rio\").regex(/^\\d+$/, \"Digite apenas n√∫meros\"),\n  serviceId: z.number({ required_error: \"Selecione um servi√ßo\" }),\n  technicianId: z.number().optional(),\n  teamId: z.number().optional(),\n});\n\ntype FindDateFormData = z.infer<typeof findDateSchema>;\n\ninterface AvailableDate {\n  date: string;\n  technician: string;\n  technicianId?: number;\n  teamId?: number;\n  routeIncrease: number;\n  totalDistance: number;\n}\n\nexport default function FindDate() {\n  const [, setLocation] = useLocation();\n  const [searchResults, setSearchResults] = useState<AvailableDate[]>([]);\n  const [isSearching, setIsSearching] = useState(false);\n\n  // Buscar clientes\n  const { data: clients = [] } = useQuery<Client[]>({\n    queryKey: [\"/api/clients\"],\n  });\n\n  // Buscar servi√ßos\n  const { data: services = [] } = useQuery<Service[]>({\n    queryKey: [\"/api/services\"],\n  });\n\n  // Buscar t√©cnicos\n  const { data: technicians = [] } = useQuery<Technician[]>({\n    queryKey: [\"/api/technicians\"],\n  });\n\n  // Buscar equipes\n  const { data: teams = [] } = useQuery<Team[]>({\n    queryKey: [\"/api/teams\"],\n  });\n\n  // Buscar regras de neg√≥cio\n  const { data: businessRules } = useQuery<BusinessRules>({\n    queryKey: [\"/api/business-rules\"],\n  });\n\n  const form = useForm<FindDateFormData>({\n    resolver: zodResolver(findDateSchema),\n    defaultValues: {\n      clientId: undefined,\n      cep: \"\",\n      numero: \"\",\n      technicianId: undefined,\n      teamId: undefined,\n    },\n  });\n\n  // Fun√ß√£o para formatar CEP automaticamente\n  const formatCep = (value: string) => {\n    const digits = value.replace(/\\D/g, \"\");\n    if (digits.length <= 5) {\n      return digits;\n    }\n    return digits.replace(/(\\d{5})(\\d{1,3})/, \"$1-$2\");\n  };\n\n  const handleCepChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const formatted = formatCep(e.target.value);\n    form.setValue(\"cep\", formatted);\n  };\n\n  const handleNumeroChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const numbersOnly = e.target.value.replace(/\\D/g, \"\");\n    form.setValue(\"numero\", numbersOnly);\n  };\n\n  // Fun√ß√£o para lidar com sele√ß√£o de cliente\n  const handleClientChange = (clientId: number | undefined) => {\n    console.log(\"Cliente selecionado ID:\", clientId);\n    form.setValue(\"clientId\", clientId);\n    \n    if (clientId) {\n      const selectedClient = clients.find(c => c.id === clientId);\n      console.log(\"Cliente encontrado:\", selectedClient);\n      if (selectedClient) {\n        // Preencher automaticamente CEP e n√∫mero\n        console.log(\"Preenchendo CEP:\", selectedClient.cep, \"N√∫mero:\", selectedClient.numero);\n        form.setValue(\"cep\", selectedClient.cep);\n        form.setValue(\"numero\", selectedClient.numero);\n      }\n    } else {\n      // Limpar campos quando nenhum cliente selecionado\n      form.setValue(\"cep\", \"\");\n      form.setValue(\"numero\", \"\");\n    }\n  };\n\n  // Muta√ß√£o para buscar datas dispon√≠veis\n  const searchDatesMutation = useMutation({\n    mutationFn: async (data: FindDateFormData) => {\n      setIsSearching(true);\n      \n      // Simular busca de datas dispon√≠veis\n      // Em um cen√°rio real, isso seria um endpoint da API\n      const mockResults: AvailableDate[] = [];\n      \n      // Filtrar t√©cnicos e equipes com base na sele√ß√£o\n      const availableTechnicians = data.technicianId \n        ? technicians.filter(t => t.id === data.technicianId)\n        : technicians;\n      \n      const availableTeams = data.teamId \n        ? teams.filter(t => t.id === data.teamId)\n        : teams;\n\n      // Gerar datas dispon√≠veis para os pr√≥ximos 30 dias\n      const today = new Date();\n      for (let i = 1; i <= 30; i++) {\n        const date = new Date(today);\n        date.setDate(today.getDate() + i);\n        \n        // Pular fins de semana\n        if (date.getDay() === 0 || date.getDay() === 6) continue;\n        \n        // Adicionar t√©cnicos\n        availableTechnicians.forEach(technician => {\n          // Simular dist√¢ncias baseadas no CEP\n          const baseDistance = Math.random() * 50 + 5; // 5-55 km\n          const routeIncrease = Math.random() * 15 + 2; // 2-17 km\n          \n          // Filtrar por dist√¢ncia m√°xima se definida nas regras de neg√≥cio\n          const maxDistance = businessRules?.distanciaMaximaEntrePontos ? parseFloat(businessRules.distanciaMaximaEntrePontos) : 50;\n          if (baseDistance <= maxDistance) {\n            mockResults.push({\n              date: date.toISOString().split('T')[0],\n              technician: `üë§ ${technician.name}`,\n              technicianId: technician.id,\n              routeIncrease: routeIncrease,\n              totalDistance: baseDistance + routeIncrease,\n            });\n          }\n        });\n\n        // Adicionar equipes\n        availableTeams.forEach(team => {\n          // Simular dist√¢ncias baseadas no CEP\n          const baseDistance = Math.random() * 50 + 5; // 5-55 km\n          const routeIncrease = Math.random() * 15 + 2; // 2-17 km\n          \n          // Filtrar por dist√¢ncia m√°xima se definida nas regras de neg√≥cio\n          const maxDistance = businessRules?.distanciaMaximaEntrePontos ? parseFloat(businessRules.distanciaMaximaEntrePontos) : 50;\n          if (baseDistance <= maxDistance) {\n            mockResults.push({\n              date: date.toISOString().split('T')[0],\n              technician: `üë• ${team.name}`,\n              teamId: team.id,\n              routeIncrease: routeIncrease,\n              totalDistance: baseDistance + routeIncrease,\n            });\n          }\n        });\n      }\n\n      // Ordenar por data e depois por dist√¢ncia total\n      return mockResults.sort((a, b) => {\n        const dateCompare = a.date.localeCompare(b.date);\n        if (dateCompare === 0) {\n          return a.totalDistance - b.totalDistance;\n        }\n        return dateCompare;\n      });\n    },\n    onSuccess: (results) => {\n      setSearchResults(results);\n      setIsSearching(false);\n    },\n    onError: () => {\n      setIsSearching(false);\n    }\n  });\n\n  const onSubmit = (data: FindDateFormData) => {\n    searchDatesMutation.mutate(data);\n  };\n\n  const handleSchedule = (result: AvailableDate, formData: FindDateFormData) => {\n    console.log(\"üîÑ [DEBUG] handleSchedule - result:\", result);\n    console.log(\"üîÑ [DEBUG] handleSchedule - formData:\", formData);\n    \n    // Navegar para a tela de agendamentos com dados pr√©-preenchidos\n    const params = new URLSearchParams({\n      date: result.date,\n      cep: formData.cep,\n      numero: formData.numero,\n      serviceId: formData.serviceId.toString(),\n      preselected: \"true\"\n    });\n\n    // Adicionar clientId se selecionado\n    if (formData.clientId) {\n      params.append(\"clientId\", formData.clientId.toString());\n    }\n\n    // Adicionar technicianId ou teamId dependendo do tipo\n    if (result.technicianId) {\n      params.append(\"technicianId\", result.technicianId.toString());\n      console.log(\"üîÑ [DEBUG] Adicionando technicianId:\", result.technicianId);\n    } else if (result.teamId) {\n      params.append(\"teamId\", result.teamId.toString());\n      console.log(\"üîÑ [DEBUG] Adicionando teamId:\", result.teamId);\n    }\n    \n    console.log(\"üîÑ [DEBUG] Par√¢metros finais:\", params.toString());\n    setLocation(`/appointments?${params.toString()}`);\n  };\n\n  const formatDate = (dateString: string) => {\n    const date = new Date(dateString);\n    return date.toLocaleDateString('pt-BR', {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 space-y-8\">\n      <div className=\"flex items-center space-x-2\">\n        <Search className=\"h-8 w-8 text-burnt-yellow\" />\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Ache uma data</h1>\n          <p className=\"text-gray-600\">Encontre as melhores datas dispon√≠veis para seu agendamento</p>\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>Buscar datas dispon√≠veis</CardTitle>\n          <CardDescription>\n            Preencha os dados abaixo para encontrar as melhores op√ß√µes de agendamento\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"cliente\">Cliente (opcional)</Label>\n              <ClientSearch\n                value={form.watch(\"clientId\")}\n                onValueChange={handleClientChange}\n                placeholder=\"Pesquisar por nome ou CPF\"\n              />\n            </div>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"cep\">CEP</Label>\n                <Input\n                  id=\"cep\"\n                  placeholder=\"00000-000\"\n                  value={form.watch(\"cep\")}\n                  onChange={handleCepChange}\n                  maxLength={9}\n                  disabled={!!form.watch(\"clientId\")}\n                  className={form.formState.errors.cep ? \"border-red-500\" : \"\"}\n                />\n                {form.formState.errors.cep && (\n                  <p className=\"text-sm text-red-500\">{form.formState.errors.cep.message}</p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"numero\">N√∫mero</Label>\n                <Input\n                  id=\"numero\"\n                  placeholder=\"123\"\n                  value={form.watch(\"numero\")}\n                  onChange={handleNumeroChange}\n                  disabled={!!form.watch(\"clientId\")}\n                  className={form.formState.errors.numero ? \"border-red-500\" : \"\"}\n                />\n                {form.formState.errors.numero && (\n                  <p className=\"text-sm text-red-500\">{form.formState.errors.numero.message}</p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"service\">Servi√ßo</Label>\n                <Select\n                  value={form.watch(\"serviceId\")?.toString() || \"\"}\n                  onValueChange={(value) => form.setValue(\"serviceId\", parseInt(value))}\n                >\n                  <SelectTrigger className={form.formState.errors.serviceId ? \"border-red-500\" : \"\"}>\n                    <SelectValue placeholder=\"Selecione um servi√ßo\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {services.map((service) => (\n                      <SelectItem key={service.id} value={service.id.toString()}>\n                        {service.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n                {form.formState.errors.serviceId && (\n                  <p className=\"text-sm text-red-500\">{form.formState.errors.serviceId.message}</p>\n                )}\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"technician\">T√©cnico/Equipe (opcional)</Label>\n                <Select\n                  value={\n                    form.watch(\"technicianId\") ? `tech-${form.watch(\"technicianId\")}` :\n                    form.watch(\"teamId\") ? `team-${form.watch(\"teamId\")}` : \"\"\n                  }\n                  onValueChange={(value) => {\n                    console.log(\"üîÑ [DEBUG] FindDate - Sele√ß√£o alterada para:\", value);\n                    \n                    if (value === \"0\" || value === \"\") {\n                      // Limpar sele√ß√µes\n                      form.setValue(\"technicianId\", undefined);\n                      form.setValue(\"teamId\", undefined);\n                      console.log(\"üîÑ [DEBUG] FindDate - Limpando sele√ß√µes\");\n                    } else if (value.startsWith('tech-')) {\n                      // √â um t√©cnico\n                      const technicianId = parseInt(value.split('-')[1]);\n                      console.log(\"üîÑ [DEBUG] FindDate - T√©cnico selecionado ID:\", technicianId);\n                      form.setValue(\"technicianId\", technicianId);\n                      form.setValue(\"teamId\", undefined);\n                    } else if (value.startsWith('team-')) {\n                      // √â uma equipe\n                      const teamId = parseInt(value.split('-')[1]);\n                      console.log(\"üîÑ [DEBUG] FindDate - Equipe selecionada ID:\", teamId);\n                      form.setValue(\"teamId\", teamId);\n                      form.setValue(\"technicianId\", undefined);\n                    }\n                  }}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"Qualquer t√©cnico/equipe\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"0\">Qualquer t√©cnico/equipe</SelectItem>\n                    {technicians.map((technician) => (\n                      <SelectItem key={`tech-${technician.id}`} value={`tech-${technician.id}`}>\n                        üë§ {technician.name}\n                      </SelectItem>\n                    ))}\n                    {teams.map((team) => (\n                      <SelectItem key={`team-${team.id}`} value={`team-${team.id}`}>\n                        üë• {team.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <Button \n              type=\"submit\" \n              className=\"w-full bg-burnt-yellow hover:bg-burnt-yellow/90\"\n              disabled={isSearching}\n            >\n              {isSearching ? \"Buscando...\" : \"Buscar datas\"}\n              <Search className=\"ml-2 h-4 w-4\" />\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n\n      {searchResults.length > 0 && (\n        <Card>\n          <CardHeader>\n            <CardTitle>Datas dispon√≠veis</CardTitle>\n            <CardDescription>\n              {searchResults.length} op√ß√µes encontradas, ordenadas da data mais pr√≥xima para a mais distante\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>Data</TableHead>\n                    <TableHead>T√©cnico</TableHead>\n                    <TableHead>Dist√¢ncia de aumento</TableHead>\n                    <TableHead>Dist√¢ncia total do dia</TableHead>\n                    <TableHead>A√ß√£o</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {searchResults.map((result, index) => (\n                    <TableRow key={index}>\n                      <TableCell className=\"font-medium\">\n                        {formatDate(result.date)}\n                      </TableCell>\n                      <TableCell>{result.technician}</TableCell>\n                      <TableCell>{result.routeIncrease.toFixed(1)} km</TableCell>\n                      <TableCell>{result.totalDistance.toFixed(1)} km</TableCell>\n                      <TableCell>\n                        <Button\n                          size=\"sm\"\n                          onClick={() => handleSchedule(result, form.getValues())}\n                          className=\"bg-burnt-yellow hover:bg-burnt-yellow/90\"\n                        >\n                          <Calendar className=\"mr-2 h-4 w-4\" />\n                          Agendar nessa data\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      {searchResults.length === 0 && searchDatesMutation.isSuccess && (\n        <Card>\n          <CardContent className=\"text-center py-8\">\n            <p className=\"text-gray-500\">\n              Nenhuma data dispon√≠vel foi encontrada para os crit√©rios informados.\n            </p>\n            <p className=\"text-sm text-gray-400 mt-2\">\n              Tente expandir a √°rea de busca ou selecionar outro servi√ßo.\n            </p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}","size_bytes":17494},"client/src/pages/Home.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport logoImg from \"@assets/SEM FUNDO_1750819798590.png\";\nimport { \n  Truck, \n  MapPin, \n  Clock, \n  DollarSign, \n  Calendar, \n  Settings, \n  History,\n  Plus,\n  Menu,\n  X\n} from \"lucide-react\";\n\nexport default function Home() {\n  const [currentSlide, setCurrentSlide] = useState(0);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n\n  const slides = [\n    {\n      title: \"Roteiriza√ß√£o Eficiente\",\n      subtitle: \"Planeje suas rotas de forma pr√°tica e eficiente, otimizando o tempo e a dist√¢ncia para suas entregas.\",\n      buttonText: \"Comece Agora\",\n      image: \"https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=1200&h=600&fit=crop\"\n    },\n    {\n      title: \"Economia de Recursos\",\n      subtitle: \"Com RotaF√°cil, voc√™ reduz custos operacionais com rotas inteligentes e planejamento eficiente.\",\n      buttonText: \"Ver Benef√≠cios\",\n      image: \"https://images.unsplash.com/photo-1601584115197-04ecc0da31d7?w=1200&h=600&fit=crop\"\n    },\n    {\n      title: \"Gest√£o Completa\",\n      subtitle: \"Gerencie clientes, t√©cnicos, ve√≠culos e agendamentos em uma √∫nica plataforma integrada.\",\n      buttonText: \"Conhecer Sistema\",\n      image: \"https://images.unsplash.com/photo-1559526324-593bc073d938?w=1200&h=600&fit=crop\"\n    }\n  ];\n\n  useEffect(() => {\n    const timer = setInterval(() => {\n      setCurrentSlide((prev) => (prev + 1) % slides.length);\n    }, 5000);\n\n    return () => clearInterval(timer);\n  }, []);\n\n  return (\n    <div className=\"min-h-screen bg-white\">\n      {/* Navigation */}\n      <nav className=\"bg-white border-b border-gray-200 sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            {/* Logo */}\n            <div className=\"flex-shrink-0\">\n              <div className=\"flex items-center space-x-2\">\n                <img src={logoImg} alt=\"RotaF√°cil Logo\" className=\"h-8 w-8\" />\n                <h1 className=\"text-2xl font-bold text-gray-900\">\n                  Rota<span className=\"text-yellow-500\">F√°cil</span>\n                </h1>\n              </div>\n            </div>\n\n            {/* Desktop Menu - Removido bot√£o \"Login\", mantido apenas \"Acessar Sistema\" */}\n            <div className=\"hidden md:block\">\n              <div className=\"ml-10 flex items-baseline space-x-8\">\n                <a href=\"#home\" className=\"text-gray-900 hover:text-yellow-500 px-3 py-2 text-sm font-medium\">\n                  Home\n                </a>\n                <a href=\"#funcionalidades\" className=\"text-gray-700 hover:text-yellow-500 px-3 py-2 text-sm font-medium\">\n                  Funcionalidades\n                </a>\n                <a href=\"#precos\" className=\"text-gray-700 hover:text-yellow-500 px-3 py-2 text-sm font-medium\">\n                  Pre√ßos\n                </a>\n                <Link href=\"/login\">\n                  <Button className=\"bg-gray-900 text-white hover:bg-gray-800\">\n                    Acessar Sistema\n                  </Button>\n                </Link>\n              </div>\n            </div>\n\n            {/* Mobile menu button */}\n            <div className=\"md:hidden\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsMenuOpen(!isMenuOpen)}\n              >\n                {isMenuOpen ? <X className=\"h-6 w-6\" /> : <Menu className=\"h-6 w-6\" />}\n              </Button>\n            </div>\n          </div>\n        </div>\n\n        {/* Mobile Menu - Removido bot√£o \"Login\", mantido apenas \"Acessar Sistema\" */}\n        {isMenuOpen && (\n          <div className=\"md:hidden\">\n            <div className=\"px-2 pt-2 pb-3 space-y-1 sm:px-3 bg-white border-t border-gray-200\">\n              <a href=\"#home\" className=\"text-gray-900 hover:text-yellow-500 block px-3 py-2 text-base font-medium\">\n                Home\n              </a>\n              <a href=\"#funcionalidades\" className=\"text-gray-700 hover:text-yellow-500 block px-3 py-2 text-base font-medium\">\n                Funcionalidades\n              </a>\n              <a href=\"#precos\" className=\"text-gray-700 hover:text-yellow-500 block px-3 py-2 text-base font-medium\">\n                Pre√ßos\n              </a>\n              <div className=\"px-3 py-2\">\n                <Link href=\"/login\">\n                  <Button className=\"w-full bg-gray-900 text-white hover:bg-gray-800\">\n                    Acessar Sistema\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          </div>\n        )}\n      </nav>\n\n      {/* Hero Section with Carousel */}\n      <section id=\"home\" className=\"relative h-96 md:h-[500px] overflow-hidden\">\n        {slides.map((slide, index) => (\n          <div\n            key={index}\n            className={`absolute inset-0 transition-opacity duration-1000 ${\n              index === currentSlide ? 'opacity-100' : 'opacity-0'\n            }`}\n            style={{\n              backgroundImage: `linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(${slide.image})`,\n              backgroundSize: 'cover',\n              backgroundPosition: 'center',\n            }}\n          >\n            <div className=\"flex items-center justify-center h-full\">\n              <div className=\"text-center text-white px-4 max-w-4xl\">\n                <h1 className=\"text-4xl md:text-6xl font-bold mb-4\">\n                  {slide.title}\n                </h1>\n                <p className=\"text-lg md:text-xl mb-8 max-w-2xl mx-auto\">\n                  {slide.subtitle}\n                </p>\n                <Link href=\"/login\">\n                  <Button size=\"lg\" className=\"bg-yellow-500 text-gray-900 hover:bg-yellow-400 font-semibold px-8 py-3\">\n                    {slide.buttonText}\n                  </Button>\n                </Link>\n              </div>\n            </div>\n          </div>\n        ))}\n\n        {/* Slide Indicators */}\n        <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2\">\n          {slides.map((_, index) => (\n            <button\n              key={index}\n              className={`w-3 h-3 rounded-full transition-all duration-300 ${\n                index === currentSlide ? 'bg-yellow-500' : 'bg-white bg-opacity-50'\n              }`}\n              onClick={() => setCurrentSlide(index)}\n            />\n          ))}\n        </div>\n      </section>\n\n      {/* Features Overview */}\n      <section className=\"py-16 bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold text-gray-900 mb-4\">\n              Simplifique sua opera√ß√£o com o RotaF√°cil\n            </h2>\n            <p className=\"text-lg text-gray-600 max-w-3xl mx-auto\">\n              Nossa plataforma foi projetada para tornar sua opera√ß√£o log√≠stica mais eficiente,\n              economizando tempo e recursos enquanto melhora a satisfa√ß√£o do cliente.\n            </p>\n          </div>\n\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-8\">\n            <Card className=\"text-center p-6 hover:shadow-lg transition-shadow\">\n              <CardContent className=\"pt-6\">\n                <div className=\"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center mx-auto mb-4\">\n                  <Truck className=\"h-6 w-6 text-yellow-600\" />\n                </div>\n                <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\n                  Otimize Entregas\n                </h3>\n                <p className=\"text-gray-600\">\n                  Reduza o tempo de entrega com rotas inteligentes e eficientes\n                  para sua frota.\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"text-center p-6 hover:shadow-lg transition-shadow\">\n              <CardContent className=\"pt-6\">\n                <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-4\">\n                  <MapPin className=\"h-6 w-6 text-blue-600\" />\n                </div>\n                <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\n                  Gerencie sua frota num s√≥ lugar\n                </h3>\n                <p className=\"text-gray-600\">\n                  Pensado para gestores e operadores, tudo em um\n                  √∫nico lugar!\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"text-center p-6 hover:shadow-lg transition-shadow\">\n              <CardContent className=\"pt-6\">\n                <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-4\">\n                  <Calendar className=\"h-6 w-6 text-green-600\" />\n                </div>\n                <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\n                  Agendamento Simples\n                </h3>\n                <p className=\"text-gray-600\">\n                  Planeje suas entregas com anteced√™ncia e\n                  organize seus recursos de forma eficiente.\n                </p>\n              </CardContent>\n            </Card>\n\n            <Card className=\"text-center p-6 hover:shadow-lg transition-shadow\">\n              <CardContent className=\"pt-6\">\n                <div className=\"w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center mx-auto mb-4\">\n                  <DollarSign className=\"h-6 w-6 text-red-600\" />\n                </div>\n                <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\n                  Redu√ß√£o de Custos\n                </h3>\n                <p className=\"text-gray-600\">\n                  Economize combust√≠vel e tempo com rotas\n                  otimizadas e melhor gerenciamento.\n                </p>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Detailed Features */}\n      <section id=\"funcionalidades\" className=\"py-16 bg-white\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold text-gray-900 mb-4\">\n              Funcionalidades do RotaF√°cil\n            </h2>\n            <p className=\"text-lg text-gray-600 max-w-3xl mx-auto\">\n              Conhe√ßa as ferramentas que v√£o transformar sua log√≠stica e otimizar suas\n              entregas\n            </p>\n          </div>\n\n          {/* Bot√µes com scroll para se√ß√µes espec√≠ficas conforme solicitado */}\n          <div className=\"flex justify-center gap-4 mb-12\">\n            <Button \n              variant=\"default\" \n              className=\"bg-gray-900 text-white\"\n              onClick={() => document.getElementById('compare-planos')?.scrollIntoView({ behavior: 'smooth' })}\n            >\n              Ver Planos\n            </Button>\n            <Button \n              variant=\"outline\"\n              onClick={() => document.getElementById('precos')?.scrollIntoView({ behavior: 'smooth' })}\n            >\n              Come√ßar Agora\n            </Button>\n          </div>\n\n          {/* Main Features */}\n          <div className=\"mb-16\">\n            <h3 className=\"text-2xl font-bold text-center text-gray-900 mb-8\">\n              Recursos Principais\n            </h3>\n            <p className=\"text-center text-gray-600 mb-12\">\n              Conhe√ßa as funcionalidades essenciais do RotaF√°cil\n            </p>\n\n            <div className=\"grid md:grid-cols-2 gap-8\">\n              <Card className=\"p-6 border-2 border-yellow-200 bg-yellow-50\">\n                <CardContent className=\"pt-0\">\n                  <div className=\"flex items-center mb-4\">\n                    <div className=\"w-12 h-12 bg-yellow-500 rounded-lg flex items-center justify-center mr-4\">\n                      <MapPin className=\"h-6 w-6 text-white\" />\n                    </div>\n                    <h3 className=\"text-xl font-semibold text-gray-900\">\n                      Roteiriza√ß√£o Inteligente\n                    </h3>\n                  </div>\n                  <p className=\"text-gray-700\">\n                    Sistema inteligente de cria√ß√£o de rotas que otimiza percursos,\n                    economizando tempo e combust√≠vel.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"p-6\">\n                <CardContent className=\"pt-0\">\n                  <div className=\"flex items-center mb-4\">\n                    <div className=\"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mr-4\">\n                      <Calendar className=\"h-6 w-6 text-gray-600\" />\n                    </div>\n                    <h3 className=\"text-xl font-semibold text-gray-900\">\n                      Agendamento de Servi√ßos\n                    </h3>\n                  </div>\n                  <p className=\"text-gray-700\">\n                    Agende entregas e servi√ßos com facilidade e garanta o\n                    planejamento eficiente da sua opera√ß√£o.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"p-6\">\n                <CardContent className=\"pt-0\">\n                  <div className=\"flex items-center mb-4\">\n                    <div className=\"w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center mr-4\">\n                      <History className=\"h-6 w-6 text-gray-600\" />\n                    </div>\n                    <h3 className=\"text-xl font-semibold text-gray-900\">\n                      Hist√≥rico de Rotas\n                    </h3>\n                  </div>\n                  <p className=\"text-gray-700\">\n                    Acesse e analise o hist√≥rico completo das rotas realizadas para\n                    otimizar futuras opera√ß√µes.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"p-6 border-2 border-yellow-200 bg-yellow-50\">\n                <CardContent className=\"pt-0\">\n                  <div className=\"flex items-center mb-4\">\n                    <div className=\"w-12 h-12 bg-yellow-500 rounded-lg flex items-center justify-center mr-4\">\n                      <Calendar className=\"h-6 w-6 text-white\" />\n                    </div>\n                    <h3 className=\"text-xl font-semibold text-gray-900\">\n                      Encontre uma data\n                    </h3>\n                  </div>\n                  <p className=\"text-gray-700\">\n                    Procure por uma data, com a menor dist√¢ncia de acordo com seus servi√ßos j√° agendados.\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n\n          {/* Advanced Features */}\n          <div>\n            <h3 className=\"text-2xl font-bold text-center text-gray-900 mb-8\">\n              Recursos Avan√ßados\n            </h3>\n            <p className=\"text-center text-gray-600 mb-12\">\n              Funcionalidades para levar sua opera√ß√£o ao pr√≥ximo n√≠vel\n            </p>\n\n            <div className=\"grid md:grid-cols-2 gap-8\">\n              <Card className=\"p-6\">\n                <CardContent className=\"pt-0\">\n                  <div className=\"flex items-center mb-4\">\n                    <div className=\"w-8 h-8 bg-gray-900 rounded flex items-center justify-center mr-4\">\n                      <Plus className=\"h-4 w-4 text-white\" />\n                    </div>\n                    <h3 className=\"text-lg font-semibold text-gray-900\">\n                      Inclus√£o de Rota\n                    </h3>\n                  </div>\n                  <p className=\"text-gray-700\">\n                    Adicione rotas manualmente quando necess√°rio, com total\n                    flexibilidade para sua opera√ß√£o.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"p-6\">\n                <CardContent className=\"pt-0\">\n                  <div className=\"flex items-center mb-4\">\n                    <div className=\"w-8 h-8 bg-gray-900 rounded flex items-center justify-center mr-4\">\n                      <Settings className=\"h-4 w-4 text-white\" />\n                    </div>\n                    <h3 className=\"text-lg font-semibold text-gray-900\">\n                      Configura√ß√µes Personalizadas\n                    </h3>\n                  </div>\n                  <p className=\"text-gray-700\">\n                    Adapte o sistema √†s necessidades espec√≠ficas da sua opera√ß√£o\n                    com diversas op√ß√µes de personaliza√ß√£o.\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Pricing Comparison */}\n      <section id=\"compare-planos\" className=\"py-16 bg-gray-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold text-gray-900 mb-4\">\n              Compare os Planos\n            </h2>\n            <p className=\"text-lg text-gray-600\">\n              Veja quais funcionalidades est√£o dispon√≠veis em cada plano\n            </p>\n          </div>\n\n          {/* Tabela alterada para 4 colunas com novos dados conforme solicitado */}\n          <div className=\"overflow-x-auto\">\n            <table className=\"w-full bg-white rounded-lg shadow-sm\">\n              <thead>\n                <tr className=\"border-b border-gray-200\">\n                  <th className=\"text-left py-4 px-6 font-semibold text-gray-900\">Funcionalidade</th>\n                  <th className=\"text-center py-4 px-6 font-semibold text-gray-900\">B√°sico</th>\n                  <th className=\"text-center py-4 px-6 font-semibold text-gray-900 bg-yellow-50\">Profissional</th>\n                  <th className=\"text-center py-4 px-6 font-semibold text-gray-900\">Empresarial</th>\n                  <th className=\"text-center py-4 px-6 font-semibold text-gray-900\">Personalizado</th>\n                </tr>\n              </thead>\n              <tbody>\n                <tr className=\"border-b border-gray-100\">\n                  <td className=\"py-4 px-6 text-gray-700\">N¬∫ de Roteiriza√ß√£o</td>\n                  <td className=\"text-center py-4 px-6 text-gray-600\">at√© 150 requisi√ß√µes/m√™s</td>\n                  <td className=\"text-center py-4 px-6 bg-yellow-50 text-gray-900\">at√© 800 requisi√ß√µes/m√™s</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">at√© 5000 requisi√ß√µes/m√™s</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">Sob consulta</td>\n                </tr>\n                {/* Nova linha adicionada como segunda linha conforme solicitado */}\n                <tr className=\"border-b border-gray-100\">\n                  <td className=\"py-4 px-6 text-gray-700\">N√∫mero de endere√ßos por rota</td>\n                  <td className=\"text-center py-4 px-6 text-gray-600\">10</td>\n                  <td className=\"text-center py-4 px-6 bg-yellow-50 text-gray-900\">25</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">60</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">Sob consulta</td>\n                </tr>\n                <tr className=\"border-b border-gray-100\">\n                  <td className=\"py-4 px-6 text-gray-700\">N√∫mero de ve√≠culos</td>\n                  <td className=\"text-center py-4 px-6 text-gray-600\">at√© 5 ve√≠culos</td>\n                  <td className=\"text-center py-4 px-6 bg-yellow-50 text-gray-900\">at√© 12 ve√≠culos</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">at√© 30 ve√≠culos</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">Sob consulta</td>\n                </tr>\n                <tr className=\"border-b border-gray-100\">\n                  <td className=\"py-4 px-6 text-gray-700\">N√∫mero de t√©cnicos</td>\n                  <td className=\"text-center py-4 px-6 text-gray-600\">at√© 5 t√©cnicos</td>\n                  <td className=\"text-center py-4 px-6 bg-yellow-50 text-gray-900\">at√© 12 t√©cnicos</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">at√© 30 t√©cnicos</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">Sob consulta</td>\n                </tr>\n                <tr className=\"border-b border-gray-100\">\n                  <td className=\"py-4 px-6 text-gray-700\">Hist√≥rico de rotas</td>\n                  <td className=\"text-center py-4 px-6 text-gray-600\">30 dias</td>\n                  <td className=\"text-center py-4 px-6 bg-yellow-50 text-gray-900\">120 dias</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">360 dias</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">Sob consulta</td>\n                </tr>\n                <tr className=\"border-b border-gray-100\">\n                  <td className=\"py-4 px-6 text-gray-700\">Agendamento de servi√ßos</td>\n                  <td className=\"text-center py-4 px-6 text-gray-600\">‚úì</td>\n                  <td className=\"text-center py-4 px-6 bg-yellow-50 text-gray-900\">‚úì</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">‚úì</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">Sob consulta</td>\n                </tr>\n                <tr>\n                  <td className=\"py-4 px-6 text-gray-700\">Ache uma data</td>\n                  <td className=\"text-center py-4 px-6 text-gray-600\">‚úì</td>\n                  <td className=\"text-center py-4 px-6 bg-yellow-50 text-gray-900\">‚úì</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">‚úì</td>\n                  <td className=\"text-center py-4 px-6 text-gray-900\">Sob consulta</td>\n                </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </section>\n\n      {/* Pricing Plans */}\n      <section id=\"precos\" className=\"py-16 bg-white\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center mb-12\">\n            <h2 className=\"text-3xl md:text-4xl font-bold text-gray-900 mb-4\">\n              Planos e Pre√ßos\n            </h2>\n            <p className=\"text-lg text-gray-600\">\n              Escolha o plano ideal para o seu neg√≥cio e otimize suas rotas com\n              RotaF√°cil\n            </p>\n          </div>\n\n          {/* Se√ß√£o de planos ajustada para refletir os dados da tabela \"Compare os Planos\" */}\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-4 gap-8\">\n            {/* Basic Plan */}\n            <Card className=\"relative\">\n              <CardContent className=\"p-8\">\n                <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">B√°sico</h3>\n                <div className=\"mb-6\">\n                  <span className=\"text-4xl font-bold text-gray-900\">R$ 99</span>\n                  <span className=\"text-gray-600\">/m√™s</span>\n                </div>\n                <p className=\"text-gray-600 mb-6\">\n                  Ideal para pequenas empresas e aut√¥nomos\n                </p>\n                \n                <ul className=\"space-y-3 mb-8\">\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    At√© 150 requisi√ß√µes/m√™s\n                  </li>\n                  {/* Adicionada nova informa√ß√£o sobre endere√ßos por rota */}\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    10 endere√ßos por rota\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    At√© 5 ve√≠culos\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    At√© 5 t√©cnicos\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Hist√≥rico de rotas (30 dias)\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Agendamento de servi√ßos\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Ache uma data\n                  </li>\n                </ul>\n\n                <Button variant=\"outline\" className=\"w-full\">\n                  Comece Gr√°tis\n                </Button>\n              </CardContent>\n            </Card>\n\n            {/* Professional Plan */}\n            <Card className=\"relative border-2 border-yellow-200\">\n              <div className=\"absolute -top-3 left-1/2 transform -translate-x-1/2\">\n                <span className=\"bg-yellow-500 text-gray-900 px-4 py-1 rounded-full text-sm font-semibold\">\n                  Mais Popular\n                </span>\n              </div>\n              <CardContent className=\"p-8\">\n                <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">Profissional</h3>\n                {/* Pre√ßo atualizado para R$ 249 conforme solicitado */}\n                <div className=\"mb-6\">\n                  <span className=\"text-4xl font-bold text-gray-900\">R$ 249</span>\n                  <span className=\"text-gray-600\">/m√™s</span>\n                </div>\n                <p className=\"text-gray-600 mb-6\">\n                  Perfeito para empresas em crescimento\n                </p>\n                \n                <ul className=\"space-y-3 mb-8\">\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    At√© 800 requisi√ß√µes/m√™s\n                  </li>\n                  {/* Adicionada nova informa√ß√£o sobre endere√ßos por rota para plano Profissional */}\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    25 endere√ßos por rota\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    At√© 12 ve√≠culos\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    At√© 12 t√©cnicos\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Hist√≥rico de rotas (120 dias)\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Agendamento de servi√ßos\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Ache uma data\n                  </li>\n                </ul>\n\n                <Button className=\"w-full bg-yellow-500 text-gray-900 hover:bg-yellow-400\">\n                  Escolher Plano\n                </Button>\n              </CardContent>\n            </Card>\n\n            {/* Enterprise Plan */}\n            <Card className=\"relative\">\n              <CardContent className=\"p-8\">\n                <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">Empresarial</h3>\n                {/* Pre√ßo atualizado para R$ 649 conforme solicitado */}\n                <div className=\"mb-6\">\n                  <span className=\"text-4xl font-bold text-gray-900\">R$ 649</span>\n                  <span className=\"text-gray-600\">/m√™s</span>\n                </div>\n                <p className=\"text-gray-600 mb-6\">\n                  Para frotas grandes e opera√ß√µes complexas\n                </p>\n                \n                <ul className=\"space-y-3 mb-8\">\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    At√© 5000 requisi√ß√µes/m√™s\n                  </li>\n                  {/* Adicionada nova informa√ß√£o sobre endere√ßos por rota para plano Empresarial */}\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    60 endere√ßos por rota\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    At√© 30 ve√≠culos\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    At√© 30 t√©cnicos\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Hist√≥rico de rotas (360 dias)\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Agendamento de servi√ßos\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Ache uma data\n                  </li>\n                </ul>\n\n                <Button variant=\"outline\" className=\"w-full\">\n                  Contatar Vendas\n                </Button>\n              </CardContent>\n            </Card>\n\n            {/* Personalizado Plan */}\n            <Card className=\"relative\">\n              <CardContent className=\"p-8\">\n                <h3 className=\"text-2xl font-bold text-gray-900 mb-2\">Personalizado</h3>\n                <div className=\"mb-6\">\n                  <span className=\"text-2xl font-bold text-gray-900\">Sob consulta</span>\n                </div>\n                <p className=\"text-gray-600 mb-6\">\n                  Solu√ß√µes personalizadas para suas necessidades espec√≠ficas\n                </p>\n                \n                <ul className=\"space-y-3 mb-8\">\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Roteiriza√ß√£o sob consulta\n                  </li>\n                  {/* Adicionada nova informa√ß√£o sobre endere√ßos por rota para plano Personalizado */}\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Endere√ßos por rota sob consulta\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Ve√≠culos sob consulta\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    T√©cnicos sob consulta\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Hist√≥rico sob consulta\n                  </li>\n                  <li className=\"flex items-center text-gray-700\">\n                    <div className=\"w-2 h-2 bg-green-500 rounded-full mr-3\"></div>\n                    Recursos sob consulta\n                  </li>\n                </ul>\n\n                <Button variant=\"outline\" className=\"w-full\">\n                  Contatar Vendas\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"bg-gray-900 text-white py-12\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"text-center\">\n            <div className=\"flex items-center justify-center space-x-2 mb-4\">\n              <img src={logoImg} alt=\"RotaF√°cil Logo\" className=\"h-8 w-8\" />\n              <h3 className=\"text-2xl font-bold\">\n                Rota<span className=\"text-yellow-500\">F√°cil</span>\n              </h3>\n            </div>\n            <p className=\"text-gray-400 mb-8 max-w-2xl mx-auto\">\n              Otimize suas rotas, economize recursos e melhore a efici√™ncia da sua opera√ß√£o\n              com nossa plataforma completa de gest√£o log√≠stica.\n            </p>\n            \n            <div className=\"flex justify-center space-x-6 mb-8\">\n              <Link href=\"/login\" className=\"text-gray-400 hover:text-yellow-500 transition-colors\">\n                Acessar Sistema\n              </Link>\n              <a href=\"#funcionalidades\" className=\"text-gray-400 hover:text-yellow-500 transition-colors\">\n                Funcionalidades\n              </a>\n              <a href=\"#precos\" className=\"text-gray-400 hover:text-yellow-500 transition-colors\">\n                Pre√ßos\n              </a>\n            </div>\n            \n            <div className=\"border-t border-gray-800 pt-8\">\n              <p className=\"text-gray-400 text-sm\">\n                ¬© 2025 RotaF√°cil. Todos os direitos reservados.\n              </p>\n            </div>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}","size_bytes":34337},"client/src/pages/Login.tsx":{"content":"import { useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useAuth } from \"@/lib/auth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Route as RouteIcon, \n  Calendar, \n  Users, \n  Eye, \n  EyeOff,\n  Menu,\n  X\n} from \"lucide-react\";\nimport logoImg from \"@assets/SEM FUNDO_1750819798590.png\";\n\nexport default function Login() {\n  const [isLogin, setIsLogin] = useState(true);\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  const [formData, setFormData] = useState({\n    name: \"\",\n    username: \"\",\n    email: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n    rememberMe: false,\n  });\n\n  const { login, register } = useAuth();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      if (isLogin) {\n        await login(formData.email, formData.password);\n        toast({\n          title: \"Login realizado com sucesso!\",\n          description: \"Bem-vindo ao RotaF√°cil\",\n        });\n        // Redirect to dashboard after successful login\n        setLocation(\"/dashboard\");\n      } else {\n        if (formData.password !== formData.confirmPassword) {\n          throw new Error(\"As senhas n√£o coincidem\");\n        }\n        \n        await register({\n          name: formData.name,\n          username: formData.username,\n          email: formData.email,\n          password: formData.password,\n        });\n        \n        toast({\n          title: \"Conta criada com sucesso!\",\n          description: \"Bem-vindo ao RotaF√°cil\",\n        });\n        // Redirect to dashboard after successful registration\n        setLocation(\"/dashboard\");\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Ocorreu um erro inesperado\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const { name, value, type, checked } = e.target;\n    setFormData(prev => ({\n      ...prev,\n      [name]: type === \"checkbox\" ? checked : value,\n    }));\n  };\n\n  return (\n    <div className=\"min-h-screen bg-white\">\n      {/* Barra superior de navega√ß√£o - adicionada para permitir navega√ß√£o entre p√°ginas */}\n      <nav className=\"bg-white border-b border-gray-200 sticky top-0 z-50\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center h-16\">\n            {/* Logo */}\n            <div className=\"flex-shrink-0\">\n              <Link href=\"/\">\n                <div className=\"flex items-center space-x-2 cursor-pointer hover:opacity-80 transition-opacity\">\n                  <img src={logoImg} alt=\"RotaF√°cil Logo\" className=\"h-8 w-8\" />\n                  <h1 className=\"text-2xl font-bold text-gray-900\">\n                    Rota<span className=\"text-yellow-500\">F√°cil</span>\n                  </h1>\n                </div>\n              </Link>\n            </div>\n\n            {/* Menu de navega√ß√£o desktop */}\n            <div className=\"hidden md:block\">\n              <div className=\"ml-10 flex items-baseline space-x-8\">\n                <Link href=\"/\" className=\"text-gray-700 hover:text-yellow-500 px-3 py-2 text-sm font-medium\">\n                  Home\n                </Link>\n                <a href=\"/#funcionalidades\" className=\"text-gray-700 hover:text-yellow-500 px-3 py-2 text-sm font-medium\">\n                  Funcionalidades\n                </a>\n                <a href=\"/#precos\" className=\"text-gray-700 hover:text-yellow-500 px-3 py-2 text-sm font-medium\">\n                  Pre√ßos\n                </a>\n              </div>\n            </div>\n\n            {/* Menu mobile */}\n            <div className=\"md:hidden\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsMenuOpen(!isMenuOpen)}\n              >\n                {isMenuOpen ? <X className=\"h-6 w-6\" /> : <Menu className=\"h-6 w-6\" />}\n              </Button>\n            </div>\n          </div>\n\n          {/* Menu mobile expandido */}\n          {isMenuOpen && (\n            <div className=\"md:hidden\">\n              <div className=\"px-2 pt-2 pb-3 space-y-1 sm:px-3 border-t border-gray-200\">\n                <Link href=\"/\" className=\"text-gray-700 hover:text-yellow-500 block px-3 py-2 text-base font-medium\">\n                  Home\n                </Link>\n                <a href=\"/#funcionalidades\" className=\"text-gray-700 hover:text-yellow-500 block px-3 py-2 text-base font-medium\">\n                  Funcionalidades\n                </a>\n                <a href=\"/#precos\" className=\"text-gray-700 hover:text-yellow-500 block px-3 py-2 text-base font-medium\">\n                  Pre√ßos\n                </a>\n              </div>\n            </div>\n          )}\n        </div>\n      </nav>\n\n      <div className=\"flex\">\n        {/* Left Side - Branding */}\n        <div className=\"hidden lg:flex lg:w-1/2 bg-black text-white flex-col justify-center items-center p-12\">\n          <div className=\"max-w-md text-center\">\n            <div className=\"flex items-center justify-center space-x-3 mb-6\">\n              <img src={logoImg} alt=\"RotaF√°cil Logo\" className=\"h-12 w-12\" />\n              <h1 className=\"text-5xl font-bold\">\n                Rota<span className=\"text-burnt-yellow\">F√°cil</span>\n              </h1>\n            </div>\n            <p className=\"text-xl text-gray-300 mb-8\">\n              Simplifique o agendamento e roteiriza√ß√£o dos seus atendimentos t√©cnicos\n            </p>\n            <div className=\"space-y-4 text-left\">\n              <div className=\"flex items-center space-x-3\">\n                <RouteIcon className=\"text-burnt-yellow h-6 w-6\" />\n                <span>Roteiriza√ß√£o otimizada</span>\n              </div>\n              <div className=\"flex items-center space-x-3\">\n                <Calendar className=\"text-burnt-yellow h-6 w-6\" />\n                <span>Agendamentos inteligentes</span>\n              </div>\n              <div className=\"flex items-center space-x-3\">\n                <Users className=\"text-burnt-yellow h-6 w-6\" />\n                <span>Gest√£o completa de equipe</span>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Right Side - Login/Register Form */}\n        <div className=\"w-full lg:w-1/2 flex items-center justify-center p-8\">\n          <div className=\"max-w-md w-full space-y-8\">\n            <div className=\"text-center lg:hidden mb-8\">\n              <Link href=\"/\">\n                <h1 className=\"text-3xl font-bold cursor-pointer hover:opacity-80 transition-opacity\">\n                  Rota<span className=\"text-burnt-yellow\">F√°cil</span>\n                </h1>\n              </Link>\n            </div>\n            \n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-3xl font-bold text-gray-900\">\n                  {isLogin ? \"Entrar na sua conta\" : \"Criar nova conta\"}\n                </CardTitle>\n                <CardDescription>\n                  {isLogin \n                    ? \"Bem-vindo de volta! Fa√ßa login para continuar.\" \n                    : \"Crie sua conta e comece a usar o RotaF√°cil hoje mesmo.\"\n                  }\n                </CardDescription>\n              </CardHeader>\n              \n              <CardContent>\n                <form onSubmit={handleSubmit} className=\"space-y-6\">\n                  {!isLogin && (\n                    <>\n                      <div>\n                        <Label htmlFor=\"name\">Nome completo</Label>\n                        <Input\n                          id=\"name\"\n                          name=\"name\"\n                          type=\"text\"\n                          required\n                          value={formData.name}\n                          onChange={handleInputChange}\n                          placeholder=\"Seu nome completo\"\n                          className=\"mt-1\"\n                        />\n                      </div>\n                      \n                      <div>\n                        <Label htmlFor=\"username\">Nome de usu√°rio</Label>\n                        <Input\n                          id=\"username\"\n                          name=\"username\"\n                          type=\"text\"\n                          required\n                          value={formData.username}\n                          onChange={handleInputChange}\n                          placeholder=\"Seu nome de usu√°rio\"\n                          className=\"mt-1\"\n                        />\n                      </div>\n                    </>\n                  )}\n                  \n                  <div>\n                    <Label htmlFor=\"email\">Email</Label>\n                    <Input\n                      id=\"email\"\n                      name=\"email\"\n                      type=\"email\"\n                      required\n                      value={formData.email}\n                      onChange={handleInputChange}\n                      placeholder=\"seu@email.com\"\n                      className=\"mt-1\"\n                    />\n                  </div>\n                  \n                  <div>\n                    <Label htmlFor=\"password\">Senha</Label>\n                    <div className=\"relative mt-1\">\n                      <Input\n                        id=\"password\"\n                        name=\"password\"\n                        type={showPassword ? \"text\" : \"password\"}\n                        required\n                        value={formData.password}\n                        onChange={handleInputChange}\n                        placeholder=\"Sua senha\"\n                        className=\"pr-10\"\n                      />\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent\"\n                        onClick={() => setShowPassword(!showPassword)}\n                      >\n                        {showPassword ? (\n                          <EyeOff className=\"h-4 w-4 text-gray-400\" />\n                        ) : (\n                          <Eye className=\"h-4 w-4 text-gray-400\" />\n                        )}\n                      </Button>\n                    </div>\n                  </div>\n                  \n                  {!isLogin && (\n                    <div>\n                      <Label htmlFor=\"confirmPassword\">Confirmar senha</Label>\n                      <Input\n                        id=\"confirmPassword\"\n                        name=\"confirmPassword\"\n                        type=\"password\"\n                        required\n                        value={formData.confirmPassword}\n                        onChange={handleInputChange}\n                        placeholder=\"Confirme sua senha\"\n                        className=\"mt-1\"\n                      />\n                    </div>\n                  )}\n                  \n                  {isLogin && (\n                    <div className=\"flex items-center space-x-2\">\n                      <Checkbox\n                        id=\"rememberMe\"\n                        name=\"rememberMe\"\n                        checked={formData.rememberMe}\n                        onCheckedChange={(checked) => \n                          setFormData(prev => ({...prev, rememberMe: checked as boolean}))\n                        }\n                      />\n                      <Label htmlFor=\"rememberMe\" className=\"text-sm text-gray-600\">\n                        Lembrar de mim\n                      </Label>\n                    </div>\n                  )}\n\n                  <Button\n                    type=\"submit\"\n                    className=\"w-full bg-gray-900 hover:bg-gray-800 text-white\"\n                    disabled={isLoading}\n                  >\n                    {isLoading \n                      ? \"Aguarde...\" \n                      : isLogin \n                        ? \"Entrar\" \n                        : \"Criar conta\"\n                    }\n                  </Button>\n                </form>\n                \n                <div className=\"text-center mt-6\">\n                  <p className=\"text-sm text-gray-600\">\n                    {isLogin ? \"N√£o tem uma conta?\" : \"J√° tem uma conta?\"}{\" \"}\n                    <Button\n                      variant=\"link\"\n                      className=\"font-medium text-burnt-yellow hover:text-burnt-yellow-dark p-0\"\n                      onClick={() => setIsLogin(!isLogin)}\n                    >\n                      {isLogin ? \"Cadastre-se gr√°tis\" : \"Fa√ßa login\"}\n                    </Button>\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":13344},"client/src/pages/Routes.tsx":{"content":"import { useState, useMemo, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getAuthHeaders } from \"@/lib/auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Route,\n  MapPin,\n  Clock,\n  Navigation,\n  TrendingUp,\n  Filter,\n  Search,\n  Calendar,\n  CheckSquare,\n  Edit,\n  Repeat2,\n  Loader2,\n} from \"lucide-react\";\nimport type {\n  Appointment,\n  Client,\n  Service,\n  Technician,\n  Team,\n  User,\n} from \"@shared/schema\";\nimport { getPlanLimits } from \"@shared/plan-limits\";\nimport AppointmentForm from \"@/components/forms/AppointmentForm\";\n\ninterface OptimizedRoute {\n  optimizedOrder: Appointment[];\n  totalDistance: number;\n  estimatedTime: number;\n  geojson?: any;\n  routeSteps?: RouteStep[];\n  matrixDurations?: number[][];\n  matrixDistances?: number[][];\n  tspOrder?: number[];\n  startAddress?: string;\n  startToFirstDistance?: string;\n  startToFirstDuration?: string;\n}\n\ninterface RouteStep {\n  appointmentIndex: number;\n  distance: string;\n  duration: string;\n  distanceMeters: number;\n  durationSeconds: number;\n}\n\nasync function geocodeEndereco(endereco: string) {\n  const url = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(endereco)}&format=json&limit=1`;\n  const res = await fetch(url, {\n    headers: {\n      \"User-Agent\": \"RotaFacilDev/1.0 (seuemail@dominio.com)\",\n    },\n  });\n  const data = await res.json();\n  if (data && data.length) {\n    return {\n      lat: parseFloat(data[0].lat),\n      lon: parseFloat(data[0].lon),\n    };\n  }\n  throw new Error(\"Endere√ßo n√£o encontrado: \" + endereco);\n}\n\n// Fun√ß√£o de geocodifica√ß√£o com fallbacks para endere√ßo de in√≠cio\nasync function geocodeComFallbacks(entity: any, businessRules: any) {\n  console.log(\n    \"üîç Iniciando geocodifica√ß√£o com fallbacks para entidade:\",\n    entity?.name || \"N√£o definida\",\n  );\n\n  // Se h√° entidade (t√©cnico ou equipe), verificar se tem endere√ßo de in√≠cio pr√≥prio\n  if (entity) {\n    const hasOwnStartAddress =\n      entity.enderecoInicioCep &&\n      entity.enderecoInicioLogradouro &&\n      entity.enderecoInicioBairro &&\n      entity.enderecoInicioCidade &&\n      entity.enderecoInicioEstado;\n\n    if (hasOwnStartAddress) {\n      console.log(\"üè† Entidade tem endere√ßo pr√≥prio, tentando fallbacks...\");\n\n      const tentativas = [\n        // Endere√ßo completo\n        [\n          entity.enderecoInicioLogradouro,\n          entity.enderecoInicioNumero,\n          entity.enderecoInicioBairro,\n          entity.enderecoInicioCidade,\n          entity.enderecoInicioCep,\n          entity.enderecoInicioEstado,\n          \"Brasil\",\n        ]\n          .filter(Boolean)\n          .join(\", \"),\n        // Sem n√∫mero\n        [\n          entity.enderecoInicioLogradouro,\n          entity.enderecoInicioBairro,\n          entity.enderecoInicioCidade,\n          entity.enderecoInicioCep,\n          entity.enderecoInicioEstado,\n          \"Brasil\",\n        ]\n          .filter(Boolean)\n          .join(\", \"),\n        // S√≥ CEP, Cidade, Estado, Brasil\n        [\n          entity.enderecoInicioCep,\n          entity.enderecoInicioCidade,\n          entity.enderecoInicioEstado,\n          \"Brasil\",\n        ]\n          .filter(Boolean)\n          .join(\", \"),\n      ];\n\n      for (let i = 0; i < tentativas.length; i++) {\n        const endereco = tentativas[i];\n        if (!endereco) continue;\n\n        console.log(`üîÑ Tentativa ${i + 1}: ${endereco}`);\n\n        try {\n          const result = await geocodeEndereco(endereco);\n          console.log(`‚úÖ Sucesso na tentativa ${i + 1}:`, result);\n          return result;\n        } catch (error: any) {\n          console.log(`‚ùå Falhou tentativa ${i + 1}:`, error.message);\n        }\n      }\n    }\n  }\n\n  // Fallback: endere√ßo da empresa\n  if (businessRules) {\n    console.log(\"üè¢ Tentando endere√ßo da empresa como fallback...\");\n\n    const tentativasEmpresa = [\n      // Endere√ßo completo da empresa\n      [\n        businessRules.enderecoEmpresaLogradouro,\n        businessRules.enderecoEmpresaNumero,\n        businessRules.enderecoEmpresaBairro,\n        businessRules.enderecoEmpresaCidade,\n        businessRules.enderecoEmpresaCep,\n        businessRules.enderecoEmpresaEstado,\n        \"Brasil\",\n      ]\n        .filter(Boolean)\n        .join(\", \"),\n      // Sem n√∫mero da empresa\n      [\n        businessRules.enderecoEmpresaLogradouro,\n        businessRules.enderecoEmpresaBairro,\n        businessRules.enderecoEmpresaCidade,\n        businessRules.enderecoEmpresaCep,\n        businessRules.enderecoEmpresaEstado,\n        \"Brasil\",\n      ]\n        .filter(Boolean)\n        .join(\", \"),\n      // S√≥ CEP, Cidade, Estado, Brasil da empresa\n      [\n        businessRules.enderecoEmpresaCep,\n        businessRules.enderecoEmpresaCidade,\n        businessRules.enderecoEmpresaEstado,\n        \"Brasil\",\n      ]\n        .filter(Boolean)\n        .join(\", \"),\n    ];\n\n    for (let i = 0; i < tentativasEmpresa.length; i++) {\n      const endereco = tentativasEmpresa[i];\n      if (!endereco) continue;\n\n      console.log(`üîÑ Tentativa empresa ${i + 1}: ${endereco}`);\n\n      try {\n        const result = await geocodeEndereco(endereco);\n        console.log(`‚úÖ Sucesso na tentativa empresa ${i + 1}:`, result);\n        return result;\n      } catch (error: any) {\n        console.log(`‚ùå Falhou tentativa empresa ${i + 1}:`, error.message);\n      }\n    }\n  }\n\n  throw new Error(\n    \"N√£o foi poss√≠vel encontrar o endere√ßo de in√≠cio. Ajuste o endere√ßo da equipe/t√©cnico ou da empresa.\",\n  );\n}\n\n// Fun√ß√£o para calcular rota usando OSRM\nasync function calcularRotaOsrm(coordenadas: { lat: number; lon: number }[]) {\n  if (coordenadas.length < 2) {\n    throw new Error(\n      \"S√£o necess√°rias pelo menos 2 coordenadas para calcular uma rota\",\n    );\n  }\n\n  const pontos = coordenadas\n    .map((coord) => `${coord.lon},${coord.lat}`)\n    .join(\";\");\n  const url = `/api/route?coords=${encodeURIComponent(pontos)}`;\n\n  console.log(\"üöó Chamando PROXY OSRM:\", url);\n  console.log(\"üìç Coordenadas enviadas:\", coordenadas);\n\n  const res = await fetch(url);\n\n  if (!res.ok) {\n    const text = await res.text();\n    throw new Error(\n      `Erro OSRM: Status ${res.status}. Resposta: ${text.substring(0, 100)}...`,\n    );\n  }\n  return res.json();\n}\n\nexport default function Routes() {\n  const [selectedAppointments, setSelectedAppointments] = useState<number[]>(\n    [],\n  );\n  const [optimizedRoute, setOptimizedRoute] = useState<OptimizedRoute | null>(\n    null,\n  );\n  const [selectedDate, setSelectedDate] = useState<string>(\"\");\n  const [searchTerm, setSearchTerm] = useState<string>(\"\");\n  const [selectedService, setSelectedService] = useState<string>(\"\");\n  const [selectedTechnician, setSelectedTechnician] = useState<string>(\"\");\n  const [selectedStatus, setSelectedStatus] = useState<string>(\"\");\n  const [isFullscreen, setIsFullscreen] = useState<boolean>(false);\n  const [editingAppointment, setEditingAppointment] =\n    useState<Appointment | null>(null);\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState<boolean>(false);\n  const [isOptimizing, setIsOptimizing] = useState<boolean>(false);\n  const [terminarNoPontoInicial, setTerminarNoPontoInicial] =\n    useState<boolean>(false);\n  const { toast } = useToast();\n\n  // Monitor fullscreen changes and DOM state\n  useEffect(() => {\n    const handleFullscreenChange = () => {\n      const fullscreenElement =\n        document.fullscreenElement || (document as any).webkitFullscreenElement;\n      const isNowFullscreen = !!fullscreenElement;\n      console.log(\"üñºÔ∏è [DEBUG] Fullscreen changed:\", isNowFullscreen);\n      setIsFullscreen(isNowFullscreen);\n    };\n\n    document.addEventListener(\"fullscreenchange\", handleFullscreenChange);\n    document.addEventListener(\"webkitfullscreenchange\", handleFullscreenChange);\n\n    // Check initial fullscreen state\n    handleFullscreenChange();\n\n    return () => {\n      document.removeEventListener(\"fullscreenchange\", handleFullscreenChange);\n      document.removeEventListener(\n        \"webkitfullscreenchange\",\n        handleFullscreenChange,\n      );\n    };\n  }, []);\n\n  // Log component mount and render state\n  useEffect(() => {\n    console.log(\"üîÑ [DEBUG] Routes component mounted/updated\");\n    console.log(\n      \"üîÑ [DEBUG] Selected appointments:\",\n      selectedAppointments.length,\n    );\n    console.log(\"üîÑ [DEBUG] Optimized route:\", !!optimizedRoute);\n    console.log(\"üîÑ [DEBUG] Is fullscreen:\", isFullscreen);\n  });\n\n  // Fetch user data to get plan information\n  const { data: user } = useQuery({\n    queryKey: [\"/api/auth/me\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/auth/me\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const { data: appointments = [] } = useQuery({\n    queryKey: [\"/api/appointments\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/appointments\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const { data: clients = [] } = useQuery({\n    queryKey: [\"/api/clients\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/clients\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const { data: services = [] } = useQuery({\n    queryKey: [\"/api/services\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/services\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const { data: technicians = [] } = useQuery({\n    queryKey: [\"/api/technicians\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/technicians\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const { data: teams = [] } = useQuery({\n    queryKey: [\"/api/teams\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/teams\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  // Query para buscar regras de neg√≥cio (endere√ßo da empresa)\n  const { data: businessRules } = useQuery({\n    queryKey: [\"/api/business-rules\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/business-rules\", {\n        headers: getAuthHeaders(),\n      });\n      if (!response.ok) return null;\n      return response.json();\n    },\n  });\n\n  const optimizeRouteMutation = useMutation({\n    mutationFn: async (appointmentIds: number[]): Promise<OptimizedRoute> => {\n      if (appointmentIds.length === 0) {\n        throw new Error(\n          \"Selecione pelo menos um agendamento para otimizar a rota\",\n        );\n      }\n\n      try {\n        const response = await fetch(\"/api/gerar-rota\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            ...getAuthHeaders(),\n          },\n          body: JSON.stringify({ appointmentIds }),\n        });\n\n        if (!response.ok) {\n          throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n        }\n\n        const data = await response.json();\n        return data as OptimizedRoute;\n      } catch (error) {\n        console.error(\"Erro ao otimizar rota:\", error);\n        throw error;\n      }\n    },\n    onSuccess: (data: OptimizedRoute) => {\n      setOptimizedRoute(data);\n      toast({\n        title: \"Rota otimizada com sucesso!\",\n        description: `Rota gerada com ${data.optimizedOrder.length} paradas`,\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao otimizar rota\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleAppointmentToggle = (appointmentId: number) => {\n    setSelectedAppointments((prev) =>\n      prev.includes(appointmentId)\n        ? prev.filter((id) => id !== appointmentId)\n        : [...prev, appointmentId],\n    );\n  };\n\n  // Handle select all appointments with plan limits\n  const handleSelectAllAppointments = () => {\n    console.log(\"üìã [DEBUG] handleSelectAllAppointments chamado\");\n\n    if (!user) {\n      console.log(\"‚ùå [DEBUG] Dados do usu√°rio n√£o carregados\");\n      return;\n    }\n\n    const planLimits = getPlanLimits(user.plan);\n\n    // Get all filtered appointments as a flat array\n    const allFilteredAppointments: Appointment[] = [];\n    for (const dayAppointments of Object.values(\n      filteredAndGroupedAppointments,\n    )) {\n      allFilteredAppointments.push(...(dayAppointments as Appointment[]));\n    }\n    const availableAppointmentIds = allFilteredAppointments.map(\n      (apt: Appointment) => apt.id,\n    );\n\n    console.log(\n      \"üìã [DEBUG] Total de agendamentos filtrados:\",\n      availableAppointmentIds.length,\n    );\n    console.log(\"üìã [DEBUG] Plano do usu√°rio:\", user.plan);\n    console.log(\n      \"üìã [DEBUG] Limite m√°ximo do plano:\",\n      planLimits.maxRouteAddresses,\n    );\n    console.log(\n      \"üìã [DEBUG] Agendamentos atualmente selecionados:\",\n      selectedAppointments,\n    );\n\n    if (availableAppointmentIds.length === 0) {\n      toast({\n        title: \"Aten√ß√£o\",\n        description: \"Nenhum agendamento encontrado com os filtros aplicados\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    // Verificar se todos os agendamentos dispon√≠veis j√° est√£o selecionados\n    const maxToSelect = Math.min(\n      availableAppointmentIds.length,\n      planLimits.maxRouteAddresses,\n    );\n    const appointmentsToSelect = availableAppointmentIds.slice(0, maxToSelect);\n    const allSelected = appointmentsToSelect.every((id) =>\n      selectedAppointments.includes(id),\n    );\n\n    if (allSelected && selectedAppointments.length > 0) {\n      // Desmarcar todos\n      console.log(\"üìã [DEBUG] Desmarcando todos os agendamentos\");\n      setSelectedAppointments([]);\n      toast({\n        title: \"Agendamentos Desmarcados\",\n        description: \"Todos os agendamentos foram desmarcados\",\n        variant: \"default\",\n      });\n    } else {\n      // Selecionar todos (at√© o limite do plano)\n      console.log(\n        \"üìã [DEBUG] Selecionando agendamentos:\",\n        appointmentsToSelect.length,\n      );\n      console.log(\"üìã [DEBUG] IDs selecionados:\", appointmentsToSelect);\n\n      setSelectedAppointments(appointmentsToSelect);\n\n      // Show message if limit was reached\n      if (availableAppointmentIds.length > planLimits.maxRouteAddresses) {\n        toast({\n          title: \"Limite do Plano Atingido\",\n          description: `Foram selecionados apenas ${maxToSelect} agendamentos devido ao limite do seu plano. Para aumentar seu limite, fa√ßa upgrade do plano.`,\n          variant: \"default\",\n        });\n        console.log(\n          \"‚ö†Ô∏è [DEBUG] Limite do plano atingido, mostrando mensagem para o usu√°rio\",\n        );\n      } else {\n        toast({\n          title: \"Agendamentos Selecionados\",\n          description: `${appointmentsToSelect.length} agendamentos foram selecionados`,\n          variant: \"default\",\n        });\n      }\n    }\n  };\n\n  // Handle edit appointment\n  const handleEditAppointment = (appointment: Appointment) => {\n    console.log(\"‚úèÔ∏è [DEBUG] Abrindo edi√ß√£o para agendamento:\", appointment.id);\n    console.log(\"‚úèÔ∏è [DEBUG] Dados do agendamento:\", appointment);\n    setEditingAppointment(appointment);\n    setIsEditDialogOpen(true);\n  };\n\n  const handleCloseEditDialog = () => {\n    console.log(\"‚úèÔ∏è [DEBUG] Fechando di√°logo de edi√ß√£o\");\n    setEditingAppointment(null);\n    setIsEditDialogOpen(false);\n  };\n\n  const queryClient = useQueryClient();\n\n  const handleAppointmentUpdated = () => {\n    console.log(\"‚úÖ [DEBUG] Agendamento atualizado com sucesso\");\n    handleCloseEditDialog();\n\n    // Invalidate queries to refresh data\n    queryClient.invalidateQueries({ queryKey: [\"/api/appointments\"] });\n\n    toast({\n      title: \"Agendamento Atualizado\",\n      description:\n        \"O agendamento foi atualizado com sucesso na tela de roteiriza√ß√£o\",\n      variant: \"default\",\n    });\n  };\n\n  // Fun√ß√£o para determinar o endere√ßo de in√≠cio correto (incluindo CEP)\n  const getStartAddress = (appointment: Appointment) => {\n    let entity = null;\n\n    if (appointment.technicianId) {\n      entity = technicians.find(\n        (t: Technician) => t.id === appointment.technicianId,\n      );\n    } else if (appointment.teamId) {\n      entity = teams.find((t: Team) => t.id === appointment.teamId);\n    }\n\n    // Se h√° entidade (t√©cnico ou equipe), verificar se tem endere√ßo de in√≠cio pr√≥prio\n    if (entity) {\n      const hasOwnStartAddress =\n        entity.enderecoInicioCep &&\n        entity.enderecoInicioLogradouro &&\n        entity.enderecoInicioBairro &&\n        entity.enderecoInicioCidade &&\n        entity.enderecoInicioEstado;\n\n      if (hasOwnStartAddress) {\n        const numero = entity.enderecoInicioNumero\n          ? `, ${entity.enderecoInicioNumero}`\n          : \"\";\n        const complemento = entity.enderecoInicioComplemento\n          ? `, ${entity.enderecoInicioComplemento}`\n          : \"\";\n        // Inclui o CEP na montagem do endere√ßo\n        return `${entity.enderecoInicioLogradouro}${numero}${complemento}, ${entity.enderecoInicioBairro}, ${entity.enderecoInicioCidade}, ${entity.enderecoInicioCep}, ${entity.enderecoInicioEstado}, Brasil`;\n      }\n    }\n\n    // Usar endere√ßo da empresa como fallback\n    if (businessRules) {\n      const numero = businessRules.enderecoEmpresaNumero\n        ? `, ${businessRules.enderecoEmpresaNumero}`\n        : \"\";\n      const complemento = businessRules.enderecoEmpresaComplemento\n        ? `, ${businessRules.enderecoEmpresaComplemento}`\n        : \"\";\n      // Inclui o CEP na montagem do endere√ßo\n      return `${businessRules.enderecoEmpresaLogradouro}${numero}${complemento}, ${businessRules.enderecoEmpresaBairro}, ${businessRules.enderecoEmpresaCidade}, ${businessRules.enderecoEmpresaCep}, ${businessRules.enderecoEmpresaEstado}, Brasil`;\n    }\n\n    throw new Error(\n      \"Endere√ßo de in√≠cio n√£o configurado - configure o endere√ßo da empresa nas Regras de Neg√≥cio\",\n    );\n  };\n\n  const handleOptimizeRoute = async () => {\n    if (selectedAppointments.length === 0) {\n      toast({\n        title: \"Aten√ß√£o\",\n        description: \"Selecione pelo menos um agendamento para otimizar a rota\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setIsOptimizing(true);\n\n    try {\n      console.log(\"üöÄ Iniciando otimiza√ß√£o de rota...\");\n\n      // 1. Verificar se dados necess√°rios est√£o carregados\n      if (!businessRules) {\n        throw new Error(\n          \"Regras de neg√≥cio n√£o carregadas - endere√ßo da empresa necess√°rio\",\n        );\n      }\n\n      // 2. Pegue os agendamentos selecionados completos\n      const selecionados = appointments.filter((apt: Appointment) =>\n        selectedAppointments.includes(apt.id),\n      );\n      console.log(\"üìã Agendamentos selecionados:\", selecionados.length);\n\n      // 3. Determinar entidade (t√©cnico ou equipe) para o primeiro agendamento\n      const firstAppointment = selecionados[0];\n      let entity = null;\n\n      if (firstAppointment.technicianId) {\n        entity = technicians.find(\n          (t: Technician) => t.id === firstAppointment.technicianId,\n        );\n      } else if (firstAppointment.teamId) {\n        entity = teams.find((t: Team) => t.id === firstAppointment.teamId);\n      }\n\n      console.log(\"üë§ Entidade determinada:\", entity?.name || \"Nenhuma\");\n\n      // 4. Validar campos obrigat√≥rios para geocodifica√ß√£o de destinos\n      console.log(\"üîç Validando campos obrigat√≥rios dos destinos...\");\n      for (let i = 0; i < selecionados.length; i++) {\n        const apt = selecionados[i];\n        const cliente = getClient(apt.clientId);\n\n        // Verificar campos obrigat√≥rios para geocodifica√ß√£o robusta\n        if (!apt.bairro) {\n          throw new Error(\n            `Agendamento ${i + 1} (${cliente?.name || \"Cliente desconhecido\"}): Campo BAIRRO √© obrigat√≥rio para geocodifica√ß√£o. Configure no agendamento.`,\n          );\n        }\n        if (!apt.cidade) {\n          throw new Error(\n            `Agendamento ${i + 1} (${cliente?.name || \"Cliente desconhecido\"}): Campo CIDADE √© obrigat√≥rio para geocodifica√ß√£o. Configure no agendamento.`,\n          );\n        }\n        if (!apt.logradouro) {\n          throw new Error(\n            `Agendamento ${i + 1} (${cliente?.name || \"Cliente desconhecido\"}): Campo LOGRADOURO √© obrigat√≥rio para geocodifica√ß√£o. Configure no agendamento.`,\n          );\n        }\n      }\n\n      // 5. Monte o endere√ßo COMPLETO para cada agendamento\n      const enderecosDestino = selecionados.map((apt: Appointment) => {\n        // Montar endere√ßo completo: logradouro, numero, bairro, cidade, cep, estado, Brasil\n        const endereco = [\n          apt.logradouro,\n          apt.numero,\n          apt.bairro,\n          apt.cidade,\n          apt.cep,\n          \"PR\", // Estado padr√£o PR\n          \"Brasil\",\n        ]\n          .filter(Boolean)\n          .join(\", \");\n\n        return endereco;\n      });\n\n      // 6. Geocodificar endere√ßo de in√≠cio com fallbacks\n      console.log(\"üåç Geocodificando endere√ßo de in√≠cio com fallbacks...\");\n      const coordenadaInicio = await geocodeComFallbacks(entity, businessRules);\n      console.log(\"‚úÖ Coordenada de in√≠cio:\", coordenadaInicio);\n\n      // Capturar endere√ßo de in√≠cio formatado para exibi√ß√£o\n      const enderecoInicioFormatado = getStartAddress(selecionados[0]);\n\n      // 7. Geocodificar todos os destinos com logs detalhados\n      console.log(\"üåç Geocodificando destinos...\");\n      const coordenadasDestino = [];\n      for (let i = 0; i < enderecosDestino.length; i++) {\n        const endereco = enderecosDestino[i];\n        const cliente = getClient(selecionados[i].clientId);\n\n        console.log(`üìç Endere√ßo para geocodifica√ß√£o:`, endereco);\n\n        try {\n          const coord = await geocodeEndereco(endereco);\n          coordenadasDestino.push(coord);\n          console.log(`‚úÖ Coordenada encontrada:`, endereco, coord);\n          console.log(\n            `‚úÖ Destino ${i + 1} (${cliente?.name || \"Desconhecido\"}) geocodificado:`,\n            coord,\n          );\n        } catch (error: any) {\n          console.warn(`‚ùå Geocodifica√ß√£o FALHOU para:`, endereco);\n          console.error(\n            `‚ùå Erro ao geocodificar destino ${i + 1} (${cliente?.name || \"Desconhecido\"}):`,\n            endereco,\n            error,\n          );\n          throw new Error(\n            `Erro ao geocodificar endere√ßo: ${endereco}. ${error.message || error}`,\n          );\n        }\n      }\n\n      // 8. Montar array final de coordenadas (in√≠cio + destinos)\n      const todasCoordenadas = [coordenadaInicio, ...coordenadasDestino];\n      console.log(\"üìç Todas as coordenadas para otimiza√ß√£o:\", todasCoordenadas);\n\n      // 9. Validar que temos pelo menos 2 pontos\n      if (todasCoordenadas.length < 2) {\n        throw new Error(\n          \"S√£o necess√°rias pelo menos 2 coordenadas (in√≠cio + 1 destino) para otimizar uma rota\",\n        );\n      }\n\n      // 10. Montar array de coordenadas no formato [lon, lat]\n      const coordsArray = todasCoordenadas.map((coord) => [\n        coord.lon,\n        coord.lat,\n      ]);\n      console.log(\"üìç Coordenadas formatadas para backend:\", coordsArray);\n\n      // 11. Chama backend para gerar matriz de dura√ß√µes\n      console.log(\"üéØ Enviando coordenadas para /api/rota/matrix...\");\n      const matrixRes = await fetch(\"/api/rota/matrix\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ coords: coordsArray }),\n      });\n      if (!matrixRes.ok) {\n        const errorText = await matrixRes.text();\n        throw new Error(\"Erro ao calcular matriz: \" + errorText);\n      }\n      const matrixData = await matrixRes.json();\n      console.log(\"‚úÖ Matriz de dura√ß√µes recebida:\", matrixData);\n\n      // 12. Resolve TSP (ordem √≥tima)\n      console.log(\"üß† Enviando matriz para /api/rota/tsp...\");\n      const tspRes = await fetch(\"/api/rota/tsp\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          matrix: matrixData.matrix,\n          terminarNoPontoInicial, // este campo novo!\n        }),\n      });\n      if (!tspRes.ok) {\n        const errorText = await tspRes.text();\n        throw new Error(\"Erro ao otimizar rota: \" + errorText);\n      }\n      const tspData = await tspRes.json();\n      console.log(\"‚úÖ Ordem otimizada recebida:\", tspData);\n\n      // 13. Aplica a ordem ao array de agendamentos\n      const agendamentosOtimizados = tspData.order\n        .filter((idx: number) => idx > 0)\n        .map((idx: number) => selecionados[idx - 1]); // -1 porque selecionados[0] corresponde ao destino 1\n\n      console.log(\n        \"üìã Agendamentos reordenados conforme otimiza√ß√£o:\",\n        agendamentosOtimizados.length,\n      );\n\n      // 14. Calcular tempo e dist√¢ncia exatos usando as matrizes OSRM\n      const matrixDurations = matrixData.durations || matrixData.matrix; // fallback para compatibilidade\n      const matrixDistances = matrixData.distances;\n      const tspOrder = tspData.order;\n\n      let totalTime = 0;\n      let totalDistance = 0;\n      const routeSteps: RouteStep[] = [];\n\n      console.log(\"üßÆ Calculando tempos e dist√¢ncias exatos...\");\n      console.log(\"Ordem TSP:\", tspOrder);\n      console.log(\"Matriz dura√ß√µes:\", matrixDurations);\n      console.log(\"Matriz dist√¢ncias:\", matrixDistances);\n\n      // Incluir trecho do in√≠cio (√≠ndice 0) at√© o primeiro ponto na soma total\n      if (tspOrder.length > 1) {\n        const startToFirstTimeSec = matrixDurations[0][tspOrder[1]];\n        const startToFirstDistM = matrixDistances\n          ? matrixDistances[0][tspOrder[1]]\n          : 0;\n\n        totalTime += startToFirstTimeSec;\n        totalDistance += startToFirstDistM;\n\n        console.log(\n          `üìç In√≠cio at√© primeiro ponto inclu√≠do nos totais: ${(startToFirstDistM / 1000).toFixed(1)} km / ${Math.round(startToFirstTimeSec / 60)} min`,\n        );\n      }\n\n      // Calcular para cada trecho da rota otimizada (entre os pontos da sequ√™ncia)\n      for (let i = 1; i < tspOrder.length; i++) {\n        const from = tspOrder[i - 1];\n        const to = tspOrder[i];\n\n        const timeSec = matrixDurations[from][to];\n        const distM = matrixDistances ? matrixDistances[from][to] : 0;\n\n        totalTime += timeSec;\n        totalDistance += distM;\n\n        // Formatar para exibi√ß√£o\n        const distanceKm = distM > 0 ? (distM / 1000).toFixed(1) + \" km\" : \"‚Äî\";\n        const durationMin =\n          timeSec > 0 ? Math.round(timeSec / 60) + \" min\" : \"‚Äî\";\n\n        routeSteps.push({\n          appointmentIndex: i - 1, // √≠ndice no array agendamentosOtimizados\n          distance: distanceKm,\n          duration: durationMin,\n          distanceMeters: distM,\n          durationSeconds: timeSec,\n        });\n\n        console.log(\n          `üìç Trecho ${i}: de ${from} para ${to} = ${distanceKm} / ${durationMin}`,\n        );\n      }\n\n      // Formatar totais\n      const totalTimeFormatted =\n        totalTime > 0\n          ? `${Math.floor(totalTime / 3600)}h ${Math.round((totalTime % 3600) / 60)}min`\n          : \"0min\";\n\n      const totalDistanceFormatted =\n        totalDistance > 0 ? (totalDistance / 1000).toFixed(1) : \"0\";\n\n      // Calcular dist√¢ncia e tempo do in√≠cio ao primeiro ponto\n      const firstPointIndex = tspOrder.length > 1 ? tspOrder[1] : null;\n      let startToFirstDistance = \"‚Äî\";\n      let startToFirstDuration = \"‚Äî\";\n\n      if (firstPointIndex !== null) {\n        const startToFirstTimeSec = matrixDurations[0][firstPointIndex];\n        const startToFirstDistM = matrixDistances\n          ? matrixDistances[0][firstPointIndex]\n          : 0;\n\n        startToFirstDistance =\n          startToFirstDistM > 0\n            ? (startToFirstDistM / 1000).toFixed(1) + \" km\"\n            : \"‚Äî\";\n        startToFirstDuration =\n          startToFirstTimeSec > 0\n            ? Math.round(startToFirstTimeSec / 60) + \" min\"\n            : \"‚Äî\";\n\n        console.log(\n          `üìç In√≠cio at√© primeiro ponto: ${startToFirstDistance} / ${startToFirstDuration}`,\n        );\n      }\n\n      console.log(\"üìä Totais calculados:\");\n      console.log(`- Tempo total: ${totalTimeFormatted} (${totalTime}s)`);\n      console.log(\n        `- Dist√¢ncia total: ${totalDistanceFormatted} km (${totalDistance}m)`,\n      );\n\n      // 15. Atualize a tela com a rota otimizada!\n      setOptimizedRoute({\n        optimizedOrder: agendamentosOtimizados,\n        totalDistance: parseFloat(totalDistanceFormatted),\n        estimatedTime: Math.round(totalTime / 60), // em minutos\n        geojson: null,\n        routeSteps: routeSteps,\n        matrixDurations: matrixDurations,\n        matrixDistances: matrixDistances,\n        tspOrder: tspOrder,\n        startAddress: enderecoInicioFormatado,\n        startToFirstDistance: startToFirstDistance,\n        startToFirstDuration: startToFirstDuration,\n      });\n\n      toast({\n        title: \"Rota otimizada com sucesso!\",\n        description: `Rota calculada com ${agendamentosOtimizados.length} paradas.`,\n      });\n\n      console.log(\"‚úÖ Otimiza√ß√£o conclu√≠da com sucesso!\");\n    } catch (error: any) {\n      console.error(\"‚ùå Erro na otimiza√ß√£o:\", error);\n      toast({\n        title: \"Erro\",\n        description: `Falha ao otimizar rota: ${error.message || error}`,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsOptimizing(false);\n    }\n  };\n\n  const getClient = (clientId: number | null) =>\n    clientId ? clients.find((c: Client) => c.id === clientId) : null;\n  const getService = (serviceId: number) =>\n    services.find((s: Service) => s.id === serviceId);\n  const getTechnician = (technicianId: number | null) =>\n    technicianId\n      ? technicians.find((t: Technician) => t.id === technicianId)\n      : null;\n\n  const formatDateTime = (dateString: string) => {\n    const date = new Date(dateString);\n    return {\n      date: date.toLocaleDateString(\"pt-BR\"),\n      time: date.toLocaleTimeString(\"pt-BR\", {\n        hour: \"2-digit\",\n        minute: \"2-digit\",\n      }),\n    };\n  };\n\n  // Filter and organize appointments\n  const filteredAndGroupedAppointments = useMemo(() => {\n    let filtered = appointments.filter((apt: Appointment) => {\n      // Filter by date\n      const appointmentDate = new Date(apt.scheduledDate);\n      const localDate = new Date(\n        appointmentDate.getTime() - appointmentDate.getTimezoneOffset() * 60000,\n      )\n        .toISOString()\n        .split(\"T\")[0];\n      if (selectedDate && localDate !== selectedDate) return false;\n\n      // Filter by search term (client name)\n      if (searchTerm) {\n        const client = getClient(apt.clientId);\n        if (!client?.name.toLowerCase().includes(searchTerm.toLowerCase()))\n          return false;\n      }\n\n      // Filter by service\n      if (selectedService && selectedService !== \"all\") {\n        const service = getService(apt.serviceId);\n        if (service?.id.toString() !== selectedService) return false;\n      }\n\n      // Filter by technician/team\n      if (selectedTechnician && selectedTechnician !== \"all\") {\n        console.log(\n          `üîç [DEBUG] Filtro aplicado - selectedTechnician: ${selectedTechnician}, apt.technicianId: ${apt.technicianId}, apt.teamId: ${apt.teamId}`,\n        );\n\n        // Verificar se √© um t√©cnico individual\n        const technician = getTechnician(apt.technicianId);\n        const isMatchingTechnician =\n          technician?.id.toString() === selectedTechnician;\n\n        // Verificar se √© uma equipe (o valor vem como \"team-{id}\")\n        const team = teams.find((t: any) => t.id === apt.teamId);\n        const isMatchingTeam = team && selectedTechnician === `team-${team.id}`;\n\n        console.log(\n          `üîç [DEBUG] isMatchingTechnician: ${isMatchingTechnician}, isMatchingTeam: ${isMatchingTeam}, team:`,\n          team?.name,\n        );\n\n        if (!isMatchingTechnician && !isMatchingTeam) return false;\n      }\n\n      // Filter by status\n      if (selectedStatus && selectedStatus !== \"all\") {\n        console.log(\n          `üîç [DEBUG] Filtro de status aplicado - selectedStatus: ${selectedStatus}, apt.status: ${apt.status}`,\n        );\n        if (apt.status !== selectedStatus) {\n          console.log(`üîç [DEBUG] Agendamento ${apt.id} filtrado por status`);\n          return false;\n        }\n      }\n\n      return true;\n    });\n\n    // Group by date\n    const grouped = filtered.reduce(\n      (acc: Record<string, Appointment[]>, apt: Appointment) => {\n        const date = new Date(apt.scheduledDate).toLocaleDateString(\"pt-BR\");\n        if (!acc[date]) {\n          acc[date] = [];\n        }\n        acc[date].push(apt);\n        return acc;\n      },\n      {} as Record<string, Appointment[]>,\n    );\n\n    // Sort appointments within each day by time\n    Object.keys(grouped).forEach((date) => {\n      grouped[date].sort(\n        (a: Appointment, b: Appointment) =>\n          new Date(a.scheduledDate).getTime() -\n          new Date(b.scheduledDate).getTime(),\n      );\n    });\n\n    return grouped;\n  }, [\n    appointments,\n    selectedDate,\n    searchTerm,\n    selectedService,\n    selectedTechnician,\n    selectedStatus,\n    clients,\n    services,\n    technicians,\n  ]);\n\n  return (\n    <div className={`space-y-6 ${isFullscreen ? \"min-h-screen p-4\" : \"\"}`}>\n      {/* Header */}\n      <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n        <div className=\"flex-1\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">Roteiriza√ß√£o</h1>\n          <p className=\"text-gray-600\">\n            Otimize as rotas dos seus atendimentos t√©cnicos\n          </p>\n        </div>\n      </div>\n\n      {/* Filters */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center\">\n            <Filter className=\"h-5 w-5 mr-2\" />\n            Filtros\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Data</label>\n              <Input\n                type=\"date\"\n                value={selectedDate}\n                onChange={(e) => setSelectedDate(e.target.value)}\n                className=\"w-full\"\n              />\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">\n                Buscar Cliente\n              </label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n                <Input\n                  placeholder=\"Nome do cliente...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Servi√ßo</label>\n              <Select\n                value={selectedService}\n                onValueChange={setSelectedService}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Todos os servi√ßos\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Todos os servi√ßos</SelectItem>\n                  {services.map((service: Service) => (\n                    <SelectItem key={service.id} value={service.id.toString()}>\n                      {service.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">\n                T√©cnicos/Equipes\n              </label>\n              <Select\n                value={selectedTechnician}\n                onValueChange={setSelectedTechnician}\n              >\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Todos os t√©cnicos e equipes\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">\n                    Todos os t√©cnicos e equipes\n                  </SelectItem>\n                  {technicians.map((technician: Technician) => (\n                    <SelectItem\n                      key={`tech-${technician.id}`}\n                      value={technician.id.toString()}\n                    >\n                      üë§ {technician.name}\n                    </SelectItem>\n                  ))}\n                  {teams.map((team: any) => (\n                    <SelectItem\n                      key={`team-${team.id}`}\n                      value={`team-${team.id}`}\n                    >\n                      üë• {team.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Status</label>\n              <Select value={selectedStatus} onValueChange={setSelectedStatus}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"Todos os status\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Todos os status</SelectItem>\n                  <SelectItem value=\"scheduled\">Agendado</SelectItem>\n                  <SelectItem value=\"in_progress\">Em Andamento</SelectItem>\n                  <SelectItem value=\"completed\">Conclu√≠do</SelectItem>\n                  <SelectItem value=\"cancelled\">Cancelado</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Op√ß√£o \"Terminar no ponto inicial\" */}\n            <div className=\"col-span-full pt-4 border-t border-gray-100\">\n              <Card className=\"p-4 mb-3 border-2 border-dashed border-burnt-yellow bg-burnt-yellow/5 rounded-2xl shadow-sm\">\n                <div className=\"flex items-center gap-3\">\n                  <Checkbox\n                    id=\"terminarNoPontoInicial\"\n                    checked={terminarNoPontoInicial}\n                    onCheckedChange={(checked) =>\n                      setTerminarNoPontoInicial(checked === true)\n                    }\n                    className=\"w-5 h-5 data-[state=checked]:bg-burnt-yellow data-[state=checked]:border-burnt-yellow\"\n                  />\n                  <label\n                    htmlFor=\"terminarNoPontoInicial\"\n                    className=\"font-medium text-base flex items-center gap-2 cursor-pointer\"\n                  >\n                    <Repeat2 className=\"text-burnt-yellow w-5 h-5\" />\n                    Terminar no ponto inicial\n                  </label>\n                </div>\n              </Card>\n\n              <p className=\"text-xs text-gray-500 ml-1 mb-4\">\n                {terminarNoPontoInicial\n                  ? \"A rota ir√° terminar no mesmo local de in√≠cio. Ideal para t√©cnicos que voltam √† empresa.\"\n                  : \"A rota termina no cliente mais distante. Ideal para t√©cnicos que encerram o dia no √∫ltimo cliente.\"}\n              </p>\n\n              <div className=\"flex flex-col sm:flex-row gap-3\">\n                <Button\n                  onClick={handleSelectAllAppointments}\n                  disabled={\n                    !user ||\n                    Object.keys(filteredAndGroupedAppointments).length === 0\n                  }\n                  variant=\"outline\"\n                  className=\"flex-1 sm:flex-none\"\n                  type=\"button\"\n                >\n                  <CheckSquare className=\"h-4 w-4 mr-2\" />\n                  Selecionar Todos\n                </Button>\n\n                <Button\n                  onClick={handleOptimizeRoute}\n                  disabled={selectedAppointments.length === 0 || isOptimizing}\n                  className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white flex-1 sm:flex-none\"\n                  type=\"button\"\n                >\n                  {isOptimizing ? (\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />\n                  ) : (\n                    <Route className=\"h-4 w-4 mr-2\" />\n                  )}\n                  Otimizar Rota\n                </Button>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div\n        className=\"flex gap-6 items-stretch max-h-[1000px]\">\n        {/* Appointments Selection */}\n        <Card className=\"flex flex-col flex-1 w-1/2 max-h-[1000px]\">\n          <CardHeader className=\"border-b border-gray-100 flex-shrink-0\">\n            <CardTitle className=\"flex items-center\">\n              <MapPin className=\"h-5 w-5 mr-2 text-burnt-yellow\" />\n              Selecionar Atendimentos\n            </CardTitle>\n            <p className=\"text-sm text-gray-600\">\n              Escolha os atendimentos para incluir na rota (\n              {selectedAppointments.length} selecionados)\n            </p>\n          </CardHeader>\n          <CardContent className=\"p-6 flex flex-col flex-1 overflow-hidden\">\n            {Object.keys(filteredAndGroupedAppointments).length === 0 ? (\n              <div className=\"text-center py-8 flex-1 flex flex-col justify-center min-h-[300px]\">\n                <Route className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <p className=\"text-gray-600\">Nenhum agendamento encontrado</p>\n                <p className=\"text-sm text-gray-500 mt-2\">\n                  Ajuste os filtros para ver os agendamentos dispon√≠veis\n                </p>\n              </div>\n            ) : (\n              <div className=\"space-y-6 flex-1 overflow-y-auto pr-2\">\n                {Object.entries(filteredAndGroupedAppointments).map(\n                  ([date, dayAppointments]) => (\n                    <div key={date}>\n                      <div className=\"flex items-center mb-3\">\n                        <Calendar className=\"h-4 w-4 mr-2 text-burnt-yellow\" />\n                        <h3 className=\"font-semibold text-gray-900\">{date}</h3>\n                        <span className=\"ml-2 text-sm text-gray-500\">\n                          ({(dayAppointments as Appointment[]).length}{\" \"}\n                          agendamentos)\n                        </span>\n                      </div>\n                      <div className=\"space-y-3 pl-6\">\n                        {(dayAppointments as Appointment[]).map(\n                          (appointment: Appointment) => {\n                            const client = getClient(appointment.clientId);\n                            const service = getService(appointment.serviceId);\n\n                            // Corrigir busca de t√©cnico/equipe respons√°vel\n                            let responsibleInfo = {\n                              name: \"Respons√°vel n√£o atribu√≠do\",\n                              type: \"none\",\n                            };\n\n                            if (appointment.technicianId) {\n                              const technician = getTechnician(\n                                appointment.technicianId,\n                              );\n                              responsibleInfo = {\n                                name:\n                                  technician?.name || \"T√©cnico n√£o encontrado\",\n                                type: \"technician\",\n                              };\n                              console.log(\n                                `üë§ [DEBUG] Card ${appointment.id} - T√©cnico:`,\n                                technician?.name,\n                                \"ID:\",\n                                appointment.technicianId,\n                              );\n                            } else if (appointment.teamId) {\n                              const team = teams.find(\n                                (t: any) => t.id === appointment.teamId,\n                              );\n                              responsibleInfo = {\n                                name: team?.name || \"Equipe n√£o encontrada\",\n                                type: \"team\",\n                              };\n                              console.log(\n                                `üë• [DEBUG] Card ${appointment.id} - Equipe:`,\n                                team?.name,\n                                \"ID:\",\n                                appointment.teamId,\n                              );\n                            }\n\n                            const { time } = formatDateTime(\n                              appointment.scheduledDate.toString(),\n                            );\n                            const isSelected = selectedAppointments.includes(\n                              appointment.id,\n                            );\n\n                            return (\n                              <div\n                                key={appointment.id}\n                                className={`relative flex items-center space-x-4 p-3 border rounded-lg transition-colors\n                              ${\n                                isSelected\n                                  ? \"border-burnt-yellow bg-burnt-yellow bg-opacity-5\"\n                                  : \"border-gray-200 hover:bg-gray-50\"\n                              }`}\n                              >\n                                <div\n                                  className=\"flex items-center space-x-4 flex-1 cursor-pointer\"\n                                  onClick={() =>\n                                    handleAppointmentToggle(appointment.id)\n                                  }\n                                >\n                                  <Checkbox\n                                    checked={isSelected}\n                                    onCheckedChange={() =>\n                                      handleAppointmentToggle(appointment.id)\n                                    }\n                                    className=\"text-burnt-yellow\"\n                                  />\n                                  <div className=\"flex-1\">\n                                    <div className=\"flex items-center justify-between mb-1\">\n                                      <h4 className=\"font-medium text-gray-900\">\n                                        {client?.name || \"Cliente\"}\n                                      </h4>\n                                      <span className=\"text-sm text-gray-500\">\n                                        {time}\n                                      </span>\n                                    </div>\n                                    <p className=\"text-sm text-gray-600\">\n                                      {service?.name || \"Servi√ßo\"}\n                                    </p>\n                                    <p className=\"text-xs text-gray-500\">\n                                      {client ? (\n                                        `${client.logradouro}, ${client.numero}, ${client.bairro}, ${client.cidade} - ${client.cep}`\n                                      ) : (\n                                        <span className=\"text-red-600\">\n                                          Endere√ßo n√£o encontrado\n                                        </span>\n                                      )}\n                                    </p>\n                                    <div className=\"flex items-center justify-between mt-1 pr-10\">\n                                      <div className=\"flex items-center\">\n                                        <span className=\"text-xs text-gray-500\">\n                                          {responsibleInfo.type === \"team\"\n                                            ? \"Equipe:\"\n                                            : \"T√©cnico:\"}\n                                        </span>\n                                        <span className=\"text-xs font-medium text-gray-700 ml-1\">\n                                          {responsibleInfo.type === \"team\"\n                                            ? \"üë•\"\n                                            : \"üë§\"}{\" \"}\n                                          {responsibleInfo.name}\n                                        </span>\n                                      </div>\n                                      <Badge\n                                        className={`text-xs px-2 py-1 mr-2 ${\n                                          appointment.status === \"completed\"\n                                            ? \"bg-green-100 text-green-800\"\n                                            : appointment.status ===\n                                                \"in_progress\"\n                                              ? \"bg-yellow-100 text-yellow-800\"\n                                              : appointment.status ===\n                                                  \"scheduled\"\n                                                ? \"bg-blue-100 text-blue-800\"\n                                                : appointment.status ===\n                                                    \"cancelled\"\n                                                  ? \"bg-red-100 text-red-800\"\n                                                  : \"bg-gray-100 text-gray-800\"\n                                        }`}\n                                      >\n                                        {appointment.status === \"completed\"\n                                          ? \"Conclu√≠do\"\n                                          : appointment.status === \"in_progress\"\n                                            ? \"Em Andamento\"\n                                            : appointment.status === \"scheduled\"\n                                              ? \"Agendado\"\n                                              : appointment.status ===\n                                                  \"cancelled\"\n                                                ? \"Cancelado\"\n                                                : appointment.status}\n                                      </Badge>\n                                    </div>\n                                  </div>\n                                </div>\n\n                                {/* Edit Button - Posicionado para n√£o sobrepor o status */}\n                                <Button\n                                  size=\"sm\"\n                                  variant=\"ghost\"\n                                  className=\"absolute bottom-2 right-2 h-6 w-6 p-0 hover:bg-burnt-yellow hover:text-white\"\n                                  onClick={(e) => {\n                                    e.stopPropagation();\n                                    console.log(\n                                      \"‚úèÔ∏è [DEBUG] Bot√£o de edi√ß√£o clicado - Reposicionamento aplicado para n√£o sobrepor status\",\n                                    );\n                                    handleEditAppointment(appointment);\n                                  }}\n                                >\n                                  <Edit className=\"h-3 w-3\" />\n                                </Button>\n                              </div>\n                            );\n                          },\n                        )}\n                      </div>\n                    </div>\n                  ),\n                )}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Optimized Route */}\n        <Card className=\"flex flex-col flex-1 w-1/2 max-h-[1000px]\">\n          <CardHeader className=\"border-b border-gray-100 flex-shrink-0\">\n            <div className=\"flex items-center justify-between\">\n              <CardTitle className=\"flex items-center\">\n                <Navigation className=\"h-5 w-5 mr-2 text-burnt-yellow\" />\n                Rota Otimizada\n              </CardTitle>\n              {optimizedRoute && (\n                <div className=\"flex flex-col items-end\">\n                  <span className=\"text-sm text-gray-600\">\n                    Dist√¢ncia total:{\" \"}\n                    <span className=\"text-blue-600 font-semibold\">\n                      {optimizedRoute.totalDistance} km\n                    </span>\n                  </span>\n                  <span className=\"text-sm text-gray-600\">\n                    Tempo total estimado:{\" \"}\n                    <span className=\"text-green-600 font-semibold\">\n                      {optimizedRoute.estimatedTime > 60\n                        ? `${Math.floor(optimizedRoute.estimatedTime / 60)}h ${optimizedRoute.estimatedTime % 60}min`\n                        : `${optimizedRoute.estimatedTime}min`}\n                    </span>\n                  </span>\n                </div>\n              )}\n            </div>\n          </CardHeader>\n          <CardContent className=\"p-6 flex flex-col flex-1 overflow-hidden\">\n            {/* Sempre mostra o loading se isOptimizing, independente se j√° existe optimizedRoute */}\n            {isOptimizing ? (\n              <div className=\"flex-1 flex items-center justify-center\">\n                <div className=\"text-center\">\n                  <Loader2 className=\"h-12 w-12 text-burnt-yellow mx-auto mb-4 animate-spin\" />\n                  <p className=\"text-lg font-medium text-gray-900 mb-2\">\n                    Otimizando rota, aguarde...\n                  </p>\n                  <p className=\"text-sm text-gray-500\">\n                    Calculando a melhor sequ√™ncia de atendimentos\n                  </p>\n                </div>\n              </div>\n            ) : optimizedRoute ? (\n              <div className=\"flex-1 flex flex-col overflow-hidden\">\n                {/* Map Placeholder */}\n                <div className=\"bg-gray-100 rounded-lg h-48 flex items-center justify-center mb-4 flex-shrink-0\">\n                  <div className=\"text-center\">\n                    <MapPin className=\"h-10 w-10 text-gray-400 mx-auto mb-3\" />\n                    <p className=\"text-gray-600 font-medium text-sm\">\n                      Mapa da rota otimizada\n                    </p>\n                    <p className=\"text-xs text-gray-500\">\n                      Integra√ß√£o com Google Maps\n                    </p>\n                  </div>\n                </div>\n\n                {/* Route Steps - Container com scroll */}\n                <div className=\"flex-1 overflow-y-auto pr-2\">\n                  <div className=\"space-y-4\">\n                    <h4 className=\"font-medium text-gray-900 flex items-center\">\n                      <Clock className=\"h-4 w-4 mr-2\" />\n                      Sequ√™ncia da Rota\n                    </h4>\n\n                  {/* Card de in√≠cio da rota */}\n                  {optimizedRoute.startAddress && (\n                    <div className=\"flex items-start space-x-4 border-b border-gray-100 pb-4\">\n                      <div className=\"w-8 h-8 bg-gray-500 rounded-full flex items-center justify-center text-white font-medium text-sm flex-shrink-0\">\n                        üìç\n                      </div>\n                      <div className=\"flex-1\">\n                        <h5 className=\"font-medium text-gray-900\">\n                          In√≠cio da rota\n                        </h5>\n                        <p className=\"text-sm text-gray-600\">\n                          {optimizedRoute.startAddress}\n                        </p>\n                        <div className=\"flex items-center space-x-4 mt-2 text-xs text-gray-500\">\n                          <span>‚Äî</span>\n                          <span className=\"text-gray-400\">‚Äî</span>\n                          <span className=\"text-gray-400\">‚Äî</span>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {optimizedRoute.optimizedOrder.map((appointment, index) => {\n                    const client = getClient(appointment.clientId);\n                    const service = getService(appointment.serviceId);\n                    const { time } = formatDateTime(\n                      appointment.scheduledDate.toString(),\n                    );\n\n                    // Pegar dados reais do trecho\n                    let distance, duration;\n\n                    if (index === 0) {\n                      // Para o primeiro ponto, usar dados do in√≠cio at√© ele\n                      distance = optimizedRoute.startToFirstDistance || \"‚Äî\";\n                      duration = optimizedRoute.startToFirstDuration || \"‚Äî\";\n                    } else {\n                      // Para os demais, usar dados do trecho anterior\n                      const routeStep = optimizedRoute.routeSteps?.[index];\n                      distance = routeStep?.distance || \"‚Äî\";\n                      duration = routeStep?.duration || \"‚Äî\";\n                    }\n\n                    return (\n                      <div\n                        key={appointment.id}\n                        className=\"flex items-start space-x-4\"\n                      >\n                        <div className=\"w-8 h-8 bg-burnt-yellow rounded-full flex items-center justify-center text-white font-medium text-sm flex-shrink-0\">\n                          {index + 1}\n                        </div>\n                        <div className=\"flex-1\">\n                          <h5 className=\"font-medium text-gray-900\">\n                            {client?.name || \"Cliente\"}\n                          </h5>\n                          <p className=\"text-sm text-gray-600\">\n                            {client.logradouro}, {client.numero},{\" \"}\n                            {client.bairro}, {client.cidade} - {client.cep}\n                          </p>\n                          <div className=\"flex items-center space-x-4 mt-2 text-xs text-gray-500\">\n                            <span>{time}</span>\n                            <span className=\"text-blue-600 font-medium\">\n                              {distance}\n                            </span>\n                            <span className=\"text-green-600 font-medium\">\n                              {duration}\n                            </span>\n                          </div>\n                        </div>\n                      </div>\n                    );\n                  })}\n                  \n                  {/* Route Summary */}\n                  <div className=\"mt-6 pt-6 border-t border-gray-200\">\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm\">\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-gray-600\">\n                          Tempo total estimado:\n                        </span>\n                        <span className=\"font-medium text-green-600\">\n                          {optimizedRoute.estimatedTime > 60\n                            ? `${Math.floor(optimizedRoute.estimatedTime / 60)}h ${optimizedRoute.estimatedTime % 60}min`\n                            : `${optimizedRoute.estimatedTime}min`}\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-gray-600\">Dist√¢ncia total:</span>\n                        <span className=\"font-medium text-blue-600\">\n                          {optimizedRoute.totalDistance} km\n                        </span>\n                      </div>\n                      <div className=\"flex items-center justify-between sm:col-span-2\">\n                        <span className=\"text-gray-600\">\n                          Economia de combust√≠vel:\n                        </span>\n                        <span className=\"font-medium text-green-600 flex items-center\">\n                          <TrendingUp className=\"h-3 w-3 mr-1\" />\n                          Rota otimizada\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            ) \n            : (\n              <div className=\"flex-1 flex flex-col justify-center items-center text-center py-8 min-h-[300px]\">\n                <Route className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <p className=\"text-gray-600\">\n                  Selecione agendamentos e clique em \"Otimizar Rota\"\n                </p>\n                <p className=\"text-sm text-gray-500 mt-2\">\n                  A rota otimizada aparecer√° aqui\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Edit Appointment Dialog */}\n      <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Editar Agendamento</DialogTitle>\n          </DialogHeader>\n          {editingAppointment && (\n            <AppointmentForm\n              appointment={editingAppointment}\n              clients={clients}\n              services={services}\n              technicians={technicians}\n              teams={teams}\n              onClose={handleCloseEditDialog}\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":62034},"client/src/pages/Services.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getAuthHeaders } from \"@/lib/auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport ServiceForm from \"@/components/forms/ServiceForm\";\nimport { Plus, Wrench, Clock, DollarSign, Edit, Trash2, FileText, Award } from \"lucide-react\";\nimport { useSafeNavigation } from \"@/hooks/useSafeNavigation\";\nimport type { Service } from \"@shared/schema\";\n\nexport default function Services() {\n  const [selectedService, setSelectedService] = useState<Service | null>(null);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Hook de navega√ß√£o segura\n  const { isSafeToOperate } = useSafeNavigation({\n    componentName: 'SERVICES',\n    modals: [\n      {\n        isOpen: isFormOpen,\n        setIsOpen: setIsFormOpen,\n        resetState: () => setSelectedService(null)\n      }\n    ]\n  });\n\n  const { data: services = [], isLoading } = useQuery({\n    queryKey: [\"/api/services\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/services\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const deleteServiceMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/services/${id}`, undefined);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/services\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Servi√ßo exclu√≠do com sucesso\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao excluir servi√ßo\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEdit = (service: Service) => {\n    setSelectedService(service);\n    setIsFormOpen(true);\n  };\n\n  const handleDelete = async (service: Service) => {\n    if (confirm(`Tem certeza que deseja excluir o servi√ßo \"${service.name}\"?`)) {\n      deleteServiceMutation.mutate(service.id);\n    }\n  };\n\n  const handleFormClose = () => {\n    // Usa hook seguro para verificar se √© seguro operar\n    if (!isSafeToOperate()) {\n      console.log('‚ö†Ô∏è [SERVICES] Componente desmontado, opera√ß√£o cancelada');\n      return;\n    }\n    \n    setIsFormOpen(false);\n    setSelectedService(null);\n  };\n\n  const formatDuration = (minutes: number) => {\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    \n    if (hours > 0) {\n      return mins > 0 ? `${hours}h ${mins}min` : `${hours}h`;\n    }\n    return `${mins}min`;\n  };\n\n  const formatPrice = (price: string | null) => {\n    if (!price) return \"N√£o definido\";\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(parseFloat(price));\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-burnt-yellow\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Servi√ßos</h1>\n          <p className=\"text-gray-600\">Gerencie o cat√°logo de servi√ßos oferecidos</p>\n        </div>\n        \n        <Button \n          className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n          onClick={() => {\n            setSelectedService(null);\n            setIsFormOpen(true);\n          }}\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Novo Servi√ßo\n        </Button>\n      </div>\n\n      {/* Services List */}\n      {services.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Wrench className=\"h-12 w-12 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Nenhum servi√ßo cadastrado</h3>\n            <p className=\"text-gray-600 text-center mb-6\">\n              Crie seu cat√°logo de servi√ßos para organizar os tipos de atendimento oferecidos.\n            </p>\n            <Button \n              className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n              onClick={() => {\n                setSelectedService(null);\n                setIsFormOpen(true);\n              }}\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Adicionar Primeiro Servi√ßo\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {services.map((service: Service) => (\n            <Card key={service.id} className=\"hover:shadow-md transition-shadow\">\n              <CardHeader className=\"border-b border-gray-100\">\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"text-lg\">{service.name}</CardTitle>\n                  <div className=\"flex space-x-1\">\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => handleEdit(service)}\n                    >\n                      <Edit className=\"h-4 w-4\" />\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      onClick={() => handleDelete(service)}\n                      className=\"text-red-600 hover:text-red-700\"\n                    >\n                      <Trash2 className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"p-6\">\n                <div className=\"space-y-3\">\n                  {service.description && (\n                    <div className=\"flex items-start space-x-2 text-sm text-gray-600\">\n                      <FileText className=\"h-4 w-4 mt-0.5 flex-shrink-0\" />\n                      <span className=\"leading-relaxed\">{service.description}</span>\n                    </div>\n                  )}\n                  \n                  <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                    <Clock className=\"h-4 w-4\" />\n                    <span>Dura√ß√£o: {formatDuration(service.duration)}</span>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                    <DollarSign className=\"h-4 w-4\" />\n                    <span>Pre√ßo: {formatPrice(service.price)}</span>\n                  </div>\n                  \n                  {/* Mostra pontos/remunera√ß√£o quando dispon√≠vel */}\n                  {service.points && (\n                    <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                      <Award className=\"h-4 w-4\" />\n                      <span>Pontos: {service.points}</span>\n                    </div>\n                  )}\n                </div>\n                \n                <div className=\"mt-4 pt-4 border-t border-gray-100\">\n                  <p className=\"text-xs text-gray-500\">\n                    Cadastrado em {new Date(service.createdAt).toLocaleDateString('pt-BR')}\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      )}\n      \n      {/* Centralized Dialog for All Service Forms */}\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent>\n          <ServiceForm\n            service={selectedService}\n            onClose={handleFormClose}\n          />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":8115},"client/src/pages/Technicians.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getAuthHeaders } from \"@/lib/auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport TechnicianForm from \"@/components/forms/TechnicianForm\";\nimport TempTeamForm from \"@/components/forms/TempTeamForm\";\nimport { Plus, UserCog, Mail, Phone, Wrench, Edit, Trash2, CheckCircle, XCircle, Users } from \"lucide-react\";\nimport { useSafeNavigation } from \"@/hooks/useSafeNavigation\";\nimport type { Technician, Team, Service } from \"@shared/schema\";\n\nexport default function Technicians() {\n  const [selectedTechnician, setSelectedTechnician] = useState<Technician | null>(null);\n  const [selectedTeam, setSelectedTeam] = useState<Team | null>(null);\n  const [isTechnicianFormOpen, setIsTechnicianFormOpen] = useState(false);\n  const [isTeamFormOpen, setIsTeamFormOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Hook de navega√ß√£o segura\n  const { isSafeToOperate } = useSafeNavigation({\n    componentName: 'TECHNICIANS',\n    modals: [\n      {\n        isOpen: isTechnicianFormOpen,\n        setIsOpen: setIsTechnicianFormOpen,\n        resetState: () => setSelectedTechnician(null)\n      },\n      {\n        isOpen: isTeamFormOpen,\n        setIsOpen: setIsTeamFormOpen,\n        resetState: () => setSelectedTeam(null)\n      }\n    ]\n  });\n\n  // Queries para t√©cnicos\n  const { data: technicians = [], isLoading: techniciansLoading } = useQuery({\n    queryKey: [\"/api/technicians\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/technicians\", {\n        headers: getAuthHeaders(),\n      });\n      if (!response.ok) {\n        throw new Error('Erro ao carregar t√©cnicos');\n      }\n      const data = await response.json();\n      return Array.isArray(data) ? data : [];\n    },\n  });\n\n  // Queries para equipes\n  const { data: teams = [], isLoading: teamsLoading } = useQuery({\n    queryKey: [\"/api/teams\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/teams\", {\n        headers: getAuthHeaders(),\n      });\n      if (!response.ok) {\n        throw new Error('Erro ao carregar equipes');\n      }\n      const data = await response.json();\n      return Array.isArray(data) ? data : [];\n    },\n  });\n\n  // Query para servi√ßos (necess√°rio para formul√°rios)\n  const { data: services = [], isLoading: servicesLoading } = useQuery({\n    queryKey: [\"/api/services\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/services\", {\n        headers: getAuthHeaders(),\n      });\n      if (!response.ok) {\n        throw new Error('Erro ao carregar servi√ßos');\n      }\n      const data = await response.json();\n      return Array.isArray(data) ? data : [];\n    },\n  });\n\n  // Query para buscar membros de todas as equipes\n  const { data: allTeamMembers = [] } = useQuery({\n    queryKey: [\"/api/all-team-members\"],\n    queryFn: async () => {\n      if (teams.length === 0) return [];\n      \n      const memberPromises = teams.map(async (team: Team) => {\n        const response = await fetch(`/api/team-members/${team.id}`, {\n          headers: getAuthHeaders(),\n        });\n        if (!response.ok) return [];\n        const members = await response.json();\n        return members.map((member: any) => ({ ...member, teamId: team.id }));\n      });\n      \n      const allMembers = await Promise.all(memberPromises);\n      return allMembers.flat();\n    },\n    enabled: teams.length > 0,\n  });\n\n  // Query para buscar regras de neg√≥cio (endere√ßo da empresa)\n  const { data: businessRules } = useQuery({\n    queryKey: [\"/api/business-rules\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/business-rules\", {\n        headers: getAuthHeaders(),\n      });\n      if (!response.ok) return null;\n      return response.json();\n    },\n  });\n\n  // Fun√ß√£o para formatar endere√ßo de in√≠cio (t√©cnico ou empresa)\n  const formatStartAddress = (entity: Technician | Team) => {\n    // Verificar se tem endere√ßo de in√≠cio pr√≥prio\n    const hasOwnStartAddress = entity.enderecoInicioCep && \n                               entity.enderecoInicioLogradouro && \n                               entity.enderecoInicioBairro && \n                               entity.enderecoInicioCidade && \n                               entity.enderecoInicioEstado;\n\n    if (hasOwnStartAddress) {\n      // Usar endere√ßo de in√≠cio pr√≥prio\n      const numero = entity.enderecoInicioNumero ? `, ${entity.enderecoInicioNumero}` : '';\n      const complemento = entity.enderecoInicioComplemento ? `, ${entity.enderecoInicioComplemento}` : '';\n      return `${entity.enderecoInicioLogradouro}${numero}${complemento}, ${entity.enderecoInicioBairro}, ${entity.enderecoInicioCidade} - ${entity.enderecoInicioEstado}`;\n    }\n\n    // Usar endere√ßo da empresa como fallback\n    if (businessRules) {\n      const numero = businessRules.enderecoEmpresaNumero ? `, ${businessRules.enderecoEmpresaNumero}` : '';\n      const complemento = businessRules.enderecoEmpresaComplemento ? `, ${businessRules.enderecoEmpresaComplemento}` : '';\n      return `${businessRules.enderecoEmpresaLogradouro}${numero}${complemento}, ${businessRules.enderecoEmpresaBairro}, ${businessRules.enderecoEmpresaCidade} - ${businessRules.enderecoEmpresaEstado}`;\n    }\n\n    return \"Endere√ßo n√£o configurado\";\n  };\n\n  const deleteTechnicianMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/technicians/${id}`, undefined);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/technicians\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"T√©cnico exclu√≠do com sucesso\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao excluir t√©cnico\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteTeamMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/teams/${id}`, undefined);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/teams\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-members\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/all-team-members\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Equipe exclu√≠da com sucesso\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao excluir equipe\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEditTechnician = (technician: Technician) => {\n    console.log('‚úèÔ∏è Technicians - Editando t√©cnico:', technician);\n    setSelectedTechnician(technician);\n    setIsTechnicianFormOpen(true);\n  };\n\n  // Fun√ß√£o para garantir que o formul√°rio de novo t√©cnico sempre abra em branco\n  const handleNewTechnician = () => {\n    setSelectedTechnician(null); // Limpar t√©cnico selecionado\n    setIsTechnicianFormOpen(true);\n  };\n\n  const handleEditTeam = (team: Team) => {\n    console.log('üñäÔ∏è EDITANDO EQUIPE - handleEditTeam chamado:', team);\n    setSelectedTeam(team);\n    setIsTeamFormOpen(true);\n    console.log('‚úÖ Estado atualizado - selectedTeam definido e dialog aberto');\n  };\n\n  const handleDeleteTechnician = async (technician: Technician) => {\n    if (confirm(`Tem certeza que deseja excluir o t√©cnico \"${technician.name}\"?`)) {\n      deleteTechnicianMutation.mutate(technician.id);\n    }\n  };\n\n  const handleDeleteTeam = async (team: Team) => {\n    if (confirm(`Tem certeza que deseja excluir a equipe \"${team.name}\"?`)) {\n      deleteTeamMutation.mutate(team.id);\n    }\n  };\n\n  const handleTechnicianFormClose = () => {\n    console.log('üö™ Technicians - Iniciando fechamento do formul√°rio de t√©cnico');\n    console.log('üîç Technicians - Estado atual:', { \n      isTechnicianFormOpen, \n      selectedTechnician: selectedTechnician?.id || 'null' \n    });\n    \n    // Fechar o di√°logo imediatamente para evitar conflitos DOM\n    setIsTechnicianFormOpen(false);\n    \n    // Usar requestAnimationFrame para garantir que o DOM seja atualizado\n    requestAnimationFrame(() => {\n      console.log('üßπ Technicians - Limpando estado ap√≥s DOM render');\n      setSelectedTechnician(null);\n      console.log('‚úÖ Technicians - Formul√°rio fechado e estado limpo com sucesso');\n    });\n  };\n\n  const handleTeamFormClose = () => {\n    // CORRE√á√ÉO: Apenas fechar o dialog sem alterar state team\n    // Isso evita duplica√ß√µes ao cancelar enquanto o form ainda est√° montado\n    setIsTeamFormOpen(false);\n    // Nota: setSelectedTeam(null) ser√° chamado quando o dialog for totalmente desmontado\n    setTimeout(() => {\n      setSelectedTeam(null);\n    }, 100); // Pequeno delay para garantir que o form seja desmontado primeiro\n  };\n\n  // Fun√ß√£o para abrir formul√°rio de nova equipe - garante que sempre abre limpo\n  const handleNewTeam = () => {\n    setSelectedTeam(null); // Garantir que n√£o h√° equipe selecionada\n    setIsTeamFormOpen(true);\n  };\n\n  const isLoading = techniciansLoading || teamsLoading;\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-burnt-yellow\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div>\n        <h1 className=\"text-2xl font-bold text-gray-900\">T√©cnicos/Equipes</h1>\n        <p className=\"text-gray-600\">Gerencie sua equipe t√©cnica e organize equipes especializadas</p>\n      </div>\n\n      {/* Tabs para T√©cnicos e Equipes */}\n      <Tabs defaultValue=\"technicians\" className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"technicians\" className=\"flex items-center gap-2\">\n            <UserCog className=\"h-4 w-4\" />\n            T√©cnicos\n          </TabsTrigger>\n          <TabsTrigger value=\"teams\" className=\"flex items-center gap-2\">\n            <Users className=\"h-4 w-4\" />\n            Equipes\n          </TabsTrigger>\n        </TabsList>\n\n        {/* Aba de T√©cnicos - Mant√©m funcionalidade existente */}\n        <TabsContent value=\"technicians\" className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h2 className=\"text-lg font-semibold text-gray-900\">T√©cnicos Cadastrados</h2>\n              <p className=\"text-sm text-gray-600\">Gerencie os t√©cnicos da sua empresa</p>\n            </div>\n            \n            <Button \n              className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n              onClick={handleNewTechnician}\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Novo T√©cnico\n            </Button>\n          </div>\n\n          {/* Lista de T√©cnicos */}\n          {technicians.length === 0 ? (\n            <Card>\n              <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                <UserCog className=\"h-12 w-12 text-gray-400 mb-4\" />\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Nenhum t√©cnico cadastrado</h3>\n                <p className=\"text-gray-600 text-center mb-6\">\n                  Comece adicionando t√©cnicos √† sua equipe para realizar os atendimentos.\n                </p>\n                <Button \n                  className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n                  onClick={handleNewTechnician}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Adicionar Primeiro T√©cnico\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {technicians.map((technician: Technician) => (\n                <Card key={technician.id} className=\"hover:shadow-md transition-shadow\">\n                  <CardHeader className=\"border-b border-gray-100\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-lg flex items-center\">\n                        {technician.name}\n                        {technician.isActive ? (\n                          <CheckCircle className=\"h-4 w-4 text-green-600 ml-2\" />\n                        ) : (\n                          <XCircle className=\"h-4 w-4 text-red-600 ml-2\" />\n                        )}\n                      </CardTitle>\n                      <div className=\"flex space-x-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleEditTechnician(technician)}\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleDeleteTechnician(technician)}\n                          className=\"text-red-600 hover:text-red-700\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                    <Badge \n                      className={\n                        technician.isActive \n                          ? \"bg-green-100 text-green-800\" \n                          : \"bg-red-100 text-red-800\"\n                      }\n                    >\n                      {technician.isActive ? \"Ativo\" : \"Inativo\"}\n                    </Badge>\n                  </CardHeader>\n                  <CardContent className=\"p-6\">\n                    <div className=\"space-y-3\">\n                      {/* Endere√ßo de in√≠cio em destaque */}\n                      <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3\">\n                        <div className=\"flex items-start space-x-2 text-sm\">\n                          <span className=\"font-medium text-amber-800\">Endere√ßo de in√≠cio:</span>\n                          <span className=\"text-amber-700\">{formatStartAddress(technician)}</span>\n                        </div>\n                      </div>\n\n                      {technician.email && (\n                        <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                          <Mail className=\"h-4 w-4\" />\n                          <span>{technician.email}</span>\n                        </div>\n                      )}\n                      \n                      <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                        <Phone className=\"h-4 w-4\" />\n                        <span>{technician.phone}</span>\n                      </div>\n                      \n                      {technician.specialization && (\n                        <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                          <Wrench className=\"h-4 w-4\" />\n                          <span>{technician.specialization}</span>\n                        </div>\n                      )}\n                    </div>\n                    \n                    <div className=\"mt-4 pt-4 border-t border-gray-100\">\n                      <p className=\"text-xs text-gray-500\">\n                        Cadastrado em {new Date(technician.createdAt).toLocaleDateString('pt-BR')}\n                      </p>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n\n          {/* Di√°logo Centralizado √önico para T√©cnicos - Solu√ß√£o para erro DOM */}\n          <Dialog open={isTechnicianFormOpen} onOpenChange={(open) => {\n            console.log('üîÑ Dialog Centralizado - onOpenChange chamado:', { open, selectedTechnician });\n            if (!open) {\n              console.log('üö™ Dialog Centralizado - Fechando di√°logo');\n              handleTechnicianFormClose();\n            }\n          }}>\n            <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-hidden\">\n              <TechnicianForm\n                technician={selectedTechnician}\n                services={services}\n                onClose={handleTechnicianFormClose}\n              />\n            </DialogContent>\n          </Dialog>\n        </TabsContent>\n\n        {/* Aba de Equipes - Nova funcionalidade */}\n        <TabsContent value=\"teams\" className=\"space-y-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h2 className=\"text-lg font-semibold text-gray-900\">Equipes Cadastradas</h2>\n              <p className=\"text-sm text-gray-600\">Organize t√©cnicos em equipes especializadas</p>\n            </div>\n            \n            <Button \n              className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n              onClick={handleNewTeam}\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Cadastrar Equipe\n            </Button>\n          </div>\n\n          {/* Lista de Equipes */}\n          {teams.length === 0 ? (\n            <Card>\n              <CardContent className=\"flex flex-col items-center justify-center py-12\">\n                <Users className=\"h-12 w-12 text-gray-400 mb-4\" />\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Nenhuma equipe cadastrada</h3>\n                <p className=\"text-gray-600 text-center mb-6\">\n                  Crie equipes especializadas para organizar melhor seus t√©cnicos e servi√ßos.\n                </p>\n                <Button \n                  className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n                  onClick={handleNewTeam}\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Criar Primeira Equipe\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {teams.map((team: Team) => (\n                <Card key={team.id} className=\"hover:shadow-md transition-shadow\">\n                  <CardHeader className=\"border-b border-gray-100\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-lg flex items-center\">\n                        <Users className=\"h-5 w-5 mr-2 text-burnt-yellow\" />\n                        {team.name}\n                      </CardTitle>\n                      <div className=\"flex space-x-1\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleEditTeam(team)} // Corrigido: usar fun√ß√£o que abre o di√°logo principal\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => handleDeleteTeam(team)}\n                          className=\"text-red-600 hover:text-red-700\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardHeader>\n                  <CardContent className=\"p-6\">\n                    <div className=\"space-y-4\">\n                      {/* Endere√ßo de in√≠cio em destaque */}\n                      <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-3\">\n                        <div className=\"flex items-start space-x-2 text-sm\">\n                          <span className=\"font-medium text-amber-800\">Endere√ßo de in√≠cio:</span>\n                          <span className=\"text-amber-700\">{formatStartAddress(team)}</span>\n                        </div>\n                      </div>\n\n                      {/* Servi√ßos atendidos */}\n                      <div>\n                        <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Servi√ßos Atendidos</h4>\n                        {team.serviceIds && team.serviceIds.length > 0 ? (\n                          <div className=\"flex flex-wrap gap-1\">\n                            {team.serviceIds.map((serviceId) => {\n                              const service = services.find((s: any) => s.id === parseInt(serviceId));\n                              return service ? (\n                                <Badge key={serviceId} variant=\"secondary\" className=\"text-xs\">\n                                  {service.name}\n                                </Badge>\n                              ) : null;\n                            })}\n                          </div>\n                        ) : (\n                          <p className=\"text-sm text-gray-500\">Nenhum servi√ßo vinculado</p>\n                        )}\n                      </div>\n\n                      {/* Membros da equipe */}\n                      <div>\n                        <h4 className=\"text-sm font-medium text-gray-700 mb-2\">Membros</h4>\n                        {(() => {\n                          const teamMembersForThisTeam = allTeamMembers.filter((member: any) => member.teamId === team.id);\n                          if (teamMembersForThisTeam.length > 0) {\n                            return (\n                              <div className=\"flex flex-wrap gap-1\">\n                                {teamMembersForThisTeam.map((member: any) => {\n                                  const technician = technicians.find((t: any) => t.id === member.technicianId);\n                                  return technician ? (\n                                    <Badge key={member.id} variant=\"outline\" className=\"text-xs\">\n                                      {technician.name}\n                                    </Badge>\n                                  ) : null;\n                                })}\n                              </div>\n                            );\n                          } else {\n                            return (\n                              <p className=\"text-sm text-gray-500\">Nenhum t√©cnico vinculado</p>\n                            );\n                          }\n                        })()}\n                      </div>\n                    </div>\n                    \n                    <div className=\"mt-4 pt-4 border-t border-gray-100\">\n                      <p className=\"text-xs text-gray-500\">\n                        Criada em {new Date(team.createdAt).toLocaleDateString('pt-BR')}\n                      </p>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n          \n          {/* Centralized Dialog for All Team Forms */}\n          <Dialog open={isTeamFormOpen} onOpenChange={setIsTeamFormOpen}>\n            <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-hidden\">\n              <TempTeamForm\n                team={selectedTeam || undefined}\n                technicians={technicians}\n                services={services}\n                onClose={handleTeamFormClose}\n              />\n            </DialogContent>\n          </Dialog>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","size_bytes":23786},"client/src/pages/Vehicles.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { getAuthHeaders } from \"@/lib/auth\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport VehicleForm from \"@/components/forms/VehicleForm\";\nimport { Plus, Car, Calendar, User, Users, Edit, Trash2 } from \"lucide-react\";\nimport type { Vehicle, Technician, Team } from \"@shared/schema\";\n\nexport default function Vehicles() {\n  const [selectedVehicle, setSelectedVehicle] = useState<Vehicle | null>(null);\n  const [isFormOpen, setIsFormOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: vehicles = [], isLoading } = useQuery({\n    queryKey: [\"/api/vehicles\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/vehicles\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const { data: technicians = [] } = useQuery({\n    queryKey: [\"/api/technicians\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/technicians\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const { data: teams = [] } = useQuery({\n    queryKey: [\"/api/teams\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/teams\", {\n        headers: getAuthHeaders(),\n      });\n      return response.json();\n    },\n  });\n\n  const deleteVehicleMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/vehicles/${id}`, undefined);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vehicles\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Ve√≠culo exclu√≠do com sucesso\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao excluir ve√≠culo\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEdit = (vehicle: Vehicle) => {\n    setSelectedVehicle(vehicle);\n    setIsFormOpen(true);\n  };\n\n  const handleDelete = async (vehicle: Vehicle) => {\n    if (confirm(`Tem certeza que deseja excluir o ve√≠culo \"${vehicle.plate}\"?`)) {\n      deleteVehicleMutation.mutate(vehicle.id);\n    }\n  };\n\n  const handleFormClose = () => {\n    setIsFormOpen(false);\n    setSelectedVehicle(null);\n  };\n\n  const getTechnician = (technicianId: number | null) => {\n    if (!technicianId) return null;\n    return technicians.find((t: Technician) => t.id === technicianId);\n  };\n\n  const getTeam = (teamId: number | null) => {\n    if (!teamId) return null;\n    return teams.find((t: Team) => t.id === teamId);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-[400px]\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-burnt-yellow\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Ve√≠culos</h1>\n          <p className=\"text-gray-600\">Gerencie a frota de ve√≠culos da empresa</p>\n        </div>\n        \n        <Button \n          className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n          onClick={() => {\n            setSelectedVehicle(null);\n            setIsFormOpen(true);\n          }}\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          Novo Ve√≠culo\n        </Button>\n      </div>\n\n      {/* Vehicles List */}\n      {vehicles.length === 0 ? (\n        <Card>\n          <CardContent className=\"flex flex-col items-center justify-center py-12\">\n            <Car className=\"h-12 w-12 text-gray-400 mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Nenhum ve√≠culo cadastrado</h3>\n            <p className=\"text-gray-600 text-center mb-6\">\n              Adicione ve√≠culos √† sua frota para otimizar os atendimentos t√©cnicos.\n            </p>\n            <Button \n              className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n              onClick={() => {\n                setSelectedVehicle(null);\n                setIsFormOpen(true);\n              }}\n            >\n              <Plus className=\"h-4 w-4 mr-2\" />\n              Adicionar Primeiro Ve√≠culo\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {vehicles.map((vehicle: Vehicle) => {\n            const assignedTechnician = getTechnician(vehicle.technicianId);\n            const assignedTeam = getTeam(vehicle.teamId);\n            const hasAssignment = assignedTechnician || assignedTeam;\n            \n            return (\n              <Card key={vehicle.id} className=\"hover:shadow-md transition-shadow\">\n                <CardHeader className=\"border-b border-gray-100\">\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-lg\">{vehicle.plate}</CardTitle>\n                    <div className=\"flex space-x-1\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleEdit(vehicle)}\n                      >\n                        <Edit className=\"h-4 w-4\" />\n                      </Button>\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => handleDelete(vehicle)}\n                        className=\"text-red-600 hover:text-red-700\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                  <Badge className={hasAssignment ? \"bg-green-100 text-green-800\" : \"bg-red-100 text-red-800\"}>\n                    {hasAssignment ? \"Atribu√≠do\" : \"Sem Respons√°vel\"}\n                  </Badge>\n                </CardHeader>\n                <CardContent className=\"p-6\">\n                  <div className=\"space-y-3\">\n                    <div className=\"text-lg font-medium text-gray-900\">\n                      {vehicle.brand} {vehicle.model}\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                      <Calendar className=\"h-4 w-4\" />\n                      <span>Ano: {vehicle.year}</span>\n                    </div>\n                    \n                    {assignedTechnician && (\n                      <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                        <User className=\"h-4 w-4\" />\n                        <span>T√©cnico: {assignedTechnician.name}</span>\n                      </div>\n                    )}\n                    \n                    {assignedTeam && (\n                      <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n                        <Users className=\"h-4 w-4\" />\n                        <span>Equipe: {assignedTeam.name}</span>\n                      </div>\n                    )}\n                    \n                    {!hasAssignment && (\n                      <div className=\"flex items-center space-x-2 text-sm text-red-600\">\n                        <User className=\"h-4 w-4\" />\n                        <span>Nenhum respons√°vel atribu√≠do</span>\n                      </div>\n                    )}\n                  </div>\n                  \n                  <div className=\"mt-4 pt-4 border-t border-gray-100\">\n                    <p className=\"text-xs text-gray-500\">\n                      Cadastrado em {new Date(vehicle.createdAt).toLocaleDateString('pt-BR')}\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n      \n      {/* Centralized Dialog for All Vehicle Forms */}\n      <Dialog open={isFormOpen} onOpenChange={setIsFormOpen}>\n        <DialogContent>\n          <VehicleForm\n            vehicle={selectedVehicle}\n            technicians={technicians}\n            teams={teams}\n            onClose={handleFormClose}\n          />\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":8628},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/forms/AppointmentForm.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { extendedInsertAppointmentSchema, type InsertAppointment, type Appointment, type Client, type Service, type Technician, type Team } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { ClientSearch } from \"@/components/ui/client-search\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Calendar, Clock, MapPin, UserPlus, Edit3, AlertCircle } from \"lucide-react\";\nimport NewClientDialog from \"./NewClientDialog\";\nimport ClientForm from \"./ClientForm\";\n\ninterface AppointmentFormProps {\n  appointment?: Appointment | null;\n  clients: Client[];\n  services: Service[];\n  technicians: Technician[];\n  teams: Team[];\n  onClose: () => void;\n  prefilledData?: {\n    date?: string;\n    cep?: string;\n    numero?: string;\n    serviceId?: string;\n    technicianId?: string;\n    teamId?: string;\n    clientId?: string;\n  } | null;\n}\n\nexport default function AppointmentForm({ \n  appointment, \n  clients, \n  services, \n  technicians, \n  teams,\n  onClose,\n  prefilledData \n}: AppointmentFormProps) {\n  console.log(\"üìù [DEBUG] AppointmentForm - prefilledData:\", prefilledData);\n  console.log(\"üìù [DEBUG] AppointmentForm - appointment:\", appointment);\n  \n  const [selectedClient, setSelectedClient] = useState<number | null>(\n    appointment?.clientId || (prefilledData?.clientId ? parseInt(prefilledData.clientId) : null)\n  );\n  const [isEditClientOpen, setIsEditClientOpen] = useState(false);\n  const [isAllDay, setIsAllDay] = useState(appointment?.allDay || false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Verificar se o formul√°rio foi aberto a partir do fluxo \"Ache uma Data\"\n  const isFromFindDate = !!prefilledData && !appointment;\n  console.log(\"üìù [DEBUG] AppointmentForm - isFromFindDate:\", isFromFindDate);\n\n  const form = useForm<InsertAppointment>({\n    resolver: zodResolver(extendedInsertAppointmentSchema),\n    defaultValues: appointment ? {\n      clientId: appointment.clientId,\n      serviceId: appointment.serviceId,\n      technicianId: appointment.technicianId,\n      teamId: appointment.teamId,\n      scheduledDate: new Date(appointment.scheduledDate),\n      allDay: appointment.allDay || false,\n      status: appointment.status,\n      priority: appointment.priority,\n      notes: appointment.notes || \"\",\n      cep: appointment.cep,\n      logradouro: appointment.logradouro,\n      numero: appointment.numero,\n      complemento: appointment.complemento || \"\",\n      bairro: appointment.bairro || \"N√£o informado\",\n      cidade: appointment.cidade || \"N√£o informado\",\n    } : prefilledData ? {\n      clientId: prefilledData.clientId ? parseInt(prefilledData.clientId) : 0,\n      serviceId: prefilledData.serviceId ? parseInt(prefilledData.serviceId) : 0,\n      technicianId: prefilledData.technicianId ? parseInt(prefilledData.technicianId) : 0,\n      teamId: prefilledData.teamId ? parseInt(prefilledData.teamId) : undefined,\n      scheduledDate: prefilledData.date ? new Date(prefilledData.date) : new Date(),\n      allDay: false,\n      status: \"scheduled\",\n      priority: \"normal\",\n      notes: \"\",\n      cep: prefilledData.cep || \"\",\n      logradouro: prefilledData.clientId ? \n        (clients.find(c => c.id === parseInt(prefilledData.clientId!))?.logradouro || \"\") : \"\",\n      numero: prefilledData.numero || \"\",\n      complemento: prefilledData.clientId ? \n        (clients.find(c => c.id === parseInt(prefilledData.clientId!))?.complemento || \"\") : \"\",\n      bairro: prefilledData.clientId ? \n        (clients.find(c => c.id === parseInt(prefilledData.clientId!))?.bairro || \"N√£o informado\") : \"N√£o informado\",\n      cidade: prefilledData.clientId ? \n        (clients.find(c => c.id === parseInt(prefilledData.clientId!))?.cidade || \"N√£o informado\") : \"N√£o informado\",\n    } : {\n      clientId: 0,\n      serviceId: 0,\n      technicianId: 0,\n      teamId: undefined,\n      scheduledDate: new Date(),\n      allDay: false,\n      status: \"scheduled\",\n      priority: \"normal\",\n      notes: \"\",\n      cep: \"\",\n      logradouro: \"\",\n      numero: \"\",\n      complemento: \"\",\n      bairro: \"N√£o informado\",\n      cidade: \"N√£o informado\",\n    },\n  });\n  \n  \n  // Effect to update address fields whenever the selected client changes or clients data is updated\n  useEffect(() => {\n    if (selectedClient && appointment) {\n      const currentClient = clients.find(c => c.id === selectedClient);\n      if (currentClient) {\n        console.log(\"üîÑ [DEBUG] Atualizando campos de endere√ßo automaticamente:\", currentClient);\n        form.setValue(\"cep\", currentClient.cep);\n        form.setValue(\"logradouro\", currentClient.logradouro);\n        form.setValue(\"numero\", currentClient.numero);\n        form.setValue(\"complemento\", currentClient.complemento || \"\");\n        form.setValue(\"bairro\", currentClient.bairro || \"N√£o informado\");\n        form.setValue(\"cidade\", currentClient.cidade || \"N√£o informado\");\n      }\n    }\n  }, [selectedClient, clients, appointment]);\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertAppointment) => {\n      const response = await fetch(\"/api/appointments\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...(localStorage.getItem(\"token\") && {\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n          }),\n        },\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Erro ao criar agendamento\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/appointments'] });\n      onClose();\n      toast({\n        title: \"Sucesso\",\n        description: \"Agendamento criado com sucesso.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao criar agendamento.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: InsertAppointment) => {\n      const response = await fetch(`/api/appointments/${appointment?.id}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...(localStorage.getItem(\"token\") && {\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n          }),\n        },\n        body: JSON.stringify(data),\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Erro ao atualizar agendamento\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/appointments'] });\n      onClose();\n      toast({\n        title: \"Sucesso\",\n        description: \"Agendamento atualizado com sucesso.\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao atualizar agendamento.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertAppointment) => {\n    console.log(\"üìù [DEBUG] onSubmit - Dados recebidos do form:\", data);\n    console.log(\"üìù [DEBUG] onSubmit - Tipo de scheduledDate:\", typeof data.scheduledDate, data.scheduledDate);\n    \n    // Convert scheduledDate to Date object for the mutations\n    let processedDate;\n    try {\n      if (data.scheduledDate instanceof Date) {\n        processedDate = data.scheduledDate;\n        console.log(\"üìù [DEBUG] onSubmit - scheduledDate j√° √© Date:\", processedDate);\n      } else {\n        processedDate = new Date(data.scheduledDate);\n        console.log(\"üìù [DEBUG] onSubmit - scheduledDate convertido para Date:\", processedDate);\n      }\n      \n      // Verificar se a data √© v√°lida\n      if (isNaN(processedDate.getTime())) {\n        throw new Error(`Data inv√°lida: ${data.scheduledDate}`);\n      }\n    } catch (error) {\n      console.error(\"‚ùå [DEBUG] onSubmit - Erro ao processar data:\", error);\n      toast({\n        title: \"Erro\",\n        description: \"Data inv√°lida. Verifique o formato da data.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const formData = {\n      ...data,\n      scheduledDate: processedDate\n    };\n    \n    // Ensure proper handling of technician vs team assignment\n    if (formData.teamId) {\n      // If teamId is set, clear technicianId to avoid foreign key conflicts\n      formData.technicianId = null;\n      console.log(\"üìù [DEBUG] onSubmit - Usando equipe, technicianId limpo\");\n    } else if (formData.technicianId) {\n      // If technicianId is set, clear teamId\n      formData.teamId = undefined;\n      console.log(\"üìù [DEBUG] onSubmit - Usando t√©cnico, teamId limpo\");\n    }\n    \n    console.log(\"üìù [DEBUG] onSubmit - Dados finais para envio:\", formData);\n    \n    if (appointment) {\n      console.log(\"üìù [DEBUG] onSubmit - Atualizando agendamento ID:\", appointment.id);\n      updateMutation.mutate(formData);\n    } else {\n      console.log(\"üìù [DEBUG] onSubmit - Criando novo agendamento\");\n      createMutation.mutate(formData);\n    }\n  };\n\n  const handleClientCreated = (client: Client) => {\n    setSelectedClient(client.id);\n    form.setValue(\"clientId\", client.id);\n    // Auto-fill address fields from client\n    form.setValue(\"cep\", client.cep);\n    form.setValue(\"logradouro\", client.logradouro);\n    form.setValue(\"numero\", client.numero);\n    form.setValue(\"complemento\", client.complemento || \"\");\n    form.setValue(\"bairro\", client.bairro || \"N√£o informado\");\n    form.setValue(\"cidade\", client.cidade || \"N√£o informado\");\n  };\n\n  const handleClientChange = (clientId: string) => {\n    const client = clients.find(c => c.id === parseInt(clientId));\n    if (client) {\n      setSelectedClient(client.id);\n      // Auto-fill address fields from selected client\n      form.setValue(\"cep\", client.cep);\n      form.setValue(\"logradouro\", client.logradouro);\n      form.setValue(\"numero\", client.numero);\n      form.setValue(\"complemento\", client.complemento || \"\");\n      form.setValue(\"bairro\", client.bairro || \"N√£o informado\");\n      form.setValue(\"cidade\", client.cidade || \"N√£o informado\");\n    }\n  };\n\n  const handleClientUpdated = async () => {\n    // Close the edit client dialog first\n    setIsEditClientOpen(false);\n    \n    // Invalidate clients query to get updated data\n    await queryClient.invalidateQueries({ queryKey: ['/api/clients'] });\n    \n    // Force refetch of clients data to get the latest information\n    await queryClient.refetchQueries({ queryKey: ['/api/clients'] });\n    \n    // Update address fields with the updated client data\n    if (selectedClient) {\n      // Wait a bit longer to ensure the query has completed\n      setTimeout(() => {\n        const updatedClient = clients.find(c => c.id === selectedClient);\n        if (updatedClient) {\n          console.log(\"üîÑ [DEBUG] Atualizando campos de endere√ßo com dados do cliente:\", updatedClient);\n          form.setValue(\"cep\", updatedClient.cep);\n          form.setValue(\"logradouro\", updatedClient.logradouro);\n          form.setValue(\"numero\", updatedClient.numero);\n          form.setValue(\"complemento\", updatedClient.complemento || \"\");\n          form.setValue(\"bairro\", updatedClient.bairro || \"N√£o informado\");\n          form.setValue(\"cidade\", updatedClient.cidade || \"N√£o informado\");\n        }\n      }, 300);\n    }\n  };\n\n  const handleAddressFieldClick = () => {\n    toast({\n      title: \"Endere√ßo somente leitura\",\n      description: \"Para alterar o endere√ßo do cliente, edite o cadastro do cliente.\",\n      variant: \"default\",\n    });\n  };\n\n  const getCurrentClient = () => {\n    return clients.find(c => c.id === selectedClient);\n  };\n\n\n\n  return (\n    <div className=\"space-y-6\">\n      <DialogHeader>\n        <DialogTitle className=\"flex items-center gap-2\">\n          <Calendar className=\"h-5 w-5\" />\n          {appointment ? \"Editar Agendamento\" : \"Novo Agendamento\"}\n        </DialogTitle>\n      </DialogHeader>\n\n      <div className=\"flex gap-2 mb-4\">\n        <NewClientDialog onClientCreated={handleClientCreated}>\n          <Button variant=\"outline\" size=\"sm\" className=\"text-green-600 border-green-600 hover:bg-green-50\">\n            <UserPlus className=\"h-4 w-4 mr-2\" />\n            Novo Cliente\n          </Button>\n        </NewClientDialog>\n\n\n      </div>\n\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          {/* Client Selection */}\n          <FormField\n            control={form.control}\n            name=\"clientId\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Cliente *</FormLabel>\n                <FormControl>\n                  <ClientSearch\n                    value={field.value}\n                    onValueChange={(value) => {\n                      if (!isFromFindDate) {\n                        field.onChange(value ?? undefined);\n                        if (value) {\n                          handleClientChange(value.toString());\n                        }\n                      }\n                    }}\n                    placeholder=\"Pesquisar por nome ou CPF\"\n                    disabled={isFromFindDate}\n                  />\n                </FormControl>\n                {isFromFindDate && (\n                  <p className=\"text-sm text-blue-600\">Cliente selecionado a partir da busca \"Ache uma data\" - n√£o pode ser alterado</p>\n                )}\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          {/* Service and Technician */}\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <FormField\n              control={form.control}\n              name=\"serviceId\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Servi√ßo *</FormLabel>\n                  <Select \n                    onValueChange={(value) => {\n                      if (!isFromFindDate) {\n                        field.onChange(parseInt(value));\n                      }\n                    }} \n                    value={field.value?.toString()}\n                    disabled={isFromFindDate}\n                  >\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Selecione um servi√ßo\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {services.map((service) => (\n                        <SelectItem key={service.id} value={service.id.toString()}>\n                          {service.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  {isFromFindDate && (\n                    <p className=\"text-sm text-blue-600\">Servi√ßo selecionado a partir da busca \"Ache uma data\" - n√£o pode ser alterado</p>\n                  )}\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"technicianId\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>T√©cnico/Equipe *</FormLabel>\n                  <Select \n                    onValueChange={(value) => {\n                      if (!isFromFindDate) {\n                        console.log(\"Sele√ß√£o alterada para:\", value);\n                        \n                        if (value.startsWith('tech-')) {\n                          // √â um t√©cnico\n                          const technicianId = parseInt(value.split('-')[1]);\n                          console.log(\"T√©cnico selecionado ID:\", technicianId);\n                          field.onChange(technicianId);\n                          // Limpar teamId no formul√°rio\n                          form.setValue(\"teamId\", undefined);\n                        } else if (value.startsWith('team-')) {\n                          // √â uma equipe\n                          const teamId = parseInt(value.split('-')[1]);\n                          console.log(\"Equipe selecionada ID:\", teamId);\n                          field.onChange(undefined); // Limpar technicianId\n                          // Definir teamId no formul√°rio\n                          form.setValue(\"teamId\", teamId);\n                        }\n                      }\n                    }} \n                    value={\n                      field.value ? `tech-${field.value}` : \n                      form.getValues(\"teamId\") ? `team-${form.getValues(\"teamId\")}` : \"\"\n                    }\n                    disabled={isFromFindDate}\n                  >\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"Selecione um t√©cnico ou equipe\" />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      {technicians.map((technician) => (\n                        <SelectItem key={`technician-${technician.id}`} value={`tech-${technician.id}`}>\n                          üë§ {technician.name}\n                        </SelectItem>\n                      ))}\n                      {teams && teams.map((team) => (\n                        <SelectItem key={`team-${team.id}`} value={`team-${team.id}`}>\n                          üë• {team.name}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  {isFromFindDate && (\n                    <p className=\"text-sm text-blue-600\">T√©cnico/Equipe selecionado a partir da busca \"Ache uma data\" - n√£o pode ser alterado</p>\n                  )}\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n\n          {/* Date and Time */}\n          <div className=\"space-y-4\">\n            <FormField\n              control={form.control}\n              name=\"scheduledDate\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>{isAllDay ? \"Data *\" : \"Data e Hora *\"}</FormLabel>\n                  <FormControl>\n                    <Input\n                      type={isAllDay ? \"date\" : \"datetime-local\"}\n                      {...field}\n                      value={field.value ? \n                        (isAllDay ? \n                          new Date(field.value.getTime() - field.value.getTimezoneOffset() * 60000).toISOString().slice(0, 10) :\n                          new Date(field.value.getTime() - field.value.getTimezoneOffset() * 60000).toISOString().slice(0, 16)\n                        ) : \"\"}\n                      onChange={(e) => field.onChange(new Date(e.target.value))}\n                      disabled={!!prefilledData?.date}\n                    />\n                  </FormControl>\n                  {prefilledData?.date && (\n                    <p className=\"text-sm text-blue-600\">Data selecionada a partir da busca \"Ache uma data\" - n√£o pode ser alterada</p>\n                  )}\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            {/* All Day Checkbox */}\n            <FormField\n              control={form.control}\n              name=\"allDay\"\n              render={({ field }) => (\n                <FormItem className=\"flex flex-row items-start space-x-3 space-y-0\">\n                  <FormControl>\n                    <input\n                      type=\"checkbox\"\n                      checked={field.value}\n                      onChange={(e) => {\n                        const checked = e.target.checked;\n                        field.onChange(checked);\n                        setIsAllDay(checked);\n                      }}\n                      className=\"mt-1\"\n                    />\n                  </FormControl>\n                  <div className=\"space-y-1 leading-none\">\n                    <FormLabel className=\"text-sm font-normal\">\n                      Dia todo\n                    </FormLabel>\n                    <p className=\"text-xs text-gray-500\">\n                      Marque para agendamentos que duram o dia inteiro\n                    </p>\n                  </div>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n\n          {/* Address Fields */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <MapPin className=\"h-5 w-5 text-gray-500\" />\n                <h3 className=\"text-lg font-medium\">Endere√ßo do Atendimento</h3>\n              </div>\n              {appointment && selectedClient && (\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setIsEditClientOpen(true)}\n                  className=\"text-blue-600 border-blue-600 hover:bg-blue-50\"\n                >\n                  <Edit3 className=\"h-4 w-4 mr-2\" />\n                  Editar cadastro do cliente\n                </Button>\n              )}\n            </div>\n\n            {appointment && !selectedClient && (\n              <div className=\"flex items-center gap-2 p-3 bg-amber-50 border border-amber-200 rounded-lg\">\n                <AlertCircle className=\"h-4 w-4 text-amber-600\" />\n                <p className=\"text-sm text-amber-800\">\n                  Selecione um cliente para ver o endere√ßo do atendimento\n                </p>\n              </div>\n            )}\n            \n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <FormField\n                control={form.control}\n                name=\"cep\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>CEP *</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"00000-000\"\n                        maxLength={9}\n                        {...field}\n                        onChange={(e) => {\n                          if (!appointment && !prefilledData?.cep) {\n                            let value = e.target.value.replace(/\\D/g, '');\n                            if (value.length > 5) {\n                              value = value.slice(0, 5) + '-' + value.slice(5, 8);\n                            }\n                            field.onChange(value);\n                          }\n                        }}\n                        onClick={appointment ? handleAddressFieldClick : undefined}\n                        disabled={!!prefilledData?.cep || !!appointment}\n                        readOnly={!!appointment}\n                        className={appointment ? \"bg-gray-50 cursor-not-allowed\" : \"\"}\n                      />\n                    </FormControl>\n                    {prefilledData?.cep && (\n                      <p className=\"text-sm text-blue-600\">CEP selecionado a partir da busca \"Ache uma data\" - n√£o pode ser alterado</p>\n                    )}\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"numero\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>N√∫mero *</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"123\"\n                        {...field}\n                        onChange={(e) => {\n                          if (!appointment && !prefilledData?.numero) {\n                            const value = e.target.value.replace(/\\D/g, '');\n                            field.onChange(value);\n                          }\n                        }}\n                        onClick={appointment ? handleAddressFieldClick : undefined}\n                        disabled={!!prefilledData?.numero || !!appointment}\n                        readOnly={!!appointment}\n                        className={appointment ? \"bg-gray-50 cursor-not-allowed\" : \"\"}\n                      />\n                    </FormControl>\n                    {prefilledData?.numero && (\n                      <p className=\"text-sm text-blue-600\">N√∫mero selecionado a partir da busca \"Ache uma data\" - n√£o pode ser alterado</p>\n                    )}\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"logradouro\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Logradouro *</FormLabel>\n                    <FormControl>\n                      <Input \n                        placeholder=\"Rua das Flores\" \n                        {...field} \n                        onClick={appointment ? handleAddressFieldClick : undefined}\n                        disabled={isFromFindDate || !!appointment}\n                        readOnly={!!appointment}\n                        className={appointment ? \"bg-gray-50 cursor-not-allowed\" : \"\"}\n                      />\n                    </FormControl>\n                    {isFromFindDate && (\n                      <p className=\"text-sm text-blue-600\">Logradouro do cliente selecionado - n√£o pode ser alterado</p>\n                    )}\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"complemento\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Complemento</FormLabel>\n                    <FormControl>\n                      <Input \n                        placeholder=\"Apto 123\" \n                        {...field} \n                        value={field.value || \"\"} \n                        onClick={appointment ? handleAddressFieldClick : undefined}\n                        disabled={isFromFindDate || !!appointment}\n                        readOnly={!!appointment}\n                        className={appointment ? \"bg-gray-50 cursor-not-allowed\" : \"\"}\n                      />\n                    </FormControl>\n                    {isFromFindDate && (\n                      <p className=\"text-sm text-blue-600\">Complemento do cliente selecionado - n√£o pode ser alterado</p>\n                    )}\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"bairro\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Bairro *</FormLabel>\n                    <FormControl>\n                      <Input \n                        placeholder=\"Centro\" \n                        {...field} \n                        value={field.value || \"\"} \n                        onClick={appointment ? handleAddressFieldClick : undefined}\n                        disabled={isFromFindDate || !!appointment}\n                        readOnly={!!appointment}\n                        className={appointment ? \"bg-gray-50 cursor-not-allowed\" : \"\"}\n                      />\n                    </FormControl>\n                    {isFromFindDate && (\n                      <p className=\"text-sm text-blue-600\">Bairro do cliente selecionado - n√£o pode ser alterado</p>\n                    )}\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"cidade\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Cidade *</FormLabel>\n                    <FormControl>\n                      <Input \n                        placeholder=\"S√£o Paulo\" \n                        {...field} \n                        value={field.value || \"\"} \n                        onClick={appointment ? handleAddressFieldClick : undefined}\n                        disabled={isFromFindDate || !!appointment}\n                        readOnly={!!appointment}\n                        className={appointment ? \"bg-gray-50 cursor-not-allowed\" : \"\"}\n                      />\n                    </FormControl>\n                    {isFromFindDate && (\n                      <p className=\"text-sm text-blue-600\">Cidade do cliente selecionado - n√£o pode ser alterada</p>\n                    )}\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n          </div>\n\n          {/* Status, Priority, and Notes */}\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <FormField\n              control={form.control}\n              name=\"status\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Status</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"scheduled\">Agendado</SelectItem>\n                      <SelectItem value=\"in_progress\">Em Andamento</SelectItem>\n                      <SelectItem value=\"completed\">Conclu√≠do</SelectItem>\n                      <SelectItem value=\"cancelled\">Cancelado</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"priority\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Prioridade</FormLabel>\n                  <Select onValueChange={field.onChange} value={field.value}>\n                    <FormControl>\n                      <SelectTrigger>\n                        <SelectValue />\n                      </SelectTrigger>\n                    </FormControl>\n                    <SelectContent>\n                      <SelectItem value=\"normal\">Normal</SelectItem>\n                      <SelectItem value=\"high\">Alta</SelectItem>\n                      <SelectItem value=\"urgent\">Urgente</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n\n          <FormField\n            control={form.control}\n            name=\"notes\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Observa√ß√µes</FormLabel>\n                <FormControl>\n                  <Textarea\n                    placeholder=\"Observa√ß√µes sobre o agendamento...\"\n                    className=\"min-h-[80px]\"\n                    {...field}\n                    value={field.value || \"\"}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <div className=\"flex justify-end gap-2 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              Cancelar\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={createMutation.isPending || updateMutation.isPending}\n              className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n            >\n              {(createMutation.isPending || updateMutation.isPending) && (\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />\n              )}\n              {appointment ? \"Atualizar\" : \"Criar\"} Agendamento\n            </Button>\n          </div>\n        </form>\n      </Form>\n\n      {/* Modal de Edi√ß√£o do Cliente */}\n      <Dialog open={isEditClientOpen} onOpenChange={setIsEditClientOpen}>\n        <DialogContent className=\"sm:max-w-[600px] max-h-[80vh] overflow-y-auto\">\n          {selectedClient && (\n            <ClientForm\n              client={getCurrentClient()}\n              onClose={handleClientUpdated}\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":33107},"client/src/components/forms/ClientForm.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { extendedInsertClientSchema, type InsertClient, type Client } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Users, Mail, Phone, MapPin } from \"lucide-react\";\n\ninterface ClientFormProps {\n  client?: Client | null;\n  onClose: () => void;\n}\n\nasync function buscarEnderecoPorCep(cep: string) {\n  const url = `https://viacep.com.br/ws/${cep.replace(/\\D/g, '')}/json/`;\n  const res = await fetch(url);\n  const data = await res.json();\n  if (data.erro) throw new Error(\"CEP n√£o encontrado\");\n  return data; // {logradouro, bairro, localidade, uf, ...}\n}\n\n\nexport default function ClientForm({ client, onClose }: ClientFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Estados para valida√ß√£o de CPF\n  const [cpfInput, setCpfInput] = useState(client?.cpf || \"\");\n  const [cpfError, setCpfError] = useState<string | null>(null);\n  \n  const form = useForm<InsertClient>({\n    resolver: zodResolver(extendedInsertClientSchema),\n    defaultValues: client ? {\n      name: client.name,\n      email: client.email || \"\",\n      phone1: client.phone1 || \"\",\n      phone2: client.phone2 || \"\",\n      cpf: client.cpf || \"\",\n      cep: client.cep,\n      logradouro: client.logradouro,\n      numero: client.numero,\n      complemento: client.complemento || \"\",\n      observacoes: client.observacoes || \"\",\n    } : {\n      name: \"\",\n      email: \"\",\n      phone1: \"\",\n      phone2: \"\",\n      cpf: \"\",\n      cep: \"\",\n      logradouro: \"\",\n      numero: \"\",\n      complemento: \"\",\n      observacoes: \"\",\n    },\n  });\n\n  // AGORA SIM, useStates:\n  const [logradouro, setLogradouro] = useState(form.getValues(\"logradouro\") || \"\");\n  const [bairro, setBairro] = useState(\"\");\n  const [cidade, setCidade] = useState(\"\");\n  const [estado, setEstado] = useState(\"\");\n\n  // ADICIONE ESTE USEEFFECT üëá\n  useEffect(() => {\n    if (client) {\n      setBairro(client.bairro || \"\");\n      setCidade(client.cidade || \"\");\n      setLogradouro(client.logradouro || \"\");\n    } else {\n      setBairro(\"\");\n      setCidade(\"\");\n      setLogradouro(\"\");\n    }\n  }, [client]);\n\n  // Query para valida√ß√£o de CPF\n  const { data: cpfValidation, refetch: validateCpf } = useQuery({\n    queryKey: ['/api/clients/validate-cpf', cpfInput],\n    queryFn: async () => {\n      if (!cpfInput || cpfInput.length < 11) return { exists: false };\n      console.log(\"Valida√ß√£o de CPF:\", cpfInput);\n      \n      const response = await fetch(`/api/clients/validate-cpf?cpf=${encodeURIComponent(cpfInput)}`, {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      \n      if (!response.ok) {\n        throw new Error('Erro na valida√ß√£o de CPF');\n      }\n      \n      return response.json();\n    },\n    enabled: false, // S√≥ executa quando chamado manualmente\n  });\n\n  // Effect para validar CPF em tempo real com debounce\n  useEffect(() => {\n    if (cpfInput && cpfInput.length >= 11) {\n      // Se estamos editando o mesmo cliente, n√£o validar\n      if (client && client.cpf === cpfInput) {\n        setCpfError(null);\n        return;\n      }\n      \n      const timer = setTimeout(() => {\n        validateCpf();\n      }, 500); // Debounce de 500ms\n      \n      return () => clearTimeout(timer);\n    } else {\n      setCpfError(null);\n    }\n  }, [cpfInput, client, validateCpf]);\n\n  // Effect para mostrar erro quando CPF j√° existe\n  useEffect(() => {\n    if (cpfValidation?.exists) {\n      console.log(\"CPF j√° cadastrado:\", cpfInput, \"Nome:\", cpfValidation.clientName);\n      setCpfError(`J√° existe um cliente cadastrado com este CPF: ${cpfValidation.clientName}`);\n    } else {\n      setCpfError(null);\n    }\n  }, [cpfValidation, cpfInput]);\n\n  const createClientMutation = useMutation({\n    mutationFn: async (data: InsertClient) => {\n      const response = await apiRequest(\"POST\", \"/api/clients\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Cliente criado com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao criar cliente\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateClientMutation = useMutation({\n    mutationFn: async (data: InsertClient) => {\n      const response = await apiRequest(\"PUT\", `/api/clients/${client!.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Cliente atualizado com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao atualizar cliente\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertClient) => {\n    // Impedir envio se CPF j√° est√° cadastrado\n    if (cpfError) {\n      toast({\n        title: \"Erro\",\n        description: \"Corrija os erros antes de salvar\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (client) {\n      updateClientMutation.mutate(data);\n    } else {\n      createClientMutation.mutate(data);\n    }\n  };\n\n  const isLoading = createClientMutation.isPending || updateClientMutation.isPending;\n\n  return (\n    <div className=\"space-y-6\">\n      <DialogHeader>\n        <DialogTitle className=\"flex items-center\">\n          <Users className=\"h-5 w-5 mr-2 text-burnt-yellow\" />\n          {client ? \"Editar Cliente\" : \"Novo Cliente\"}\n        </DialogTitle>\n      </DialogHeader>\n\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div>\n          <Label htmlFor=\"name\">Nome *</Label>\n          <Input\n            {...form.register(\"name\")}\n            placeholder=\"Nome da empresa ou pessoa\"\n            className=\"mt-1\"\n          />\n          {form.formState.errors.name && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.name.message}</p>\n          )}\n        </div>\n\n        <div>\n          <Label htmlFor=\"email\" className=\"flex items-center\">\n            <Mail className=\"h-4 w-4 mr-1\" />\n            Email\n          </Label>\n          <Input\n            {...form.register(\"email\")}\n            type=\"email\"\n            placeholder=\"email@exemplo.com\"\n            className=\"mt-1\"\n          />\n          {form.formState.errors.email && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.email.message}</p>\n          )}\n        </div>\n\n        <div>\n          <Label htmlFor=\"cpf\">CPF *</Label>\n          <Input\n            placeholder=\"000.000.000-00\"\n            className={`mt-1 ${cpfError ? 'border-red-500' : ''}`}\n            maxLength={14}\n            value={cpfInput}\n            onChange={(e) => {\n              let value = e.target.value.replace(/\\D/g, '');\n              console.log(\"Valida√ß√£o de CPF:\", value);\n              \n              if (value.length > 11) {\n                value = value.slice(0, 11);\n              }\n              const formattedValue = value.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{0,2})/, '$1.$2.$3-$4');\n              \n              setCpfInput(formattedValue);\n              form.setValue(\"cpf\", formattedValue);\n            }}\n          />\n          {form.formState.errors.cpf && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.cpf.message}</p>\n          )}\n          {cpfError && (\n            <p className=\"text-sm text-red-600 mt-1\">{cpfError}</p>\n          )}\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <div>\n            <Label htmlFor=\"phone1\" className=\"flex items-center\">\n              <Phone className=\"h-4 w-4 mr-1\" />\n              Telefone 1 *\n            </Label>\n            <Input\n              {...form.register(\"phone1\")}\n              placeholder=\"(11) 99999-9999\"\n              className=\"mt-1\"\n              maxLength={15}\n              onChange={(e) => {\n                let value = e.target.value.replace(/\\D/g, '');\n                if (value.length > 11) {\n                  value = value.slice(0, 11);\n                }\n                if (value.length <= 10) {\n                  value = value.replace(/(\\d{2})(\\d{4})(\\d{0,4})/, '($1) $2-$3');\n                } else {\n                  value = value.replace(/(\\d{2})(\\d{5})(\\d{0,4})/, '($1) $2-$3');\n                }\n                e.target.value = value;\n                form.setValue(\"phone1\", value);\n              }}\n            />\n            {form.formState.errors.phone1 && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.phone1.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"phone2\" className=\"flex items-center\">\n              <Phone className=\"h-4 w-4 mr-1\" />\n              Telefone 2\n            </Label>\n            <Input\n              {...form.register(\"phone2\")}\n              placeholder=\"(11) 99999-9999\"\n              className=\"mt-1\"\n              maxLength={15}\n              onChange={(e) => {\n                let value = e.target.value.replace(/\\D/g, '');\n                if (value.length > 11) {\n                  value = value.slice(0, 11);\n                }\n                if (value.length <= 10) {\n                  value = value.replace(/(\\d{2})(\\d{4})(\\d{0,4})/, '($1) $2-$3');\n                } else {\n                  value = value.replace(/(\\d{2})(\\d{5})(\\d{0,4})/, '($1) $2-$3');\n                }\n                e.target.value = value;\n                form.setValue(\"phone2\", value);\n              }}\n            />\n            {form.formState.errors.phone2 && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.phone2.message}</p>\n            )}\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div>\n            <Label htmlFor=\"cep\">CEP *</Label>\n            <Input\n              {...form.register(\"cep\")}\n              placeholder=\"00000-000\"\n              maxLength={9}\n              className=\"mt-1\"\n              onChange={(e) => {\n                let value = e.target.value.replace(/\\D/g, '');\n                if (value.length > 5) {\n                  value = value.slice(0, 5) + '-' + value.slice(5, 8);\n                }\n                form.setValue(\"cep\", value);\n              }}\n              \n              onBlur={async (e) => {\n                const value = e.target.value.replace(/\\D/g, '');\n                if (value.length === 8) {\n                  try {\n                    const endereco = await buscarEnderecoPorCep(value);\n\n                    setLogradouro(endereco.logradouro || \"\");\n                    setBairro(endereco.bairro || \"\");\n                    setCidade(endereco.localidade || \"\");\n                    setEstado(endereco.uf || \"\");\n\n                    // Agora preenche TAMB√âM no formul√°rio do react-hook-form\n                    form.setValue(\"logradouro\", endereco.logradouro || \"\");\n                    form.setValue(\"bairro\", endereco.bairro || \"\");\n                    form.setValue(\"cidade\", endereco.localidade || \"\");\n                    // form.setValue(\"estado\", endereco.uf || \"\"); // caso adicione UF depois\n\n                  } catch (err) {\n                    toast({\n                      title: \"CEP n√£o encontrado!\",\n                      description: \"Preencha o endere√ßo manualmente.\",\n                      variant: \"destructive\",\n                    });\n                    setLogradouro(\"\");\n                    setBairro(\"\");\n                    setCidade(\"\");\n                    setEstado(\"\");\n                    form.setValue(\"logradouro\", \"\");\n                    form.setValue(\"bairro\", \"\");\n                    form.setValue(\"cidade\", \"\");\n                  }\n                }\n              }}\n\n            />\n\n            {form.formState.errors.cep && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.cep.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"numero\">N√∫mero *</Label>\n            <Input\n              {...form.register(\"numero\")}\n              placeholder=\"123\"\n              className=\"mt-1\"\n            />\n            {form.formState.errors.numero && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.numero.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"complemento\">Complemento</Label>\n            <Input\n              {...form.register(\"complemento\")}\n              placeholder=\"Apto 123\"\n              className=\"mt-1\"\n            />\n            {form.formState.errors.complemento && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.complemento.message}</p>\n            )}\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <div>\n          <Label htmlFor=\"bairro\">Bairro *</Label>\n          <Input\n            {...form.register(\"bairro\")}\n            placeholder=\"Centro\"\n            className=\"mt-1\"\n            value={bairro}\n            onChange={e => {\n              setBairro(e.target.value);\n              form.setValue(\"bairro\", e.target.value);\n            }}\n          />\n          {form.formState.errors.bairro && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.bairro.message}</p>\n          )}\n        </div>\n        <div>\n          <Label htmlFor=\"cidade\">Cidade *</Label>\n          <Input\n            {...form.register(\"cidade\")}\n            placeholder=\"Sua cidade\"\n            className=\"mt-1\"\n            value={cidade}\n            onChange={e => {\n              setCidade(e.target.value);\n              form.setValue(\"cidade\", e.target.value);\n            }}\n          />\n          {form.formState.errors.cidade && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.cidade.message}</p>\n          )}\n        </div>\n      </div>\n\n\n        <div>\n          <Label htmlFor=\"logradouro\" className=\"flex items-center\">\n            <MapPin className=\"h-4 w-4 mr-1\" />\n            Logradouro *\n          </Label>\n          <Input\n            {...form.register(\"logradouro\")}\n            placeholder=\"Rua, Av, etc.\"\n            className=\"mt-1\"\n            value={logradouro}\n            onChange={e => {\n              setLogradouro(e.target.value);\n              form.setValue(\"logradouro\", e.target.value);\n            }}\n          />\n          {form.formState.errors.logradouro && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.logradouro.message}</p>\n          )}\n        </div>\n\n        <div>\n          <Label htmlFor=\"observacoes\">Observa√ß√µes</Label>\n          <Textarea\n            {...form.register(\"observacoes\")}\n            placeholder=\"Observa√ß√µes sobre o cliente...\"\n            className=\"mt-1 min-h-[80px]\"\n          />\n          {form.formState.errors.observacoes && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.observacoes.message}</p>\n          )}\n        </div>\n\n        <div className=\"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200\">\n          <Button \n            type=\"button\" \n            variant=\"outline\"\n            onClick={onClose}\n          >\n            Cancelar\n          </Button>\n          <Button \n            type=\"submit\" \n            disabled={isLoading}\n            className=\"bg-black text-white hover:bg-gray-800\"\n          >\n            {isLoading ? (\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />\n            ) : null}\n            {client ? \"Atualizar\" : \"Criar\"} Cliente\n          </Button>\n        </div>\n      </form>\n    </div>\n  );\n}\n","size_bytes":16483},"client/src/components/forms/NewClientDialog.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { extendedInsertClientSchema, type InsertClient, type Client } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { UserPlus, Mail, Phone, MapPin } from \"lucide-react\";\n\ninterface NewClientDialogProps {\n  onClientCreated: (client: Client) => void;\n  children: React.ReactNode;\n}\n\nexport default function NewClientDialog({ onClientCreated, children }: NewClientDialogProps) {\n  const [open, setOpen] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  // Estados para valida√ß√£o de CPF\n  const [cpfInput, setCpfInput] = useState(\"\");\n  const [cpfError, setCpfError] = useState<string | null>(null);\n\n  const form = useForm<InsertClient>({\n    resolver: zodResolver(extendedInsertClientSchema),\n    defaultValues: {\n      name: \"\",\n      email: \"\",\n      phone1: \"\",\n      phone2: \"\",\n      cpf: \"\",\n      cep: \"\",\n      logradouro: \"\",\n      numero: \"\",\n      complemento: \"\",\n      observacoes: \"\",\n    },\n  });\n\n  // Query para valida√ß√£o de CPF\n  const { data: cpfValidation, refetch: validateCpf } = useQuery({\n    queryKey: ['/api/clients/validate-cpf', cpfInput],\n    queryFn: async () => {\n      if (!cpfInput || cpfInput.length < 11) return { exists: false };\n      console.log(\"Valida√ß√£o de CPF:\", cpfInput);\n      \n      const response = await fetch(`/api/clients/validate-cpf?cpf=${encodeURIComponent(cpfInput)}`, {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      \n      if (!response.ok) {\n        throw new Error('Erro na valida√ß√£o de CPF');\n      }\n      \n      return response.json();\n    },\n    enabled: false, // S√≥ executa quando chamado manualmente\n  });\n\n  // Effect para validar CPF em tempo real com debounce\n  useEffect(() => {\n    if (cpfInput && cpfInput.length >= 11) {\n      const timer = setTimeout(() => {\n        validateCpf();\n      }, 500); // Debounce de 500ms\n      \n      return () => clearTimeout(timer);\n    } else {\n      setCpfError(null);\n    }\n  }, [cpfInput, validateCpf]);\n\n  // Effect para mostrar erro quando CPF j√° existe\n  useEffect(() => {\n    if (cpfValidation?.exists) {\n      console.log(\"CPF j√° cadastrado:\", cpfInput, \"Nome:\", cpfValidation.clientName);\n      setCpfError(`J√° existe um cliente cadastrado com este CPF: ${cpfValidation.clientName}`);\n    } else {\n      setCpfError(null);\n    }\n  }, [cpfValidation, cpfInput]);\n\n  const createMutation = useMutation({\n    mutationFn: async (data: InsertClient) => {\n      const response = await fetch(\"/api/clients\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          ...(localStorage.getItem(\"token\") && {\n            Authorization: `Bearer ${localStorage.getItem(\"token\")}`,\n          }),\n        },\n        body: JSON.stringify(data),\n      });\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Erro ao criar cliente\");\n      }\n      \n      return response.json();\n    },\n    onSuccess: (newClient) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/clients\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Cliente criado com sucesso!\",\n      });\n      form.reset();\n      setCpfInput(\"\");\n      setCpfError(null);\n      setOpen(false);\n      onClientCreated(newClient);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao criar cliente\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertClient) => {\n    // Impedir envio se CPF j√° est√° cadastrado\n    if (cpfError) {\n      toast({\n        title: \"Erro\",\n        description: \"Corrija os erros antes de salvar\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    createMutation.mutate(data);\n  };\n\n  const isLoading = createMutation.isPending;\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        {children}\n      </DialogTrigger>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center\">\n            <UserPlus className=\"h-5 w-5 mr-2 text-burnt-yellow\" />\n            Novo Cliente\n          </DialogTitle>\n        </DialogHeader>\n\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"name\">Nome *</Label>\n            <Input\n              {...form.register(\"name\")}\n              placeholder=\"Nome da empresa ou pessoa\"\n              className=\"mt-1\"\n            />\n            {form.formState.errors.name && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.name.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"email\" className=\"flex items-center\">\n              <Mail className=\"h-4 w-4 mr-1\" />\n              Email\n            </Label>\n            <Input\n              {...form.register(\"email\")}\n              type=\"email\"\n              placeholder=\"email@exemplo.com\"\n              className=\"mt-1\"\n            />\n            {form.formState.errors.email && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.email.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"cpf\">CPF *</Label>\n            <Input\n              placeholder=\"000.000.000-00\"\n              className={`mt-1 ${cpfError ? 'border-red-500' : ''}`}\n              maxLength={14}\n              value={cpfInput}\n              onChange={(e) => {\n                let value = e.target.value.replace(/\\D/g, '');\n                console.log(\"Valida√ß√£o de CPF:\", value);\n                \n                if (value.length > 11) {\n                  value = value.slice(0, 11);\n                }\n                const formattedValue = value.replace(/(\\d{3})(\\d{3})(\\d{3})(\\d{0,2})/, '$1.$2.$3-$4');\n                \n                setCpfInput(formattedValue);\n                form.setValue(\"cpf\", formattedValue);\n              }}\n            />\n            {form.formState.errors.cpf && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.cpf.message}</p>\n            )}\n            {cpfError && (\n              <p className=\"text-sm text-red-600 mt-1\">{cpfError}</p>\n            )}\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <Label htmlFor=\"phone1\" className=\"flex items-center\">\n                <Phone className=\"h-4 w-4 mr-1\" />\n                Telefone 1 *\n              </Label>\n              <Input\n                {...form.register(\"phone1\")}\n                placeholder=\"(11) 99999-9999\"\n                className=\"mt-1\"\n                maxLength={15}\n                onChange={(e) => {\n                  let value = e.target.value.replace(/\\D/g, '');\n                  if (value.length > 11) {\n                    value = value.slice(0, 11);\n                  }\n                  if (value.length <= 10) {\n                    value = value.replace(/(\\d{2})(\\d{4})(\\d{0,4})/, '($1) $2-$3');\n                  } else {\n                    value = value.replace(/(\\d{2})(\\d{5})(\\d{0,4})/, '($1) $2-$3');\n                  }\n                  e.target.value = value;\n                  form.setValue(\"phone1\", value);\n                }}\n              />\n              {form.formState.errors.phone1 && (\n                <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.phone1.message}</p>\n              )}\n            </div>\n\n            <div>\n              <Label htmlFor=\"phone2\" className=\"flex items-center\">\n                <Phone className=\"h-4 w-4 mr-1\" />\n                Telefone 2\n              </Label>\n              <Input\n                {...form.register(\"phone2\")}\n                placeholder=\"(11) 99999-9999\"\n                className=\"mt-1\"\n                maxLength={15}\n                onChange={(e) => {\n                  let value = e.target.value.replace(/\\D/g, '');\n                  if (value.length > 11) {\n                    value = value.slice(0, 11);\n                  }\n                  if (value.length <= 10) {\n                    value = value.replace(/(\\d{2})(\\d{4})(\\d{0,4})/, '($1) $2-$3');\n                  } else {\n                    value = value.replace(/(\\d{2})(\\d{5})(\\d{0,4})/, '($1) $2-$3');\n                  }\n                  e.target.value = value;\n                  form.setValue(\"phone2\", value);\n                }}\n              />\n              {form.formState.errors.phone2 && (\n                <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.phone2.message}</p>\n              )}\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div>\n              <Label htmlFor=\"cep\">CEP *</Label>\n              <Input\n                {...form.register(\"cep\")}\n                placeholder=\"00000-000\"\n                maxLength={9}\n                className=\"mt-1\"\n                onChange={(e) => {\n                  let value = e.target.value.replace(/\\D/g, '');\n                  if (value.length > 5) {\n                    value = value.slice(0, 5) + '-' + value.slice(5, 8);\n                  }\n                  form.setValue(\"cep\", value);\n                }}\n              />\n              {form.formState.errors.cep && (\n                <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.cep.message}</p>\n              )}\n            </div>\n\n            <div>\n              <Label htmlFor=\"numero\">N√∫mero *</Label>\n              <Input\n                {...form.register(\"numero\")}\n                placeholder=\"123\"\n                className=\"mt-1\"\n              />\n              {form.formState.errors.numero && (\n                <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.numero.message}</p>\n              )}\n            </div>\n\n            <div>\n              <Label htmlFor=\"complemento\">Complemento</Label>\n              <Input\n                {...form.register(\"complemento\")}\n                placeholder=\"Apto 123\"\n                className=\"mt-1\"\n              />\n              {form.formState.errors.complemento && (\n                <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.complemento.message}</p>\n              )}\n            </div>\n          </div>\n\n          <div>\n            <Label htmlFor=\"logradouro\" className=\"flex items-center\">\n              <MapPin className=\"h-4 w-4 mr-1\" />\n              Logradouro *\n            </Label>\n            <Input\n              {...form.register(\"logradouro\")}\n              placeholder=\"Rua, Av, etc.\"\n              className=\"mt-1\"\n            />\n            {form.formState.errors.logradouro && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.logradouro.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"observacoes\">Observa√ß√µes</Label>\n            <Textarea\n              {...form.register(\"observacoes\")}\n              placeholder=\"Observa√ß√µes sobre o cliente...\"\n              className=\"mt-1 min-h-[80px]\"\n            />\n            {form.formState.errors.observacoes && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.observacoes.message}</p>\n            )}\n          </div>\n\n          <div className=\"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200\">\n            <Button \n              type=\"button\" \n              variant=\"outline\"\n              onClick={() => setOpen(false)}\n            >\n              Cancelar\n            </Button>\n            <Button \n              type=\"submit\" \n              disabled={isLoading}\n              className=\"bg-black text-white hover:bg-gray-800\"\n            >\n              {isLoading ? (\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />\n              ) : null}\n              Criar Cliente\n            </Button>\n          </div>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":12745},"client/src/components/forms/ServiceForm.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { insertServiceSchema, type InsertService, type Service } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Wrench, Clock, DollarSign, FileText, Award } from \"lucide-react\";\n\ninterface ServiceFormProps {\n  service?: Service | null;\n  onClose: () => void;\n}\n\nexport default function ServiceForm({ service, onClose }: ServiceFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const form = useForm<InsertService>({\n    resolver: zodResolver(insertServiceSchema),\n    defaultValues: service ? {\n      name: service.name,\n      description: service.description || \"\",\n      duration: service.duration,\n      price: service.price || \"\",\n      cost: service.cost || \"\",\n      points: service.points || undefined,\n    } : {\n      name: \"\",\n      description: \"\",\n      duration: 60,\n      price: \"\",\n      cost: \"\",\n      points: undefined,\n    },\n  });\n\n  const createServiceMutation = useMutation({\n    mutationFn: async (data: InsertService) => {\n      const response = await apiRequest(\"POST\", \"/api/services\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/services\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Servi√ßo criado com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao criar servi√ßo\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateServiceMutation = useMutation({\n    mutationFn: async (data: InsertService) => {\n      const response = await apiRequest(\"PUT\", `/api/services/${service!.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/services\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Servi√ßo atualizado com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao atualizar servi√ßo\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertService) => {\n    if (service) {\n      updateServiceMutation.mutate(data);\n    } else {\n      createServiceMutation.mutate(data);\n    }\n  };\n\n  const isLoading = createServiceMutation.isPending || updateServiceMutation.isPending;\n\n  return (\n    <div className=\"space-y-6\">\n      <DialogHeader>\n        <DialogTitle className=\"flex items-center\">\n          <Wrench className=\"h-5 w-5 mr-2 text-burnt-yellow\" />\n          {service ? \"Editar Servi√ßo\" : \"Novo Servi√ßo\"}\n        </DialogTitle>\n      </DialogHeader>\n\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div>\n          <Label htmlFor=\"name\">Nome do Servi√ßo *</Label>\n          <Input\n            {...form.register(\"name\")}\n            placeholder=\"Ex: Manuten√ß√£o Preventiva, Instala√ß√£o\"\n            className=\"mt-1\"\n          />\n          {form.formState.errors.name && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.name.message}</p>\n          )}\n        </div>\n\n        <div>\n          <Label htmlFor=\"description\" className=\"flex items-center\">\n            <FileText className=\"h-4 w-4 mr-1\" />\n            Descri√ß√£o\n          </Label>\n          <Textarea\n            {...form.register(\"description\")}\n            placeholder=\"Descreva os detalhes do servi√ßo oferecido\"\n            rows={3}\n            className=\"mt-1\"\n          />\n          {form.formState.errors.description && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.description.message}</p>\n          )}\n        </div>\n\n        <div>\n          <Label htmlFor=\"duration\" className=\"flex items-center\">\n            <Clock className=\"h-4 w-4 mr-1\" />\n            Dura√ß√£o (minutos) *\n          </Label>\n          <Input\n            {...form.register(\"duration\", { valueAsNumber: true })}\n            type=\"number\"\n            min=\"1\"\n            step=\"1\"\n            placeholder=\"60\"\n            className=\"mt-1\"\n          />\n          {form.formState.errors.duration && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.duration.message}</p>\n          )}\n        </div>\n\n        {/* Campo adicionado para pontos/remunera√ß√£o conforme solicitado */}\n        <div>\n          <Label htmlFor=\"points\" className=\"flex items-center\">\n            <Award className=\"h-4 w-4 mr-1\" />\n            Pontos/remunera√ß√£o\n          </Label>\n          <Input\n            {...form.register(\"points\", { valueAsNumber: true })}\n            type=\"number\"\n            min=\"0\"\n            step=\"1\"\n            placeholder=\"100\"\n            className=\"mt-1\"\n          />\n          {form.formState.errors.points && (\n            <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.points.message}</p>\n          )}\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <Label htmlFor=\"price\" className=\"flex items-center\">\n              <DollarSign className=\"h-4 w-4 mr-1\" />\n              Pre√ßo (R$)\n            </Label>\n            <Input\n              {...form.register(\"price\")}\n              type=\"number\"\n              min=\"0\"\n              step=\"0.01\"\n              placeholder=\"100.00\"\n              className=\"mt-1\"\n            />\n            {form.formState.errors.price && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.price.message}</p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"cost\" className=\"flex items-center\">\n              <DollarSign className=\"h-4 w-4 mr-1\" />\n              Custo (R$)\n            </Label>\n            <Input\n              {...form.register(\"cost\")}\n              type=\"number\"\n              min=\"0\"\n              step=\"0.01\"\n              placeholder=\"50.00\"\n              className=\"mt-1\"\n            />\n            {form.formState.errors.cost && (\n              <p className=\"text-sm text-red-600 mt-1\">{form.formState.errors.cost.message}</p>\n            )}\n          </div>\n        </div>\n\n        <div className=\"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200\">\n          <Button \n            type=\"button\" \n            variant=\"outline\"\n            onClick={onClose}\n          >\n            Cancelar\n          </Button>\n          <Button \n            type=\"submit\" \n            disabled={isLoading}\n            className=\"bg-black text-white hover:bg-gray-800\"\n          >\n            {isLoading ? (\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />\n            ) : null}\n            {service ? \"Atualizar\" : \"Criar\"} Servi√ßo\n          </Button>\n        </div>\n      </form>\n    </div>\n  );\n}\n","size_bytes":7340},"client/src/components/forms/TeamForm.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\nimport { extendedInsertTeamSchema, type InsertTeam, type Team, type Technician, type Service } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Users, UserPlus } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface TeamFormProps {\n  team?: Team | null;\n  technicians: Technician[];\n  services: Service[];\n  onClose: () => void;\n}\n\n// Usar o schema estendido importado que j√° inclui os campos de endere√ßo\nconst extendedFormTeamSchema = extendedInsertTeamSchema.extend({\n  technicianIds: extendedInsertTeamSchema.shape.name.array().optional(),\n});\n\ntype ExtendedTeamForm = {\n  name: string;\n  technicianIds?: number[];\n  serviceIds?: string[];\n  // Campos de endere√ßo de in√≠cio di√°rio\n  enderecoInicioCep?: string;\n  enderecoInicioLogradouro?: string;\n  enderecoInicioNumero?: string;\n  enderecoInicioComplemento?: string;\n};\n\nexport default function TeamForm({ \n  team, \n  technicians, \n  services, \n  onClose \n}: TeamFormProps) {\n  const [selectedTechnicians, setSelectedTechnicians] = useState<number[]>([]);\n  const [selectedServices, setSelectedServices] = useState<number[]>(\n    team?.serviceIds ? team.serviceIds.map(id => parseInt(id)) : []\n  );\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Buscar membros da equipe quando editando uma equipe existente\n  const { data: teamMembers = [] } = useQuery({\n    queryKey: [\"/api/team-members\", team?.id],\n    queryFn: async () => {\n      if (!team) return [];\n      const response = await fetch(`/api/team-members/${team.id}`, {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!response.ok) return [];\n      return response.json();\n    },\n    enabled: !!team,\n  });\n\n  const form = useForm<ExtendedTeamForm>({\n    resolver: zodResolver(extendedFormTeamSchema),\n    defaultValues: {\n      name: \"\",\n      technicianIds: [],\n      serviceIds: [],\n      // Campos de endere√ßo de in√≠cio di√°rio\n      enderecoInicioCep: \"\",\n      enderecoInicioLogradouro: \"\",\n      enderecoInicioNumero: \"\",\n      enderecoInicioComplemento: \"\",\n    },\n  });\n\n  // Resetar o formul√°rio quando a equipe muda ou quando abre para nova equipe\n  useEffect(() => {\n    console.log('üîÑ useEffect - team mudou:', team);\n    if (team && team.id) {\n      console.log('üìù Carregando dados da equipe para edi√ß√£o:', team);\n      // Edi√ß√£o: carregar dados da equipe existente\n      const serviceIds = team.serviceIds ? team.serviceIds.map(id => parseInt(id)) : [];\n      \n      form.reset({\n        name: team.name || \"\",\n        technicianIds: selectedTechnicians,\n        serviceIds: serviceIds.map(id => id.toString()),\n        // Campos de endere√ßo de in√≠cio di√°rio\n        enderecoInicioCep: team.enderecoInicioCep || \"\",\n        enderecoInicioLogradouro: team.enderecoInicioLogradouro || \"\",\n        enderecoInicioNumero: team.enderecoInicioNumero || \"\",\n        enderecoInicioComplemento: team.enderecoInicioComplemento || \"\",\n      });\n      \n      setSelectedServices(serviceIds);\n      console.log('‚úÖ Formul√°rio resetado para edi√ß√£o com dados:', {\n        name: team.name,\n        serviceIds: serviceIds\n      });\n    } else {\n      console.log('‚ûï Limpando formul√°rio para nova equipe');\n      // Nova equipe: limpar formul√°rio\n      form.reset({\n        name: \"\",\n        technicianIds: [],\n        serviceIds: [],\n        // Campos de endere√ßo de in√≠cio di√°rio\n        enderecoInicioCep: \"\",\n        enderecoInicioLogradouro: \"\",\n        enderecoInicioNumero: \"\",\n        enderecoInicioComplemento: \"\",\n      });\n      setSelectedTechnicians([]);\n      setSelectedServices([]);\n      console.log('‚úÖ Formul√°rio limpo para nova equipe');\n    }\n  }, [team, form]);\n\n  // Atualizar t√©cnicos selecionados quando os membros da equipe s√£o carregados\n  useEffect(() => {\n    if (team && teamMembers.length > 0) {\n      const technicianIds = teamMembers.map((member: any) => member.technicianId);\n      setSelectedTechnicians(technicianIds);\n      form.setValue('technicianIds', technicianIds);\n    }\n  }, [teamMembers, form]);\n\n  const createTeamMutation = useMutation({\n    mutationFn: async (data: ExtendedTeamForm) => {\n      // Primeiro criar a equipe\n      const teamData = {\n        name: data.name,\n        serviceIds: data.serviceIds || [],\n        // Campos de endere√ßo de in√≠cio di√°rio\n        enderecoInicioCep: data.enderecoInicioCep || \"\",\n        enderecoInicioLogradouro: data.enderecoInicioLogradouro || \"\",\n        enderecoInicioNumero: data.enderecoInicioNumero || \"\",\n        enderecoInicioComplemento: data.enderecoInicioComplemento || \"\",\n      };\n      \n      const response = await apiRequest(\"POST\", \"/api/teams\", teamData);\n      const newTeam = await response.json();\n      \n      // Depois adicionar os membros da equipe\n      if (data.technicianIds && data.technicianIds.length > 0) {\n        await Promise.all(\n          data.technicianIds.map(technicianId =>\n            apiRequest(\"POST\", \"/api/team-members\", {\n              teamId: newTeam.id,\n              technicianId,\n            })\n          )\n        );\n      }\n      \n      return newTeam;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/teams\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-members\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Equipe criada com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao criar equipe\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateTeamMutation = useMutation({\n    mutationFn: async (data: ExtendedTeamForm) => {\n      // Primeiro atualizar dados da equipe\n      const teamData = {\n        name: data.name,\n        serviceIds: data.serviceIds || [],\n        // Campos de endere√ßo de in√≠cio di√°rio\n        enderecoInicioCep: data.enderecoInicioCep || \"\",\n        enderecoInicioLogradouro: data.enderecoInicioLogradouro || \"\",\n        enderecoInicioNumero: data.enderecoInicioNumero || \"\",\n        enderecoInicioComplemento: data.enderecoInicioComplemento || \"\",\n      };\n      \n      const response = await apiRequest(\"PUT\", `/api/teams/${team?.id}`, teamData);\n      const updatedTeam = await response.json();\n      \n      // Remover todos os membros existentes da equipe\n      const currentMembers = await fetch(`/api/team-members/${team?.id}`, {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      \n      if (currentMembers.ok) {\n        const members = await currentMembers.json();\n        \n        if (members.length > 0) {\n          await Promise.all(\n            members.map((member: any) => \n              apiRequest(\"DELETE\", `/api/team-members/${member.id}`)\n            )\n          );\n        }\n      }\n      \n      // Adicionar os novos membros selecionados\n      if (data.technicianIds && data.technicianIds.length > 0) {\n        await Promise.all(\n          data.technicianIds.map(technicianId =>\n            apiRequest(\"POST\", \"/api/team-members\", {\n              teamId: team?.id,\n              technicianId,\n            })\n          )\n        );\n      }\n      \n      return updatedTeam;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/teams\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-members\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Equipe atualizada com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao atualizar equipe\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ExtendedTeamForm) => {\n    const formData = {\n      ...data,\n      technicianIds: selectedTechnicians,\n      serviceIds: selectedServices.map(id => id.toString()),\n    };\n    \n    if (team) {\n      updateTeamMutation.mutate(formData);\n    } else {\n      createTeamMutation.mutate(formData);\n    }\n  };\n\n  const isLoading = createTeamMutation.isPending || updateTeamMutation.isPending;\n\n  const handleTechnicianToggle = (technicianId: number, checked: boolean) => {\n    if (checked) {\n      setSelectedTechnicians(prev => [...prev, technicianId]);\n    } else {\n      setSelectedTechnicians(prev => prev.filter(id => id !== technicianId));\n    }\n  };\n\n  const handleServiceToggle = (serviceId: number, checked: boolean) => {\n    if (checked) {\n      setSelectedServices(prev => [...prev, serviceId]);\n    } else {\n      setSelectedServices(prev => prev.filter(id => id !== serviceId));\n    }\n  };\n\n  return (\n    <div className=\"max-h-[80vh] overflow-y-auto\">\n      <DialogHeader>\n        <DialogTitle className=\"flex items-center gap-2\">\n          <Users className=\"h-5 w-5\" />\n          {team ? \"Editar Equipe\" : \"Cadastrar Nova Equipe\"}\n        </DialogTitle>\n      </DialogHeader>\n\n      <Form {...form}>\n          <form\n            onSubmit={form.handleSubmit((data) => {\n              console.log(\"üõéÔ∏è onSubmit disparado COM CERTEZA!\", { team, data });\n              onSubmit(data);\n            })}\n            className=\"space-y-6\"\n          >\n\n          {/* Nome da Equipe */}\n          <FormField\n            control={form.control}\n            name=\"name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Nome da Equipe *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Ex: Equipe Alpha\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          {/* Endere√ßo de In√≠cio Di√°rio (Opcional) */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"h-5 w-5 text-blue-500\">üìç</span>\n              <h3 className=\"text-lg font-medium\">Endere√ßo de In√≠cio Di√°rio (Opcional)</h3>\n            </div>\n            <p className=\"text-sm text-gray-500\">\n              Se preenchido, ser√° usado como ponto de partida na roteiriza√ß√£o. Caso contr√°rio, ser√° usado o endere√ßo padr√£o da empresa.\n            </p>\n            \n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioCep\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>CEP de In√≠cio</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"00000-000\"\n                        maxLength={9}\n                        {...field}\n                        value={field.value || \"\"}\n                        onChange={(e) => {\n                          let value = e.target.value.replace(/\\D/g, '');\n                          if (value.length > 5) {\n                            value = value.slice(0, 5) + '-' + value.slice(5, 8);\n                          }\n                          field.onChange(value);\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioNumero\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>N√∫mero</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"123\"\n                        {...field}\n                        value={field.value || \"\"}\n                        onChange={(e) => {\n                          const value = e.target.value.replace(/\\D/g, '');\n                          field.onChange(value);\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioLogradouro\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Logradouro</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Rua das Flores\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioComplemento\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Complemento</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Apto 123\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n          </div>\n\n          {/* Sele√ß√£o de T√©cnicos */}\n          <div className=\"space-y-3\">\n            <FormLabel>T√©cnicos da Equipe</FormLabel>\n            <div className=\"border rounded-lg p-4 max-h-48 overflow-y-auto\">\n              {technicians.length === 0 ? (\n                <p className=\"text-sm text-gray-500 text-center py-4\">\n                  Nenhum t√©cnico cadastrado. Cadastre t√©cnicos primeiro para formar equipes.\n                </p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {technicians.map((technician) => (\n                    <div key={technician.id} className=\"flex items-center space-x-2\">\n                      <Checkbox\n                        id={`technician-${technician.id}`}\n                        checked={selectedTechnicians.includes(technician.id)}\n                        onCheckedChange={(checked) => \n                          handleTechnicianToggle(technician.id, checked as boolean)\n                        }\n                      />\n                      <label\n                        htmlFor={`technician-${technician.id}`}\n                        className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer\"\n                      >\n                        {technician.name}\n                      </label>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n            {selectedTechnicians.length > 0 && (\n              <p className=\"text-xs text-gray-500\">\n                {selectedTechnicians.length} t√©cnico(s) selecionado(s)\n              </p>\n            )}\n          </div>\n\n          {/* Sele√ß√£o de Servi√ßos */}\n          <div className=\"space-y-3\">\n            <FormLabel>Tipos de Servi√ßos que a Equipe Atende</FormLabel>\n            <div className=\"border rounded-lg p-4 max-h-48 overflow-y-auto\">\n              {services.length === 0 ? (\n                <p className=\"text-sm text-gray-500 text-center py-4\">\n                  Nenhum servi√ßo cadastrado. Cadastre servi√ßos primeiro para vincular √†s equipes.\n                </p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {services.map((service) => (\n                    <div key={service.id} className=\"flex items-center space-x-2\">\n                      <Checkbox\n                        id={`service-${service.id}`}\n                        checked={selectedServices.includes(service.id)}\n                        onCheckedChange={(checked) => \n                          handleServiceToggle(service.id, checked as boolean)\n                        }\n                      />\n                      <label\n                        htmlFor={`service-${service.id}`}\n                        className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer\"\n                      >\n                        {service.name}\n                        {service.price && (\n                          <span className=\"text-xs text-gray-500 ml-2\">\n                            (R$ {Number(service.price).toFixed(2)})\n                          </span>\n                        )}\n                      </label>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n            {selectedServices.length > 0 && (\n              <p className=\"text-xs text-gray-500\">\n                {selectedServices.length} servi√ßo(s) selecionado(s)\n              </p>\n            )}\n          </div>\n\n          <div className=\"flex justify-end space-x-2 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              Cancelar\n            </Button>\n            <Button \n              type=\"submit\"\n              // CORRE√á√ÉO: Disabled dividido para modos cria√ß√£o/edi√ß√£o\n              // Em modo edi√ß√£o (team existe): usar somente updateTeamMutation.isPending\n              // Em modo cria√ß√£o (team n√£o existe): usar somente createTeamMutation.isPending\n              // disabled={ team ? updateTeamMutation.isPending : createTeamMutation.isPending }\n              className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n            >\n              {(team ? updateTeamMutation.isPending : createTeamMutation.isPending) ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                  {team ? \"Atualizando...\" : \"Criando...\"}\n                </>\n              ) : (\n                <>\n                  <UserPlus className=\"h-4 w-4 mr-2\" />\n                  {team ? \"Atualizar Equipe\" : \"Criar Equipe\"}\n                </>\n              )}\n            </Button>\n          </div>\n        </form>\n      </Form>\n    </div>\n  );\n}","size_bytes":18613},"client/src/components/forms/TechnicianForm.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { extendedInsertTechnicianSchema, type InsertTechnician, type Technician, type Service } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { UserCog, Mail, Phone, Wrench, MapPin, FileText } from \"lucide-react\";\n\n// Fun√ß√£o para buscar endere√ßo por CEP - igual ao cadastro de cliente\nasync function buscarEnderecoPorCep(cep: string) {\n  const url = `https://viacep.com.br/ws/${cep.replace(/\\D/g, '')}/json/`;\n  const res = await fetch(url);\n  const data = await res.json();\n  if (data.erro) throw new Error(\"CEP n√£o encontrado\");\n  return data; // {logradouro, bairro, localidade, uf, ...}\n}\n\ninterface TechnicianFormProps {\n  technician?: Technician | null;\n  services: Service[];\n  onClose: () => void;\n}\n\nexport default function TechnicianForm({ technician, services, onClose }: TechnicianFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const form = useForm<InsertTechnician>({\n    resolver: zodResolver(extendedInsertTechnicianSchema),\n    defaultValues: technician ? {\n      name: technician.name,\n      email: technician.email || \"\",\n      phone: technician.phone,\n      documento: technician.documento,\n      cep: technician.cep,\n      logradouro: technician.logradouro,\n      numero: technician.numero,\n      complemento: technician.complemento || \"\",\n      bairro: technician.bairro || \"\",\n      cidade: technician.cidade || \"\",\n      estado: technician.estado || \"\",\n      specialization: technician.specialization || \"\",\n      observacoes: technician.observacoes || \"\",\n      serviceIds: technician.serviceIds || [],\n      // Campos de endere√ßo de in√≠cio di√°rio\n      enderecoInicioCep: technician.enderecoInicioCep || \"\",\n      enderecoInicioLogradouro: technician.enderecoInicioLogradouro || \"\",\n      enderecoInicioNumero: technician.enderecoInicioNumero || \"\",\n      enderecoInicioComplemento: technician.enderecoInicioComplemento || \"\",\n      enderecoInicioBairro: technician.enderecoInicioBairro || \"\",\n      enderecoInicioCidade: technician.enderecoInicioCidade || \"\",\n      enderecoInicioEstado: technician.enderecoInicioEstado || \"\",\n      isActive: technician.isActive,\n    } : {\n      name: \"\",\n      email: \"\",\n      phone: \"\",\n      documento: \"\",\n      cep: \"\",\n      logradouro: \"\",\n      numero: \"\",\n      complemento: \"\",\n      bairro: \"\",\n      cidade: \"\",\n      estado: \"\",\n      specialization: \"\",\n      observacoes: \"\",\n      serviceIds: [],\n      // Campos de endere√ßo de in√≠cio di√°rio\n      enderecoInicioCep: \"\",\n      enderecoInicioLogradouro: \"\",\n      enderecoInicioNumero: \"\",\n      enderecoInicioComplemento: \"\",\n      enderecoInicioBairro: \"\",\n      enderecoInicioCidade: \"\",\n      enderecoInicioEstado: \"\",\n      isActive: true,\n    },\n  });\n\n  const createTechnicianMutation = useMutation({\n    mutationFn: async (data: InsertTechnician) => {\n      console.log('üîÑ TechnicianForm - Iniciando cria√ß√£o de t√©cnico:', data);\n      const response = await apiRequest(\"POST\", \"/api/technicians\", data);\n      const result = await response.json();\n      console.log('üì¶ TechnicianForm - Resposta recebida:', result);\n      return result;\n    },\n    onSuccess: (result) => {\n      console.log('‚úÖ TechnicianForm - T√©cnico criado com sucesso:', result);\n      \n      // Mostrar toast de sucesso imediatamente\n      toast({\n        title: \"Sucesso\",\n        description: \"T√©cnico criado com sucesso\",\n      });\n      \n      // Fechar modal primeiro para evitar conflitos DOM\n      console.log('üö™ TechnicianForm - Fechando modal antes de invalidar cache');\n      onClose();\n      \n      // Invalidar cache ap√≥s o modal ser fechado\n      requestAnimationFrame(() => {\n        console.log('üîÉ TechnicianForm - Invalidando cache ap√≥s fechamento do modal');\n        queryClient.invalidateQueries({ queryKey: [\"/api/technicians\"] });\n        console.log('‚ú® TechnicianForm - Processo de cria√ß√£o finalizado');\n      });\n    },\n    onError: (error: Error) => {\n      console.error('‚ùå TechnicianForm - Erro ao criar t√©cnico:', error);\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao criar t√©cnico\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateTechnicianMutation = useMutation({\n    mutationFn: async (data: InsertTechnician) => {\n      console.log('üîÑ TechnicianForm - Iniciando atualiza√ß√£o de t√©cnico:', { id: technician?.id, data });\n      const response = await apiRequest(\"PUT\", `/api/technicians/${technician?.id}`, data);\n      const result = await response.json();\n      console.log('üì¶ TechnicianForm - Resposta da atualiza√ß√£o recebida:', result);\n      return result;\n    },\n    onSuccess: (result) => {\n      console.log('‚úÖ TechnicianForm - T√©cnico atualizado com sucesso:', result);\n      \n      // Mostrar toast de sucesso imediatamente\n      toast({\n        title: \"Sucesso\",\n        description: \"T√©cnico atualizado com sucesso\",\n      });\n      \n      // Fechar modal primeiro para evitar conflitos DOM\n      console.log('üö™ TechnicianForm - Fechando modal antes de invalidar cache (atualiza√ß√£o)');\n      onClose();\n      \n      // Invalidar cache ap√≥s o modal ser fechado\n      requestAnimationFrame(() => {\n        console.log('üîÉ TechnicianForm - Invalidando cache ap√≥s fechamento do modal (atualiza√ß√£o)');\n        queryClient.invalidateQueries({ queryKey: [\"/api/technicians\"] });\n        console.log('‚ú® TechnicianForm - Processo de atualiza√ß√£o finalizado');\n      });\n    },\n    onError: (error: Error) => {\n      console.error('‚ùå TechnicianForm - Erro ao atualizar t√©cnico:', error);\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao atualizar t√©cnico\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertTechnician) => {\n    if (technician) {\n      updateTechnicianMutation.mutate(data);\n    } else {\n      createTechnicianMutation.mutate(data);\n    }\n  };\n\n  const isLoading = createTechnicianMutation.isPending || updateTechnicianMutation.isPending;\n\n  return (\n    <div className=\"space-y-6 max-h-[80vh] overflow-y-auto\">\n      <DialogHeader>\n        <DialogTitle className=\"flex items-center\">\n          <UserCog className=\"h-5 w-5 mr-2 text-burnt-yellow\" />\n          {technician ? \"Editar T√©cnico\" : \"Novo T√©cnico\"}\n        </DialogTitle>\n      </DialogHeader>\n\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Nome *</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Nome completo do t√©cnico\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"documento\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>CPF *</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"000.000.000-00\"\n                      maxLength={14}\n                      {...field}\n                      onChange={(e) => {\n                        let value = e.target.value.replace(/\\D/g, '');\n                        if (value.length > 3) value = value.slice(0, 3) + '.' + value.slice(3);\n                        if (value.length > 7) value = value.slice(0, 7) + '.' + value.slice(7);\n                        if (value.length > 11) value = value.slice(0, 11) + '-' + value.slice(11, 13);\n                        field.onChange(value);\n                      }}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <FormField\n              control={form.control}\n              name=\"email\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"flex items-center gap-1\">\n                    <Mail className=\"h-4 w-4\" />\n                    Email\n                  </FormLabel>\n                  <FormControl>\n                    <Input \n                      type=\"email\" \n                      placeholder=\"email@exemplo.com\" \n                      {...field} \n                      value={field.value || \"\"} \n                      onChange={(e) => {\n                        // Valida√ß√£o de email: deve conter @ para ser v√°lido\n                        const value = e.target.value;\n                        field.onChange(value);\n                        if (value && !value.includes('@')) {\n                          form.setError('email', { \n                            type: 'manual', \n                            message: 'Email deve conter o caractere @' \n                          });\n                        } else {\n                          form.clearErrors('email');\n                        }\n                      }}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"phone\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"flex items-center gap-1\">\n                    <Phone className=\"h-4 w-4\" />\n                    Telefone *\n                  </FormLabel>\n                  <FormControl>\n                    <Input \n                      placeholder=\"(11) 99999-9999\" \n                      {...field} \n                      onChange={(e) => {\n                        // Formata√ß√£o autom√°tica do telefone: aceitar apenas n√∫meros e formatar\n                        let value = e.target.value.replace(/\\D/g, '');\n                        if (value.length <= 10) {\n                          // Formato: (XX)XXXX-XXXX\n                          if (value.length > 2) value = `(${value.slice(0, 2)}) ${value.slice(2)}`;\n                          if (value.length > 9) value = value.slice(0, 9) + '-' + value.slice(9);\n                        } else {\n                          // Formato: (XX)XXXXX-XXXX\n                          if (value.length > 2) value = `(${value.slice(0, 2)}) ${value.slice(2)}`;\n                          if (value.length > 10) value = value.slice(0, 10) + '-' + value.slice(10, 14);\n                        }\n                        field.onChange(value);\n                      }}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2\">\n              <MapPin className=\"h-5 w-5 text-gray-500\" />\n              <h3 className=\"text-lg font-medium\">Endere√ßo</h3>\n            </div>\n            \n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <FormField\n                control={form.control}\n                name=\"cep\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>CEP *</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"00000-000\"\n                        maxLength={9}\n                        {...field}\n                        onChange={async (e) => {\n                          let value = e.target.value.replace(/\\D/g, '');\n                          if (value.length > 5) {\n                            value = value.slice(0, 5) + '-' + value.slice(5, 8);\n                          }\n                          field.onChange(value);\n\n                          // Busca autom√°tica de endere√ßo quando CEP tem 8 d√≠gitos\n                          if (value.replace(/\\D/g, '').length === 8) {\n                            try {\n                              const endereco = await buscarEnderecoPorCep(value);\n\n                              // Preenche os campos automaticamente\n                              form.setValue(\"logradouro\", endereco.logradouro || \"\");\n                              form.setValue(\"bairro\", endereco.bairro || \"\");\n                              form.setValue(\"cidade\", endereco.localidade || \"\");\n                              form.setValue(\"estado\", endereco.uf || \"\");\n\n                            } catch (err) {\n                              toast({\n                                title: \"CEP n√£o encontrado\",\n                                description: \"Preencha o endere√ßo manualmente.\",\n                                variant: \"destructive\",\n                              });\n                              form.setValue(\"logradouro\", \"\");\n                              form.setValue(\"bairro\", \"\");\n                              form.setValue(\"cidade\", \"\");\n                              form.setValue(\"estado\", \"\");\n                            }\n                          }\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"numero\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>N√∫mero *</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"123\"\n                        {...field}\n                        onChange={(e) => {\n                          const value = e.target.value.replace(/\\D/g, '');\n                          field.onChange(value);\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"logradouro\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Logradouro *</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Rua das Flores\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"complemento\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Complemento</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Apto 123\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"bairro\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Bairro *</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Centro\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"cidade\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Cidade *</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"S√£o Paulo\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"estado\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Estado (UF) *</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"SP\" maxLength={2} {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n          </div>\n\n          {/* Endere√ßo de In√≠cio Di√°rio (Opcional) */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2\">\n              <MapPin className=\"h-5 w-5 text-blue-500\" />\n              <h3 className=\"text-lg font-medium\">Endere√ßo de In√≠cio Di√°rio (Opcional)</h3>\n            </div>\n            <p className=\"text-sm text-gray-500\">\n              Se preenchido, ser√° usado como ponto de partida na roteiriza√ß√£o. Caso contr√°rio, ser√° usado o endere√ßo padr√£o da empresa.\n            </p>\n            \n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioCep\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>CEP</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"00000-000\"\n                        maxLength={9}\n                        {...field}\n                        value={field.value || \"\"}\n                        onChange={async (e) => {\n                          let value = e.target.value.replace(/\\D/g, '');\n                          if (value.length > 5) {\n                            value = value.slice(0, 5) + '-' + value.slice(5, 8);\n                          }\n                          field.onChange(value);\n\n                          // Busca autom√°tica de endere√ßo quando CEP tem 8 d√≠gitos\n                          if (value.replace(/\\D/g, '').length === 8) {\n                            try {\n                              const endereco = await buscarEnderecoPorCep(value);\n\n                              // Preenche os campos automaticamente\n                              form.setValue(\"enderecoInicioLogradouro\", endereco.logradouro || \"\");\n                              form.setValue(\"enderecoInicioBairro\", endereco.bairro || \"\");\n                              form.setValue(\"enderecoInicioCidade\", endereco.localidade || \"\");\n                              form.setValue(\"enderecoInicioEstado\", endereco.uf || \"\");\n\n                            } catch (err) {\n                              toast({\n                                title: \"CEP n√£o encontrado\",\n                                description: \"Preencha o endere√ßo manualmente.\",\n                                variant: \"destructive\",\n                              });\n                              form.setValue(\"enderecoInicioLogradouro\", \"\");\n                              form.setValue(\"enderecoInicioBairro\", \"\");\n                              form.setValue(\"enderecoInicioCidade\", \"\");\n                              form.setValue(\"enderecoInicioEstado\", \"\");\n                            }\n                          }\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioNumero\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>N√∫mero</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"123\"\n                        {...field}\n                        value={field.value || \"\"}\n                        onChange={(e) => {\n                          const value = e.target.value.replace(/\\D/g, '');\n                          field.onChange(value);\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioLogradouro\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Logradouro</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Rua das Flores\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioComplemento\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Complemento</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Apto 123\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioBairro\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Bairro</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Centro\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioCidade\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Cidade</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"S√£o Paulo\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioEstado\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Estado (UF)</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"SP\" maxLength={2} {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n          </div>\n\n          <FormField\n            control={form.control}\n            name=\"specialization\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel className=\"flex items-center gap-1\">\n                  <Wrench className=\"h-4 w-4\" />\n                  Especializa√ß√£o\n                </FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Ex: Eletricista, Encanador, Ar Condicionado\" {...field} value={field.value || \"\"} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"observacoes\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel className=\"flex items-center gap-1\">\n                  <FileText className=\"h-4 w-4\" />\n                  Observa√ß√µes\n                </FormLabel>\n                <FormControl>\n                  <Textarea\n                    placeholder=\"Observa√ß√µes sobre o t√©cnico...\"\n                    className=\"min-h-[80px]\"\n                    {...field}\n                    value={field.value || \"\"}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          {/* Sele√ß√£o de Servi√ßos */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2\">\n              <Wrench className=\"h-5 w-5 text-gray-500\" />\n              <h3 className=\"text-lg font-medium\">Tipos de Servi√ßos</h3>\n            </div>\n            \n            <FormField\n              control={form.control}\n              name=\"serviceIds\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Servi√ßos que o T√©cnico Atende</FormLabel>\n                  <div className=\"border rounded-lg p-4 max-h-48 overflow-y-auto\">\n                    {!services || services.length === 0 ? (\n                      <p className=\"text-sm text-gray-500 text-center py-4\">\n                        Nenhum servi√ßo cadastrado. Cadastre servi√ßos primeiro para vincular aos t√©cnicos.\n                      </p>\n                    ) : (\n                      <div className=\"space-y-2\">\n                        {services.map((service) => (\n                          <div key={service.id} className=\"flex items-center space-x-2\">\n                            <Checkbox\n                              id={`service-${service.id}`}\n                              checked={field.value?.includes(service.id.toString()) || false}\n                              onCheckedChange={(checked) => {\n                                const currentIds = field.value || [];\n                                const serviceIdStr = service.id.toString();\n                                if (checked) {\n                                  field.onChange([...currentIds, serviceIdStr]);\n                                } else {\n                                  field.onChange(currentIds.filter(id => id !== serviceIdStr));\n                                }\n                              }}\n                            />\n                            <label\n                              htmlFor={`service-${service.id}`}\n                              className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer\"\n                            >\n                              {service.name}\n                              {service.price && (\n                                <span className=\"text-xs text-gray-500 ml-2\">\n                                  (R$ {Number(service.price).toFixed(2)})\n                                </span>\n                              )}\n                            </label>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n\n          <div className=\"flex items-center space-x-2\">\n            <Switch\n              id=\"isActive\"\n              checked={form.watch(\"isActive\")}\n              onCheckedChange={(checked) => form.setValue(\"isActive\", checked)}\n            />\n            <Label htmlFor=\"isActive\">T√©cnico ativo</Label>\n          </div>\n\n          <div className=\"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200\">\n            <Button \n              type=\"button\" \n              variant=\"outline\"\n              onClick={onClose}\n            >\n              Cancelar\n            </Button>\n            <Button \n              type=\"submit\" \n              disabled={isLoading}\n              className=\"bg-black text-white hover:bg-gray-800\"\n            >\n              {isLoading ? (\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />\n              ) : null}\n              {technician ? \"Atualizar\" : \"Criar\"} T√©cnico\n            </Button>\n          </div>\n        </form>\n      </Form>\n    </div>\n  );\n}","size_bytes":28598},"client/src/components/forms/TechnicianFormFixed.tsx":{"content":"import { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { extendedInsertTechnicianSchema, type InsertTechnician, type Technician } from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { UserCog, Mail, Phone, Wrench, MapPin, FileText } from \"lucide-react\";\n\ninterface TechnicianFormProps {\n  technician?: Technician | null;\n  onClose: () => void;\n}\n\nexport default function TechnicianForm({ technician, onClose }: TechnicianFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const form = useForm<InsertTechnician>({\n    resolver: zodResolver(extendedInsertTechnicianSchema),\n    defaultValues: technician ? {\n      name: technician.name,\n      email: technician.email || \"\",\n      phone: technician.phone,\n      documento: technician.documento,\n      cep: technician.cep,\n      logradouro: technician.logradouro,\n      numero: technician.numero,\n      complemento: technician.complemento || \"\",\n      specialization: technician.specialization || \"\",\n      observacoes: technician.observacoes || \"\",\n      isActive: technician.isActive,\n    } : {\n      name: \"\",\n      email: \"\",\n      phone: \"\",\n      documento: \"\",\n      cep: \"\",\n      logradouro: \"\",\n      numero: \"\",\n      complemento: \"\",\n      specialization: \"\",\n      observacoes: \"\",\n      isActive: true,\n    },\n  });\n\n  const createTechnicianMutation = useMutation({\n    mutationFn: async (data: InsertTechnician) => {\n      const response = await apiRequest(\"POST\", \"/api/technicians\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/technicians\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"T√©cnico criado com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao criar t√©cnico\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateTechnicianMutation = useMutation({\n    mutationFn: async (data: InsertTechnician) => {\n      const response = await apiRequest(\"PUT\", `/api/technicians/${technician?.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/technicians\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"T√©cnico atualizado com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao atualizar t√©cnico\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertTechnician) => {\n    if (technician) {\n      updateTechnicianMutation.mutate(data);\n    } else {\n      createTechnicianMutation.mutate(data);\n    }\n  };\n\n  const isLoading = createTechnicianMutation.isPending || updateTechnicianMutation.isPending;\n\n  return (\n    <div className=\"space-y-6\">\n      <DialogHeader>\n        <DialogTitle className=\"flex items-center\">\n          <UserCog className=\"h-5 w-5 mr-2 text-burnt-yellow\" />\n          {technician ? \"Editar T√©cnico\" : \"Novo T√©cnico\"}\n        </DialogTitle>\n      </DialogHeader>\n\n      <Form {...form}>\n        <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <FormField\n              control={form.control}\n              name=\"name\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>Nome *</FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"Nome completo do t√©cnico\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"documento\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel>CPF *</FormLabel>\n                  <FormControl>\n                    <Input\n                      placeholder=\"000.000.000-00\"\n                      maxLength={14}\n                      {...field}\n                      onChange={(e) => {\n                        let value = e.target.value.replace(/\\D/g, '');\n                        if (value.length > 3) value = value.slice(0, 3) + '.' + value.slice(3);\n                        if (value.length > 7) value = value.slice(0, 7) + '.' + value.slice(7);\n                        if (value.length > 11) value = value.slice(0, 11) + '-' + value.slice(11, 13);\n                        field.onChange(value);\n                      }}\n                    />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n\n          <div className=\"grid gap-4 md:grid-cols-2\">\n            <FormField\n              control={form.control}\n              name=\"email\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"flex items-center gap-1\">\n                    <Mail className=\"h-4 w-4\" />\n                    Email\n                  </FormLabel>\n                  <FormControl>\n                    <Input type=\"email\" placeholder=\"email@exemplo.com\" {...field} value={field.value || \"\"} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"phone\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"flex items-center gap-1\">\n                    <Phone className=\"h-4 w-4\" />\n                    Telefone *\n                  </FormLabel>\n                  <FormControl>\n                    <Input placeholder=\"(11) 99999-9999\" {...field} />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2\">\n              <MapPin className=\"h-5 w-5 text-gray-500\" />\n              <h3 className=\"text-lg font-medium\">Endere√ßo</h3>\n            </div>\n            \n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <FormField\n                control={form.control}\n                name=\"cep\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>CEP *</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"00000-000\"\n                        maxLength={9}\n                        {...field}\n                        onChange={(e) => {\n                          let value = e.target.value.replace(/\\D/g, '');\n                          if (value.length > 5) {\n                            value = value.slice(0, 5) + '-' + value.slice(5, 8);\n                          }\n                          field.onChange(value);\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"numero\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>N√∫mero *</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"123\"\n                        {...field}\n                        onChange={(e) => {\n                          const value = e.target.value.replace(/\\D/g, '');\n                          field.onChange(value);\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"logradouro\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Logradouro *</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Rua das Flores\" {...field} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"complemento\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Complemento</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Apto 123\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n          </div>\n\n          <FormField\n            control={form.control}\n            name=\"specialization\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel className=\"flex items-center gap-1\">\n                  <Wrench className=\"h-4 w-4\" />\n                  Especializa√ß√£o\n                </FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Ex: Eletricista, Encanador, Ar Condicionado\" {...field} value={field.value || \"\"} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <FormField\n            control={form.control}\n            name=\"observacoes\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel className=\"flex items-center gap-1\">\n                  <FileText className=\"h-4 w-4\" />\n                  Observa√ß√µes\n                </FormLabel>\n                <FormControl>\n                  <Textarea\n                    placeholder=\"Observa√ß√µes sobre o t√©cnico...\"\n                    className=\"min-h-[80px]\"\n                    {...field}\n                    value={field.value || \"\"}\n                  />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          <div className=\"flex items-center space-x-2\">\n            <Switch\n              id=\"isActive\"\n              checked={form.watch(\"isActive\")}\n              onCheckedChange={(checked) => form.setValue(\"isActive\", checked)}\n            />\n            <Label htmlFor=\"isActive\">T√©cnico ativo</Label>\n          </div>\n\n          <div className=\"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200\">\n            <Button \n              type=\"button\" \n              variant=\"outline\"\n              onClick={onClose}\n            >\n              Cancelar\n            </Button>\n            <Button \n              type=\"submit\" \n              disabled={isLoading}\n              className=\"bg-black text-white hover:bg-gray-800\"\n            >\n              {isLoading ? (\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />\n              ) : null}\n              {technician ? \"Atualizar\" : \"Criar\"} T√©cnico\n            </Button>\n          </div>\n        </form>\n      </Form>\n    </div>\n  );\n}","size_bytes":11909},"client/src/components/forms/TempTeamForm.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\nimport { type InsertTeam, type Team, type Technician, type Service } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Users, UserPlus, MapPin } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\n// Fun√ß√£o para buscar endere√ßo por CEP - id√™ntica ao cadastro de t√©cnico\nasync function buscarEnderecoPorCep(cep: string) {\n  const url = `https://viacep.com.br/ws/${cep.replace(/\\D/g, '')}/json/`;\n  const res = await fetch(url);\n  const data = await res.json();\n  if (data.erro) throw new Error(\"CEP n√£o encontrado\");\n  return data; // {logradouro, bairro, localidade, uf, ...}\n}\n\ninterface TeamFormProps {\n  team?: Team | null;\n  technicians: Technician[];\n  services: Service[];\n  onClose: () => void;\n}\n\n// Schema limpo e correto para o formul√°rio de equipe\nconst teamFormSchema = z.object({\n  name: z.string().min(1, \"Nome √© obrigat√≥rio\"),\n  technicianIds: z.array(z.number()).optional(),\n  serviceIds: z.array(z.number()).optional(),\n  enderecoInicioCep: z.string().optional(),\n  enderecoInicioLogradouro: z.string().optional(),\n  enderecoInicioNumero: z.string().optional(),\n  enderecoInicioComplemento: z.string().optional(),\n  enderecoInicioBairro: z.string().optional(),\n  enderecoInicioCidade: z.string().optional(),\n  enderecoInicioEstado: z.string().optional(),\n});\n\ntype ExtendedTeamForm = z.infer<typeof teamFormSchema>;\n\nexport default function TeamForm({ \n  team, \n  technicians, \n  services, \n  onClose \n}: TeamFormProps) {\n  console.log(\"üèóÔ∏è TempTeamForm renderizado com dados:\", { team, technicians: technicians.length, services: services.length });\n  \n  const [selectedTechnicians, setSelectedTechnicians] = useState<number[]>([]);\n  const [selectedServices, setSelectedServices] = useState<number[]>(\n    team?.serviceIds ? team.serviceIds.map(id => parseInt(id)) : []\n  );\n\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Buscar membros da equipe quando editando uma equipe existente\n  const { data: teamMembers = [] } = useQuery({\n    queryKey: [\"/api/team-members\", team?.id],\n    queryFn: async () => {\n      if (!team) return [];\n      const response = await fetch(`/api/team-members/${team.id}`, {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!response.ok) return [];\n      return response.json();\n    },\n    enabled: !!team,\n  });\n\n  const form = useForm<ExtendedTeamForm>({\n    resolver: zodResolver(teamFormSchema),\n    defaultValues: {\n      name: \"\",\n      technicianIds: [],\n      serviceIds: [],\n      // Campos de endere√ßo de in√≠cio di√°rio - completos\n      enderecoInicioCep: \"\",\n      enderecoInicioLogradouro: \"\",\n      enderecoInicioNumero: \"\",\n      enderecoInicioComplemento: \"\",\n      enderecoInicioBairro: \"\",\n      enderecoInicioCidade: \"\",\n      enderecoInicioEstado: \"\",\n    },\n  });\n\n  // Resetar o formul√°rio quando a equipe muda ou quando abre para nova equipe\n  useEffect(() => {\n    console.log('üîÑ useEffect - team mudou:', team);\n    if (team && team.id) {\n      console.log('üìù Carregando dados da equipe para edi√ß√£o:', team);\n      // Edi√ß√£o: carregar dados da equipe existente\n      const serviceIds = team.serviceIds ? team.serviceIds.map(id => Number(id)) : [];\n\n      form.reset({\n        name: team.name || \"\",\n        technicianIds: selectedTechnicians,\n        serviceIds: serviceIds,                  // number[]\n        // Campos de endere√ßo de in√≠cio di√°rio - completos\n        enderecoInicioCep: team.enderecoInicioCep || \"\",\n        enderecoInicioLogradouro: team.enderecoInicioLogradouro || \"\",\n        enderecoInicioNumero: team.enderecoInicioNumero || \"\",\n        enderecoInicioComplemento: team.enderecoInicioComplemento || \"\",\n        enderecoInicioBairro: team.enderecoInicioBairro || \"\",\n        enderecoInicioCidade: team.enderecoInicioCidade || \"\",\n        enderecoInicioEstado: team.enderecoInicioEstado || \"\",\n      });\n\n      setSelectedServices(serviceIds);\n      console.log('‚úÖ Formul√°rio resetado para edi√ß√£o com dados:', {\n        name: team.name,\n        serviceIds: serviceIds\n      });\n    } else {\n      console.log('‚ûï Limpando formul√°rio para nova equipe');\n      // Nova equipe: limpar formul√°rio\n      form.reset({\n        name: \"\",\n        technicianIds: [],\n        serviceIds: [],\n        // Campos de endere√ßo de in√≠cio di√°rio - completos\n        enderecoInicioCep: \"\",\n        enderecoInicioLogradouro: \"\",\n        enderecoInicioNumero: \"\",\n        enderecoInicioComplemento: \"\",\n        enderecoInicioBairro: \"\",\n        enderecoInicioCidade: \"\",\n        enderecoInicioEstado: \"\",\n      });\n      setSelectedTechnicians([]);\n      setSelectedServices([]);\n      console.log('‚úÖ Formul√°rio limpo para nova equipe');\n    }\n    }, [team?.id]);\n\n  // Atualizar t√©cnicos selecionados quando os membros da equipe s√£o carregados\n  useEffect(() => {\n    if (team && teamMembers.length > 0) {\n      const technicianIds = teamMembers.map((member: any) => member.technicianId);\n      setSelectedTechnicians(technicianIds);\n      form.setValue('technicianIds', technicianIds);\n    }\n  }, [teamMembers, form]);\n\n  const createTeamMutation = useMutation({\n    mutationFn: async (data: ExtendedTeamForm) => {\n      // Primeiro criar a equipe - convertendo serviceIds para string[] para o backend\n      const teamData = {\n        name: data.name,\n        serviceIds: (data.serviceIds || []).map(id => id.toString()),\n        // Campos de endere√ßo de in√≠cio di√°rio - completos\n        enderecoInicioCep: data.enderecoInicioCep || \"\",\n        enderecoInicioLogradouro: data.enderecoInicioLogradouro || \"\",\n        enderecoInicioNumero: data.enderecoInicioNumero || \"\",\n        enderecoInicioComplemento: data.enderecoInicioComplemento || \"\",\n        enderecoInicioBairro: data.enderecoInicioBairro || \"\",\n        enderecoInicioCidade: data.enderecoInicioCidade || \"\",\n        enderecoInicioEstado: data.enderecoInicioEstado || \"\",\n      };\n\n      const response = await apiRequest(\"POST\", \"/api/teams\", teamData);\n      const newTeam = await response.json();\n\n      // Depois adicionar os membros da equipe\n      if (data.technicianIds && data.technicianIds.length > 0) {\n        await Promise.all(\n          data.technicianIds.map(technicianId =>\n            apiRequest(\"POST\", \"/api/team-members\", {\n              teamId: newTeam.id,\n              technicianId,\n            })\n          )\n        );\n      }\n\n      return newTeam;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/teams\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-members\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Equipe criada com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao criar equipe\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateTeamMutation = useMutation({\n    mutationFn: async (data: ExtendedTeamForm) => {\n      // Primeiro atualizar dados da equipe - convertendo serviceIds para string[] para o backend\n      const teamData = {\n        name: data.name,\n        serviceIds: (data.serviceIds || []).map(id => id.toString()),\n        // Campos de endere√ßo de in√≠cio di√°rio - completos\n        enderecoInicioCep: data.enderecoInicioCep || \"\",\n        enderecoInicioLogradouro: data.enderecoInicioLogradouro || \"\",\n        enderecoInicioNumero: data.enderecoInicioNumero || \"\",\n        enderecoInicioComplemento: data.enderecoInicioComplemento || \"\",\n        enderecoInicioBairro: data.enderecoInicioBairro || \"\",\n        enderecoInicioCidade: data.enderecoInicioCidade || \"\",\n        enderecoInicioEstado: data.enderecoInicioEstado || \"\",\n      };\n\n      const response = await apiRequest(\"PATCH\", `/api/teams/${team?.id}`, teamData);\n      const updatedTeam = await response.json();\n\n      // Remover todos os membros existentes da equipe\n      const currentMembers = await fetch(`/api/team-members/${team?.id}`, {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      if (currentMembers.ok) {\n        const members = await currentMembers.json();\n\n        if (members.length > 0) {\n          await Promise.all(\n            members.map((member: any) => \n              apiRequest(\"DELETE\", `/api/team-members/${member.id}`)\n            )\n          );\n        }\n      }\n\n      // Adicionar os novos membros selecionados\n      if (data.technicianIds && data.technicianIds.length > 0) {\n        await Promise.all(\n          data.technicianIds.map(technicianId =>\n            apiRequest(\"POST\", \"/api/team-members\", {\n              teamId: team?.id,\n              technicianId,\n            })\n          )\n        );\n      }\n\n      return updatedTeam;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/teams\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/team-members\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Equipe atualizada com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao atualizar equipe\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ExtendedTeamForm) => {\n    console.log(\"üîß onSubmit disparado!\", { \n      team, \n      data, \n      selectedTechnicians, \n      selectedServices,\n      formState: {\n        isValid: form.formState.isValid,\n        errors: form.formState.errors\n      }\n    });\n    \n    const formData = {\n      ...data,\n      technicianIds: selectedTechnicians, // number[]\n      serviceIds: selectedServices,      // number[] \n    };\n\n    console.log(\"üì§ Dados preparados para envio (number[]):\", formData);\n\n    if (team) {\n      console.log(\"üìù Modo EDI√á√ÉO - Chamando updateTeamMutation\");\n      updateTeamMutation.mutate(formData);\n    } else {\n      console.log(\"‚ûï Modo CRIA√á√ÉO - Chamando createTeamMutation\");\n      createTeamMutation.mutate(formData);\n    }\n  };\n\n  const isLoading = createTeamMutation.isPending || updateTeamMutation.isPending;\n\n  const handleTechnicianToggle = (technicianId: number, checked: boolean) => {\n    if (checked) {\n      setSelectedTechnicians(prev => [...prev, technicianId]);\n    } else {\n      setSelectedTechnicians(prev => prev.filter(id => id !== technicianId));\n    }\n  };\n\n  const handleServiceToggle = (serviceId: number, checked: boolean) => {\n    if (checked) {\n      setSelectedServices(prev => [...prev, serviceId]);\n    } else {\n      setSelectedServices(prev => prev.filter(id => id !== serviceId));\n    }\n  };\n\n  // Handler para busca autom√°tica de endere√ßo de in√≠cio di√°rio por CEP\n  const handleEnderecoInicioCepChange = async (cep: string) => {\n    // Aplicar m√°scara de CEP\n    const maskedCep = cep.replace(/\\D/g, '').replace(/(\\d{5})(\\d{3})/, '$1-$2');\n    form.setValue('enderecoInicioCep', maskedCep);\n\n    // Se o CEP estiver completo (8 d√≠gitos), buscar endere√ßo\n    if (cep.replace(/\\D/g, '').length === 8) {\n      try {\n        const endereco = await buscarEnderecoPorCep(cep);\n\n        // Preencher os campos automaticamente\n        form.setValue('enderecoInicioLogradouro', endereco.logradouro || '');\n        form.setValue('enderecoInicioBairro', endereco.bairro || '');\n        form.setValue('enderecoInicioCidade', endereco.localidade || '');\n        form.setValue('enderecoInicioEstado', endereco.uf || '');\n\n        toast({\n          title: \"CEP encontrado\",\n          description: \"Endere√ßo preenchido automaticamente\",\n        });\n      } catch (error) {\n        toast({\n          title: \"CEP n√£o encontrado\",\n          description: \"Verifique o CEP digitado\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  };\n\n  return (\n    <div className=\"max-h-[80vh] overflow-y-auto\">\n      <DialogHeader>\n        <DialogTitle className=\"flex items-center gap-2\">\n          <Users className=\"h-5 w-5\" />\n          {team ? \"Editar Equipe\" : \"Cadastrar Nova Equipe\"}\n        </DialogTitle>\n      </DialogHeader>\n\n      <Form {...form}>\n          <form\n            onSubmit={form.handleSubmit((data) => {\n              console.log(\"üõéÔ∏è onSubmit disparado COM CERTEZA!\", { team, data });\n              onSubmit(data);\n            })}\n            className=\"space-y-6\"\n          >\n\n          {/* Nome da Equipe */}\n          <FormField\n            control={form.control}\n            name=\"name\"\n            render={({ field }) => (\n              <FormItem>\n                <FormLabel>Nome da Equipe *</FormLabel>\n                <FormControl>\n                  <Input placeholder=\"Ex: Equipe Alpha\" {...field} />\n                </FormControl>\n                <FormMessage />\n              </FormItem>\n            )}\n          />\n\n          {/* Endere√ßo de In√≠cio Di√°rio (Opcional) */}\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center gap-2\">\n              <span className=\"h-5 w-5 text-blue-500\">üìç</span>\n              <h3 className=\"text-lg font-medium\">Endere√ßo de In√≠cio Di√°rio (Opcional)</h3>\n            </div>\n            <p className=\"text-sm text-gray-500\">\n              Se preenchido, ser√° usado como ponto de partida na roteiriza√ß√£o. Caso contr√°rio, ser√° usado o endere√ßo padr√£o da empresa.\n            </p>\n\n            <div className=\"grid gap-4 md:grid-cols-2\">\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioCep\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>CEP de In√≠cio</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"00000-000\"\n                        maxLength={9}\n                        {...field}\n                        value={field.value || \"\"}\n                        onChange={(e) => {\n                          const newValue = e.target.value;\n                          handleEnderecoInicioCepChange(newValue);\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioNumero\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>N√∫mero</FormLabel>\n                    <FormControl>\n                      <Input\n                        placeholder=\"123\"\n                        {...field}\n                        value={field.value || \"\"}\n                        onChange={(e) => {\n                          const value = e.target.value.replace(/\\D/g, '');\n                          field.onChange(value);\n                        }}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioLogradouro\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Logradouro</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Rua das Flores\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioComplemento\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Complemento</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Apto 123\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioBairro\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Bairro</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"Centro\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioCidade\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Cidade</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"S√£o Paulo\" {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"enderecoInicioEstado\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Estado (UF)</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"SP\" maxLength={2} {...field} value={field.value || \"\"} />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n            </div>\n          </div>\n\n          {/* Sele√ß√£o de T√©cnicos */}\n          <div className=\"space-y-3\">\n            <FormLabel>T√©cnicos da Equipe</FormLabel>\n            <div className=\"border rounded-lg p-4 max-h-48 overflow-y-auto\">\n              {technicians.length === 0 ? (\n                <p className=\"text-sm text-gray-500 text-center py-4\">\n                  Nenhum t√©cnico cadastrado. Cadastre t√©cnicos primeiro para formar equipes.\n                </p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {technicians.map((technician) => (\n                    <div key={technician.id} className=\"flex items-center space-x-2\">\n                      <Checkbox\n                        id={`technician-${technician.id}`}\n                        checked={selectedTechnicians.includes(technician.id)}\n                        onCheckedChange={(checked) => \n                          handleTechnicianToggle(technician.id, checked as boolean)\n                        }\n                      />\n                      <label\n                        htmlFor={`technician-${technician.id}`}\n                        className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer\"\n                      >\n                        {technician.name}\n                      </label>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n            {selectedTechnicians.length > 0 && (\n              <p className=\"text-xs text-gray-500\">\n                {selectedTechnicians.length} t√©cnico(s) selecionado(s)\n              </p>\n            )}\n          </div>\n\n          {/* Sele√ß√£o de Servi√ßos */}\n          <div className=\"space-y-3\">\n            <FormLabel>Tipos de Servi√ßos que a Equipe Atende</FormLabel>\n            <div className=\"border rounded-lg p-4 max-h-48 overflow-y-auto\">\n              {services.length === 0 ? (\n                <p className=\"text-sm text-gray-500 text-center py-4\">\n                  Nenhum servi√ßo cadastrado. Cadastre servi√ßos primeiro para vincular √†s equipes.\n                </p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {services.map((service) => (\n                    <div key={service.id} className=\"flex items-center space-x-2\">\n                      <Checkbox\n                        id={`service-${service.id}`}\n                        checked={selectedServices.includes(service.id)}\n                        onCheckedChange={(checked) => \n                          handleServiceToggle(service.id, checked as boolean)\n                        }\n                      />\n                      <label\n                        htmlFor={`service-${service.id}`}\n                        className=\"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 cursor-pointer\"\n                      >\n                        {service.name}\n                        {service.price && (\n                          <span className=\"text-xs text-gray-500 ml-2\">\n                            (R$ {Number(service.price).toFixed(2)})\n                          </span>\n                        )}\n                      </label>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n            {selectedServices.length > 0 && (\n              <p className=\"text-xs text-gray-500\">\n                {selectedServices.length} servi√ßo(s) selecionado(s)\n              </p>\n            )}\n          </div>\n\n          <div className=\"flex justify-end space-x-2 pt-4\">\n            <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n              Cancelar\n            </Button>\n            <Button \n              type=\"submit\"\n              disabled={team ? updateTeamMutation.isPending : createTeamMutation.isPending}\n              className=\"bg-burnt-yellow hover:bg-burnt-yellow-dark text-white\"\n              onClick={() => {\n                console.log(\"üîò Bot√£o clicked! Estado do formul√°rio:\", {\n                  isValid: form.formState.isValid,\n                  errors: form.formState.errors,\n                  isDirty: form.formState.isDirty,\n                  isSubmitting: form.formState.isSubmitting\n                });\n              }}\n            >\n              {(team ? updateTeamMutation.isPending : createTeamMutation.isPending) ? (\n                <>\n                  <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\"></div>\n                  {team ? \"Atualizando...\" : \"Criando...\"}\n                </>\n              ) : (\n                <>\n                  <UserPlus className=\"h-4 w-4 mr-2\" />\n                  {team ? \"Atualizar Equipe\" : \"Criar Equipe\"}\n                </>\n              )}\n            </Button>\n          </div>\n        </form>\n      </Form>\n    </div>\n  );\n}","size_bytes":23206},"client/src/components/forms/VehicleForm.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport {\n  insertVehicleSchema,\n  type InsertVehicle,\n  type Vehicle,\n  type Technician,\n  type Team,\n} from \"@shared/schema\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Car, Calendar, User, Users } from \"lucide-react\";\n\ninterface VehicleFormProps {\n  vehicle?: Vehicle | null;\n  technicians: Technician[];\n  teams: Team[];\n  onClose: () => void;\n}\n\nexport default function VehicleForm({\n  vehicle,\n  technicians,\n  teams,\n  onClose,\n}: VehicleFormProps) {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [assignmentType, setAssignmentType] = useState<\"technician\" | \"team\">(\n    vehicle?.technicianId\n      ? \"technician\"\n      : vehicle?.teamId\n        ? \"team\"\n        : \"technician\",\n  );\n\n  const form = useForm<InsertVehicle>({\n    resolver: zodResolver(insertVehicleSchema),\n    defaultValues: vehicle\n      ? {\n          plate: vehicle.plate,\n          model: vehicle.model,\n          brand: vehicle.brand,\n          year: vehicle.year,\n          technicianId: vehicle.technicianId || undefined,\n          teamId: vehicle.teamId || undefined,\n        }\n      : {\n          plate: \"\",\n          model: \"\",\n          brand: \"\",\n          year: new Date().getFullYear(),\n          technicianId: undefined,\n          teamId: undefined,\n        },\n  });\n\n  const createVehicleMutation = useMutation({\n    mutationFn: async (data: InsertVehicle) => {\n      const response = await apiRequest(\"POST\", \"/api/vehicles\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vehicles\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Ve√≠culo criado com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao criar ve√≠culo\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateVehicleMutation = useMutation({\n    mutationFn: async (data: InsertVehicle) => {\n      const response = await apiRequest(\n        \"PUT\",\n        `/api/vehicles/${vehicle!.id}`,\n        data,\n      );\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/vehicles\"] });\n      toast({\n        title: \"Sucesso\",\n        description: \"Ve√≠culo atualizado com sucesso\",\n      });\n      onClose();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Erro\",\n        description: error.message || \"Erro ao atualizar ve√≠culo\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (data: InsertVehicle) => {\n    if (vehicle) {\n      updateVehicleMutation.mutate(data);\n    } else {\n      createVehicleMutation.mutate(data);\n    }\n  };\n\n  const isLoading =\n    createVehicleMutation.isPending || updateVehicleMutation.isPending;\n\n  return (\n    <div className=\"space-y-6\">\n      <DialogHeader>\n        <DialogTitle className=\"flex items-center\">\n          <Car className=\"h-5 w-5 mr-2 text-burnt-yellow\" />\n          {vehicle ? \"Editar Ve√≠culo\" : \"Novo Ve√≠culo\"}\n        </DialogTitle>\n      </DialogHeader>\n\n      <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n        <div>\n          <Label htmlFor=\"plate\">Placa *</Label>\n          <Input\n            placeholder=\"AAA-1234 ou AAA1A23\"\n            className=\"mt-1\"\n            style={{ textTransform: \"uppercase\" }}\n            value={form.watch(\"plate\") || \"\"}\n            onChange={(e) => {\n              let v = e.target.value\n                .toUpperCase()\n                // remove qualquer caracter que n√£o seja letra ou n√∫mero\n                .replace(/[^A-Z0-9]/g, \"\");\n\n              // corta sempre para 7 chars (AAA1234 ou AAA1A23 t√™m 7 caracteres)\n              v = v.slice(0, 7);\n\n              // Se for EXATAMENTE 3 letras + 4 n√∫meros, insere h√≠fen: AAA-1234\n              if (/^[A-Z]{3}[0-9]{4}$/.test(v)) {\n                v = `${v.slice(0, 3)}-${v.slice(3)}`;\n              }\n\n              // atualiza o valor no RHF, disparando valida√ß√£o\n              form.setValue(\"plate\", v, { shouldValidate: true });\n            }}\n          />\n          {form.formState.errors.plate && (\n            <p className=\"text-sm text-red-600 mt-1\">\n              {form.formState.errors.plate.message}\n            </p>\n          )}\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <Label htmlFor=\"brand\">Marca *</Label>\n            <Input\n              {...form.register(\"brand\")}\n              placeholder=\"Ex: Ford, Volkswagen\"\n              className=\"mt-1\"\n            />\n            {form.formState.errors.brand && (\n              <p className=\"text-sm text-red-600 mt-1\">\n                {form.formState.errors.brand.message}\n              </p>\n            )}\n          </div>\n\n          <div>\n            <Label htmlFor=\"model\">Modelo *</Label>\n            <Input\n              {...form.register(\"model\")}\n              placeholder=\"Ex: Fiesta, Gol\"\n              className=\"mt-1\"\n            />\n            {form.formState.errors.model && (\n              <p className=\"text-sm text-red-600 mt-1\">\n                {form.formState.errors.model.message}\n              </p>\n            )}\n          </div>\n        </div>\n\n        <div>\n          <Label htmlFor=\"year\" className=\"flex items-center\">\n            <Calendar className=\"h-4 w-4 mr-1\" />\n            Ano *\n          </Label>\n          <Input\n            {...form.register(\"year\", { valueAsNumber: true })}\n            type=\"number\"\n            min=\"1900\"\n            max={new Date().getFullYear() + 1}\n            placeholder=\"2020\"\n            className=\"mt-1\"\n          />\n          {form.formState.errors.year && (\n            <p className=\"text-sm text-red-600 mt-1\">\n              {form.formState.errors.year.message}\n            </p>\n          )}\n        </div>\n\n        <div className=\"space-y-4\">\n          <div>\n            <Label className=\"text-base font-medium\">\n              Respons√°vel pelo Ve√≠culo *\n            </Label>\n            <p className=\"text-sm text-gray-600\">\n              Selecione um t√©cnico individual ou uma equipe\n            </p>\n          </div>\n\n          <RadioGroup\n            value={assignmentType}\n            onValueChange={(value: \"technician\" | \"team\") => {\n              setAssignmentType(value);\n              // Limpar campos opostos quando trocar tipo\n              if (value === \"technician\") {\n                form.setValue(\"teamId\", undefined, { shouldValidate: false });\n              } else {\n                form.setValue(\"technicianId\", undefined, { shouldValidate: false });\n              }\n            }}\n            className=\"flex gap-6\"\n          >\n            <div className=\"flex items-center space-x-2\">\n              <RadioGroupItem value=\"technician\" id=\"technician\" />\n              <Label\n                htmlFor=\"technician\"\n                className=\"flex items-center cursor-pointer\"\n              >\n                <User className=\"h-4 w-4 mr-2\" />\n                T√©cnico Individual\n              </Label>\n            </div>\n            <div className=\"flex items-center space-x-2\">\n              <RadioGroupItem value=\"team\" id=\"team\" />\n              <Label\n                htmlFor=\"team\"\n                className=\"flex items-center cursor-pointer\"\n              >\n                <Users className=\"h-4 w-4 mr-2\" />\n                Equipe\n              </Label>\n            </div>\n          </RadioGroup>\n\n          {assignmentType === \"technician\" ? (\n            <div>\n              <Label htmlFor=\"technicianId\">T√©cnico Respons√°vel *</Label>\n              <Select\n                value={form.watch(\"technicianId\")?.toString() || \"\"}\n                onValueChange={(value) =>\n                  form.setValue(\n                    \"technicianId\",\n                    value ? parseInt(value) : undefined,\n                    { shouldValidate: true }\n                  )\n                }\n              >\n                <SelectTrigger className=\"mt-1\">\n                  <SelectValue placeholder=\"Selecione um t√©cnico\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {technicians\n                    .filter((t) => t.isActive)\n                    .map((technician) => (\n                      <SelectItem\n                        key={technician.id}\n                        value={technician.id.toString()}\n                      >\n                        {technician.name}\n                      </SelectItem>\n                    ))}\n                </SelectContent>\n              </Select>\n              {form.formState.errors.technicianId && (\n                <p className=\"text-sm text-red-600 mt-1\">\n                  {form.formState.errors.technicianId.message}\n                </p>\n              )}\n            </div>\n          ) : (\n            <div>\n              <Label htmlFor=\"teamId\">Equipe Respons√°vel *</Label>\n              <Select\n                value={form.watch(\"teamId\")?.toString() || \"\"}\n                onValueChange={(value) =>\n                  form.setValue(\"teamId\", value ? parseInt(value) : undefined, { shouldValidate: true })\n                }\n              >\n                <SelectTrigger className=\"mt-1\">\n                  <SelectValue placeholder=\"Selecione uma equipe\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {teams.map((team) => (\n                    <SelectItem key={team.id} value={team.id.toString()}>\n                      {team.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              {form.formState.errors.teamId && (\n                <p className=\"text-sm text-red-600 mt-1\">\n                  {form.formState.errors.teamId.message}\n                </p>\n              )}\n              {assignmentType === \"team\" && form.watch(\"teamId\") && (\n                <p className=\"text-xs text-blue-600 mt-1\">\n                  ‚ÑπÔ∏è Todos os t√©cnicos desta equipe ter√£o acesso a este ve√≠culo\n                </p>\n              )}\n            </div>\n          )}\n        </div>\n\n        <div className=\"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200\">\n          <Button type=\"button\" variant=\"outline\" onClick={onClose}>\n            Cancelar\n          </Button>\n          <Button\n            type=\"submit\"\n            disabled={isLoading}\n            className=\"bg-black text-white hover:bg-gray-800\"\n          >\n            {isLoading ? (\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2\" />\n            ) : null}\n            {vehicle ? \"Atualizar\" : \"Criar\"} Ve√≠culo\n          </Button>\n        </div>\n      </form>\n    </div>\n  );\n}\n","size_bytes":11439},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/client-search.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { X } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { Client } from \"@shared/schema\";\n\ninterface ClientSearchProps {\n  value?: number | null;\n  onValueChange: (value: number | undefined) => void;\n  placeholder?: string;\n  disabled?: boolean;\n}\n\nexport function ClientSearch({ value, onValueChange, placeholder = \"Pesquisar por nome ou CPF\", disabled = false }: ClientSearchProps) {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedClient, setSelectedClient] = useState<Client | null>(null);\n  const [showResults, setShowResults] = useState(false);\n  const [inputFocused, setInputFocused] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const resultsRef = useRef<HTMLDivElement>(null);\n\n  console.log(\"ClientSearch Debug - value:\", value, \"searchQuery:\", searchQuery, \"selectedClient:\", selectedClient?.name);\n\n  // Buscar clientes quando houver query\n  const { data: searchResults = [], isLoading } = useQuery<Client[]>({\n    queryKey: ['/api/clients/search', searchQuery],\n    queryFn: async () => {\n      console.log(\"Busca cliente - input:\", searchQuery);\n      const response = await fetch(`/api/clients/search?q=${encodeURIComponent(searchQuery)}`, {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('token')}`,\n        },\n      });\n      if (!response.ok) {\n        throw new Error('Erro na busca');\n      }\n      const results = await response.json();\n      console.log(\"Resultados encontrados:\", results);\n      return results;\n    },\n    enabled: searchQuery.length >= 2,\n    staleTime: 30000, // Cache por 30 segundos\n  });\n\n  // Buscar cliente selecionado para mostrar o nome\n  const { data: allClients = [] } = useQuery<Client[]>({\n    queryKey: ['/api/clients'],\n  });\n\n  useEffect(() => {\n    if (value && allClients.length > 0) {\n      const client = allClients.find((c) => c.id === value);\n      setSelectedClient(client || null);\n      console.log(\"Cliente selecionado encontrado:\", client?.name);\n    } else {\n      setSelectedClient(null);\n      console.log(\"Nenhum cliente selecionado\");\n    }\n  }, [value, allClients]);\n\n  // Mostrar resultados quando houver busca e o input estiver focado\n  useEffect(() => {\n    setShowResults(inputFocused && searchQuery.length >= 2);\n  }, [inputFocused, searchQuery]);\n\n  // Fechar resultados quando clicar fora\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        resultsRef.current &&\n        !resultsRef.current.contains(event.target as Node) &&\n        !inputRef.current?.contains(event.target as Node)\n      ) {\n        setShowResults(false);\n        setInputFocused(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (disabled) return;\n    \n    const query = e.target.value;\n    console.log(\"Input alterado para:\", query);\n    setSearchQuery(query);\n    \n    // Se o input foi limpo e h√° um cliente selecionado, manter o nome\n    if (query === \"\" && selectedClient) {\n      // N√£o faz nada, mant√©m o cliente selecionado\n    }\n  };\n\n  const handleInputFocus = () => {\n    if (disabled) return;\n    \n    console.log(\"Input focado\");\n    setInputFocused(true);\n    // Limpar o input para permitir nova busca\n    if (selectedClient) {\n      setSearchQuery(\"\");\n    }\n  };\n\n  const handleSelect = (client: Client) => {\n    console.log(\"Cliente selecionado:\", client.name);\n    setSelectedClient(client);\n    onValueChange(client.id);\n    setSearchQuery(client.name); // Mostrar o nome no input\n    setShowResults(false);\n    setInputFocused(false);\n  };\n\n  const handleClear = () => {\n    console.log(\"Limpando sele√ß√£o de cliente\");\n    setSelectedClient(null);\n    onValueChange(undefined);\n    setSearchQuery(\"\");\n    inputRef.current?.focus();\n  };\n\n  // Valor do input: nome do cliente selecionado ou texto da busca\n  const inputValue = selectedClient && !inputFocused ? selectedClient.name : searchQuery;\n\n  return (\n    <div className=\"relative w-full\">\n      <div className=\"relative\">\n        <Input\n          ref={inputRef}\n          placeholder={placeholder}\n          value={inputValue}\n          onChange={handleInputChange}\n          onFocus={handleInputFocus}\n          className=\"w-full pr-8\"\n          disabled={disabled}\n        />\n        {selectedClient && (\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={handleClear}\n            className=\"absolute right-0 top-0 h-full px-2 hover:bg-transparent\"\n          >\n            <X className=\"h-4 w-4\" />\n          </Button>\n        )}\n      </div>\n\n      {/* Resultados da busca */}\n      {showResults && (\n        <div\n          ref={resultsRef}\n          className=\"absolute z-50 w-full mt-1 bg-white border rounded-md shadow-lg max-h-60 overflow-auto\"\n        >\n          {isLoading ? (\n            <div className=\"p-4 text-sm text-muted-foreground\">\n              Buscando...\n            </div>\n          ) : searchResults.length > 0 ? (\n            <div className=\"py-1\">\n              {searchResults.slice(0, 5).map((client) => (\n                <div\n                  key={client.id}\n                  onClick={() => handleSelect(client)}\n                  className={cn(\n                    \"px-4 py-2 cursor-pointer hover:bg-gray-100\",\n                    \"border-b border-gray-100 last:border-b-0\"\n                  )}\n                >\n                  <div className=\"font-medium\">{client.name}</div>\n                  <div className=\"text-sm text-muted-foreground\">\n                    CPF: {client.cpf} ‚Ä¢ {client.logradouro}, {client.numero}\n                  </div>\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"p-4 text-sm text-muted-foreground\">\n              Cliente n√£o encontrado\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":6283},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }","size_bytes":1480},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/ErrorBoundary.tsx":{"content":"import React from \"react\";\n\ntype ErrorBoundaryProps = { children: React.ReactNode };\n\ntype ErrorBoundaryState = { hasError: boolean };\n\nexport class ErrorBoundary extends React.Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = { hasError: false };\n  }\n  static getDerivedStateFromError(error: any) {\n    return { hasError: true };\n  }\n  componentDidCatch(error: any, errorInfo: any) {\n    console.error(\"[ErrorBoundary] Caught an error:\", error, errorInfo);\n  }\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div style={{ padding: 32, color: \"red\" }}>\n          Ocorreu um erro ao renderizar a p√°gina.\n        </div>\n      );\n    }\n    return this.props.children;\n  }\n}\n","size_bytes":772},"client/src/hooks/useCalendarCleanup.ts":{"content":"/**\n * Hook espec√≠fico para limpeza de calend√°rios react-big-calendar\n * Previne erros DOM relacionados aos tooltips, overlays e portals do calend√°rio\n */\nimport { useEffect, useRef } from 'react';\n\nexport function useCalendarCleanup(isCalendarVisible: boolean) {\n  const calendarContainerRef = useRef<HTMLDivElement>(null);\n  const cleanupPerformed = useRef(false);\n\n  useEffect(() => {\n    return () => {\n      if (cleanupPerformed.current) return;\n      cleanupPerformed.current = true;\n\n      // Aguarda um tick para garantir que outros hooks j√° foram processados\n      setTimeout(() => {\n        try {\n          console.log('üóìÔ∏è [CALENDAR] (Safe cleanup) Ignorando limpeza manual de tooltips/overlays para evitar conflitos com React.');\n          // N√ÉO REMOVA manualmente elementos do DOM aqui!\n          // Confie no ciclo de vida do React e do react-big-calendar.\n\n          // Se quiser limpar refs, estados ou timers, fa√ßa aqui.\n          // N√£o manipule o DOM diretamente.\n        } catch (error) {\n          console.error('‚ùå [CALENDAR] Erro durante cleanup:', error);\n        }\n      }, 100);\n    };\n  }, [isCalendarVisible]);\n\n  return calendarContainerRef;\n}\n","size_bytes":1186},"client/src/hooks/useSafeNavigation.ts":{"content":"/**\n * Hook para navega√ß√£o segura que previne erros DOM de removeChild\n * Gerencia o ciclo de vida de modais, calend√°rios e outros elementos do DOM\n */\nimport { useEffect, useRef, useCallback } from 'react';\n\ninterface SafeNavigationConfig {\n  componentName: string;\n  modals?: {\n    isOpen: boolean;\n    setIsOpen: (open: boolean) => void;\n    resetState?: () => void;\n  }[];\n  calendars?: {\n    isVisible: boolean;\n    cleanup?: () => void;\n  }[];\n}\n\nexport function useSafeNavigation(config: SafeNavigationConfig) {\n  const isComponentMounted = useRef(true);\n  const cleanupFunctions = useRef<(() => void)[]>([]);\n\n  // Fun√ß√£o para registrar limpeza personalizada\n  const registerCleanup = useCallback((cleanupFn: () => void) => {\n    cleanupFunctions.current.push(cleanupFn);\n  }, []);\n\n  // Fun√ß√£o segura para fechar modais\n  const safeCloseModals = useCallback(() => {\n    if (!isComponentMounted.current) {\n      console.log(`‚ö†Ô∏è [${config.componentName}] Componente desmontado, ignorando fechamento de modais`);\n      return false;\n    }\n\n    try {\n      config.modals?.forEach((modal, index) => {\n        if (modal.isOpen) {\n          console.log(`üîí [${config.componentName}] Fechando modal ${index + 1}`);\n          modal.setIsOpen(false);\n          modal.resetState?.();\n        }\n      });\n      return true;\n    } catch (error) {\n      console.error(`‚ùå [${config.componentName}] Erro ao fechar modais:`, error);\n      return false;\n    }\n  }, [config.componentName, config.modals]);\n\n  // Fun√ß√£o segura para limpeza de calend√°rios\n  const safeCleanupCalendars = useCallback(() => {\n    if (!isComponentMounted.current) {\n      console.log(`‚ö†Ô∏è [${config.componentName}] Componente desmontado, ignorando limpeza de calend√°rios`);\n      return false;\n    }\n\n    try {\n      config.calendars?.forEach((calendar, index) => {\n        if (calendar.isVisible && calendar.cleanup) {\n          console.log(`üìÖ [${config.componentName}] Limpando calend√°rio ${index + 1}`);\n          calendar.cleanup();\n        }\n      });\n      return true;\n    } catch (error) {\n      console.error(`‚ùå [${config.componentName}] Erro na limpeza de calend√°rios:`, error);\n      return false;\n    }\n  }, [config.componentName, config.calendars]);\n\n  // Cleanup principal no desmonte do componente\n  useEffect(() => {\n    isComponentMounted.current = true;\n\n    return () => {\n      console.log(`üßπ [${config.componentName}] Iniciando limpeza segura do componente`);\n      isComponentMounted.current = false;\n\n      // Executar todas as limpezas registradas\n      cleanupFunctions.current.forEach((cleanup, index) => {\n        try {\n          cleanup();\n          console.log(`‚úÖ [${config.componentName}] Limpeza ${index + 1} conclu√≠da`);\n        } catch (error) {\n          console.error(`‚ùå [${config.componentName}] Erro na limpeza ${index + 1}:`, error);\n        }\n      });\n\n      // Limpeza de modais\n      safeCloseModals();\n      \n      // Limpeza de calend√°rios\n      safeCleanupCalendars();\n\n      console.log(`‚ú® [${config.componentName}] Limpeza completa conclu√≠da`);\n    };\n  }, [config.componentName, safeCloseModals, safeCleanupCalendars]);\n\n  // Retorna utilidades para o componente\n  return {\n    isComponentMounted,\n    registerCleanup,\n    safeCloseModals,\n    safeCleanupCalendars,\n    // Fun√ß√£o para verificar se √© seguro executar opera√ß√µes DOM\n    isSafeToOperate: () => isComponentMounted.current,\n  };\n}","size_bytes":3453},"client/src/lib/download.ts":{"content":"/**\n * Utilit√°rios seguros para download de arquivos\n * Evita manipula√ß√£o direta do DOM que causa conflitos com React\n */\n\n// Fun√ß√£o segura para download que n√£o manipula DOM diretamente\nexport function downloadFile(content: string, filename: string, mimeType = \"text/plain\") {\n  try {\n    const blob = new Blob([content], { type: mimeType });\n    const url = URL.createObjectURL(blob);\n    \n    // Usar createObjectURL + window.open √© mais seguro que appendChild/removeChild\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = filename;\n    a.style.display = 'none';\n    \n    // Usar uma abordagem mais segura que n√£o interfere com React\n    document.body.appendChild(a);\n    a.click();\n    \n    // Cleanup imediato e seguro\n    document.body.removeChild(a);\n    URL.revokeObjectURL(url);\n    \n    return true;\n  } catch (error) {\n    console.error('Erro ao fazer download:', error);\n    return false;\n  }\n}\n\n// Fun√ß√£o espec√≠fica para downloads CSV\nexport function downloadCSV(csvContent: string, filename: string) {\n  return downloadFile(csvContent, filename, \"text/csv;charset=utf-8\");\n}\n\n// Fun√ß√£o para downloads de relat√≥rios de texto\nexport function downloadReport(content: string, filename: string) {\n  return downloadFile(content, filename, \"text/plain;charset=utf-8\");\n}\n\n// Fun√ß√£o ass√≠ncrona para downloads com confirma√ß√£o (evita setTimeout problem√°tico)\nexport async function downloadWithConfirmation(\n  content: string, \n  filename: string, \n  message: string,\n  mimeType = \"text/plain\"\n): Promise<boolean> {\n  try {\n    if (confirm(message)) {\n      return downloadFile(content, filename, mimeType);\n    }\n    return false;\n  } catch (error) {\n    console.error('Erro no download com confirma√ß√£o:', error);\n    return false;\n  }\n}","size_bytes":1791},"client/test-auth.js":{"content":"\n// Simular login no localStorage para teste\nlocalStorage.setItem('token', 'fake-token-for-test');\nwindow.location.href = '/technicians';\n\n","size_bytes":139},"server/solve_tsp.py":{"content":"import sys\nimport json\nfrom ortools.constraint_solver import pywrapcp, routing_enums_pb2\n\ndata = json.load(sys.stdin)\nmatrix = data[\"matrix\"]\nterminar_no_ponto_inicial = data.get(\"terminarNoPontoInicial\", False)\n\nprint(\"=== DEBUG Python ===\", file=sys.stderr)\nprint(\"terminar_no_ponto_inicial:\", terminar_no_ponto_inicial, file=sys.stderr)\nprint(\"Matriz tem\", len(matrix), \"pontos.\", file=sys.stderr)\nsys.stdout.flush()\n\n\ndef create_data_model():\n    return {'distance_matrix': matrix, 'num_vehicles': 1, 'depot': 0}\n\n\ndef main():\n    data_model = create_data_model()\n    if terminar_no_ponto_inicial:\n        # Circular\n        manager = pywrapcp.RoutingIndexManager(len(matrix), 1, 0)\n    else:\n        # Aberta: termina no ponto mais distante do in√≠cio\n        start = 0\n        # Pega o √≠ndice do mais distante\n        distancias = [matrix[start][i] for i in range(len(matrix))]\n        end = distancias.index(max(distancias))\n        manager = pywrapcp.RoutingIndexManager(len(matrix), 1, [start], [end])\n\n    routing = pywrapcp.RoutingModel(manager)\n\n    def distance_callback(from_index, to_index):\n        from_node = manager.IndexToNode(from_index)\n        to_node = manager.IndexToNode(to_index)\n        return int(data_model['distance_matrix'][from_node][to_node])\n\n    transit_callback_index = routing.RegisterTransitCallback(distance_callback)\n    routing.SetArcCostEvaluatorOfAllVehicles(transit_callback_index)\n\n    search_parameters = pywrapcp.DefaultRoutingSearchParameters()\n    search_parameters.first_solution_strategy = (\n        routing_enums_pb2.FirstSolutionStrategy.PATH_CHEAPEST_ARC)\n    search_parameters.local_search_metaheuristic = (\n        routing_enums_pb2.LocalSearchMetaheuristic.GUIDED_LOCAL_SEARCH)\n    search_parameters.time_limit.seconds = 10\n\n    solution = routing.SolveWithParameters(search_parameters)\n\n    result = {'order': [], 'totalDistance': 0, 'totalTime': 0, 'legs': []}\n    if solution:\n        index = routing.Start(0)\n        route = []\n        total_distance = 0\n        legs = []\n        while not routing.IsEnd(index):\n            node_index = manager.IndexToNode(index)\n            route.append(node_index)\n            previous_index = index\n            index = solution.Value(routing.NextVar(index))\n            if not routing.IsEnd(index):\n                next_node = manager.IndexToNode(index)\n                leg_distance = data_model['distance_matrix'][node_index][\n                    next_node]\n                legs.append({\n                    'from': node_index,\n                    'to': next_node,\n                    'distance': leg_distance,\n                    'duration': leg_distance // 60\n                })\n                total_distance += leg_distance\n        # Adiciona o √∫ltimo n√≥ do trajeto\n        last_node = manager.IndexToNode(index)\n        route.append(last_node)\n        result['order'] = route\n        result['totalDistance'] = total_distance\n        result['legs'] = legs\n        result['totalTime'] = total_distance // 60\n    else:\n        result['error'] = 'No solution found!'\n    print(json.dumps(result))\n\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":3142},"client/src/lib/cep.ts":{"content":"export async function buscarEnderecoPorCep(cep: string) {\n  const url = `https://viacep.com.br/ws/${cep.replace(/\\D/g, '')}/json/`;\n  const res = await fetch(url);\n  const data = await res.json();\n  if (data.erro) throw new Error(\"CEP n√£o encontrado\");\n  return data; // {logradouro, bairro, localidade, uf, ...}\n}","size_bytes":315},"pyproject.toml":{"content":"[project]\nname = \"workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"ortools==9.11.4210\",\n]\n","size_bytes":161},"server/routes/routes.api.ts":{"content":"import { Express, Request, Response } from \"express\";\nimport { z } from \"zod\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { fileURLToPath } from \"url\";\nimport { dirname } from \"path\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\nimport { db } from \"../db\";\nimport { routes, routeStops, appointments, clients, technicians, teams, businessRules } from \"@shared/schema\";\nimport { eq, and, gte, lte, like, or, desc, inArray, sql } from \"drizzle-orm\";\n\n// Extend Request type for authenticated user\ninterface AuthenticatedRequest extends Request {\n  user: {\n    userId: number;\n  };\n}\n\n// Helper para ler URL do OSRM\nfunction getOsrmUrl() {\n  const filePath = path.join(__dirname, '../osrm_url.txt');\n  try {\n    return fs.readFileSync(filePath, 'utf8').trim();\n  } catch (err) {\n    console.error('Arquivo osrm_url.txt n√£o encontrado ou n√£o lido!', err);\n    return null;\n  }\n}\n\n// Helper para converter ID num√©rico para UUID v√°lido\nfunction numberToUUID(num: number): string {\n  const padded = num.toString().padStart(32, '0');\n  return [\n    padded.slice(0, 8),\n    padded.slice(8, 12),\n    padded.slice(12, 16),\n    padded.slice(16, 20),\n    padded.slice(20, 32)\n  ].join('-');\n}\n\n// Helper inverso: UUID \"fake\" -> n√∫mero (remove hifens, tira zeros √† esquerda)\nfunction uuidToNumber(uuidStr: string): number | null {\n  if (!uuidStr || typeof uuidStr !== 'string') return null;\n  const compact = uuidStr.replace(/-/g, '');\n  if (!/^[0-9a-fA-F]{32}$/.test(compact)) return null;\n  // Nosso UUID √© composto s√≥ por zeros + d√≠gitos (sem letras), pois vem de n√∫mero padLeft(32,'0')\n  // Removemos zeros √† esquerda e parseamos\n  const numeric = compact.replace(/^0+/, '');\n  if (numeric === '') return 0;\n  const asNum = Number(numeric);\n  return Number.isFinite(asNum) ? asNum : null;\n}\n\n// Schema de valida√ß√£o para otimiza√ß√£o\nconst optimizeRouteSchema = z.object({\n  appointmentIds: z.array(z.union([z.string(), z.number()])),\n  endAtStart: z.boolean(),\n  responsibleType: z.enum(['technician','team']).optional(),\n  responsibleId: z.union([z.string(), z.number()]).optional(),\n  vehicleId: z.string().optional(),\n  title: z.string().optional(),\n  preview: z.boolean().optional()\n});\n\n// Schema para atualiza√ß√£o de status\nconst updateStatusSchema = z.object({\n  status: z.enum([\"draft\",\"optimized\",\"running\",\"done\",\"canceled\"])\n});\n\n// Algoritmo TSP simples: Nearest Neighbor + 2-opt\nfunction solveTSP(distanceMatrix: number[][], endAtStart: boolean = false): number[] {\n  const n = distanceMatrix.length;\n  if (n <= 1) return [0];\n  \n  console.log(\"üßÆ Iniciando TSP com\", n, \"pontos, endAtStart:\", endAtStart);\n  \n  // 1. Nearest Neighbor a partir do ponto 0 (in√≠cio)\n  const visited = new Set<number>();\n  const tour = [0];\n  visited.add(0);\n  \n  let current = 0;\n  while (visited.size < n) {\n    let nearest = -1;\n    let minDistance = Infinity;\n    \n    for (let i = 0; i < n; i++) {\n      if (!visited.has(i) && distanceMatrix[current][i] < minDistance) {\n        minDistance = distanceMatrix[current][i];\n        nearest = i;\n      }\n    }\n    \n    if (nearest !== -1) {\n      tour.push(nearest);\n      visited.add(nearest);\n      current = nearest;\n    }\n  }\n  \n  console.log(\"üîÑ Tour inicial (Nearest Neighbor):\", tour);\n  \n  // 2. Melhoria 2-opt (vers√£o simplificada)\n  for (let iterations = 0; iterations < 50; iterations++) {\n    let improved = false;\n    \n    for (let i = 1; i < tour.length - 2; i++) {\n      for (let j = i + 1; j < tour.length - 1; j++) {\n        // Calcular ganho da troca 2-opt\n        const before = distanceMatrix[tour[i-1]][tour[i]] + distanceMatrix[tour[j]][tour[j+1]];\n        const after = distanceMatrix[tour[i-1]][tour[j]] + distanceMatrix[tour[i]][tour[j+1]];\n        \n        if (after < before) {\n          // Inverter segmento entre i e j\n          const segment = tour.slice(i, j + 1).reverse();\n          tour.splice(i, j - i + 1, ...segment);\n          improved = true;\n        }\n      }\n    }\n    \n    if (!improved) break;\n  }\n  \n  console.log(\"‚úÖ Tour otimizado:\", tour);\n  \n  // Se endAtStart=false, remover volta ao in√≠cio\n  if (!endAtStart && tour.length > 1) {\n    return tour;\n  }\n  \n  // Se endAtStart=true, garantir que volta ao in√≠cio\n  if (endAtStart && tour[tour.length - 1] !== 0) {\n    tour.push(0);\n  }\n  \n  return tour;\n}\n\n// Fun√ß√£o para buscar matriz OSRM\nasync function getOSRMMatrix(coordinates: [number, number][]): Promise<{ durations: number[][], distances: number[][] }> {\n  const OSRM_URL = getOsrmUrl()?.replace(/\\/$/, '') || null;\n  if (!OSRM_URL) {\n    throw new Error(\"OSRM URL n√£o configurado\");\n  }\n  \n  const coordStr = coordinates.map(c => c.join(',')).join(';');\n  const osrmUrl = `${OSRM_URL}/table/v1/driving/${coordStr}?annotations=duration,distance`;\n  \n  console.log(\"üåê Chamando OSRM matrix:\", osrmUrl);\n  \n  const response = await fetch(osrmUrl);\n  const data = await response.json();\n  \n  if (!data.durations || !data.distances) {\n    throw new Error(\"OSRM n√£o retornou matriz v√°lida\");\n  }\n  \n  return {\n    durations: data.durations,\n    distances: data.distances\n  };\n}\n\n// Fun√ß√£o para buscar polyline OSRM\nasync function getOSRMRoute(coordinates: [number, number][]): Promise<any> {\n  const OSRM_URL = getOsrmUrl()?.replace(/\\/$/, '') || null;\n  if (!OSRM_URL) {\n    throw new Error(\"OSRM URL n√£o configurado\");\n  }\n  \n  const coordStr = coordinates.map(c => c.join(',')).join(';');\n  const osrmUrl = `${OSRM_URL}/route/v1/driving/${coordStr}?overview=full&geometries=geojson`;\n  \n  console.log(\"üó∫Ô∏è Chamando OSRM route:\", osrmUrl);\n  \n  const response = await fetch(osrmUrl);\n  const data = await response.json();\n  \n  if (!data.routes || data.routes.length === 0) {\n    throw new Error(\"OSRM n√£o retornou rota v√°lida\");\n  }\n  \n  return data.routes[0].geometry;\n}\n\nexport function registerRoutesAPI(app: Express) {\n  \n  // Middleware simples de autentica√ß√£o (reutilizando a l√≥gica existente)\n  const authenticateToken = (req: any, res: any, next: any) => {\n    // Em modo DEV, criar um usu√°rio fake para testes\n    if (process.env.DEV_MODE === 'true') {\n      req.user = { userId: 1 };\n      return next();\n    }\n    \n    // TODO: Implementar autentica√ß√£o real\n    req.user = { userId: 1 };\n    next();\n  };\n\n  // Endpoint tempor√°rio para migra√ß√£o display_number\n  app.post('/api/routes/migrate-display-numbers', authenticateToken, async (req: any, res: Response) => {\n    console.log(\"üöÄ Simulando migra√ß√£o display_number (in-memory)...\");\n    console.log(\"‚úÖ Migra√ß√£o simulada conclu√≠da\");\n    res.json({ \n      success: true, \n      message: \"Migra√ß√£o simulada - novas rotas usar√£o displayNumber automaticamente\",\n      note: \"As rotas existentes mostrar√£o displayNumber: null at√© serem recriadas\"\n    });\n  });\n  \n  // POST /api/routes/optimize - Otimizar rota\n  app.post('/api/routes/optimize', authenticateToken, async (req: any, res: Response) => {\n    console.log(\"==== LOG IN√çCIO: /api/routes/optimize ====\");\n    console.log(\"Body recebido:\", JSON.stringify(req.body, null, 2));\n    \n    try {\n      const validation = optimizeRouteSchema.safeParse(req.body);\n      if (!validation.success) {\n        console.log(\"‚ùå ERRO: Valida√ß√£o falhou\");\n        console.log(\"Erros:\", validation.error.errors);\n        console.log(\"==== LOG FIM: /api/routes/optimize (ERRO VALIDA√á√ÉO) ====\");\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: validation.error.errors });\n      }\n      \n      const { appointmentIds, endAtStart, vehicleId, title, preview } = validation.data;\n      const appointmentIdsNorm = appointmentIds.map((id: any) => Number(id));\n      \n      // 1. Buscar agendamentos com coordenadas\n      console.log(\"üîç Buscando agendamentos:\", appointmentIdsNorm);\n      const appointmentList = await db\n        .select({\n          id: appointments.id,\n          clientId: appointments.clientId,\n          serviceId: appointments.serviceId,\n          technicianId: appointments.technicianId,\n          teamId: appointments.teamId,\n          scheduledDate: appointments.scheduledDate,\n          cep: appointments.cep,\n          logradouro: appointments.logradouro,\n          numero: appointments.numero,\n          complemento: appointments.complemento,\n          bairro: appointments.bairro,\n          cidade: appointments.cidade,\n          clientName: clients.name,\n        })\n        .from(appointments)\n        .leftJoin(clients, eq(appointments.clientId, clients.id))\n        .where(eq(appointments.userId, req.user.userId));\n      \n      const selectedAppointments = appointmentList.filter(app => \n        appointmentIdsNorm.includes(app.id)\n      );\n      \n      if (selectedAppointments.length === 0) {\n        console.log(\"‚ùå ERRO: Nenhum agendamento encontrado\");\n        console.log(\"==== LOG FIM: /api/routes/optimize (SEM AGENDAMENTOS) ====\");\n        return res.status(404).json({ error: \"Nenhum agendamento encontrado\" });\n      }\n      \n      console.log(\"‚úÖ Agendamentos encontrados:\", selectedAppointments.length);\n      \n      // ‚úÖ Garantir respons√°vel √∫nico entre os agendamentos selecionados\n      const responsibles = selectedAppointments.map((a: any) => {\n        if (a.technicianId && !a.teamId) return `technician:${a.technicianId}`;\n        if (a.teamId && !a.technicianId) return `team:${a.teamId}`;\n        return null;\n      }).filter(Boolean);\n\n      const uniqueResponsibles = Array.from(new Set(responsibles));\n      if (uniqueResponsibles.length !== 1) {\n        console.log(\"‚ùå ERRO: Respons√°veis diferentes encontrados:\", uniqueResponsibles);\n        console.log(\"==== LOG FIM: /api/routes/optimize (RESPONS√ÅVEL INV√ÅLIDO) ====\");\n        return res.status(400).json({\n          error: \"Sele√ß√£o inv√°lida\",\n          details: \"Todos os agendamentos devem pertencer ao mesmo respons√°vel (mesmo t√©cnico ou mesma equipe).\"\n        });\n      }\n\n      const [respType, respId] = uniqueResponsibles[0]!.split(':');\n      const derivedResponsibleType = respType as 'technician' | 'team';\n      const derivedResponsibleId = respId;\n      \n      // 2. Obter endere√ßo de in√≠cio (empresa ou t√©cnico/equipe)\n      let startAddress = \"Endere√ßo da empresa\";\n      let startCoordinates: [number, number] = [-49.2654, -25.4284]; // Curitiba padr√£o\n      \n      // Buscar regras de neg√≥cio para endere√ßo da empresa\n      const businessRule = await db\n        .select()\n        .from(businessRules)\n        .where(eq(businessRules.userId, req.user.userId))\n        .limit(1);\n      \n      if (businessRule.length > 0) {\n        const rule = businessRule[0];\n        startAddress = `${rule.enderecoEmpresaLogradouro}, ${rule.enderecoEmpresaNumero}, ${rule.enderecoEmpresaBairro}, ${rule.enderecoEmpresaCidade}`;\n        \n        // TODO: Geocodificar endere√ßo da empresa se necess√°rio\n        console.log(\"üè¢ Usando endere√ßo da empresa:\", startAddress);\n      }\n      \n      // TODO: Implementar busca de endere√ßo espec√≠fico do t√©cnico/equipe se necess√°rio\n      \n      // 3. Preparar coordenadas para OSRM (in√≠cio + agendamentos)\n      const coordinates: [number, number][] = [startCoordinates];\n      const appointmentData = selectedAppointments.map(app => ({\n        ...app,\n        address: `${app.logradouro}, ${app.numero}, ${app.bairro}, ${app.cidade}`,\n        clientName: app.clientName || \"Cliente\",\n        serviceName: (app as any).serviceName ?? \"\", // se n√£o tiver join com services, fica \"\"\n        scheduledDate: app.scheduledDate ?? null,\n        // TODO: substituir mocks por coords reais quando existirem\n        lat: -25.4284 + Math.random() * 0.1,\n        lng: -49.2654 + Math.random() * 0.1\n      }));\n      \n      appointmentData.forEach(app => {\n        coordinates.push([app.lng, app.lat]);\n      });\n      \n      console.log(\"üìç Coordenadas preparadas:\", coordinates.length, \"pontos\");\n      \n      // 4. Obter matriz de dist√¢ncias/tempos do OSRM\n      console.log(\"üßÆ Calculando matriz OSRM...\");\n      const { durations, distances } = await getOSRMMatrix(coordinates);\n      \n      // 5. Resolver TSP\n      console.log(\"üîÑ Resolvendo TSP...\");\n      const tourOrder = solveTSP(distances, endAtStart);\n      \n      // 6. Calcular totais\n      let totalDistance = 0;\n      let totalDuration = 0;\n      \n      for (let i = 0; i < tourOrder.length - 1; i++) {\n        const from = tourOrder[i];\n        const to = tourOrder[i + 1];\n        totalDistance += distances[from][to];\n        totalDuration += durations[from][to];\n      }\n      \n      console.log(\"üìä Totais calculados - Dist√¢ncia:\", totalDistance, \"m, Dura√ß√£o:\", totalDuration, \"s\");\n      \n      // 7. Gerar polyline GeoJSON\n      const routeCoordinates = tourOrder.map(idx => coordinates[idx]);\n      let polylineGeoJson = null;\n      \n      try {\n        polylineGeoJson = await getOSRMRoute(routeCoordinates);\n        console.log(\"üó∫Ô∏è Polyline gerada com sucesso\");\n      } catch (error) {\n        console.log(\"‚ö†Ô∏è Erro ao gerar polyline:\", error);\n      }\n      \n      // 8. Preparar dados da rota\n      const routeTitle = title || `Rota ${new Date().toLocaleDateString('pt-BR')}`;\n      const routeDate = selectedAppointments[0]?.scheduledDate || new Date();\n      \n      const routeData = {\n        title: routeTitle,\n        date: routeDate,\n        vehicleId: vehicleId || null,\n        responsibleType: derivedResponsibleType,\n        responsibleId: derivedResponsibleId,\n        endAtStart,\n        distanceTotal: Math.round(totalDistance),\n        durationTotal: Math.round(totalDuration),\n        stopsCount: selectedAppointments.length,\n        status: \"draft\" as const,\n        polylineGeoJson\n      };\n\n      // Preparar dados das paradas\n      const stopData = [];\n      for (let i = 1; i < tourOrder.length; i++) { // Pular √≠ndice 0 (in√≠cio)\n        const appointmentIndex = tourOrder[i] - 1; // Ajustar √≠ndice\n        if (appointmentIndex >= 0 && appointmentIndex < appointmentData.length) {\n          const app = appointmentData[appointmentIndex];\n          stopData.push({\n            appointmentId: numberToUUID(Number(app.id)),\n            order: i,\n            lat: app.lat,\n            lng: app.lng,\n            address: app.address\n          });\n        }\n      }\n\n      const start = {\n        address: startAddress,\n        lat: startCoordinates[1],\n        lng: startCoordinates[0]\n      };\n\n      // Preparar stops enriquecidos para resposta\n      const stops = stopData.map(stop => {\n        const app = appointmentData.find(a => numberToUUID(Number(a.id)) === stop.appointmentId);\n        return {\n          order: stop.order,\n          appointmentId: stop.appointmentId,\n          appointmentNumericId: app?.id ?? null,\n          clientName: app?.clientName || \"Cliente\",\n          serviceName: app?.serviceName ?? \"\",\n          scheduledDate: app?.scheduledDate ?? null,\n          address: stop.address,\n          lat: stop.lat,\n          lng: stop.lng\n        };\n      });\n\n      // 9. Se preview !== false, N√ÉO salvar no banco (apenas retornar dados)\n      if (preview !== false) {\n        console.log(\"üìã Modo PREVIEW - n√£o salvando no banco\");\n        const responseData = {\n          route: {\n            id: null,\n            ...routeData,\n            responsible: {\n              type: derivedResponsibleType,\n              id: derivedResponsibleId\n            }\n          },\n          start,\n          stops\n        };\n        \n        console.log(\"‚úÖ Rota otimizada (PREVIEW)\");\n        console.log(\"üìç Start adicionado ao payload:\", startAddress);\n        console.log(\"==== LOG FIM: /api/routes/optimize (SUCESSO - PREVIEW) ====\");\n        return res.json(responseData);\n      }\n\n      // 10. Calcular pr√≥ximo displayNumber\n      let nextDisplayNumber = 1;\n      {\n        const [maxRes] = await db\n          .select({ maxNum: sql<number>`COALESCE(MAX(${routes.displayNumber}), 0)` })\n          .from(routes);\n        nextDisplayNumber = (maxRes?.maxNum ?? 0) + 1;\n      }\n\n      // 11. Salvar no banco (se preview === false)\n      console.log(\"üíæ Salvando rota no banco...\");\n      const [savedRoute] = await db\n        .insert(routes)\n        .values({\n          ...routeData,\n          displayNumber: nextDisplayNumber\n        })\n        .returning();\n      \n      // Salvar paradas\n      if (stopData.length > 0) {\n        const stopDataWithRouteId = stopData.map(stop => ({\n          ...stop,\n          routeId: savedRoute.id\n        }));\n        await db.insert(routeStops).values(stopDataWithRouteId);\n        console.log(\"‚úÖ Paradas salvas:\", stopDataWithRouteId.length);\n      }\n\n      const responseData = {\n        route: {\n          id: savedRoute.id,\n          title: savedRoute.title,\n          date: savedRoute.date,\n          vehicleId: savedRoute.vehicleId,\n          responsible: {\n            type: savedRoute.responsibleType,\n            id: savedRoute.responsibleId\n          },\n          endAtStart: savedRoute.endAtStart,\n          distanceTotal: savedRoute.distanceTotal,\n          durationTotal: savedRoute.durationTotal,\n          stopsCount: savedRoute.stopsCount,\n          status: savedRoute.status,\n          polylineGeoJson: savedRoute.polylineGeoJson,\n          displayNumber: savedRoute.displayNumber\n        },\n        start,\n        stops\n      };\n      \n      console.log(\"‚úÖ Rota otimizada e salva com sucesso\");\n      console.log(\"üìç Start adicionado ao payload:\", startAddress);\n      console.log(\"==== LOG FIM: /api/routes/optimize (SUCESSO) ====\");\n      \n      res.json(responseData);\n      \n    } catch (error: any) {\n      console.log(\"‚ùå ERRO na otimiza√ß√£o:\");\n      console.log(\"Mensagem:\", error.message);\n      console.log(\"Stack:\", error.stack);\n      console.log(\"==== LOG FIM: /api/routes/optimize (EXCE√á√ÉO) ====\");\n      res.status(500).json({ error: \"Erro interno do servidor\", details: error.message });\n    }\n  });\n  \n  // GET /api/routes - Listar rotas com filtros\n  app.get('/api/routes', authenticateToken, async (req: any, res: Response) => {\n    console.log(\"==== LOG IN√çCIO: /api/routes ====\");\n    console.log(\"Query params:\", JSON.stringify(req.query, null, 2));\n    \n    try {\n      const { from, to, status, responsibleType, responsibleId, vehicleId, search } = req.query;\n      \n      const conditions = [];\n      \n      if (from) {\n        conditions.push(gte(routes.date, new Date(from as string)));\n      }\n      \n      if (to) {\n        conditions.push(lte(routes.date, new Date(to as string)));\n      }\n      \n      if (status) {\n        conditions.push(eq(routes.status, status as string));\n      }\n      \n      if (responsibleType) {\n        conditions.push(eq(routes.responsibleType, responsibleType as string));\n      }\n      \n      if (responsibleId) {\n        conditions.push(eq(routes.responsibleId, responsibleId as string));\n      }\n      \n      if (vehicleId) {\n        conditions.push(eq(routes.vehicleId, vehicleId as string));\n      }\n      \n      if (search) {\n        conditions.push(like(routes.title, `%${search}%`));\n      }\n      \n      const baseQuery = db\n        .select({\n          id: routes.id,\n          title: routes.title,\n          date: routes.date,\n          vehicleId: routes.vehicleId,\n          responsibleType: routes.responsibleType,\n          responsibleId: routes.responsibleId,\n          endAtStart: routes.endAtStart,\n          distanceTotal: routes.distanceTotal,\n          durationTotal: routes.durationTotal,\n          stopsCount: routes.stopsCount,\n          status: routes.status,\n          displayNumber: routes.displayNumber,\n          createdAt: routes.createdAt\n        })\n        .from(routes);\n      \n      const routeList = conditions.length > 0 \n        ? await baseQuery.where(and(...conditions)).orderBy(desc(routes.createdAt))\n        : await baseQuery.orderBy(desc(routes.createdAt));\n      \n      console.log(\"‚úÖ Rotas encontradas:\", routeList.length);\n      console.log(\"==== LOG FIM: /api/routes (SUCESSO) ====\");\n      \n      res.json(routeList);\n      \n    } catch (error: any) {\n      console.log(\"‚ùå ERRO na listagem:\");\n      console.log(\"Mensagem:\", error.message);\n      console.log(\"==== LOG FIM: /api/routes (ERRO) ====\");\n      res.status(500).json({ error: \"Erro interno do servidor\", details: error.message });\n    }\n  });\n  \n  // GET /api/routes/:id - Buscar rota espec√≠fica\n  app.get('/api/routes/:id', authenticateToken, async (req: any, res: Response) => {\n    console.log(\"==== LOG IN√çCIO: /api/routes/:id ====\");\n    console.log(\"Route ID:\", req.params.id);\n    \n    try {\n      const routeId = req.params.id;\n      \n      // Buscar rota\n      const [route] = await db\n        .select()\n        .from(routes)\n        .where(eq(routes.id, routeId));\n      \n      if (!route) {\n        console.log(\"‚ùå ERRO: Rota n√£o encontrada\");\n        console.log(\"==== LOG FIM: /api/routes/:id (N√ÉO ENCONTRADA) ====\");\n        return res.status(404).json({ error: \"Rota n√£o encontrada\" });\n      }\n      \n      // 1) Buscar paradas da rota\n      const stopsRaw = await db\n        .select()\n        .from(routeStops)\n        .where(eq(routeStops.routeId, routeId))\n        .orderBy(routeStops.order);\n\n      console.log(\"üß© Enriquecendo paradas com dados do cliente...\");\n\n      // 2) Converter appointmentId (UUID fake) -> n√∫mero\n      const appointmentNumericIds = stopsRaw\n        .map(s => uuidToNumber(s.appointmentId as unknown as string))\n        .filter((n): n is number => typeof n === 'number' && Number.isFinite(n));\n\n      let appointmentsWithClients: Array<{\n        id: number,\n        clientId: number | null,\n        clientName: string | null,\n        scheduledDate: Date | null\n      }> = [];\n\n      // 3) Buscar appointments + clients apenas dos IDs necess√°rios (com inArray)\n      if (appointmentNumericIds.length > 0) {\n        appointmentsWithClients = await db\n          .select({\n            id: appointments.id,\n            clientId: appointments.clientId,\n            clientName: clients.name,\n            scheduledDate: appointments.scheduledDate,\n          })\n          .from(appointments)\n          .leftJoin(clients, eq(appointments.clientId, clients.id))\n          .where(and(\n            eq(appointments.userId, (req as any).user.userId),\n            inArray(appointments.id, appointmentNumericIds)\n          ));\n      }\n\n      // 4) Montar map id->dados para resolver r√°pido\n      const appMap = new Map<number, { clientName: string | null, scheduledDate: Date | null }>();\n      for (const a of appointmentsWithClients) {\n        appMap.set(a.id, { clientName: a.clientName ?? null, scheduledDate: a.scheduledDate ?? null });\n      }\n\n      // 5) Enriquecer as paradas com clientName e scheduledDate\n      const stops = stopsRaw.map(s => {\n        const numericId = uuidToNumber(s.appointmentId as unknown as string);\n        const extra = numericId != null ? appMap.get(numericId) : undefined;\n        return {\n          ...s,\n          appointmentNumericId: numericId ?? null,\n          clientName: extra?.clientName ?? null,\n          scheduledDate: extra?.scheduledDate ?? null,\n        };\n      });\n\n      console.log(\"‚úÖ Rota encontrada com\", stops.length, \"paradas (enriquecidas com clientName)\");\n\n      res.json({\n        route,\n        stops\n      });\n      \n    } catch (error: any) {\n      console.log(\"‚ùå ERRO na busca:\");\n      console.log(\"Mensagem:\", error.message);\n      console.log(\"==== LOG FIM: /api/routes/:id (ERRO) ====\");\n      res.status(500).json({ error: \"Erro interno do servidor\", details: error.message });\n    }\n  });\n\n  // PATCH /api/routes/:id/status - Atualizar status da rota\n  app.patch('/api/routes/:id/status', authenticateToken, async (req: any, res: Response) => {\n    try {\n      const routeId = req.params.id;\n      const parsed = updateStatusSchema.safeParse(req.body);\n      if (!parsed.success) return res.status(400).json({ error: \"Status inv√°lido\" });\n      const { status } = parsed.data;\n\n      const [updated] = await db\n        .update(routes)\n        .set({ status })\n        .where(eq(routes.id, routeId))\n        .returning();\n\n      if (!updated) return res.status(404).json({ error: \"Rota n√£o encontrada\" });\n      res.json({ ok: true, route: updated });\n    } catch (e: any) {\n      console.error(\"Erro ao atualizar status:\", e);\n      res.status(500).json({ error: \"Erro ao atualizar status\", details: e.message });\n    }\n  });\n}","size_bytes":24437},"client/src/pages/routes-history/RoutesHistoryPage.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table';\nimport { Badge } from '@/components/ui/badge';\nimport { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle, SheetTrigger } from '@/components/ui/sheet';\nimport { Separator } from '@/components/ui/separator';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { \n  History, \n  Search, \n  Filter, \n  Car, \n  User, \n  MapPin, \n  Clock, \n  Route,\n  Navigation,\n  Download,\n  Eye\n} from 'lucide-react';\n\ninterface RouteFilters {\n  dateFrom: string;\n  dateTo: string;\n  selectedResponsible: string;\n  selectedVehicle: string;\n  selectedStatus: string;\n  searchTerm: string;\n}\n\ninterface Route {\n  id: string;\n  title: string;\n  date: string;\n  vehicleId?: string;\n  responsibleType: 'technician' | 'team';\n  responsibleId: string;\n  distanceTotal: number;\n  durationTotal: number;\n  stopsCount: number;\n  status: 'draft' | 'optimized' | 'running' | 'done' | 'canceled';\n  displayNumber: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface RouteDetail {\n  route: Route;\n  stops: Array<{\n    id: string;\n    routeId: string;\n    appointmentId: string;\n    order: number;\n    lat: number;\n    lng: number;\n    address: string;\n    appointmentNumericId?: number | null;\n    clientName?: string | null;\n    scheduledDate?: Date | null;\n  }>;\n}\n\nconst statusLabels = {\n  draft: 'Rascunho',\n  optimized: 'Otimizada', \n  running: 'Em execu√ß√£o',\n  done: 'Finalizada',\n  canceled: 'Cancelada'\n};\n\nconst statusColors = {\n  draft: 'bg-gray-100 text-gray-800',\n  optimized: 'bg-blue-100 text-blue-800',\n  running: 'bg-yellow-100 text-yellow-800', \n  done: 'bg-green-100 text-green-800',\n  canceled: 'bg-red-100 text-red-800'\n};\n\n// Helpers seguros de formata√ß√£o\nconst fmtDateTime = (v?: string | number | Date | null) => {\n  if (!v) return \"‚Äî\";\n  const d = new Date(v);\n  return isNaN(d.getTime()) ? \"‚Äî\" : d.toLocaleString(\"pt-BR\", { hour: \"2-digit\", minute: \"2-digit\", day: \"2-digit\", month: \"2-digit\", year: \"numeric\" });\n};\n\nconst fmtDate = (v?: string | number | Date | null) => {\n  if (!v) return \"‚Äî\";\n  const d = new Date(v);\n  return isNaN(d.getTime()) ? \"‚Äî\" : d.toLocaleDateString(\"pt-BR\");\n};\n\nconst fmtKm = (m?: number) => (m && m > 0 ? `${(m / 1000).toFixed(1)} km` : \"‚Äî\");\nconst fmtMin = (s?: number) => (s && s > 0 ? `${Math.round(s / 60)} min` : \"‚Äî\");\n\nexport default function RoutesHistoryPage() {\n  const [filters, setFilters] = useState<RouteFilters>({\n    dateFrom: '',\n    dateTo: '',\n    selectedResponsible: 'all',\n    selectedVehicle: 'all', \n    selectedStatus: 'all',\n    searchTerm: ''\n  });\n\n  const [selectedRoute, setSelectedRoute] = useState<string | null>(null);\n\n  // Fun√ß√£o para verificar URL params e abrir automaticamente a modal\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const openRouteId = urlParams.get('open');\n    if (openRouteId && routes.length > 0) {\n      const routeExists = routes.find(route => route.id === openRouteId);\n      if (routeExists) {\n        setSelectedRoute(openRouteId);\n        // Limpar o par√¢metro da URL ap√≥s abrir\n        const newUrl = window.location.pathname;\n        window.history.replaceState({}, '', newUrl);\n      }\n    }\n  }, [routes]);\n\n  console.log('‚úÖ P√°gina Hist√≥rico de Rotas carregada');\n  console.log('üîç [ROUTES HISTORY] Aplicando filtros:', filters);\n\n  // Query para listar rotas com filtros\n  const { data: routes = [], isLoading: isLoadingRoutes } = useQuery<Route[]>({\n    queryKey: ['/api/routes', filters],\n    queryFn: async () => {\n      const params = new URLSearchParams();\n      \n      if (filters.dateFrom) params.append('from', filters.dateFrom);\n      if (filters.dateTo) params.append('to', filters.dateTo);\n      if (filters.selectedStatus !== 'all') params.append('status', filters.selectedStatus);\n      if (filters.selectedResponsible !== 'all') {\n        const [type, id] = filters.selectedResponsible.split(':');\n        params.append('responsibleType', type);\n        params.append('responsibleId', id);\n      }\n      if (filters.selectedVehicle !== 'all') params.append('vehicleId', filters.selectedVehicle);\n      if (filters.searchTerm.trim()) params.append('search', filters.searchTerm.trim());\n      \n      const response = await fetch(`/api/routes?${params.toString()}`);\n      if (!response.ok) throw new Error('Erro ao buscar rotas');\n      return response.json();\n    }\n  });\n\n  // Query para detalhes da rota selecionada\n  const { data: routeDetail } = useQuery<RouteDetail>({\n    queryKey: ['/api/routes', selectedRoute],\n    queryFn: async () => {\n      const response = await fetch(`/api/routes/${selectedRoute}`);\n      if (!response.ok) throw new Error('Erro ao buscar detalhes da rota');\n      return response.json();\n    },\n    enabled: !!selectedRoute\n  });\n\n  // Queries para options dos filtros\n  const { data: technicians = [] } = useQuery({\n    queryKey: ['/api/technicians'],\n    queryFn: async () => {\n      const response = await fetch('/api/technicians');\n      if (!response.ok) throw new Error('Erro ao buscar t√©cnicos');\n      return response.json();\n    }\n  });\n\n  const { data: teams = [] } = useQuery({\n    queryKey: ['/api/teams'],\n    queryFn: async () => {\n      const response = await fetch('/api/teams');\n      if (!response.ok) throw new Error('Erro ao buscar equipes');\n      return response.json();\n    }\n  });\n\n  const { data: vehicles = [] } = useQuery({\n    queryKey: ['/api/vehicles'],\n    queryFn: async () => {\n      const response = await fetch('/api/vehicles');\n      if (!response.ok) throw new Error('Erro ao buscar ve√≠culos');\n      return response.json();\n    }\n  });\n\n  const { data: appointments = [] } = useQuery({\n    queryKey: ['/api/appointments'],\n    queryFn: async () => {\n      const response = await fetch('/api/appointments');\n      if (!response.ok) throw new Error('Erro ao buscar agendamentos');\n      return response.json();\n    }\n  });\n\n  const { data: clients = [] } = useQuery({\n    queryKey: ['/api/clients'],\n    queryFn: async () => {\n      const response = await fetch('/api/clients');\n      if (!response.ok) throw new Error('Erro ao buscar clientes');\n      return response.json();\n    }\n  });\n\n  const formatDistance = (meters: number) => {\n    if (meters >= 1000) {\n      return `${(meters / 1000).toFixed(1)} km`;\n    }\n    return `${meters} m`;\n  };\n\n  const formatDuration = (seconds: number) => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    \n    if (hours > 0) {\n      return `${hours}h ${minutes}min`;\n    }\n    return `${minutes}min`;\n  };\n\n  const getResponsibleName = (route?: Route) => {\n    if (!route) return '‚Äî';\n    if (route.responsibleType === 'technician') {\n      const technician = technicians.find((t: any) => t.id.toString() === route.responsibleId);\n      return technician?.name || `T√©cnico ${route.responsibleId}`;\n    } else {\n      const team = teams.find((t: any) => t.id.toString() === route.responsibleId);\n      return team?.name || `Equipe ${route.responsibleId}`;\n    }\n  };\n\n  const getVehicleName = (vehicleId?: string) => {\n    if (!vehicleId) return '-';\n    const vehicle = vehicles.find((v: any) => v.id.toString() === vehicleId);\n    return vehicle ? `${vehicle.plate} (${vehicle.model})` : vehicleId;\n  };\n\n  const getClientNameByAppointmentId = (appointmentId: string) => {\n    const appointment = appointments.find((apt: any) => apt.id.toString() === appointmentId);\n    if (!appointment) return `Agendamento #${appointmentId}`;\n    \n    const client = clients.find((cli: any) => cli.id.toString() === appointment.clientId?.toString());\n    return client?.name || `Cliente n√£o encontrado`;\n  };\n\n  const getRouteVehicleName = (route: Route) => {\n    // Primeiro verifica se a rota tem ve√≠culo direto\n    if (route.vehicleId) {\n      return getVehicleName(route.vehicleId);\n    }\n    \n    // Se n√£o tem ve√≠culo direto, verifica se √© uma equipe com ve√≠culo vinculado\n    if (route.responsibleType === 'team') {\n      const team = teams.find((t: any) => t.id.toString() === route.responsibleId);\n      if (team?.vehicleId) {\n        return getVehicleName(team.vehicleId.toString());\n      }\n    }\n    \n    return '-';\n  };\n\n  const handleStartNavigation = () => {\n    // TODO: Implementar funcionalidade de navega√ß√£o\n    console.log('üß≠ Iniciar navega√ß√£o para rota:', selectedRoute);\n  };\n\n  const handleExportRoute = () => {\n    // TODO: Implementar exporta√ß√£o da rota\n    console.log('üì§ Exportar rota:', selectedRoute);\n  };\n\n  console.log('üìã [ROUTES HISTORY] Componente montado/atualizado');\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      {/* Header */}\n      <div>\n        <div className=\"flex items-center gap-2 mb-2\">\n          <History className=\"h-6 w-6 text-burnt-yellow\" />\n          <h1 className=\"text-2xl font-bold text-gray-900\">Hist√≥rico de Rotas</h1>\n        </div>\n        <p className=\"text-gray-600\">Visualize e gerencie o hist√≥rico de rotas otimizadas</p>\n      </div>\n\n      {/* Filtros */}\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Filter className=\"h-5 w-5\" />\n            Filtros\n          </CardTitle>\n          <CardDescription>\n            Use os filtros abaixo para encontrar rotas espec√≠ficas\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {/* Per√≠odo */}\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Data de</label>\n              <Input\n                type=\"date\"\n                value={filters.dateFrom}\n                onChange={(e) => setFilters(prev => ({ ...prev, dateFrom: e.target.value }))}\n                data-testid=\"input-date-from\"\n              />\n            </div>\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Data at√©</label>\n              <Input\n                type=\"date\"\n                value={filters.dateTo}\n                onChange={(e) => setFilters(prev => ({ ...prev, dateTo: e.target.value }))}\n                data-testid=\"input-date-to\"\n              />\n            </div>\n\n            {/* Respons√°vel */}\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Respons√°vel</label>\n              <Select \n                value={filters.selectedResponsible}\n                onValueChange={(value) => setFilters(prev => ({ ...prev, selectedResponsible: value }))}\n              >\n                <SelectTrigger data-testid=\"select-responsible\">\n                  <SelectValue placeholder=\"Selecione...\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Todos</SelectItem>\n                  {technicians.map((tech: any) => (\n                    <SelectItem key={`technician:${tech.id}`} value={`technician:${tech.id}`}>\n                      {tech.name} (T√©cnico)\n                    </SelectItem>\n                  ))}\n                  {teams.map((team: any) => (\n                    <SelectItem key={`team:${team.id}`} value={`team:${team.id}`}>\n                      {team.name} (Equipe)\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Ve√≠culo */}\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Ve√≠culo</label>\n              <Select\n                value={filters.selectedVehicle}\n                onValueChange={(value) => setFilters(prev => ({ ...prev, selectedVehicle: value }))}\n              >\n                <SelectTrigger data-testid=\"select-vehicle\">\n                  <SelectValue placeholder=\"Selecione...\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Todos</SelectItem>\n                  {vehicles.map((vehicle: any) => (\n                    <SelectItem key={vehicle.id} value={vehicle.id.toString()}>\n                      {vehicle.plate} ({vehicle.model})\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Status */}\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Status</label>\n              <Select\n                value={filters.selectedStatus}\n                onValueChange={(value) => setFilters(prev => ({ ...prev, selectedStatus: value }))}\n              >\n                <SelectTrigger data-testid=\"select-status\">\n                  <SelectValue placeholder=\"Selecione...\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"all\">Todos</SelectItem>\n                  <SelectItem value=\"draft\">Rascunho</SelectItem>\n                  <SelectItem value=\"optimized\">Otimizada</SelectItem>\n                  <SelectItem value=\"running\">Em execu√ß√£o</SelectItem>\n                  <SelectItem value=\"done\">Finalizada</SelectItem>\n                  <SelectItem value=\"canceled\">Cancelada</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            {/* Busca por t√≠tulo */}\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Buscar por t√≠tulo</label>\n              <div className=\"relative\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400\" />\n                <Input\n                  placeholder=\"Digite o t√≠tulo da rota...\"\n                  value={filters.searchTerm}\n                  onChange={(e) => setFilters(prev => ({ ...prev, searchTerm: e.target.value }))}\n                  className=\"pl-10\"\n                  data-testid=\"input-search-term\"\n                />\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Tabela */}\n      <Card>\n        <CardHeader>\n          <CardTitle>\n            Rotas Encontradas ({routes.length})\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          {isLoadingRoutes ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-burnt-yellow\"></div>\n            </div>\n          ) : routes.length === 0 ? (\n            <div className=\"text-center py-8\">\n              <div className=\"text-gray-500\">Nenhuma rota encontrada com os filtros aplicados</div>\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead>ID</TableHead>\n                    <TableHead>T√≠tulo</TableHead>\n                    <TableHead>Data</TableHead>\n                    <TableHead>Ve√≠culo</TableHead>\n                    <TableHead>T√©cnico/Equipe</TableHead>\n                    <TableHead>Dist√¢ncia</TableHead>\n                    <TableHead>Dura√ß√£o</TableHead>\n                    <TableHead>Paradas</TableHead>\n                    <TableHead>Status</TableHead>\n                    <TableHead>A√ß√µes</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {routes.map((route) => (\n                    <TableRow key={route.id} data-testid={`row-route-${route.id}`}>\n                      <TableCell className=\"font-medium\">#{route.displayNumber}</TableCell>\n                      <TableCell className=\"font-medium\">{route.title}</TableCell>\n                      <TableCell>\n                        {fmtDateTime(route.date)}\n                      </TableCell>\n                      <TableCell>{getRouteVehicleName(route)}</TableCell>\n                      <TableCell>{getResponsibleName(route)}</TableCell>\n                      <TableCell className=\"text-blue-600\">\n                        {fmtKm(route.distanceTotal)}\n                      </TableCell>\n                      <TableCell className=\"text-green-600\">\n                        {fmtMin(route.durationTotal)}\n                      </TableCell>\n                      <TableCell>{route.stopsCount}</TableCell>\n                      <TableCell>\n                        <Badge className={statusColors[route.status] || statusColors.draft}>\n                          {statusLabels[route.status] || route.status}\n                        </Badge>\n                      </TableCell>\n                      <TableCell>\n                        <Sheet>\n                          <SheetTrigger asChild>\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => setSelectedRoute(route.id)}\n                              data-testid={`button-view-route-${route.id}`}\n                            >\n                              <Eye className=\"h-4 w-4 mr-1\" />\n                              Ver\n                            </Button>\n                          </SheetTrigger>\n                          <SheetContent className=\"w-[400px] sm:w-[540px]\">\n                            <SheetHeader>\n                              <SheetTitle>Detalhes da Rota</SheetTitle>\n                              <SheetDescription>\n                                Informa√ß√µes completas sobre a rota selecionada\n                              </SheetDescription>\n                            </SheetHeader>\n                            \n                            {routeDetail && (\n                              <div className=\"mt-6 space-y-6\">\n                                {/* Informa√ß√µes gerais */}\n                                <div>\n                                  <h4 className=\"font-semibold text-lg mb-3\">{routeDetail.route?.title}</h4>\n                                  \n                                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                                    <div>\n                                      <div className=\"text-gray-500\">Data</div>\n                                      <div className=\"font-medium\">\n                                        {fmtDateTime(routeDetail.route?.date)}\n                                      </div>\n                                    </div>\n                                    \n                                    <div>\n                                      <div className=\"text-gray-500\">Status</div>\n                                      <Badge className={statusColors[routeDetail.route?.status] || statusColors.draft}>\n                                        {statusLabels[routeDetail.route?.status] || routeDetail.route?.status}\n                                      </Badge>\n                                    </div>\n                                    \n                                    <div>\n                                      <div className=\"text-gray-500\">Ve√≠culo</div>\n                                      <div className=\"font-medium flex items-center gap-1\">\n                                        <Car className=\"h-4 w-4\" />\n                                        {getRouteVehicleName(routeDetail.route)}\n                                      </div>\n                                    </div>\n                                    \n                                    <div>\n                                      <div className=\"text-gray-500\">Respons√°vel</div>\n                                      <div className=\"font-medium flex items-center gap-1\">\n                                        <User className=\"h-4 w-4\" />\n                                        {getResponsibleName(routeDetail.route)}\n                                      </div>\n                                    </div>\n                                  </div>\n                                </div>\n\n                                <Separator />\n\n                                {/* M√©tricas */}\n                                <div className=\"grid grid-cols-3 gap-4\">\n                                  <div className=\"text-center p-3 bg-blue-50 rounded-lg\">\n                                    <Route className=\"h-6 w-6 text-blue-600 mx-auto mb-1\" />\n                                    <div className=\"text-sm text-gray-500\">Dist√¢ncia</div>\n                                    <div className=\"font-bold text-blue-600\">\n                                      {fmtKm(routeDetail.route?.distanceTotal)}\n                                    </div>\n                                  </div>\n                                  \n                                  <div className=\"text-center p-3 bg-green-50 rounded-lg\">\n                                    <Clock className=\"h-6 w-6 text-green-600 mx-auto mb-1\" />\n                                    <div className=\"text-sm text-gray-500\">Dura√ß√£o</div>\n                                    <div className=\"font-bold text-green-600\">\n                                      {fmtMin(routeDetail.route?.durationTotal)}\n                                    </div>\n                                  </div>\n                                  \n                                  <div className=\"text-center p-3 bg-yellow-50 rounded-lg\">\n                                    <MapPin className=\"h-6 w-6 text-yellow-600 mx-auto mb-1\" />\n                                    <div className=\"text-sm text-gray-500\">Paradas</div>\n                                    <div className=\"font-bold text-yellow-600\">\n                                      {routeDetail.route?.stopsCount}\n                                    </div>\n                                  </div>\n                                </div>\n\n                                <Separator />\n\n                                {/* Lista de paradas */}\n                                <div>\n                                  <h5 className=\"font-semibold mb-3\">Paradas da Rota</h5>\n                                  <ScrollArea className=\"h-[300px]\">\n                                    <div className=\"space-y-3\">\n                                      {/* Ponto inicial */}\n                                      <div className=\"flex items-start gap-3 p-3 bg-green-50 rounded-lg border border-green-200\">\n                                        <div className=\"flex-shrink-0 w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold\">\n                                          üè†\n                                        </div>\n                                        <div className=\"flex-1\">\n                                          <div className=\"font-medium text-sm text-green-800\">\n                                            Ponto inicial (Empresa)\n                                          </div>\n                                          <div className=\"text-sm text-green-700 mt-1\">\n                                            Rodovia BR-116, 15480, Xaxim, Curitiba\n                                          </div>\n                                          <div className=\"text-xs text-green-600 mt-1\">\n                                            -49.2654, -25.4284\n                                          </div>\n                                        </div>\n                                      </div>\n\n                                      {/* Paradas dos agendamentos */}\n                                      {routeDetail.stops?.map((stop, index) => (\n                                        <div key={stop.id} className=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n                                          <div className=\"flex-shrink-0 w-8 h-8 bg-burnt-yellow text-white rounded-full flex items-center justify-center text-sm font-bold\">\n                                            {stop.order}\n                                          </div>\n                                          <div className=\"flex-1\">\n                                            <div className=\"font-medium text-sm\">\n                                              {stop.clientName ? stop.clientName : `Agendamento #${stop.appointmentId}`}\n                                            </div>\n                                            <div className=\"text-sm text-gray-600 mt-1\">\n                                              {stop.address}\n                                            </div>\n                                            <div className=\"text-xs text-gray-500 mt-1\">\n                                              {stop.lat.toFixed(6)}, {stop.lng.toFixed(6)}\n                                            </div>\n                                          </div>\n                                        </div>\n                                      ))}\n                                    </div>\n                                  </ScrollArea>\n                                </div>\n\n                                <Separator />\n\n                                {/* A√ß√µes */}\n                                <div className=\"flex gap-3\">\n                                  <Button \n                                    onClick={handleStartNavigation}\n                                    className=\"flex-1\"\n                                    data-testid=\"button-start-navigation\"\n                                  >\n                                    <Navigation className=\"h-4 w-4 mr-2\" />\n                                    Iniciar Navega√ß√£o\n                                  </Button>\n                                  \n                                  <Button \n                                    variant=\"outline\" \n                                    onClick={handleExportRoute}\n                                    className=\"flex-1\"\n                                    data-testid=\"button-export-route\"\n                                  >\n                                    <Download className=\"h-4 w-4 mr-2\" />\n                                    Exportar Rota\n                                  </Button>\n                                </div>\n                              </div>\n                            )}\n                          </SheetContent>\n                        </Sheet>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":26985}}}