Arquivo: client/src/pages/routes-history/RoutesHistoryPage.tsx
Problema: erro “Cannot read properties of undefined (reading 'split')” ao formatar datas no drawer. O objeto de detalhe vem como { route, start, stops }; o campo de data está em routeDetail.route.date (e não routeDetail.date). Também é mais seguro usar new Date(value) em vez de parseISO, com fallback quando faltar valor.

Faças as mudanças abaixo (ANTES/DEPOIS):

Adicionar helpers de formatação seguras (no topo do componente, perto de outras utils):

tsx
Copiar
Editar
// DEPOIS — helpers seguros
const fmtDateTime = (v?: string | number | Date | null) => {
  if (!v) return "—";
  const d = new Date(v);
  return isNaN(d.getTime()) ? "—" : d.toLocaleString("pt-BR", { hour: "2-digit", minute: "2-digit", day: "2-digit", month: "2-digit", year: "numeric" });
};
const fmtDate = (v?: string | number | Date | null) => {
  if (!v) return "—";
  const d = new Date(v);
  return isNaN(d.getTime()) ? "—" : d.toLocaleDateString("pt-BR");
};
const fmtKm = (m?: number) => (m && m > 0 ? `${(m / 1000).toFixed(1)} km` : "—");
const fmtMin = (s?: number) => (s && s > 0 ? `${Math.round(s / 60)} min` : "—");
Onde hoje usa format(parseISO(routeDetail.date), ...), trocar para fmtDateTime(routeDetail.route?.date):

tsx
Copiar
Editar
// ANTES
{format(parseISO(routeDetail.date), 'dd/MM/yyyy HH:mm', { locale: ptBR })}
// DEPOIS
{fmtDateTime(routeDetail.route?.date)}
Na lista de paradas do drawer, trocar qualquer uso de parseISO por fmtDateTime:

tsx
Copiar
Editar
// ANTES
const dt = stop.scheduledDate ? parseISO(stop.scheduledDate) : null;
...
{dt ? format(dt, 'dd/MM/yyyy HH:mm', { locale: ptBR }) : '—'}
// DEPOIS
{fmtDateTime(stop.scheduledDate)}
Na tabela (listagem), se houver formatDate(r.date) usando DateFns, substituir por helper seguro (ou manter se já usa new Date):

tsx
Copiar
Editar
// ANTES
{formatDate(r.date)}
// DEPOIS
{fmtDate(r.date)}
Não alterar outras páginas. Não remover imports desnecessariamente. Se parseISO/format/ptBR ficarem sem uso, pode remover os imports.

Se preferir fazer manualmente, basta trocar onde está quebrando:

No drawer:

tsx
Copiar
Editar
{/* Data da rota */}
<div className="font-medium">
  {fmtDateTime(currentRoute?.route?.date)}
</div>
Nas paradas:

tsx
Copiar
Editar
<p className="text-sm text-gray-500">
  {fmtDateTime(stop.scheduledDate)}
</p>
E manter o resto igual.