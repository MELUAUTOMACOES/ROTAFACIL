ğŸ—ºï¸ Guia de Uso â€” OptimizedRouteMap

O componente OptimizedRouteMap Ã© o Ãºnico ponto central para renderizar rotas no mapa.
Ele jÃ¡ trata pin de inÃ­cio, numeraÃ§Ã£o sequencial de paradas e ajuste automÃ¡tico de zoom.

ğŸ“¦ ImportaÃ§Ã£o
import OptimizedRouteMap from "@/components/maps/OptimizedRouteMap";

âš™ï¸ Props esperadas
<OptimizedRouteMap
  routeGeoJson={polyline ?? undefined}   // GeoJSON da rota (LineString ou Feature)
  waypoints={routeWaypoints ?? undefined} // Lista de paradas (clientes)
  startWaypoint={startPoint ?? null}      // Ponto inicial (empresa/equipe/tÃ©cnico)
/>

1. routeGeoJson

Vem direto do backend (polylineGeoJson).

Usado para desenhar a linha amarela no mapa.

Se nÃ£o tiver, o mapa ajusta o zoom sÃ³ com os waypoints.

2. waypoints

Array de objetos { lat, lon|lng, label? }.

Cada item gera um marcador numerado (1,2,3â€¦).

O OptimizedRouteMap automaticamente remove o ponto inicial dessa lista (para nÃ£o numerar como â€œ1â€).

3. startWaypoint

Objeto { lat, lon|lng }.

Mostrado sempre com o pin verde do RotaFÃ¡cil (/public/brand/rotafacil-pin.png).

Se nÃ£o for passado, o componente tenta inferir o inÃ­cio a partir do routeGeoJson.

ğŸ§­ Regras de PadrÃ£o

Todas as telas (RoteirizaÃ§Ã£o, Agendamentos, HistÃ³rico) usam OptimizedRouteMap exatamente igual.
Apenas muda a forma de montar as props (polyline, stops, start).

O ponto inicial nunca Ã© numerado. Ele sÃ³ aparece com o pin verde.
As entregas comeÃ§am no nÃºmero 1.

O ajuste de zoom (FitToData) sempre considera:

routeGeoJson (se existir), ou

startWaypoint + waypoints.

Containers de mapa precisam ter altura fixa. Exemplo usado no projeto:

<div className="relative w-full h-[420px] md:h-[480px] rounded-lg overflow-hidden border">
  <div className="absolute inset-0">
    <OptimizedRouteMap
      key={`${Boolean(polyline)}-${routeWaypoints?.length ?? 0}`}
      routeGeoJson={polyline ?? undefined}
      waypoints={routeWaypoints ?? undefined}
      startWaypoint={startPoint ?? null}
    />
  </div>
</div>

âœ… BenefÃ­cios

Pin inicial sempre correto.

Paradas numeradas de forma consistente.

Evita duplicar lÃ³gica em cada tela.

PadrÃ£o visual entre todas as telas com mapa.