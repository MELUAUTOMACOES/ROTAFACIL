O “pin” sumiu por dois motivos comuns aqui:

polyline_geojson está vindo como string do back. A gente usa como se fosse objeto, então o cálculo do “startFromGeo” falha e o início não é inferido.

Você está misturando o ponto inicial dentro de waypoints; o OptimizedRouteMap (pelo jeito) só desenha o pin verde quando recebe o início no prop startWaypoint separado.

Segue o patch mínimo pra consertar:

1) Parsear o polylineGeoJson se vier como string e passar startWaypoint

Substitua apenas o bloco anônimo dentro do <div className="absolute inset-0"> (onde montamos os props do mapa) por este:

{(() => {
  // 1) Paradas ordenadas
  const orderedStops = (routeDetail.stops || [])
    .slice()
    .sort((a, b) => (a.order ?? 0) - (b.order ?? 0));

  // 2) Waypoints das paradas (apenas as paradas!)
  const stopWps = orderedStops.map((s) => ({
    lat: Number(s.lat),
    lon: Number(s.lng),
  }));

  // 3) Tenta pegar coordenadas de início (técnico/equipe/empresa)
  const startWp = getStartCoords(routeDetail.route);

  // 4) GeoJSON vindo do backend (pode vir string → parse)
  let rawBackendGeoJson: any =
    (routeDetail.route as any)?.polylineGeoJson ??
    (routeDetail.route as any)?.routeGeoJson ??
    (routeDetail.route as any)?.geojson ??
    null;

  if (typeof rawBackendGeoJson === "string") {
    try { rawBackendGeoJson = JSON.parse(rawBackendGeoJson); } catch {}
  }

  // 5) GeoJSON para desenhar (fallback simples se não vier do back)
  const routeGeoJson =
    rawBackendGeoJson ??
    (stopWps.length >= 2
      ? { type: "LineString", coordinates: stopWps.map((w) => [w.lon, w.lat]) }
      : null);

  // 6) Se NÃO temos startWp, tenta inferir do GeoJSON (primeiro ponto da linha)
  const startFromGeo: { lat: number; lon: number } | null =
    !startWp && routeGeoJson
      ? (() => {
          const geom =
            routeGeoJson?.type === "LineString"
              ? routeGeoJson
              : routeGeoJson?.type === "Feature"
              ? routeGeoJson.geometry
              : routeGeoJson?.geometry?.type === "LineString"
              ? routeGeoJson.geometry
              : null;
          const c = geom?.coordinates?.[0];
          if (Array.isArray(c) && c.length >= 2) {
            const [lon, lat] = c;
            if (Number.isFinite(lat) && Number.isFinite(lon)) {
              return { lat: Number(lat), lon: Number(lon) };
            }
          }
          return null;
        })()
      : null;

  // 7) Ponto inicial definitivo para o pin verde
  const startPoint = startWp || startFromGeo || null;

  return (
    <OptimizedRouteMap
      routeGeoJson={routeGeoJson}
      waypoints={stopWps}           // apenas paradas numeradas
      startWaypoint={startPoint}    // pin de início
    />
  );
})()}

2) (Opcional) corrigir um typozinho no rodapé

Onde está sm:flex-flex-row, troque para sm:flex-row:

<div className="flex flex-col sm:flex-row gap-3">