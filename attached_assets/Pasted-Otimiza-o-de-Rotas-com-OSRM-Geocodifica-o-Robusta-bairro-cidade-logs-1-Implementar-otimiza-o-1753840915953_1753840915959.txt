Otimiza√ß√£o de Rotas com OSRM + Geocodifica√ß√£o Robusta (bairro/cidade/logs)
1. Implementar otimiza√ß√£o autom√°tica de rotas com OSRM TSP
Quero que voc√™ implemente a otimiza√ß√£o autom√°tica das rotas usando o endpoint TSP (Traveling Salesman Problem) do OSRM.

No backend (server/routes.ts), crie um novo endpoint chamado /api/optimize-trip, que funcione como proxy para o endpoint /trip/v1/driving/ do OSRM.

A URL deve ser montada assim:

bash
Copiar
Editar
${OSRM_URL}/trip/v1/driving/${coords}?source=first&destination=last&roundtrip=false&overview=full&geometries=geojson
Este endpoint recebe as coordenadas dos pontos e retorna a rota otimizada com a menor dist√¢ncia poss√≠vel, devolvendo tamb√©m a ordem √≥tima das paradas (waypoints).

No frontend, ao clicar em ‚ÄúOtimizar Rotas‚Äù, fa√ßa a requisi√ß√£o para /api/optimize-trip, sempre come√ßando pelo endere√ßo de in√≠cio correto.

No resultado, exiba para o usu√°rio a rota otimizada e a nova ordem das paradas.

N√£o altere o restante do fluxo, apenas adicione a chamada nova para otimiza√ß√£o.

Mostre exemplos de antes/depois da chamada no front e no back para f√°cil confer√™ncia.

2. Corrigir e robustecer a geocodifica√ß√£o dos endere√ßos de destino
Ao montar o endere√ßo para geocodifica√ß√£o dos destinos (paradas), sempre inclua:

Logradouro

N√∫mero

Bairro

Cidade

CEP

Estado

Brasil

Nunca omita bairro e cidade se existirem!
(Se algum campo n√£o existir, ignore apenas aquele campo.)

Exemplo de endere√ßo correto para geocodifica√ß√£o:

arduino
Copiar
Editar
"Rua Arlindo H. de Carvalho, 126, Bairro Xaxim, Curitiba, 83402-120, PR, Brasil"
No c√≥digo de geocodifica√ß√£o de destinos (antes de buscar coordenadas):

Adicione logs assim:

js
Copiar
Editar
console.log('üìç Endere√ßo para geocodifica√ß√£o:', enderecoString);
Ap√≥s receber a coordenada:

js
Copiar
Editar
console.log('‚úÖ Coordenada encontrada:', enderecoString, result);
Se n√£o encontrar, logue o erro:

js
Copiar
Editar
console.warn('‚ùå Geocodifica√ß√£o FALHOU para:', enderecoString);
Se bairro e cidade n√£o existirem nos dados do agendamento, bloqueie ou exiba mensagem de erro clara ao usu√°rio ‚Äî nunca tente geocodificar um endere√ßo sem esses campos, pois o resultado pode ser em outro estado ou cidade.

Se necess√°rio, adicione no front valida√ß√£o para obrigar bairro e cidade no cadastro de agendamentos.

No resultado da otimiza√ß√£o, continue mostrando nos logs as coordenadas de cada destino, para f√°cil confer√™ncia.

Restri√ß√µes
N√£o altere nenhuma outra l√≥gica do sistema al√©m da montagem dos endere√ßos, valida√ß√£o e logs.

Mantenha qualquer fallback j√° existente para endere√ßos, mas priorize sempre o endere√ßo mais completo poss√≠vel.

Resumo das tarefas:

Implementar endpoint /api/optimize-trip no backend como proxy para o OSRM /trip.

No front, ajustar a chamada para esse endpoint ao otimizar rotas.

Sempre enviar endere√ßos completos (logradouro, n√∫mero, bairro, cidade, cep, estado, Brasil) para geocodifica√ß√£o das paradas.

Adicionar logs detalhados antes/depois de cada geocodifica√ß√£o.

Bloquear ou avisar se bairro/cidade faltarem em qualquer parada.

N√£o alterar nenhuma l√≥gica extra al√©m do que foi pedido acima.

Se poss√≠vel, mostre trechos de c√≥digo antes/depois para facilitar a confer√™ncia.