colocar um “X” em cada parada da lista do modal e remover direto da rota. Abaixo vai só o que você precisa acrescentar/alterar no RoutesHistoryPage.tsx.

1) Importar o ícone

No bloco dos imports do lucide-react:

import { /* ... */, Eye, Wand2, X } from "lucide-react";

2) Mutation para remover a parada

Cole perto das outras mutations:

const removeStopMutation = useMutation({
  mutationFn: async ({ routeId, stopId }: { routeId: string; stopId: string }) => {
    const res = await apiRequest("DELETE", `/api/routes/${routeId}/stops/${stopId}`);
    if (!res.ok) {
      let msg = "Erro ao remover parada";
      try {
        const j = await res.json();
        msg = j?.message || msg;
      } catch {}
      throw new Error(msg);
    }
    return res.json();
  },
  onSuccess: () => {
    toast({
      title: "Parada removida",
      description: "O agendamento foi retirado da rota.",
    });
    // recarrega detalhe da rota e listagem
    queryClient.invalidateQueries({ queryKey: ["/api/routes", selectedRoute] });
    queryClient.invalidateQueries({ queryKey: ["/api/routes"] });
  },
  onError: (err: any) => {
    toast({
      title: "Não foi possível remover",
      description: err?.message || "Tente novamente.",
      variant: "destructive",
    });
  },
});


E a função que chama essa mutation (pode ficar logo abaixo):

const handleRemoveStop = (stop: any) => {
  if (!routeDetail?.route?.id || !stop?.id) return;

  const nome = stop?.clientName || `Agendamento #${stop.appointmentId}`;
  const ok = window.confirm(`Remover ${nome} desta rota?`);
  if (!ok) return;

  removeStopMutation.mutate({ routeId: routeDetail.route.id, stopId: stop.id });
};

3) Botão “X” em cada parada

No trecho que renderiza cada parada dentro de:

{routeDetail.stops
  ?.slice()
  .sort((a, b) => (a.order ?? 0) - (b.order ?? 0))
  .map((stop) => (
    <div key={stop.id} className="flex items-start gap-3 p-3 bg-gray-50 rounded-lg">
      <div className="flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 bg-burnt-yellow text-white rounded-full flex items-center justify-center text-sm font-bold">
        {stop.order}
      </div>

      <div className="flex-1">
        <div className="font-medium text-sm">
          {stop.clientName ? stop.clientName : `Agendamento #${stop.appointmentId}`}
        </div>
        <div className="text-xs sm:text-sm text-gray-600 mt-1">{stop.address}</div>
        <div className="text-[11px] text-gray-500 mt-1">
          {stop.lat.toFixed(6)}, {stop.lng.toFixed(6)}
        </div>
      </div>

      {/* ⬇⬇⬇  BOTÃO REMOVER */}
      <button
        onClick={() => handleRemoveStop(stop)}
        disabled={removeStopMutation.isPending}
        className="ml-2 rounded-md p-1 text-gray-500 hover:text-red-600 hover:bg-red-50"
        title="Remover da rota"
        aria-label="Remover da rota"
      >
        <X className="h-4 w-4" />
      </button>
    </div>
))}


Pronto — isso coloca um “X” no canto direito de cada card e remove o stop pelo endpoint REST.

Backend (caso ainda não exista)

O front espera DELETE /api/routes/:routeId/stops/:stopId. Se precisar criar no Express/SQL:

// server
app.delete('/api/routes/:routeId/stops/:stopId', async (req, res) => {
  const { routeId, stopId } = req.params;
  try {
    await db.query('DELETE FROM route_stops WHERE id = $1 AND route_id = $2', [stopId, routeId]);
    // opcional: recalcular stops_count / polyline
    await db.query(`
      UPDATE routes r SET stops_count = (
        SELECT COUNT(*)::int FROM route_stops rs WHERE rs.route_id = r.id
      ), updated_at = now()
      WHERE r.id = $1
    `, [routeId]);

    res.json({ ok: true });
  } catch (e) {
    console.error(e);
    res.status(500).json({ message: 'Erro ao remover parada' });
  }
});


Se o seu backend já tiver outro formato (ex.: POST /stops/remove), é só ajustar a mutationFn para bater no endpoint correto.